<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 5 Generalized linear models (GLM) | Applied Biological Data Analysis</title>
  <meta name="description" content="Helping biologists to become more informed users of R and statistical methods." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 5 Generalized linear models (GLM) | Applied Biological Data Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://greenquanteco.github.io/index.html" />
  <meta property="og:image" content="https://greenquanteco.github.io/index.html/C:/Users/ngreen62/OneDrive - Kennesaw State University/ksu/website/lab_logo_02.jpg" />
  <meta property="og:description" content="Helping biologists to become more informed users of R and statistical methods." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 5 Generalized linear models (GLM) | Applied Biological Data Analysis" />
  
  <meta name="twitter:description" content="Helping biologists to become more informed users of R and statistical methods." />
  <meta name="twitter:image" content="https://greenquanteco.github.io/index.html/C:/Users/ngreen62/OneDrive - Kennesaw State University/ksu/website/lab_logo_02.jpg" />

<meta name="author" content="Nick Green, Kennesaw State University" />


<meta name="date" content="2022-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-mod-04.html"/>
<link rel="next" href="6-mod-06.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-permissions"><i class="fa fa-check"></i>License and permissions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-requirements"><i class="fa fa-check"></i>Course requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended-reading"><i class="fa fa-check"></i>Recommended reading</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-organization"><i class="fa fa-check"></i>Course organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="1-mod-01.html"><a href="1-mod-01.html"><i class="fa fa-check"></i><b>1</b> Statistics in modern biology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1-mod-01.html"><a href="1-mod-01.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="1-mod-01.html"><a href="1-mod-01.html#statistics-in-modern-biology"><i class="fa fa-check"></i><b>1.2</b> Statistics in modern biology</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="1-mod-01.html"><a href="1-mod-01.html#the-scientific-method"><i class="fa fa-check"></i><b>1.2.1</b> The scientific method</a></li>
<li class="chapter" data-level="1.2.2" data-path="1-mod-01.html"><a href="1-mod-01.html#example-data-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Example data analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="1-mod-01.html"><a href="1-mod-01.html#misuses-of-statistics"><i class="fa fa-check"></i><b>1.3</b> Misuses of statistics</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="1-mod-01.html"><a href="1-mod-01.html#proving-the-trivial-and-meaningless-hypotheses"><i class="fa fa-check"></i><b>1.3.1</b> “Proving” the trivial and meaningless hypotheses</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-mod-01.html"><a href="1-mod-01.html#inappropriate-methods"><i class="fa fa-check"></i><b>1.3.2</b> Inappropriate methods</a></li>
<li class="chapter" data-level="1.3.3" data-path="1-mod-01.html"><a href="1-mod-01.html#p-hacking-and-data-dredging"><i class="fa fa-check"></i><b>1.3.3</b> <em>P</em>-hacking and data dredging</a></li>
<li class="chapter" data-level="1.3.4" data-path="1-mod-01.html"><a href="1-mod-01.html#inadequate-sample-sizes-and-pseudoreplication"><i class="fa fa-check"></i><b>1.3.4</b> Inadequate sample sizes and pseudoreplication</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="1-mod-01.html"><a href="1-mod-01.html#p-values-and-null-hypothesis-significance-testing-nhst"><i class="fa fa-check"></i><b>1.4</b> <em>P</em>-values and null hypothesis significance testing (NHST)</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="1-mod-01.html"><a href="1-mod-01.html#definition"><i class="fa fa-check"></i><b>1.4.1</b> Definition</a></li>
<li class="chapter" data-level="1.4.2" data-path="1-mod-01.html"><a href="1-mod-01.html#history-and-status-of-p-values"><i class="fa fa-check"></i><b>1.4.2</b> History and status of <em>P</em>-values</a></li>
<li class="chapter" data-level="1.4.3" data-path="1-mod-01.html"><a href="1-mod-01.html#where-p-values-come-from"><i class="fa fa-check"></i><b>1.4.3</b> Where <em>P</em>-values come from</a></li>
<li class="chapter" data-level="1.4.4" data-path="1-mod-01.html"><a href="1-mod-01.html#what-p-values-mean-and-do-not-mean"><i class="fa fa-check"></i><b>1.4.4</b> What <em>P</em>-values mean and do not mean</a></li>
<li class="chapter" data-level="1.4.5" data-path="1-mod-01.html"><a href="1-mod-01.html#do-you-need-a-p-value"><i class="fa fa-check"></i><b>1.4.5</b> Do you need a <em>P</em>-value?</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="1-mod-01.html"><a href="1-mod-01.html#alternatives-to-nhst"><i class="fa fa-check"></i><b>1.5</b> Alternatives to NHST</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="1-mod-01.html"><a href="1-mod-01.html#bayesian-inference"><i class="fa fa-check"></i><b>1.5.1</b> Bayesian inference</a></li>
<li class="chapter" data-level="1.5.2" data-path="1-mod-01.html"><a href="1-mod-01.html#information-theoretic-methods"><i class="fa fa-check"></i><b>1.5.2</b> Information-theoretic methods</a></li>
<li class="chapter" data-level="1.5.3" data-path="1-mod-01.html"><a href="1-mod-01.html#machine-learning"><i class="fa fa-check"></i><b>1.5.3</b> Machine learning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-mod-02.html"><a href="2-mod-02.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-mod-02.html"><a href="2-mod-02.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.1</b> Getting started with R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="2-mod-02.html"><a href="2-mod-02.html#what-is-r"><i class="fa fa-check"></i><b>2.1.1</b> What is R?</a></li>
<li class="chapter" data-level="2.1.2" data-path="2-mod-02.html"><a href="2-mod-02.html#advantages-of-r"><i class="fa fa-check"></i><b>2.1.2</b> Advantages of R</a></li>
<li class="chapter" data-level="2.1.3" data-path="2-mod-02.html"><a href="2-mod-02.html#disadvantages-of-r"><i class="fa fa-check"></i><b>2.1.3</b> Disadvantages of R</a></li>
<li class="chapter" data-level="2.1.4" data-path="2-mod-02.html"><a href="2-mod-02.html#base-r-and-vs.-tidyverse"><i class="fa fa-check"></i><b>2.1.4</b> Base R and (vs.?) <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-mod-02.html"><a href="2-mod-02.html#download-and-install-r-and-rstudio"><i class="fa fa-check"></i><b>2.2</b> Download and install R (and RStudio)</a></li>
<li class="chapter" data-level="2.3" data-path="2-mod-02.html"><a href="2-mod-02.html#using-r"><i class="fa fa-check"></i><b>2.3</b> Using R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="2-mod-02.html"><a href="2-mod-02.html#using-the-base-r-gui"><i class="fa fa-check"></i><b>2.3.1</b> Using the base R GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-mod-02.html"><a href="2-mod-02.html#using-r-in-rstudio"><i class="fa fa-check"></i><b>2.3.2</b> Using R in RStudio</a></li>
<li class="chapter" data-level="2.3.3" data-path="2-mod-02.html"><a href="2-mod-02.html#using-r-with-other-programs"><i class="fa fa-check"></i><b>2.3.3</b> Using R with other programs</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="2-mod-02.html"><a href="2-mod-02.html#mod-02-first"><i class="fa fa-check"></i><b>2.4</b> A first R session</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="2-mod-02.html"><a href="2-mod-02.html#import-data"><i class="fa fa-check"></i><b>2.4.1</b> Import data</a></li>
<li class="chapter" data-level="2.4.2" data-path="2-mod-02.html"><a href="2-mod-02.html#explore-and-visualize-data"><i class="fa fa-check"></i><b>2.4.2</b> Explore and visualize data</a></li>
<li class="chapter" data-level="2.4.3" data-path="2-mod-02.html"><a href="2-mod-02.html#transform-data"><i class="fa fa-check"></i><b>2.4.3</b> Transform data</a></li>
<li class="chapter" data-level="2.4.4" data-path="2-mod-02.html"><a href="2-mod-02.html#analyze-data"><i class="fa fa-check"></i><b>2.4.4</b> Analyze data</a></li>
<li class="chapter" data-level="2.4.5" data-path="2-mod-02.html"><a href="2-mod-02.html#write-out-results"><i class="fa fa-check"></i><b>2.4.5</b> Write out results</a></li>
<li class="chapter" data-level="2.4.6" data-path="2-mod-02.html"><a href="2-mod-02.html#save-your-work"><i class="fa fa-check"></i><b>2.4.6</b> Save your work?</a></li>
<li class="chapter" data-level="2.4.7" data-path="2-mod-02.html"><a href="2-mod-02.html#whats-next"><i class="fa fa-check"></i><b>2.4.7</b> What’s next?</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="2-mod-02.html"><a href="2-mod-02.html#write-and-execute-commands-in-the-r-console"><i class="fa fa-check"></i><b>2.5</b> Write and execute commands in the R console</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="2-mod-02.html"><a href="2-mod-02.html#r-commandsbasics"><i class="fa fa-check"></i><b>2.5.1</b> R commands–basics</a></li>
<li class="chapter" data-level="2.5.2" data-path="2-mod-02.html"><a href="2-mod-02.html#elements-of-r-code"><i class="fa fa-check"></i><b>2.5.2</b> Elements of R code</a></li>
<li class="chapter" data-level="2.5.3" data-path="2-mod-02.html"><a href="2-mod-02.html#the-r-workspace"><i class="fa fa-check"></i><b>2.5.3</b> The R workspace</a></li>
<li class="chapter" data-level="2.5.4" data-path="2-mod-02.html"><a href="2-mod-02.html#r-code-basics-assignment-and-operators"><i class="fa fa-check"></i><b>2.5.4</b> R code basics: assignment and operators</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="2-mod-02.html"><a href="2-mod-02.html#mod-02-struct"><i class="fa fa-check"></i><b>2.6</b> Basic R data structures</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="2-mod-02.html"><a href="2-mod-02.html#vectors"><i class="fa fa-check"></i><b>2.6.1</b> Vectors</a></li>
<li class="chapter" data-level="2.6.2" data-path="2-mod-02.html"><a href="2-mod-02.html#data-frames"><i class="fa fa-check"></i><b>2.6.2</b> Data frames</a></li>
<li class="chapter" data-level="2.6.3" data-path="2-mod-02.html"><a href="2-mod-02.html#matrices-and-arrays"><i class="fa fa-check"></i><b>2.6.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="2.6.4" data-path="2-mod-02.html"><a href="2-mod-02.html#lists"><i class="fa fa-check"></i><b>2.6.4</b> Lists</a></li>
<li class="chapter" data-level="2.6.5" data-path="2-mod-02.html"><a href="2-mod-02.html#s4-objects"><i class="fa fa-check"></i><b>2.6.5</b> S4 objects</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="2-mod-02.html"><a href="2-mod-02.html#r-data-types"><i class="fa fa-check"></i><b>2.7</b> R data types</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="2-mod-02.html"><a href="2-mod-02.html#character-type"><i class="fa fa-check"></i><b>2.7.1</b> Character type</a></li>
<li class="chapter" data-level="2.7.2" data-path="2-mod-02.html"><a href="2-mod-02.html#numeric-type"><i class="fa fa-check"></i><b>2.7.2</b> Numeric type</a></li>
<li class="chapter" data-level="2.7.3" data-path="2-mod-02.html"><a href="2-mod-02.html#integer-type"><i class="fa fa-check"></i><b>2.7.3</b> Integer type</a></li>
<li class="chapter" data-level="2.7.4" data-path="2-mod-02.html"><a href="2-mod-02.html#logical-type"><i class="fa fa-check"></i><b>2.7.4</b> Logical type</a></li>
<li class="chapter" data-level="2.7.5" data-path="2-mod-02.html"><a href="2-mod-02.html#special-values"><i class="fa fa-check"></i><b>2.7.5</b> Special values</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="2-mod-02.html"><a href="2-mod-02.html#manage-r-code-as-scripts-.r-files"><i class="fa fa-check"></i><b>2.8</b> Manage R code as scripts (.r files)</a></li>
<li class="chapter" data-level="2.9" data-path="2-mod-02.html"><a href="2-mod-02.html#manage-and-use-r-packages"><i class="fa fa-check"></i><b>2.9</b> Manage and use R packages</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="2-mod-02.html"><a href="2-mod-02.html#your-r-library"><i class="fa fa-check"></i><b>2.9.1</b> Your R library</a></li>
<li class="chapter" data-level="2.9.2" data-path="2-mod-02.html"><a href="2-mod-02.html#installing-packages-using-the-r-gui"><i class="fa fa-check"></i><b>2.9.2</b> Installing packages using the R GUI</a></li>
<li class="chapter" data-level="2.9.3" data-path="2-mod-02.html"><a href="2-mod-02.html#installing-packages-in-rstudio"><i class="fa fa-check"></i><b>2.9.3</b> Installing packages in RStudio</a></li>
<li class="chapter" data-level="2.9.4" data-path="2-mod-02.html"><a href="2-mod-02.html#installing-packages-using-the-r-console"><i class="fa fa-check"></i><b>2.9.4</b> Installing packages using the R console</a></li>
<li class="chapter" data-level="2.9.5" data-path="2-mod-02.html"><a href="2-mod-02.html#working-with-packages-in-r"><i class="fa fa-check"></i><b>2.9.5</b> Working with packages in R</a></li>
<li class="chapter" data-level="2.9.6" data-path="2-mod-02.html"><a href="2-mod-02.html#package-dependencies"><i class="fa fa-check"></i><b>2.9.6</b> Package dependencies</a></li>
<li class="chapter" data-level="2.9.7" data-path="2-mod-02.html"><a href="2-mod-02.html#citing-packages"><i class="fa fa-check"></i><b>2.9.7</b> Citing packages</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="2-mod-02.html"><a href="2-mod-02.html#r-documentation"><i class="fa fa-check"></i><b>2.10</b> R documentation</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="2-mod-02.html"><a href="2-mod-02.html#documentation-help-files"><i class="fa fa-check"></i><b>2.10.1</b> Documentation (help) files</a></li>
<li class="chapter" data-level="2.10.2" data-path="2-mod-02.html"><a href="2-mod-02.html#r-vignettes"><i class="fa fa-check"></i><b>2.10.2</b> R vignettes</a></li>
<li class="chapter" data-level="2.10.3" data-path="2-mod-02.html"><a href="2-mod-02.html#official-r-project-resources"><i class="fa fa-check"></i><b>2.10.3</b> Official R Project resources</a></li>
<li class="chapter" data-level="2.10.4" data-path="2-mod-02.html"><a href="2-mod-02.html#unofficial-online-resources"><i class="fa fa-check"></i><b>2.10.4</b> Unofficial online resources</a></li>
<li class="chapter" data-level="2.10.5" data-path="2-mod-02.html"><a href="2-mod-02.html#r-books"><i class="fa fa-check"></i><b>2.10.5</b> R books</a></li>
<li class="chapter" data-level="2.10.6" data-path="2-mod-02.html"><a href="2-mod-02.html#two-reminders"><i class="fa fa-check"></i><b>2.10.6</b> Two reminders</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-mod-03.html"><a href="3-mod-03.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-mod-03.html"><a href="3-mod-03.html#mod-03-inout"><i class="fa fa-check"></i><b>3.1</b> Data import and export</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-mod-03.html"><a href="3-mod-03.html#importing-data-preliminaries"><i class="fa fa-check"></i><b>3.1.1</b> Importing data: preliminaries</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-mod-03.html"><a href="3-mod-03.html#importing-data-from-text-files-with-read.csv-and-read.table"><i class="fa fa-check"></i><b>3.1.2</b> Importing data from text files with <code>read.csv()</code> and <code>read.table()</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="3-mod-03.html"><a href="3-mod-03.html#importing-data-from-saved-workspaces"><i class="fa fa-check"></i><b>3.1.3</b> Importing data from saved workspaces</a></li>
<li class="chapter" data-level="3.1.4" data-path="3-mod-03.html"><a href="3-mod-03.html#importing-data-special-cases"><i class="fa fa-check"></i><b>3.1.4</b> Importing data: special cases:</a></li>
<li class="chapter" data-level="3.1.5" data-path="3-mod-03.html"><a href="3-mod-03.html#export-data-from-r"><i class="fa fa-check"></i><b>3.1.5</b> Export data from R</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-mod-03.html"><a href="3-mod-03.html#making-values-in-r"><i class="fa fa-check"></i><b>3.2</b> Making values in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="3-mod-03.html"><a href="3-mod-03.html#producing-arbitrary-values-with-c"><i class="fa fa-check"></i><b>3.2.1</b> Producing arbitrary values with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="3-mod-03.html"><a href="3-mod-03.html#generating-regular-values"><i class="fa fa-check"></i><b>3.2.2</b> Generating regular values</a></li>
<li class="chapter" data-level="3.2.3" data-path="3-mod-03.html"><a href="3-mod-03.html#generating-random-values"><i class="fa fa-check"></i><b>3.2.3</b> Generating random values</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-mod-03.html"><a href="3-mod-03.html#selecting-data-with"><i class="fa fa-check"></i><b>3.3</b> Selecting data with <code>[]</code></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="3-mod-03.html"><a href="3-mod-03.html#mod-03-brackets"><i class="fa fa-check"></i><b>3.3.1</b> Basics of brackets</a></li>
<li class="chapter" data-level="3.3.2" data-path="3-mod-03.html"><a href="3-mod-03.html#extracting-and-selecting-data-with-logical-tests"><i class="fa fa-check"></i><b>3.3.2</b> Extracting and selecting data with logical tests</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-mod-03.html"><a href="3-mod-03.html#managing-dates-and-characters"><i class="fa fa-check"></i><b>3.4</b> Managing dates and characters</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="3-mod-03.html"><a href="3-mod-03.html#temporal-data-and-dates"><i class="fa fa-check"></i><b>3.4.1</b> Temporal data and dates</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-mod-03.html"><a href="3-mod-03.html#character-data-text"><i class="fa fa-check"></i><b>3.4.2</b> Character data (text)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="3-mod-03.html"><a href="3-mod-03.html#mod-03-dataframe"><i class="fa fa-check"></i><b>3.5</b> Data frame management</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="3-mod-03.html"><a href="3-mod-03.html#data-frame-structure"><i class="fa fa-check"></i><b>3.5.1</b> Data frame structure</a></li>
<li class="chapter" data-level="3.5.2" data-path="3-mod-03.html"><a href="3-mod-03.html#common-data-frame-operations"><i class="fa fa-check"></i><b>3.5.2</b> Common data frame operations</a></li>
<li class="chapter" data-level="3.5.3" data-path="3-mod-03.html"><a href="3-mod-03.html#other-data-frame-operations"><i class="fa fa-check"></i><b>3.5.3</b> Other data frame operations</a></li>
<li class="chapter" data-level="3.5.4" data-path="3-mod-03.html"><a href="3-mod-03.html#mod-03-reshape"><i class="fa fa-check"></i><b>3.5.4</b> Reshaping data frames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-mod-04.html"><a href="4-mod-04.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-mod-04.html"><a href="4-mod-04.html#descriptive-and-summary-statistics"><i class="fa fa-check"></i><b>4.1</b> Descriptive and summary statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4-mod-04.html"><a href="4-mod-04.html#basic-summary-statistics"><i class="fa fa-check"></i><b>4.1.1</b> Basic summary statistics</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-mod-04.html"><a href="4-mod-04.html#summarizing-data-with-the-apply-family"><i class="fa fa-check"></i><b>4.1.2</b> Summarizing data with the <code>apply()</code> family</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-tabagg"><i class="fa fa-check"></i><b>4.1.3</b> Tabulation and aggregation</a></li>
<li class="chapter" data-level="4.1.4" data-path="4-mod-04.html"><a href="4-mod-04.html#aggregation-aka-pivot-tables"><i class="fa fa-check"></i><b>4.1.4</b> Aggregation (aka: pivot tables)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-vis"><i class="fa fa-check"></i><b>4.2</b> Visualizing data distributions</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="4-mod-04.html"><a href="4-mod-04.html#boxplots-aka-box-and-whisker-plots"><i class="fa fa-check"></i><b>4.2.1</b> Boxplots (aka: box-and-whisker plots)</a></li>
<li class="chapter" data-level="4.2.2" data-path="4-mod-04.html"><a href="4-mod-04.html#histograms"><i class="fa fa-check"></i><b>4.2.2</b> Histograms</a></li>
<li class="chapter" data-level="4.2.3" data-path="4-mod-04.html"><a href="4-mod-04.html#kernel-density-plots"><i class="fa fa-check"></i><b>4.2.3</b> Kernel density plots</a></li>
<li class="chapter" data-level="4.2.4" data-path="4-mod-04.html"><a href="4-mod-04.html#empirical-cumulative-distribution-plots-ecdf"><i class="fa fa-check"></i><b>4.2.4</b> Empirical cumulative distribution plots (ECDF)</a></li>
<li class="chapter" data-level="4.2.5" data-path="4-mod-04.html"><a href="4-mod-04.html#quantile-quantile-qq-plots"><i class="fa fa-check"></i><b>4.2.5</b> Quantile-quantile (QQ) plots</a></li>
<li class="chapter" data-level="4.2.6" data-path="4-mod-04.html"><a href="4-mod-04.html#how-should-i-plot-my-data"><i class="fa fa-check"></i><b>4.2.6</b> How should I plot my data?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-dists1"><i class="fa fa-check"></i><b>4.3</b> Statistical distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="4-mod-04.html"><a href="4-mod-04.html#probability-distributions"><i class="fa fa-check"></i><b>4.3.1</b> Probability distributions</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-mod-04.html"><a href="4-mod-04.html#probability-distributions-in-r"><i class="fa fa-check"></i><b>4.3.2</b> Probability distributions in R</a></li>
<li class="chapter" data-level="4.3.3" data-path="4-mod-04.html"><a href="4-mod-04.html#discrete-distributions"><i class="fa fa-check"></i><b>4.3.3</b> Discrete distributions</a></li>
<li class="chapter" data-level="4.3.4" data-path="4-mod-04.html"><a href="4-mod-04.html#continuous-distributions"><i class="fa fa-check"></i><b>4.3.4</b> Continuous distributions</a></li>
<li class="chapter" data-level="4.3.5" data-path="4-mod-04.html"><a href="4-mod-04.html#distributions-summary"><i class="fa fa-check"></i><b>4.3.5</b> Distributions summary</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-dists2"><i class="fa fa-check"></i><b>4.4</b> Fitting and testing distributions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="4-mod-04.html"><a href="4-mod-04.html#estimating-distributional-parameters"><i class="fa fa-check"></i><b>4.4.1</b> Estimating distributional parameters</a></li>
<li class="chapter" data-level="4.4.2" data-path="4-mod-04.html"><a href="4-mod-04.html#graphical-methods-for-examining-distributions"><i class="fa fa-check"></i><b>4.4.2</b> Graphical methods for examining distributions</a></li>
<li class="chapter" data-level="4.4.3" data-path="4-mod-04.html"><a href="4-mod-04.html#formal-tests-for-distributions"><i class="fa fa-check"></i><b>4.4.3</b> Formal tests for distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-trans"><i class="fa fa-check"></i><b>4.5</b> Data transformations</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="4-mod-04.html"><a href="4-mod-04.html#why-transform"><i class="fa fa-check"></i><b>4.5.1</b> Why transform?</a></li>
<li class="chapter" data-level="4.5.2" data-path="4-mod-04.html"><a href="4-mod-04.html#transforms-vs.-link-functions"><i class="fa fa-check"></i><b>4.5.2</b> Transforms vs. link functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="4-mod-04.html"><a href="4-mod-04.html#log-transformation"><i class="fa fa-check"></i><b>4.5.3</b> Log transformation</a></li>
<li class="chapter" data-level="4.5.4" data-path="4-mod-04.html"><a href="4-mod-04.html#rank-transformation"><i class="fa fa-check"></i><b>4.5.4</b> Rank transformation</a></li>
<li class="chapter" data-level="4.5.5" data-path="4-mod-04.html"><a href="4-mod-04.html#other-transforms-less-common"><i class="fa fa-check"></i><b>4.5.5</b> Other transforms (less common)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="4-mod-04.html"><a href="4-mod-04.html#multivariate-data-exploration"><i class="fa fa-check"></i><b>4.6</b> Multivariate data exploration</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="4-mod-04.html"><a href="4-mod-04.html#scatterplots-for-two-variables"><i class="fa fa-check"></i><b>4.6.1</b> Scatterplots for two variables</a></li>
<li class="chapter" data-level="4.6.2" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-smat"><i class="fa fa-check"></i><b>4.6.2</b> Scatterplot matrices for many variables</a></li>
<li class="chapter" data-level="4.6.3" data-path="4-mod-04.html"><a href="4-mod-04.html#lattice-plots-for-hierarchical-data"><i class="fa fa-check"></i><b>4.6.3</b> Lattice plots for hierarchical data</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="4-mod-04.html"><a href="4-mod-04.html#ordination-brief-introduction"><i class="fa fa-check"></i><b>4.7</b> Ordination (brief introduction)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="4-mod-04.html"><a href="4-mod-04.html#principal-components-analysis-pca"><i class="fa fa-check"></i><b>4.7.1</b> Principal components analysis (PCA)</a></li>
<li class="chapter" data-level="4.7.2" data-path="4-mod-04.html"><a href="4-mod-04.html#nonmetric-multidimensional-scaling-nmds"><i class="fa fa-check"></i><b>4.7.2</b> Nonmetric multidimensional scaling (NMDS)</a></li>
<li class="chapter" data-level="4.7.3" data-path="4-mod-04.html"><a href="4-mod-04.html#plotting-ordinations"><i class="fa fa-check"></i><b>4.7.3</b> Plotting ordinations</a></li>
<li class="chapter" data-level="4.7.4" data-path="4-mod-04.html"><a href="4-mod-04.html#ordination-wrap-up-for-now"><i class="fa fa-check"></i><b>4.7.4</b> Ordination wrap-up (for now)</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-prob"><i class="fa fa-check"></i><b>4.8</b> Common statistical problems</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="4-mod-04.html"><a href="4-mod-04.html#outliers-and-erroneous-values"><i class="fa fa-check"></i><b>4.8.1</b> Outliers and erroneous values</a></li>
<li class="chapter" data-level="4.8.2" data-path="4-mod-04.html"><a href="4-mod-04.html#autocorrelation"><i class="fa fa-check"></i><b>4.8.2</b> Autocorrelation</a></li>
<li class="chapter" data-level="4.8.3" data-path="4-mod-04.html"><a href="4-mod-04.html#mod-04-multicol"><i class="fa fa-check"></i><b>4.8.3</b> Collinearity</a></li>
<li class="chapter" data-level="4.8.4" data-path="4-mod-04.html"><a href="4-mod-04.html#missing-data"><i class="fa fa-check"></i><b>4.8.4</b> Missing data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-mod-05.html"><a href="5-mod-05.html"><i class="fa fa-check"></i><b>5</b> Generalized linear models (GLM)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-lm"><i class="fa fa-check"></i><b>5.1</b> Prelude with linear models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="5-mod-05.html"><a href="5-mod-05.html#assumptions-of-linear-models"><i class="fa fa-check"></i><b>5.1.1</b> Assumptions of linear models</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-mod-05.html"><a href="5-mod-05.html#linear-regression-in-r"><i class="fa fa-check"></i><b>5.1.2</b> Linear regression in R</a></li>
<li class="chapter" data-level="5.1.3" data-path="5-mod-05.html"><a href="5-mod-05.html#multiple-linear-regression"><i class="fa fa-check"></i><b>5.1.3</b> Multiple linear regression</a></li>
<li class="chapter" data-level="5.1.4" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-anova"><i class="fa fa-check"></i><b>5.1.4</b> ANOVA and ANCOVA with <code>lm()</code></a></li>
<li class="chapter" data-level="5.1.5" data-path="5-mod-05.html"><a href="5-mod-05.html#variations-on-linear-models"><i class="fa fa-check"></i><b>5.1.5</b> Variations on linear models</a></li>
<li class="chapter" data-level="5.1.6" data-path="5-mod-05.html"><a href="5-mod-05.html#example-linear-regression-workflow"><i class="fa fa-check"></i><b>5.1.6</b> Example linear regression workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-basic"><i class="fa fa-check"></i><b>5.2</b> GLM basics</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5-mod-05.html"><a href="5-mod-05.html#example-glms"><i class="fa fa-check"></i><b>5.2.1</b> Example GLMS</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-mod-05.html"><a href="5-mod-05.html#glm-families"><i class="fa fa-check"></i><b>5.2.2</b> GLM families</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-mod-05.html"><a href="5-mod-05.html#glm-link-functions"><i class="fa fa-check"></i><b>5.2.3</b> GLM link functions</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-mod-05.html"><a href="5-mod-05.html#deviance-and-other-glm-diagnostics"><i class="fa fa-check"></i><b>5.2.4</b> Deviance and other GLM diagnostics</a></li>
<li class="chapter" data-level="5.2.5" data-path="5-mod-05.html"><a href="5-mod-05.html#to-pseudo-r2-or-not-to-pseudo-r2"><i class="fa fa-check"></i><b>5.2.5</b> To pseudo-<em>R</em><sup>2</sup> or not to pseudo-<em>R</em><sup>2</sup>?</a></li>
<li class="chapter" data-level="5.2.6" data-path="5-mod-05.html"><a href="5-mod-05.html#common-glms"><i class="fa fa-check"></i><b>5.2.6</b> Common GLMs</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-loglin"><i class="fa fa-check"></i><b>5.3</b> Log-linear models</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-loglin-examp"><i class="fa fa-check"></i><b>5.3.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.3.2" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-real-data"><i class="fa fa-check"></i><b>5.3.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-poisson"><i class="fa fa-check"></i><b>5.4</b> Poisson GLM for counts</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-simulated-data"><i class="fa fa-check"></i><b>5.4.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.4.2" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-real-data-1"><i class="fa fa-check"></i><b>5.4.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-quasi"><i class="fa fa-check"></i><b>5.5</b> Quasi-Poisson and negative binomial GLM</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-simulated-data-1"><i class="fa fa-check"></i><b>5.5.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.5.2" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-real-data-2"><i class="fa fa-check"></i><b>5.5.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-logistic"><i class="fa fa-check"></i><b>5.6</b> Logistic regression for binary outcomes</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-simulated-data-2"><i class="fa fa-check"></i><b>5.6.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.6.2" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-real-data-3"><i class="fa fa-check"></i><b>5.6.2</b> Example with real data</a></li>
<li class="chapter" data-level="5.6.3" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-auc"><i class="fa fa-check"></i><b>5.6.3</b> Logistic GLM diagnostics: AUC and ROC</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-binom"><i class="fa fa-check"></i><b>5.7</b> Binomial GLM for proportional data</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="5-mod-05.html"><a href="5-mod-05.html#binomial-glm"><i class="fa fa-check"></i><b>5.7.1</b> Binomial GLM</a></li>
<li class="chapter" data-level="5.7.2" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-simulated-data-3"><i class="fa fa-check"></i><b>5.7.2</b> Example with simulated data</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-gamma"><i class="fa fa-check"></i><b>5.8</b> Gamma models for overdispersed data</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="5-mod-05.html"><a href="5-mod-05.html#example-with-simulated-data-4"><i class="fa fa-check"></i><b>5.8.1</b> Example with simulated data</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-beyond"><i class="fa fa-check"></i><b>5.9</b> Beyond GLM: Overview of GAM and GEE</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-gam"><i class="fa fa-check"></i><b>5.9.1</b> Generalized additive models (GAM)</a></li>
<li class="chapter" data-level="5.9.2" data-path="5-mod-05.html"><a href="5-mod-05.html#mod-05-gee"><i class="fa fa-check"></i><b>5.9.2</b> Generalized estimating equations (GEE)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-mod-06.html"><a href="6-mod-06.html"><i class="fa fa-check"></i><b>6</b> Nonlinear models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-mod-06.html"><a href="6-mod-06.html#background"><i class="fa fa-check"></i><b>6.1</b> Background</a></li>
<li class="chapter" data-level="6.2" data-path="6-mod-06.html"><a href="6-mod-06.html#mod-06-intro"><i class="fa fa-check"></i><b>6.2</b> Nonlinear least squares (NLS)</a></li>
<li class="chapter" data-level="6.3" data-path="6-mod-06.html"><a href="6-mod-06.html#mod-06-micmen"><i class="fa fa-check"></i><b>6.3</b> Michaelis-Menten curves</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="6-mod-06.html"><a href="6-mod-06.html#mod-06-micmen-sim"><i class="fa fa-check"></i><b>6.3.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="6.3.2" data-path="6-mod-06.html"><a href="6-mod-06.html#example-with-real-data-4"><i class="fa fa-check"></i><b>6.3.2</b> Example with real data</a></li>
<li class="chapter" data-level="6.3.3" data-path="6-mod-06.html"><a href="6-mod-06.html#alternative-strategies-for-the-analysis"><i class="fa fa-check"></i><b>6.3.3</b> Alternative strategies for the analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="6-mod-06.html"><a href="6-mod-06.html#mod-06-grow"><i class="fa fa-check"></i><b>6.4</b> Biological growth curves</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="6-mod-06.html"><a href="6-mod-06.html#gompertz-and-von-bertalanffy-curves"><i class="fa fa-check"></i><b>6.4.1</b> Gompertz and von Bertalanffy curves</a></li>
<li class="chapter" data-level="6.4.2" data-path="6-mod-06.html"><a href="6-mod-06.html#example-with-real-data-5"><i class="fa fa-check"></i><b>6.4.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="6-mod-06.html"><a href="6-mod-06.html#dose-response-curves"><i class="fa fa-check"></i><b>6.5</b> Dose response curves</a></li>
<li class="chapter" data-level="6.6" data-path="6-mod-06.html"><a href="6-mod-06.html#alternatives-to-nls"><i class="fa fa-check"></i><b>6.6</b> Alternatives to NLS</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="6-mod-06.html"><a href="6-mod-06.html#generalized-nonlinear-models"><i class="fa fa-check"></i><b>6.6.1</b> Generalized nonlinear models</a></li>
<li class="chapter" data-level="6.6.2" data-path="6-mod-06.html"><a href="6-mod-06.html#quantile-regression"><i class="fa fa-check"></i><b>6.6.2</b> Quantile regression</a></li>
<li class="chapter" data-level="6.6.3" data-path="6-mod-06.html"><a href="6-mod-06.html#mod-06-gam"><i class="fa fa-check"></i><b>6.6.3</b> Generalized additive models (GAM)</a></li>
<li class="chapter" data-level="6.6.4" data-path="6-mod-06.html"><a href="6-mod-06.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.6.4</b> Classification and regression trees (CART)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-mod-07.html"><a href="7-mod-07.html"><i class="fa fa-check"></i><b>7</b> Mixed models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-mod-07.html"><a href="7-mod-07.html#prelude-glm"><i class="fa fa-check"></i><b>7.1</b> Prelude (GLM)</a></li>
<li class="chapter" data-level="7.2" data-path="7-mod-07.html"><a href="7-mod-07.html#mod-07-lmm"><i class="fa fa-check"></i><b>7.2</b> Linear mixed models (LMM)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7-mod-07.html"><a href="7-mod-07.html#formal-definition-and-example"><i class="fa fa-check"></i><b>7.2.1</b> Formal definition and example</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-mod-07.html"><a href="7-mod-07.html#example-with-simulated-data-5"><i class="fa fa-check"></i><b>7.2.2</b> Example with simulated data</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-mod-07.html"><a href="7-mod-07.html#p-values-in-lmm"><i class="fa fa-check"></i><b>7.2.3</b> <em>P</em>-values in LMM</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-mod-07.html"><a href="7-mod-07.html#specifying-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Specifying random effects</a></li>
<li class="chapter" data-level="7.2.5" data-path="7-mod-07.html"><a href="7-mod-07.html#lmm-example-with-real-data"><i class="fa fa-check"></i><b>7.2.5</b> LMM example with real data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-mod-07.html"><a href="7-mod-07.html#mod-07-glmm"><i class="fa fa-check"></i><b>7.3</b> Generalized linear mixed models (GLMM)</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="7-mod-07.html"><a href="7-mod-07.html#definition-1"><i class="fa fa-check"></i><b>7.3.1</b> Definition</a></li>
<li class="chapter" data-level="7.3.2" data-path="7-mod-07.html"><a href="7-mod-07.html#glmm-on-simulated-data"><i class="fa fa-check"></i><b>7.3.2</b> GLMM on simulated data</a></li>
<li class="chapter" data-level="7.3.3" data-path="7-mod-07.html"><a href="7-mod-07.html#glmm-on-real-data"><i class="fa fa-check"></i><b>7.3.3</b> GLMM on real data</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="7-mod-07.html"><a href="7-mod-07.html#mod-07-nlme"><i class="fa fa-check"></i><b>7.4</b> Nonlinear mixed models (NLME)</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="7-mod-07.html"><a href="7-mod-07.html#definition-and-background"><i class="fa fa-check"></i><b>7.4.1</b> Definition and background</a></li>
<li class="chapter" data-level="7.4.2" data-path="7-mod-07.html"><a href="7-mod-07.html#nlme-on-simulated-data"><i class="fa fa-check"></i><b>7.4.2</b> NLME on simulated data</a></li>
<li class="chapter" data-level="7.4.3" data-path="7-mod-07.html"><a href="7-mod-07.html#nlme-on-real-data"><i class="fa fa-check"></i><b>7.4.3</b> NLME on real data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="7-mod-07.html"><a href="7-mod-07.html#mod-07-gamm"><i class="fa fa-check"></i><b>7.5</b> (Generalized) additive mixed models (AMM/GAMM)</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="7-mod-07.html"><a href="7-mod-07.html#example-gamm-with-real-data"><i class="fa fa-check"></i><b>7.5.1</b> Example GAMM with real data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-mod-08.html"><a href="8-mod-08.html"><i class="fa fa-check"></i><b>8</b> Multivariate data analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8-mod-08.html"><a href="8-mod-08.html#multivariate-data"><i class="fa fa-check"></i><b>8.1</b> Multivariate data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="8-mod-08.html"><a href="8-mod-08.html#univariate-vs.-multivariate-data"><i class="fa fa-check"></i><b>8.1.1</b> Univariate vs. multivariate data</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-mod-08.html"><a href="8-mod-08.html#components-of-multivariate-data"><i class="fa fa-check"></i><b>8.1.2</b> Components of multivariate data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-mod-08.html"><a href="8-mod-08.html#mod-08-dist"><i class="fa fa-check"></i><b>8.2</b> Distance metrics: biological (dis)similarity</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8-mod-08.html"><a href="8-mod-08.html#euclidean-distance"><i class="fa fa-check"></i><b>8.2.1</b> Euclidean distance</a></li>
<li class="chapter" data-level="8.2.2" data-path="8-mod-08.html"><a href="8-mod-08.html#bray-curtis-and-other-distance-metrics"><i class="fa fa-check"></i><b>8.2.2</b> Bray-Curtis and other distance metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="8-mod-08.html"><a href="8-mod-08.html#clustering"><i class="fa fa-check"></i><b>8.3</b> Clustering</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="8-mod-08.html"><a href="8-mod-08.html#k-means-clustering"><i class="fa fa-check"></i><b>8.3.1</b> <em>K</em>-means clustering</a></li>
<li class="chapter" data-level="8.3.2" data-path="8-mod-08.html"><a href="8-mod-08.html#hierarchical-agglomerative-clustering"><i class="fa fa-check"></i><b>8.3.2</b> Hierarchical agglomerative clustering</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="8-mod-08.html"><a href="8-mod-08.html#mod-08-sims"><i class="fa fa-check"></i><b>8.4</b> Analyzing dissimilarity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="8-mod-08.html"><a href="8-mod-08.html#mantel-tests-distance-vs.-distance"><i class="fa fa-check"></i><b>8.4.1</b> Mantel tests: distance vs. distance</a></li>
<li class="chapter" data-level="8.4.2" data-path="8-mod-08.html"><a href="8-mod-08.html#comparing-dissimilarity-between-groups"><i class="fa fa-check"></i><b>8.4.2</b> Comparing dissimilarity between groups</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="8-mod-08.html"><a href="8-mod-08.html#mod-08-ord"><i class="fa fa-check"></i><b>8.5</b> Ordination</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="8-mod-08.html"><a href="8-mod-08.html#principal-components-analysis-pca-1"><i class="fa fa-check"></i><b>8.5.1</b> Principal components analysis (PCA)</a></li>
<li class="chapter" data-level="8.5.2" data-path="8-mod-08.html"><a href="8-mod-08.html#nmds-and-other-ordination-methods"><i class="fa fa-check"></i><b>8.5.2</b> NMDS and other ordination methods</a></li>
<li class="chapter" data-level="8.5.3" data-path="8-mod-08.html"><a href="8-mod-08.html#other-ordination-techniques"><i class="fa fa-check"></i><b>8.5.3</b> Other ordination techniques</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-mod-09.html"><a href="9-mod-09.html"><i class="fa fa-check"></i><b>9</b> Planning your analysis (what test?)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="9-mod-09.html"><a href="9-mod-09.html#how-to-use-this-guide"><i class="fa fa-check"></i><b>9.1</b> How to use this guide</a></li>
<li class="chapter" data-level="9.2" data-path="9-mod-09.html"><a href="9-mod-09.html#what-question-are-you-trying-to-answer"><i class="fa fa-check"></i><b>9.2</b> What question are you trying to answer?</a></li>
<li class="chapter" data-level="9.3" data-path="9-mod-09.html"><a href="9-mod-09.html#testing-for-a-difference-in-mean-or-location"><i class="fa fa-check"></i><b>9.3</b> Testing for a difference in mean or location</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="9-mod-09.html"><a href="9-mod-09.html#additional-considerations"><i class="fa fa-check"></i><b>9.3.1</b> Additional considerations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="9-mod-09.html"><a href="9-mod-09.html#testing-for-a-continuous-relationship-between-two-or-more-variables"><i class="fa fa-check"></i><b>9.4</b> Testing for a continuous relationship between two or more variables</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="9-mod-09.html"><a href="9-mod-09.html#additional-considerations-1"><i class="fa fa-check"></i><b>9.4.1</b> Additional considerations</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="9-mod-09.html"><a href="9-mod-09.html#classifying-observations"><i class="fa fa-check"></i><b>9.5</b> Classifying observations</a></li>
<li class="chapter" data-level="9.6" data-path="9-mod-09.html"><a href="9-mod-09.html#conclusions"><i class="fa fa-check"></i><b>9.6</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="literature-cited.html"><a href="literature-cited.html"><i class="fa fa-check"></i>Literature Cited</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Biological Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-05" class="section level1" number="5">
<h1><span class="header-section-number">Module 5</span> Generalized linear models (GLM)</h1>
<div id="mod-05-lm" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Prelude with linear models</h2>
<p>If you’ve had an introductory statistics course, then you are probably familiar with the <strong>linear regression</strong> model. Ordinary linear regression, or simple linear regression, is probably the simplest of the inferential statistical techniques that relates two continuous variables. In addition, linear models can be used with categorical predictors called <strong>factors</strong>. Several models that you’ve probably heard of are actually all special cases of the linear model:</p>
<ul>
<li><strong>Linear regression:</strong> Continuous response and continuous one predictor.</li>
<li><strong>Multiple linear regression:</strong> Continuous response and more than 1 continuous predictor.</li>
<li><strong>Two-sample <em>t</em>-test:</strong> Continuous response and 1 factor with 2 levels.</li>
<li><strong>Analysis of variance (ANOVA):</strong> Continuous response and <span class="math inline">\(\ge\)</span> 1 factor, where each factor can have <span class="math inline">\(\ge\)</span> 2 levels.</li>
<li><strong>Analysis of covariance:</strong> Continuous response variable with <span class="math inline">\(\ge\)</span> 1 continuous and <span class="math inline">\(\ge\)</span> 1 factor predictor.</li>
<li>…and many more.</li>
</ul>
<p>What makes all of these methods linear models is that there exists a way to rewrite them so that the response variable is a linear function of the predictors <span class="citation">(<a href="#ref-bolker2008ecological" role="doc-biblioref">Bolker 2008</a>)</span>.</p>
<p>Many situations are, at least at first glance, amenable to linear regression. But, as we’ll see later, many situations are better treated by more elaborate methods such as GLM or mixed models <span class="citation">(<a href="#ref-zuur2007analysing" role="doc-biblioref">Zuur et al. 2007</a>, <a href="#ref-bolker2008ecological" role="doc-biblioref">Bolker 2008</a>, <a href="#ref-bolker2009" role="doc-biblioref">Bolker et al. 2009</a>)</span>. When learning those more advanced methods it is easiest to think of them as extensions of the linear model, but it’s actually the other way around: linear regression is a special case of the more advanced methods.</p>
<p>In linear regression with one predictor variable, a response variable <em>Y</em> is modeled as a linear function of some explanatory variable <em>X</em>. The model can be written in several ways. The most common way is:</p>
<p><span class="math display">\[Y=\beta_{0}+\beta_{1}X+\varepsilon\]</span>
<span class="math display">\[\varepsilon \sim Normal(0,\sigma^{2})\]</span></p>
<p>In this equation:</p>
<ul>
<li><em>Y</em> is the response variable (AKA: dependent variable)</li>
<li><em>X</em> is the explanatory variable (AKA: independent variable or predictor variable)</li>
<li><span class="math inline">\(\beta_{0}\)</span> is the <em>Y</em>-intercept (i.e., the value of <em>Y</em> when <em>X</em> = 0). Called “beta zero” or “beta naught”.</li>
<li><span class="math inline">\(\beta_{1}\)</span> is the slope or regression coefficient (i.e., the change in <em>Y</em> per unit change in <em>X</em>). Called “beta one”.</li>
<li><span class="math inline">\(\varepsilon\)</span> is a random error term that describes residual variation not explained by the model. Residuals are identically and independently distributed (<em>i</em>.<em>i</em>.<em>d</em>.) according to a normal distribution with mean 0 and variance <span class="math inline">\(\sigma^{2}\)</span>. Called “epsilon” or “the error term”.</li>
<li>The residual variance <span class="math inline">\(\sigma^{2}\)</span> is estimated from the data. As you might expect, larger residual variance indicates a poorer fit to the data. Called “sigma squared” or the “residual variance”. Some authors might use the standard deviation (SD) <span class="math inline">\(\sigma\)</span> instead of <span class="math inline">\(\sigma^{2}\)</span> to describe the residual variation<a href="literature-cited.html#fn49" class="footnote-ref" id="fnref49"><sup>49</sup></a>.</li>
</ul>
<p>You might recognize most of this model as the equation for the slope of a line that you learned in high school algebra: <span class="math inline">\(Y=mx+b\)</span>, but <em>b</em> is now called <span class="math inline">\(\beta_{0}\)</span> and <em>m</em> is now called <span class="math inline">\(\beta_{1}\)</span>. The model intercept <span class="math inline">\(\beta_{0}\)</span> is the <strong><em>Y</em>-intercept</strong>, or the value that <em>Y</em> takes when <em>X</em> = 0. The model <strong>slope</strong> <span class="math inline">\(\beta_{1}\)</span> is the amount that <em>Y</em> changes per unit increase in <em>X</em>. That is, if <em>X</em> increases by 1, then <em>Y</em> increases by <span class="math inline">\(\beta_{1}\)</span>.</p>
<p>The linear regression model is sometimes written in other ways. Here are some other notations you might see:</p>
<p><strong>Observation-wise notation</strong></p>
<p><span class="math display">\[Y_{i}=\beta_{0}+\beta_{1}X_{i}+\varepsilon_{i}\]</span>
<span class="math display">\[\varepsilon_{i} \sim Normal(0,\sigma^{2})\]</span></p>
<p>This is very similar to the notation above, but it emphasizes that the residual is different for each observation <em>i</em>. More complicated models with additional predictors might use this form to emphasize that each observed <em>Y</em> value (<em>Y<sub>i</sub></em>) depends on a combination of predictor values (<em>X<sub>1,i</sub></em>, <em>X<sub>2,i</sub></em>, and so on) specific to observation <em>i</em>.</p>
<p><strong>State-space notation</strong></p>
<p><span class="math display">\[Y \sim Normal(E(Y), \sigma^{2}) \]</span>
<span class="math display">\[E(Y) = \beta_{0}+\beta_{1}X\]</span></p>
<p>The state-space notation explicitly separates the deterministic part of the model, which describes the “state” of <em>Y</em>, from the stochastic part, which has more to do with the “space” of potential observations. Thinking about statistical models in a state-space way is key to understanding many advanced statistical methods, including GLM and mixed models. The state-space form can also be written to include subscripts for each observation.</p>
<p><strong>Matrix notation</strong></p>
<p><span class="math display">\[ \textbf{Y} = \textbf{X}\beta + \varepsilon \]</span></p>
<p>The bold letters in this notation signify that <strong>Y</strong>, <span class="math inline">\(\beta\)</span>, <strong>X</strong>, and <span class="math inline">\(\varepsilon\)</span> are either vectors or matrices<a href="literature-cited.html#fn50" class="footnote-ref" id="fnref50"><sup>50</sup></a>. The matrix <strong>X</strong> is sometimes called the <strong>design matrix</strong>. This term comes up a lot in the R documentation and in discussion of different statistical methods (this is how most statisticians think of many statistical models).</p>
<p>The matrix notation is a compact way of writing the linear model and shows how linear models can be expressed (and calculated) using linear algebra. Note that <span class="math inline">\(\beta\)</span> is written after <strong>X</strong> here, to signify the order in which terms must occur for matrix multiplication to be defined. The matrix notation above can be expanded as:</p>
<p><span class="math display">\[ \begin{bmatrix} Y_{1} \\ Y_{2} \\ \vdots \\ Y_{n} \end{bmatrix} = \begin{bmatrix} 1 &amp; X_{1,1} &amp; \cdots &amp; X_{1,p} \\ 1 &amp; X_{2,1} &amp; \cdots &amp; X_{2,p} \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 1 &amp; X_{n,1} &amp; \cdots &amp; X_{n,p}  \end{bmatrix} \begin{bmatrix} \beta_{0} \\ \beta_{1} \\ \beta_{2} \\ \vdots \\ \beta_{p} \end{bmatrix} + \begin{bmatrix} \varepsilon_{1} \\ \varepsilon_{2} \\ \vdots \\ Y_{n} \end{bmatrix}\]</span></p>
<p>where <em>n</em> is the number of observations; <em>Y</em><sub>1</sub>, <em>Y</em><sub>2</sub>, …, <em>Y<sub>n</sub></em> is a vector of observed values of the dependent variable (aka: response variable); <em>p</em> is the number of linear predictors; <em>X<sub>i,j</sub></em> is the <em>i</em>-th value of predictor <em>j</em>; <span class="math inline">\(\beta_{0}\)</span>, <span class="math inline">\(\beta_{1}\)</span>, …, <span class="math inline">\(\beta_{p}\)</span> is the vector of regression coefficients; and <span class="math inline">\(\varepsilon_{1}\)</span>, <span class="math inline">\(\varepsilon_{2}\)</span>, .., <span class="math inline">\(\varepsilon_{n}\)</span> is a vector of <em>i</em>.<em>i</em>.<em>d</em>. normal residuals. This matrix notation illustrates how linear regression can be easily extended to models with multiple predictor variables: multiple linear regression (see below).</p>
<p>Linear regression models are fit by finding a slope and coefficient (or coefficients) that minimize the sums of squared errors, or sum of squared deviations from the expected value, or simply, residuals. Sum of squared residuals is calculated as:</p>
<p><span class="math display">\[{SS}_{res}=\sum_{i=1}^n (Y_{i}-\beta_{0}+\beta_{1}X_{i})^{2}\]</span></p>
<p>This expression shows why some authors prefer the observation-wise notation for linear regression. For ordinary linear regression, the optimal values of <span class="math inline">\(\beta_{0}\)</span> and <span class="math inline">\(\beta_{1}\)</span> can be calculated as:</p>
<p><span class="math display">\[ \hat{\beta}_{1}=\frac{\sum_{i=1}^{n}(X_{i}-\bar{X})(Y_{i}-\bar{Y})}{\sum_{i=1}^{n}(X_{i}-\bar{X})^{2}} \]</span></p>
<p><span class="math display">\[ \hat{\beta}_{0}=\bar{Y}-\hat{\beta}_{1}\bar{X} \]</span></p>
<p>The results <span class="math inline">\({\hat{\beta}}_0\)</span> and <span class="math inline">\({\hat{\beta}}_1\)</span> are referred to as “estimates” because we do not assume that our analysis gives us the “true” values of <span class="math inline">\({\hat{\beta}}_0\)</span> and <span class="math inline">\({\hat{\beta}}_1\)</span>. The “hat” symbols signify that these parameters are estimates. These symbols are usually pronounced “beta zero hat” and “beta one hat”.</p>
<p>The residual variance <span class="math inline">\({\hat{\sigma}}^2\)</span> is then estimated as:</p>
<p><span class="math display">\[{\hat{\sigma}}^2=\frac{{SS}_{res}}{n-2}\]</span></p>
<p>Expressions for <span class="math inline">\({SS}_{res}\)</span> and the estimators in cases with &gt;1 linear predictor are just more elaborate versions of the expressions for simple linear regression.</p>
<div id="assumptions-of-linear-models" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Assumptions of linear models</h3>
<p>Like all statistical models, linear regression carries with it many assumptions about the nature of the data and the relationships contained within the data. These assumptions are rarely met perfectly in real datasets, but minor violations are usually fine if they are identified and understood.</p>
<p><strong>Assumption 1: Linearity</strong></p>
<p>Linear regression assumes that there is a linear relationship between the predictor variable (or variables) and the response variable. This does not mean that the relationship is always a straight line: variables can be transformed to achieve linearity. For example, polynomial models can be considered linear because the dependent value <em>Y</em> varies as a linear function of <em>X</em> values raised to a power, not as powers of the <em>X</em> values:</p>
<p><span class="math display">\[ Y=\beta_0+\beta_1X+\beta_2X^2\]</span></p>
<p>In this quadratic model, <em>Y</em> is a linear function of <em>X</em> and <em>X</em><sup>2</sup>, according to the slopes <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span>. This is because a plot of <em>Y</em> vs. <em>X</em> would be a straight line with slope <span class="math inline">\(\beta_1\)</span>. Likewise, a plot of <em>Y</em> vs. <em>X</em><sup>2</sup> would be a straight line with slope <span class="math inline">\(\beta_2\)</span> (even though a plot of <em>Y</em> vs. <em>X</em> would be a parabola).</p>
<p><strong>Assumption 2: Constant variance (aka: homoscedasticity)</strong></p>
<p>Another key assumption of linear models is that the variance of the errors is the same for all values of the predictor variables. This condition is called <strong>homoscedasticity</strong>. Violations of this assumption, where error variance is not the same for all <em>X</em>, lead to a situation called <strong>heteroscedasticity</strong>. To relate this to the model equations above, the residual variance <span class="math inline">\(\sigma^2\)</span> is the same for all <em>X</em>. Consider the two scatterplots below, both showing some data with a fitted linear model. The left plot shows a homoscedastic relationship. The right plot does not. Heteroscedasticity is a serious problem for linear models because it leads to biased parameter estimates and standard errors (SE) of those estimates. The latter issue means that significance tests on parameters will be incorrect.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_01.jpg" /></p>
<p><strong>Assumption 3: Fixed predictor values</strong></p>
<p>A third assumption is that the <em>X</em> values are precisely known. If there is uncertainty in the <em>X</em> variables, this adds uncertainty to the <em>Y</em> values and the relationship between <em>Y</em> and <em>X</em> that linear regression cannot account for. Simply put, linear regression has a term for uncertainty in <em>Y</em> (<span class="math inline">\(\sigma^2\)</span>), but no term for uncertainty in <em>X</em>.</p>
<p><strong>Assumption 4: Independent and identically distributed errors (<em>i</em>.<em>i</em>.<em>d</em>.)</strong></p>
<p>The assumption of independently and identically distributed (<em>i</em>.<em>i</em>.<em>d</em>.) errors is very important. It means that the residual, or predictive error, for each observation depends only on that observation and not on predictor variables in other observations. When the assumption of independence is violated, the degrees of freedom in the analysis is artificially inflated, increasing the chance of a type I error (false positive). There are methods to deal with errors that are not independent, but linear regression is not one of them.</p>
<p><strong>Assumption 5: Independent predictors</strong></p>
<p>The final assumption of the linear model is that predictor variables are (mostly) independent of each other. When predictor variables are correlated, or collinear, the precision of parameter estimates suffers. When predictor variables are perfectly collinear, the linear model cannot be fit at all because the parameters (effects of different predictors) are not uniquely identifiable.</p>
</div>
<div id="linear-regression-in-r" class="section level3" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> Linear regression in R</h3>
<p>The function <code>lm()</code> for performs linear regression. It is a good idea to save your model to an <strong>object</strong>. We’ll use names like <code>mod1</code>, short for “model 1”. Note that this name uses the numeral <code>1</code>, not the lower-case letter L <code>l</code>. These two symbols look very similar in the Courier font used by R.</p>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="5-mod-05.html#cb1104-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(iris<span class="sc">$</span>Petal.Width<span class="sc">~</span>iris<span class="sc">$</span>Petal.Length)</span></code></pre></div>
<p>Using the <code>data</code> argument can make code neater:</p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="5-mod-05.html#cb1105-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Width<span class="sc">~</span>Petal.Length, <span class="at">data=</span>iris) </span></code></pre></div>
<p>The object <code>mod1</code> is really a type of object called a <strong>list</strong> with a lot of information about your model. When you write up your analysis you can extract information from mod1. The function <code>str()</code> prints a lot of information about <code>mod1</code> and what it contains:</p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="5-mod-05.html#cb1106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mod1)</span></code></pre></div>
<pre><code>## List of 12
##  $ coefficients : Named num [1:2] -0.363 0.416
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##  $ residuals    : Named num [1:150] -0.019 -0.019 0.0226 -0.0606 -0.019 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:150] -14.6888 8.9588 0.0257 -0.0576 -0.0159 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;(Intercept)&quot; &quot;Petal.Length&quot; &quot;&quot; &quot;&quot; ...
##  $ rank         : int 2
##  $ fitted.values: Named num [1:150] 0.219 0.219 0.177 0.261 0.219 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ assign       : int [1:2] 0 1
##  $ qr           :List of 5
##   ..$ qr   : num [1:150, 1:2] -12.2474 0.0816 0.0816 0.0816 0.0816 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##   .. ..- attr(*, &quot;assign&quot;)= int [1:2] 0 1
##   ..$ qraux: num [1:2] 1.08 1.1
##   ..$ pivot: int [1:2] 1 2
##   ..$ tol  : num 1e-07
##   ..$ rank : int 2
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ df.residual  : int 148
##  $ xlevels      : Named list()
##  $ call         : language lm(formula = Petal.Width ~ Petal.Length, data = iris)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language Petal.Width ~ Petal.Length
##   .. ..- attr(*, &quot;variables&quot;)= language list(Petal.Width, Petal.Length)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##   .. .. .. ..$ : chr &quot;Petal.Length&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;Petal.Length&quot;
##   .. ..- attr(*, &quot;order&quot;)= int 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(Petal.Width, Petal.Length)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##  $ model        :&#39;data.frame&#39;:   150 obs. of  2 variables:
##   ..$ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##   ..$ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language Petal.Width ~ Petal.Length
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(Petal.Width, Petal.Length)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##   .. .. .. .. ..$ : chr &quot;Petal.Length&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;Petal.Length&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(Petal.Width, Petal.Length)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</code></pre>
<p>Use <code>summary()</code> to see the terms and coefficients in the model. Note that the result of <code>summary(lm())</code> is an object in its own right, which you can assign to a name and extract information from.</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="5-mod-05.html#cb1108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Width ~ Petal.Length, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.56515 -0.12358 -0.01898  0.13288  0.64272 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.363076   0.039762  -9.131  4.7e-16 ***
## Petal.Length  0.415755   0.009582  43.387  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2065 on 148 degrees of freedom
## Multiple R-squared:  0.9271, Adjusted R-squared:  0.9266 
## F-statistic:  1882 on 1 and 148 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="5-mod-05.html#cb1110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">summary</span>(mod1))</span></code></pre></div>
<pre><code>## List of 11
##  $ call         : language lm(formula = Petal.Width ~ Petal.Length, data = iris)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language Petal.Width ~ Petal.Length
##   .. ..- attr(*, &quot;variables&quot;)= language list(Petal.Width, Petal.Length)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##   .. .. .. ..$ : chr &quot;Petal.Length&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;Petal.Length&quot;
##   .. ..- attr(*, &quot;order&quot;)= int 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(Petal.Width, Petal.Length)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;Petal.Width&quot; &quot;Petal.Length&quot;
##  $ residuals    : Named num [1:150] -0.019 -0.019 0.0226 -0.0606 -0.019 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:150] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ coefficients : num [1:2, 1:4] -0.36308 0.41576 0.03976 0.00958 -9.13122 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##   .. ..$ : chr [1:4] &quot;Estimate&quot; &quot;Std. Error&quot; &quot;t value&quot; &quot;Pr(&gt;|t|)&quot;
##  $ aliased      : Named logi [1:2] FALSE FALSE
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##  $ sigma        : num 0.206
##  $ df           : int [1:3] 2 148 2
##  $ r.squared    : num 0.927
##  $ adj.r.squared: num 0.927
##  $ fstatistic   : Named num [1:3] 1882 1 148
##   ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;value&quot; &quot;numdf&quot; &quot;dendf&quot;
##  $ cov.unscaled : num [1:2, 1:2] 0.03708 -0.00809 -0.00809 0.00215
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##   .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;Petal.Length&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;summary.lm&quot;</code></pre>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1112-1"><a href="5-mod-05.html#cb1112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                Estimate  Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  -0.3630755 0.039761990 -9.131221 4.699798e-16
## Petal.Length  0.4157554 0.009582436 43.387237 4.675004e-86</code></pre>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1114-1"><a href="5-mod-05.html#cb1114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively:</span></span>
<span id="cb1114-2"><a href="5-mod-05.html#cb1114-2" aria-hidden="true" tabindex="-1"></a>mod1.sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod1)</span>
<span id="cb1114-3"><a href="5-mod-05.html#cb1114-3" aria-hidden="true" tabindex="-1"></a>mod1.sum<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##                Estimate  Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  -0.3630755 0.039761990 -9.131221 4.699798e-16
## Petal.Length  0.4157554 0.009582436 43.387237 4.675004e-86</code></pre>
<p>Finally, you can get diagnostic plots for the model using <code>plot()</code>. These plots are useful for checking whether your data contains heteroscedasticity.</p>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1116-1"><a href="5-mod-05.html#cb1116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-441-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-441-2.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-441-3.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-441-4.png" width="672" /></p>
<p>Next, let’s get the predicted values and 95% confidence interval (CI) from the model. First, we use <code>predict()</code> to calculate the expected value (i.e., mean value of the response variable) for a range of <em>X</em> values. Then, we use the predicted standard error of the prediction to calculate the CI. Finally, we assemble everything in a plot.</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="5-mod-05.html#cb1117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of points for prediction</span></span>
<span id="cb1117-2"><a href="5-mod-05.html#cb1117-2" aria-hidden="true" tabindex="-1"></a>new.n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1117-3"><a href="5-mod-05.html#cb1117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1117-4"><a href="5-mod-05.html#cb1117-4" aria-hidden="true" tabindex="-1"></a><span class="co"># x values for prediction</span></span>
<span id="cb1117-5"><a href="5-mod-05.html#cb1117-5" aria-hidden="true" tabindex="-1"></a>newx <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(iris<span class="sc">$</span>Petal.Length), </span>
<span id="cb1117-6"><a href="5-mod-05.html#cb1117-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">max</span>(iris<span class="sc">$</span>Petal.Length),</span>
<span id="cb1117-7"><a href="5-mod-05.html#cb1117-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">length=</span>new.n)</span>
<span id="cb1117-8"><a href="5-mod-05.html#cb1117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1117-9"><a href="5-mod-05.html#cb1117-9" aria-hidden="true" tabindex="-1"></a><span class="co"># put new X values in data frame</span></span>
<span id="cb1117-10"><a href="5-mod-05.html#cb1117-10" aria-hidden="true" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Petal.Length=</span>newx)</span>
<span id="cb1117-11"><a href="5-mod-05.html#cb1117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1117-12"><a href="5-mod-05.html#cb1117-12" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate prediction and 95% CI</span></span>
<span id="cb1117-13"><a href="5-mod-05.html#cb1117-13" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(newdat),</span>
<span id="cb1117-14"><a href="5-mod-05.html#cb1117-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1117-15"><a href="5-mod-05.html#cb1117-15" aria-hidden="true" tabindex="-1"></a>mm <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.5</span>, pred<span class="sc">$</span>fit, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1117-16"><a href="5-mod-05.html#cb1117-16" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, pred<span class="sc">$</span>fit, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1117-17"><a href="5-mod-05.html#cb1117-17" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, pred<span class="sc">$</span>fit, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1117-18"><a href="5-mod-05.html#cb1117-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1117-19"><a href="5-mod-05.html#cb1117-19" aria-hidden="true" tabindex="-1"></a><span class="co"># make plot with lines for prediction and CI</span></span>
<span id="cb1117-20"><a href="5-mod-05.html#cb1117-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Petal.Length, iris<span class="sc">$</span>Petal.Width, </span>
<span id="cb1117-21"><a href="5-mod-05.html#cb1117-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb1117-22"><a href="5-mod-05.html#cb1117-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Petal length (cm)&quot;</span>,</span>
<span id="cb1117-23"><a href="5-mod-05.html#cb1117-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Petal width (cm)&quot;</span>)</span>
<span id="cb1117-24"><a href="5-mod-05.html#cb1117-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(newx, lo, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1117-25"><a href="5-mod-05.html#cb1117-25" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(newx, up, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1117-26"><a href="5-mod-05.html#cb1117-26" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(newx, mm, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-442-1.png" width="576" /></p>
<p>Below is an alternative version of the plot that uses a shaded area to show the 95% CI. The shaded area is drawn with the <code>polygon()</code> function.</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1118-1"><a href="5-mod-05.html#cb1118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative version: use shaded area for 95% CI</span></span>
<span id="cb1118-2"><a href="5-mod-05.html#cb1118-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note that polygon() goes first</span></span>
<span id="cb1118-3"><a href="5-mod-05.html#cb1118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(iris<span class="sc">$</span>Petal.Length, iris<span class="sc">$</span>Petal.Width,</span>
<span id="cb1118-4"><a href="5-mod-05.html#cb1118-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>),</span>
<span id="cb1118-5"><a href="5-mod-05.html#cb1118-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Petal length (cm)&quot;</span>,</span>
<span id="cb1118-6"><a href="5-mod-05.html#cb1118-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Petal width (cm)&quot;</span>)</span>
<span id="cb1118-7"><a href="5-mod-05.html#cb1118-7" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(newx, <span class="fu">rev</span>(newx)),</span>
<span id="cb1118-8"><a href="5-mod-05.html#cb1118-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(lo, <span class="fu">rev</span>(up)), </span>
<span id="cb1118-9"><a href="5-mod-05.html#cb1118-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey70&quot;</span>)</span>
<span id="cb1118-10"><a href="5-mod-05.html#cb1118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(newx, mm, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1118-11"><a href="5-mod-05.html#cb1118-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(iris<span class="sc">$</span>Petal.Length, iris<span class="sc">$</span>Petal.Width, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">1.1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-443-1.png" width="576" /></p>
</div>
<div id="multiple-linear-regression" class="section level3" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Multiple linear regression</h3>
<p>The linear model can easily be extended to include multiple predictors. This can be seen in the matrix notation for linear regression. With a single predictor variable <em>X</em>, the matrix form of the model is:</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_02.jpg" /></p>
<p>In this equation, the subscripts on <em>Y</em>, <em>X</em>, and <span class="math inline">\(\epsilon\)</span><a href="literature-cited.html#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a> refer to observations; the subscripts on <span class="math inline">\(\beta\)</span> identify the intercept (<span class="math inline">\(\beta_0\)</span>) or slope (<span class="math inline">\(\beta_1\)</span>). This matrix notation is shorthand for a system of equations:</p>
<p><span class="math display">\[\begin{matrix}Y_1=1\times\beta_0+\beta_1{\times X}_1+\varepsilon_1\\Y_1=1\times\beta_0+\beta_1{\times X}_2+\varepsilon_2\\\vdots\\Y_n=1\times\beta_0+\beta_1{\times X}_n+\varepsilon_n\\\end{matrix}\]</span></p>
<p>The matrix shorthand just takes advantage of the rules of matrix multiplication and addition. Multiplying the matrices <strong>X</strong> and <span class="math inline">\(\beta\)</span> will result in a matrix with the same number of columns as <span class="math inline">\(\beta\)</span> and the same number of rows as <strong>X</strong>. In other words, an <em>n</em> <span class="math inline">\(\times\)</span> 1 matrix like <strong>Y</strong>, also called a column vector.</p>
<p>With additional predictors, the design matrix is expanded with additional columns to contain the additional predictors. At the same time, the coefficient matrix <span class="math inline">\(\beta\)</span> is expanded with the same number of additional rows. The example below shows the matrix form for a regression model with 2 predictors <em>X</em><sub>1</sub> and <em>X</em><sub>2</sub>.</p>
<p><span class="math display">\[\left[\begin{matrix}Y_1\\Y_2\\\vdots\\Y_n\\\end{matrix}\right]=\left[\begin{matrix}1&amp;X_{1,1}&amp;X_{2,1}\\1&amp;X_{1,2}&amp;X_{2,2}\\\vdots&amp;\vdots&amp;\vdots\\1&amp;X_{1,n}&amp;X_{2,n}\\\end{matrix}\right]\left[\begin{matrix}\beta_0\\\beta_1\\\beta_2\\\end{matrix}\right]+\left[\begin{matrix}\varepsilon_1\\\varepsilon_2\\\vdots\\\varepsilon_n\\\end{matrix}\right] \]</span></p>
<p>Fortunately, R takes care of all this matrix algebra for you. The linear model function <code>lm()</code> will automatically define the design and coefficient matrices and estimate the latter. All you need to do is define the model equation using the formula interface as before. Predictor variables go on the right side of the <code>~</code>, separated by <code>+</code>.</p>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="5-mod-05.html#cb1119-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Length<span class="sc">~</span>Sepal.Length<span class="sc">+</span>Sepal.Width, <span class="at">data=</span>iris)</span>
<span id="cb1119-2"><a href="5-mod-05.html#cb1119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Length ~ Sepal.Length + Sepal.Width, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.25582 -0.46922 -0.05741  0.45530  1.75599 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -2.52476    0.56344  -4.481 1.48e-05 ***
## Sepal.Length  1.77559    0.06441  27.569  &lt; 2e-16 ***
## Sepal.Width  -1.33862    0.12236 -10.940  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6465 on 147 degrees of freedom
## Multiple R-squared:  0.8677, Adjusted R-squared:  0.8659 
## F-statistic:   482 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The results show that petal length increases by 1.77 cm for every additional cm of sepal length, and decreases by 1.33 cm for each additional cm of sepal width. The effects of the two predictors are assumed to be <strong>orthogonal</strong>, or independent of each other.</p>
</div>
<div id="mod-05-anova" class="section level3" number="5.1.4">
<h3><span class="header-section-number">5.1.4</span> ANOVA and ANCOVA with <code>lm()</code></h3>
<p>The formula interface is very flexible and can be used to define many kinds of models. If all predictor variables are factors (AKA: grouping or categorical variables), then the result is an analysis of variance model (ANOVA). The ANOVA table can be obtained with function <code>anova()</code>, and post-hoc tests performed on the result of <code>aov()</code>. R uses function <code>lm()</code> to fit ANOVA models because ANOVA is a special case of the linear model.</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="5-mod-05.html#cb1121-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Length<span class="sc">~</span>Species, <span class="at">data=</span>iris)</span>
<span id="cb1121-2"><a href="5-mod-05.html#cb1121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Length ~ Species, data = iris)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -1.260 -0.258  0.038  0.240  1.348 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        1.46200    0.06086   24.02   &lt;2e-16 ***
## Speciesversicolor  2.79800    0.08607   32.51   &lt;2e-16 ***
## Speciesvirginica   4.09000    0.08607   47.52   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.4303 on 147 degrees of freedom
## Multiple R-squared:  0.9414, Adjusted R-squared:  0.9406 
## F-statistic:  1180 on 2 and 147 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The model summary shows us that at least some of the species have different means. Notice that effects are shown only for two of the three species (<em>versicolor</em> and <em>virginica</em>). The level that is first alphabetically is used as a baseline. So, the effects shown for the other two species are the differences in means between those species and the baseline species. For example, species <em>versicolor</em> has a mean that is 2.798 cm greater than the mean in species <em>setosa</em>.</p>
<p>We can get the omnibus test with <code>anova()</code>.</p>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="5-mod-05.html#cb1123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># anova table:</span></span>
<span id="cb1123-2"><a href="5-mod-05.html#cb1123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod3)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Petal.Length
##            Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Species     2 437.10 218.551  1180.2 &lt; 2.2e-16 ***
## Residuals 147  27.22   0.185                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The ANOVA table shows how the variance is partitioned between that explained by species (expressed as sum of squared errors, <code>Sum Sq</code>) and the residual variation. The <em>F</em> value for each explanatory variable is the ratio of the mean squared error (<code>Mean Sq</code>) for that factor divided by the mean squared error of the residuals. The <em>F</em> value is then used to calculate <em>P</em>-value (<code>Pr(&gt;F)</code>).</p>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="5-mod-05.html#cb1125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># post-hoc test (Tukey):</span></span>
<span id="cb1125-2"><a href="5-mod-05.html#cb1125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(<span class="fu">aov</span>(mod3))</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = mod3)
## 
## $Species
##                       diff     lwr     upr p adj
## versicolor-setosa    2.798 2.59422 3.00178     0
## virginica-setosa     4.090 3.88622 4.29378     0
## virginica-versicolor 1.292 1.08822 1.49578     0</code></pre>
<p>The Tukey honest significant difference (HSD) test shows which levels of the factors in the ANOVA have means that differ from each other. The <code>diff</code> is literally the difference between the means of the levels in each row. So, the mean of <em>I</em>. <em>versicolor</em> minus the mean of <em>I</em>. <em>setosa</em> is 2.798 cm. Negative numbers would indicate that the level listed first had a smaller mean. The 95% CI of the difference is given, followed by a <em>P</em>-value that is adjusted for multiple comparisons. The <em>P</em>-values shown are not literally 0 (which is not possible). Instead, these should be interpreted as very small. Reporting them as something like “&lt;0.0001” would be appropriate.</p>
<p>Including a continuous predictor with a factor predictor
will produce main-effects analysis of covariance (ANCOVA).</p>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="5-mod-05.html#cb1127-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Length<span class="sc">~</span>Sepal.Length<span class="sc">+</span>Species, <span class="at">data=</span>iris)</span>
<span id="cb1127-2"><a href="5-mod-05.html#cb1127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Length ~ Sepal.Length + Species, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.76390 -0.17875  0.00716  0.17461  0.79954 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -1.70234    0.23013  -7.397 1.01e-11 ***
## Sepal.Length       0.63211    0.04527  13.962  &lt; 2e-16 ***
## Speciesversicolor  2.21014    0.07047  31.362  &lt; 2e-16 ***
## Speciesvirginica   3.09000    0.09123  33.870  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2826 on 146 degrees of freedom
## Multiple R-squared:  0.9749, Adjusted R-squared:  0.9744 
## F-statistic:  1890 on 3 and 146 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary table now shows the effects of both the continuous predictor and the factor predictor. As before, the estimated coefficient for a continuous predictor is the change in the response variable for every unit increase in the predictor. The estimates shown for the levels of the factor are the differences between the means of those levels and the baseline level. To fully make sense of this output, we also need to look at the omnibus test and the Tukey test outputs.</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1129-1"><a href="5-mod-05.html#cb1129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod4)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Petal.Length
##               Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## Sepal.Length   1 352.87  352.87 4419.48 &lt; 2.2e-16 ***
## Species        2  99.80   49.90  624.99 &lt; 2.2e-16 ***
## Residuals    146  11.66    0.08                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1131-1"><a href="5-mod-05.html#cb1131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(<span class="fu">aov</span>(mod4))</span></code></pre></div>
<pre><code>## Warning in replications(paste(&quot;~&quot;, xx), data = mf): non-factors ignored:
## Sepal.Length</code></pre>
<pre><code>## Warning in TukeyHSD.aov(aov(mod4)): &#39;which&#39; specified some non-factors which
## will be dropped</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = mod4)
## 
## $Species
##                           diff         lwr       upr     p adj
## versicolor-setosa    1.0696573  0.93584210 1.2034726 0.0000000
## virginica-setosa     1.1499590  1.01614380 1.2837743 0.0000000
## virginica-versicolor 0.0803017 -0.05351353 0.2141169 0.3327997</code></pre>
<p>The omnibus test and Tukey test above demonstrate the effects of the continuous predictor and the factor are orthogonal: no sums of squared errors are shared between the variables. Another way of putting that is that the response to one predictor does not depend on any other predictor.</p>
<p>When the effect of one predictor alters the effect of another predictor, the two predictors are said to “interact”. Interactions between predictors can be specified in R in two ways: <code>*</code> or <code>:</code>. Most of the time you should use <code>*</code>, which automatically fits both predictors by themselves (“main effects”) and the interaction between them (“interaction term”). The model produced this way is also called an “interaction effects ANCOVA” or “ANCOVA with interaction”.</p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="5-mod-05.html#cb1135-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">formula</span>(<span class="st">&quot;Petal.Length~Sepal.Length*Species&quot;</span>)</span>
<span id="cb1135-2"><a href="5-mod-05.html#cb1135-2" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(f1, <span class="at">data=</span>iris)</span>
<span id="cb1135-3"><a href="5-mod-05.html#cb1135-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod5)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = f1, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.68611 -0.13442 -0.00856  0.15966  0.79607 
## 
## Coefficients:
##                                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                      0.8031     0.5310   1.512    0.133    
## Sepal.Length                     0.1316     0.1058   1.244    0.216    
## Speciesversicolor               -0.6179     0.6837  -0.904    0.368    
## Speciesvirginica                -0.1926     0.6578  -0.293    0.770    
## Sepal.Length:Speciesversicolor   0.5548     0.1281   4.330 2.78e-05 ***
## Sepal.Length:Speciesvirginica    0.6184     0.1210   5.111 1.00e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2611 on 144 degrees of freedom
## Multiple R-squared:  0.9789, Adjusted R-squared:  0.9781 
## F-statistic:  1333 on 5 and 144 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The coefficients for the interaction term are <code>Sepal.Length:Speciesversicolor</code> and <code>Sepal.Length:Speciesvirginica</code>. These should be interpreted as “the change in the effect of sepal length when species is versicolor instead of setosa” and “the change in the effect of sepal length when species is virginica instead of setosa”.</p>
<p>The ANOVA table shows us that the effects of sepal length and species are NOT orthogonal, because some of the sums of squares (1.84) are associated with both variables.</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="5-mod-05.html#cb1137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod5)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Petal.Length
##                       Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
## Sepal.Length           1 352.87  352.87 5175.537 &lt; 2.2e-16 ***
## Species                2  99.80   49.90  731.905 &lt; 2.2e-16 ***
## Sepal.Length:Species   2   1.84    0.92   13.489 4.272e-06 ***
## Residuals            144   9.82    0.07                       
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="variations-on-linear-models" class="section level3" number="5.1.5">
<h3><span class="header-section-number">5.1.5</span> Variations on linear models</h3>
<p>Models without <em>Y</em>-intercepts can be fit by including <code>0+</code> in the formula. Sometimes fitting a model without an intercept can be appropriate if there is a natural reason why the response variable must be 0 when the predictor variable is 0. In such a case, any <span class="math inline">\(\beta_0\)</span> fit by the model would likely be non-significant or meaningless anyway.</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="5-mod-05.html#cb1139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate some random data</span></span>
<span id="cb1139-2"><a href="5-mod-05.html#cb1139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1139-3"><a href="5-mod-05.html#cb1139-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1139-4"><a href="5-mod-05.html#cb1139-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb1139-5"><a href="5-mod-05.html#cb1139-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fl">2.3</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb1139-6"><a href="5-mod-05.html#cb1139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1139-7"><a href="5-mod-05.html#cb1139-7" aria-hidden="true" tabindex="-1"></a><span class="co"># full model with intercept and slope:</span></span>
<span id="cb1139-8"><a href="5-mod-05.html#cb1139-8" aria-hidden="true" tabindex="-1"></a>mod7a <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb1139-9"><a href="5-mod-05.html#cb1139-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod7a)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.2284 -1.8960 -0.2605  2.0599  5.6778 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.8488     1.3149   1.406    0.177    
## x             2.1028     0.1044  20.146  8.5e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.852 on 18 degrees of freedom
## Multiple R-squared:  0.9575, Adjusted R-squared:  0.9552 
## F-statistic: 405.8 on 1 and 18 DF,  p-value: 8.498e-14</code></pre>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1141-1"><a href="5-mod-05.html#cb1141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model with slope only (i.e., no intercept)</span></span>
<span id="cb1141-2"><a href="5-mod-05.html#cb1141-2" aria-hidden="true" tabindex="-1"></a>mod7b <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>x)</span>
<span id="cb1141-3"><a href="5-mod-05.html#cb1141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod7b)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ 0 + x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.6702 -1.7713  0.2444  2.3790  5.4235 
## 
## Coefficients:
##   Estimate Std. Error t value Pr(&gt;|t|)    
## x  2.23111    0.05192   42.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.925 on 19 degrees of freedom
## Multiple R-squared:  0.9898, Adjusted R-squared:  0.9893 
## F-statistic:  1847 on 1 and 19 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>You can also fit a model with only a constant as the predictor using <code>1</code> as the right-hand side of the model formula (numeral 1, not lower-case letter L). This is also called an <strong>intercept-only model</strong>, a <strong>model of the mean</strong>, or sometimes a <strong>null model</strong>. A null model with no predictors can be a useful baseline against which to measure other models.</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="5-mod-05.html#cb1143-1" aria-hidden="true" tabindex="-1"></a>mod8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Petal.Width<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>iris) </span>
<span id="cb1143-2"><a href="5-mod-05.html#cb1143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod8)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Width ~ 1, data = iris)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.0993 -0.8993  0.1007  0.6007  1.3007 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.19933    0.06224   19.27   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7622 on 149 degrees of freedom</code></pre>
<p>The last regression flavor that we’ll cover is regression on <strong>ranks</strong>. This uses ranks of the variables rather than their actual values. A variable can be converted to ranks with function <code>rank()</code>. As with any other transformation, it might be better to transform the data in place and call the transformed data inside <code>lm()</code>.</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="5-mod-05.html#cb1145-1" aria-hidden="true" tabindex="-1"></a>mod10 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">rank</span>(Petal.Width)<span class="sc">~</span><span class="fu">rank</span>(Petal.Length), <span class="at">data=</span>iris)</span>
<span id="cb1145-2"><a href="5-mod-05.html#cb1145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod10)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rank(Petal.Width) ~ rank(Petal.Length), data = iris)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -42.506 -10.385   0.338  10.184  35.939 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         4.97766    2.47618    2.01   0.0462 *  
## rank(Petal.Length)  0.93407    0.02846   32.82   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15.08 on 148 degrees of freedom
## Multiple R-squared:  0.8792, Adjusted R-squared:  0.8784 
## F-statistic:  1077 on 1 and 148 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="5-mod-05.html#cb1147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># better: transform in place:</span></span>
<span id="cb1147-2"><a href="5-mod-05.html#cb1147-2" aria-hidden="true" tabindex="-1"></a>iris2 <span class="ot">&lt;-</span> iris</span>
<span id="cb1147-3"><a href="5-mod-05.html#cb1147-3" aria-hidden="true" tabindex="-1"></a>iris2<span class="sc">$</span>pw.rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(iris2<span class="sc">$</span>Petal.Width)</span>
<span id="cb1147-4"><a href="5-mod-05.html#cb1147-4" aria-hidden="true" tabindex="-1"></a>iris2<span class="sc">$</span>pl.rank <span class="ot">&lt;-</span> <span class="fu">rank</span>(iris2<span class="sc">$</span>Petal.Length)</span>
<span id="cb1147-5"><a href="5-mod-05.html#cb1147-5" aria-hidden="true" tabindex="-1"></a>mod10 <span class="ot">&lt;-</span> <span class="fu">lm</span>(pw.rank<span class="sc">~</span>pl.rank, <span class="at">data=</span>iris2)</span>
<span id="cb1147-6"><a href="5-mod-05.html#cb1147-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod10)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pw.rank ~ pl.rank, data = iris2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -42.506 -10.385   0.338  10.184  35.939 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  4.97766    2.47618    2.01   0.0462 *  
## pl.rank      0.93407    0.02846   32.82   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 15.08 on 148 degrees of freedom
## Multiple R-squared:  0.8792, Adjusted R-squared:  0.8784 
## F-statistic:  1077 on 1 and 148 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="example-linear-regression-workflow" class="section level3" number="5.1.6">
<h3><span class="header-section-number">5.1.6</span> Example linear regression workflow</h3>
<p>The following example shows a typical linear regression workflow. This example uses simulated data. So, the first few commands that simulate the dataset are not part of a usual regression analysis. After the data are generated, we will fit a linear model, examine the outputs, and then plot the results.</p>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="5-mod-05.html#cb1149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the data</span></span>
<span id="cb1149-2"><a href="5-mod-05.html#cb1149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1149-3"><a href="5-mod-05.html#cb1149-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1149-4"><a href="5-mod-05.html#cb1149-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, n, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb1149-5"><a href="5-mod-05.html#cb1149-5" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1149-6"><a href="5-mod-05.html#cb1149-6" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb1149-7"><a href="5-mod-05.html#cb1149-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1149-8"><a href="5-mod-05.html#cb1149-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x, sigma)</span>
<span id="cb1149-9"><a href="5-mod-05.html#cb1149-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb1149-10"><a href="5-mod-05.html#cb1149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1149-11"><a href="5-mod-05.html#cb1149-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model (analysis workflow starts here!)</span></span>
<span id="cb1149-12"><a href="5-mod-05.html#cb1149-12" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat)</span>
<span id="cb1149-13"><a href="5-mod-05.html#cb1149-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1149-14"><a href="5-mod-05.html#cb1149-14" aria-hidden="true" tabindex="-1"></a><span class="co"># examine the results</span></span>
<span id="cb1149-15"><a href="5-mod-05.html#cb1149-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = y ~ x, data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -25.033  -7.130   2.620   6.855  18.035 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  18.2851     4.6818   3.906 0.000541 ***
## x             1.5752     0.1416  11.128 8.64e-12 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.12 on 28 degrees of freedom
## Multiple R-squared:  0.8156, Adjusted R-squared:  0.809 
## F-statistic: 123.8 on 1 and 28 DF,  p-value: 8.638e-12</code></pre>
<p>The output of <code>summary()</code> tells us a lot:</p>
<ul>
<li><strong>Call</strong>: the model that was fit
Residuals: range (min, max) and 1st, 2nd, and 3rd quartiles of the distribution of residuals</li>
<li><strong>Coefficients</strong>: the estimated intercept and slope. Note that the slope associated with each predictor is named for that predictor, exactly as it was named in the function call.</li>
<li><strong>R-squared</strong>: the coefficient of determination, or proportion of variance in <em>Y</em> explained by <em>X</em>. Use the adjusted <em>R</em><sup>2</sup>, which penalizes models for the number of predictors and gives a more conservative estimate of the model goodness-of-fit.</li>
<li><strong>Omnibus ANOVA test</strong>: the last line of the output tells us a bit about the ANOVA test for overall model significance. You can get the full test with <code>anova(mod)</code>.</li>
</ul>
<p>The “coefficients” section of the output is very important. You can access it directly as a matrix:</p>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="5-mod-05.html#cb1151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##             Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 18.28512  4.6817629  3.905606 5.409231e-04
## x            1.57522  0.1415513 11.128259 8.637921e-12</code></pre>
<p>This table is really a matrix that contains the estimated values of each regression parameter, the standard error (SE) of each estimate, the test statistic t, and the P-value for each parameter. In standard linear regression, the test statistic t is calculated as:</p>
<p><span class="math display">\[t=\frac{\hat{\beta}}{se\left(\hat{\beta}\right)}\]</span></p>
<p>and the <em>P</em>-value is calculated by assuming that <em>t</em> follows a <em>t</em> distribution with <span class="math inline">\(n-2\)</span> degrees of freedom. Note that a <em>P</em>-value is calculated for both the model slope and intercept. Often a model intercept will have <em>P</em> <span class="math inline">\(\ge\)</span> 0.05. This does not mean that the regression model is invalid or non-significant. This simply means that the data do not support a model intercept significantly different from 0. This is not necessarily a problem: can you think of a biological scenario where an intercept = 0 makes sense?</p>
<p>Before moving on, we should examine some of the diagnostic plots that describe our model. These are produced by plotting our model object. This will produce several plots that you can cycle through by clicking on the plot window. The first two are probably the most important.</p>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="5-mod-05.html#cb1153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-457-1.png" width="480" /><img src="_main_files/figure-html/unnamed-chunk-457-2.png" width="480" /><img src="_main_files/figure-html/unnamed-chunk-457-3.png" width="480" /><img src="_main_files/figure-html/unnamed-chunk-457-4.png" width="480" /></p>
<p>The first plot shows model residuals vs the fitted values (i.e., the values predicted by the deterministic part of the model). This plot should show no obvious pattern. A pattern, such as residuals increasing or decreasing with predicted value, suggests that the residuals are not normal or i.i.d. Such a pattern is called heteroscedasticity. The plot below shows homoscedasticity, a much better situation. If a plot of residuals vs. fitted has a pattern, you need to investigate where that pattern might be coming from and how it can be eliminated. Potential solutions include adding additional predictors, transforming one or more predictor variables, transforming the response variable, or using a different statistical method (e.g., GLM) that can account for the various sources of heteroscedasticity.</p>
<p>The second plot is called a “quantile-quantile” plot, or “QQ plot” for short. This figure shows standardized residuals (see Module 4) on the y-axis vs. the standard scores of those quantiles in a reference distribution (in this case, a normal distribution with mean 0 and variance equal to the variance of the residuals). The points should fall on or near the diagonal line. Significant departures, particularly near the center of the distribution, suggest that the residuals are not normally distributed. If that is the case, then either the data need to be transformed to achieve normality in the residuals, or another statistical method needs to be explored.</p>
<p>Now that we have a fitted regression model, we might want to present it in a publication. The usual way is to have (1) a table showing the model coefficients; (2) text describing the model in the Results section, including the <em>R</em><sup>2</sup>; and (3) a figure showing the data and fitted model.</p>
<p>The table should resemble the output of <code>summary(mod)$coefficients</code>. Note that estimates are rounded to a reasonable number of decimal places. Test statistics and <em>P</em> values can have a couple more digits. If you can, align the numbers on the decimal point, so it is easier to compare numbers up and down a column.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>Estimate <span class="math inline">\(\pm\)</span> SE</th>
<th><em>t</em></th>
<th><em>P</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept (<span class="math inline">\(\beta_0\)</span>)</td>
<td>18.3 <span class="math inline">\(\pm\)</span> 4.7</td>
<td>3.906</td>
<td>0.0005</td>
</tr>
<tr class="even">
<td>Slope (<span class="math inline">\(\beta_1\)</span>)</td>
<td>1.6 <span class="math inline">\(\pm\)</span> 0.1</td>
<td>11.128</td>
<td>&lt;0.0001</td>
</tr>
</tbody>
</table>
<p>In order to plot the data and the relationship, we need to put together a few pieces. Namely, the predicted values (so we can add a “trendline”, as it’s called in Excel) and the 95% CI of the predicted values (so we can show how uncertain the predictions are). R makes both of these tasks straightforward, although not as easy as simply clicking “Add Trendline…” in Excel!</p>
<p>In this example, <code>px</code> is a sequence of new values within the domain of the observed <em>X</em> values—do not generate predictions outside your dataset! We are going to use a sequence of new values so that we can smoothly cover the interval between the minimum and maximum of <em>X</em>. This will make for a nicer looking plot.</p>
<p>These values are then supplied to the <code>predict()</code> function (which internally calls another function, <code>predict.lm()</code>) in a data frame. Note that the names in the new data frame must match the names in original data exactly, and any variable in the model must be in the data frame used for prediction, whether or not a variable was significant. The final argument, <code>se.fit=TRUE</code>, specifies that we want the SE of the expected value in addition to the expected value.</p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="5-mod-05.html#cb1154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new data for prediction</span></span>
<span id="cb1154-2"><a href="5-mod-05.html#cb1154-2" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length=</span><span class="dv">50</span>)</span>
<span id="cb1154-3"><a href="5-mod-05.html#cb1154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1154-4"><a href="5-mod-05.html#cb1154-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction with expected mean and SE of Y</span></span>
<span id="cb1154-5"><a href="5-mod-05.html#cb1154-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px), <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Next, we use the <code>fit</code> and <code>se.fit</code> from the result to define normal distributions at each <em>X</em> value. This way we can calculate what the expected mean and upper and lower confidence limits of the prediction are. You could subtract and add 1.96 SE from/to the mean, but the <code>qnorm()</code> method is much cleaner (and, much more adaptable to situations where other distributions apply).</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1155-1"><a href="5-mod-05.html#cb1155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted mean and 95% CI</span></span>
<span id="cb1155-2"><a href="5-mod-05.html#cb1155-2" aria-hidden="true" tabindex="-1"></a>y.mn <span class="ot">&lt;-</span> pred<span class="sc">$</span>fit</span>
<span id="cb1155-3"><a href="5-mod-05.html#cb1155-3" aria-hidden="true" tabindex="-1"></a>y.lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, pred<span class="sc">$</span>fit, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1155-4"><a href="5-mod-05.html#cb1155-4" aria-hidden="true" tabindex="-1"></a>y.up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, pred<span class="sc">$</span>fit, pred<span class="sc">$</span>se.fit)</span></code></pre></div>
<p>Now we are ready to make the plot. The code below sets some graphical options with <code>par()</code>, then makes the plot one piece at a time. The <code>par()</code> statement is not necessary if you are making graphs for yourself. However, if you are making graphs for your thesis or for a publication, it is essential to producing a clean, professional-quality figure.</p>
<p>In my workflow I prefer to first make a blank plot, then add the CI and prediction, then the original data. This ensures that the data are not plotted over by one of the other pieces. Note that the <em>y</em>-axis limits are set so that 0 is included.</p>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="5-mod-05.html#cb1156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1156-2"><a href="5-mod-05.html#cb1156-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">lend=</span><span class="dv">1</span>,</span>
<span id="cb1156-3"><a href="5-mod-05.html#cb1156-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">1.2</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span>
<span id="cb1156-4"><a href="5-mod-05.html#cb1156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>),</span>
<span id="cb1156-5"><a href="5-mod-05.html#cb1156-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>)</span>
<span id="cb1156-6"><a href="5-mod-05.html#cb1156-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.lo, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1156-7"><a href="5-mod-05.html#cb1156-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.up, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1156-8"><a href="5-mod-05.html#cb1156-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1156-9"><a href="5-mod-05.html#cb1156-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-460-1.png" width="576" /></p>
<p>Here is an alternative version of the figure, using <code>polygon()</code> to plot the confidence interval. Notice how the vertices for the polygon are specified. Half of the values are reversed with <code>rev()</code>, because the <code>polygon()</code> function basically draws the polygon vertex by vertex in a “circle”.</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="5-mod-05.html#cb1157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>), </span>
<span id="cb1157-2"><a href="5-mod-05.html#cb1157-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">1.2</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span>
<span id="cb1157-3"><a href="5-mod-05.html#cb1157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1157-4"><a href="5-mod-05.html#cb1157-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>),</span>
<span id="cb1157-5"><a href="5-mod-05.html#cb1157-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>)</span>
<span id="cb1157-6"><a href="5-mod-05.html#cb1157-6" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)), </span>
<span id="cb1157-7"><a href="5-mod-05.html#cb1157-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(y.lo, <span class="fu">rev</span>(y.up)),</span>
<span id="cb1157-8"><a href="5-mod-05.html#cb1157-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1157-9"><a href="5-mod-05.html#cb1157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1157-10"><a href="5-mod-05.html#cb1157-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-461-1.png" width="576" /></p>
<p>There is one other consideration here: do we want to show the model’s predictions and 95% CI of the expected values, or 95% CI of all values? The default is to show the 95% confidence interval, which is a statement about where we expect the <strong>mean or expected value to fall</strong>. The figures above show 95% CI. The alternative is the 95% <strong>prediction interval (PI)</strong>, sometimes called the tolerance interval. The PI describes the region where 95% of <strong>all values might fall</strong>, not just the mean. The PI is always wider than the CI. Most of the time showing the CI is appropriate…just be clear in your write-up what you are showing!</p>
<p>The figure below shows the difference between the CI and PI. Note that the output of <code>predict()</code> is different when using the argument <code>interval="prediction"</code>, so the code is a little different (we don’t have to use <code>qnorm()</code> to get the limits).</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="5-mod-05.html#cb1158-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1158-2"><a href="5-mod-05.html#cb1158-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit=</span><span class="cn">TRUE</span>,</span>
<span id="cb1158-3"><a href="5-mod-05.html#cb1158-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">interval=</span><span class="st">&quot;prediction&quot;</span>)</span>
<span id="cb1158-4"><a href="5-mod-05.html#cb1158-4" aria-hidden="true" tabindex="-1"></a>y.lo2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit[,<span class="st">&quot;lwr&quot;</span>]</span>
<span id="cb1158-5"><a href="5-mod-05.html#cb1158-5" aria-hidden="true" tabindex="-1"></a>y.up2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit[,<span class="st">&quot;upr&quot;</span>]</span>
<span id="cb1158-6"><a href="5-mod-05.html#cb1158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-7"><a href="5-mod-05.html#cb1158-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1158-8"><a href="5-mod-05.html#cb1158-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">1.2</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span>
<span id="cb1158-9"><a href="5-mod-05.html#cb1158-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-10"><a href="5-mod-05.html#cb1158-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 1: CI</span></span>
<span id="cb1158-11"><a href="5-mod-05.html#cb1158-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>),</span>
<span id="cb1158-12"><a href="5-mod-05.html#cb1158-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>,</span>
<span id="cb1158-13"><a href="5-mod-05.html#cb1158-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Confidence interval&quot;</span>)</span>
<span id="cb1158-14"><a href="5-mod-05.html#cb1158-14" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)), </span>
<span id="cb1158-15"><a href="5-mod-05.html#cb1158-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(y.lo, <span class="fu">rev</span>(y.up)),</span>
<span id="cb1158-16"><a href="5-mod-05.html#cb1158-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1158-17"><a href="5-mod-05.html#cb1158-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1158-18"><a href="5-mod-05.html#cb1158-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span>
<span id="cb1158-19"><a href="5-mod-05.html#cb1158-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1158-20"><a href="5-mod-05.html#cb1158-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 2: PI</span></span>
<span id="cb1158-21"><a href="5-mod-05.html#cb1158-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>),</span>
<span id="cb1158-22"><a href="5-mod-05.html#cb1158-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>,</span>
<span id="cb1158-23"><a href="5-mod-05.html#cb1158-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Prediction interval&quot;</span>)</span>
<span id="cb1158-24"><a href="5-mod-05.html#cb1158-24" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)),</span>
<span id="cb1158-25"><a href="5-mod-05.html#cb1158-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(y.lo2, <span class="fu">rev</span>(y.up2)),</span>
<span id="cb1158-26"><a href="5-mod-05.html#cb1158-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1158-27"><a href="5-mod-05.html#cb1158-27" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, y.mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1158-28"><a href="5-mod-05.html#cb1158-28" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-462-1.png" width="864" /></p>
</div>
</div>
<div id="mod-05-basic" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> GLM basics</h2>
<p>In the <a href="5-mod-05.html#mod-05-lm">previous section</a> we explored linear regression and other cases of the the linear model. Linear models are appropriate when there is a linear relationship between a response variable and its predictors, when the predictor variables model the response variable on its original scale, and when the residuals of the model follow a normal distribution. However, the latter two conditions do not always apply in biology.</p>
<p>The <strong>generalized linear model (GLM)</strong> is a framework that generalizes the linear model by relaxing two of the conditions in which linear models are used. In a GLM:</p>
<ul>
<li>The response variable can be modeled on a different scale than its original scale. The original scale of the data is related to the scale of the linear prediction by a link function.</li>
<li>The values of the response variable can come from many different distributions, not just the normal distribution.</li>
</ul>
<p>The GLM was introduced by <span class="citation">Nelder and Wedderburn (<a href="#ref-nelder1972" role="doc-biblioref">1972</a>)</span> and has since become a vital tool in many fields of study. Methods for fitting GLMs have been improved and expanded since the original publication, such that GLMs can be fit under many inference paradigms including least-squares, Bayesian, and machine learning frameworks.</p>
<p>The basic form of the GLM is shown below:</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_03.jpg" /></p>
<p>This form is a little abstract, but it shows the three basic parts of a GLM:</p>
<ul>
<li>Linear predictor <strong>X</strong><span class="math inline">\(\beta\)</span>, which relates the expected value of <strong>Y</strong> to a linear function of the predictors <strong>X</strong> with parameters <span class="math inline">\(\beta\)</span>.</li>
<li>Link function <em>g</em>, which relates the original values of <strong>Y</strong> to the values of the linear predictor.</li>
<li>Probability distribution <span class="math inline">\(Var(Y|X)\)</span>, which describes variability about the expected value.</li>
</ul>
<p>Below are some more concrete examples of GLMs that show the relationships between the parts. Notice how each of these examples describes a system in terms of its true, unobserved “state” and relates that state to the space of observed observations. The former part is sometimes also called the “deterministic” part of the model, while the latter is called the “stochastic” part. This framework is referred to as the “state-space” representation of a model. Thinking about your study system in state-space terms is the key to understanding GLM. This framework is useful because it allows us to think about and treat separately the deterministic part (state) and the stochastic part (space) of a statistical model.</p>
<p><strong><em>Being able to think about and deconstruct a dataset in the language of GLMs is one the main points of this course. The GLM is a very useful tool to have in your toolkit as a biologist.</em></strong></p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_04.jpg" /></p>
<div id="example-glms" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Example GLMS</h3>
<div id="linear-regression-as-a-glm" class="section level4" number="5.2.1.1">
<h4><span class="header-section-number">5.2.1.1</span> Linear regression as a GLM</h4>
<p><span class="math display">\[Y~Normal\left(\mu,\sigma^2\right)\]</span>
<span class="math display">\[\mu=\eta\]</span>
<span class="math display">\[\eta=\beta_0+\beta_1X\]</span></p>
<p>These equations show that linear regression can be thought of as a special case of GLM. The linear predictor <span class="math inline">\(\eta\)</span> (“eta”) is a linear function of the predictor variable (or variables). The expected value of <em>Y</em>, <span class="math inline">\(\mu\)</span>, is equal to <span class="math inline">\(\eta\)</span>. The variability in the response, <span class="math inline">\(\sigma^2\)</span>, is constant and does not depend on the <span class="math inline">\(\mu\)</span> (this is not the case for every GLM). Linear regression is a special case of GLM: the case with an identity link function (<span class="math inline">\(\mu=\eta\)</span>) and a normal distribution for response variables.</p>
</div>
<div id="glms-for-count-data" class="section level4" number="5.2.1.2">
<h4><span class="header-section-number">5.2.1.2</span> GLMs for count data</h4>
<p><span class="math display">\[Y~Poisson\left(\lambda\right)\]</span>
<span class="math display">\[\lambda=e^\eta\]</span>
<span class="math display">\[\eta=\beta_0+\beta_1X\]</span></p>
<p>The model above is a GLM used to model count data. Counts are often modeled as following a Poisson distribution. The Poisson distribution has one parameter, <span class="math inline">\(\lambda\)</span> (“lambda”), which is both the expected count and the variance of counts. This means that the residual variation does depend somewhat on the expected value (unlike linear regression). Because counts must be non-negative, the <strong>log link function</strong> is used. In other words, <span class="math inline">\(\log{\lambda} = \eta\)</span>. GLMs with well-known link functions are usually written without the intermediate <span class="math inline">\(\eta\)</span> variable:</p>
<p><span class="math display">\[Y~Poisson\left(\lambda\right)\]</span>
<span class="math display">\[\log{\left(\lambda\right)}=\beta_0+\beta_1X\]</span></p>
</div>
<div id="logistic-regression-glm-for-binary-data" class="section level4" number="5.2.1.3">
<h4><span class="header-section-number">5.2.1.3</span> Logistic regression: GLM for binary data</h4>
<p><span class="math display">\[Y_i~Bernoulli\left(p_i\right)\]</span>
<span class="math display">\[p_i=\frac{e^{\eta_i}}{1+e^{\eta_i}}\]</span>
<span class="math display">\[\eta_i=\beta_0+\beta_1X_i\]</span></p>
<p>The <strong>logistic regression</strong> model is really a GLM with a logit link function and a binomial error distribution. The <em>Y</em> value for each observation <em>i</em> is either 0 or 1, with P(1) = <em>p<sub>i</sub></em>. The link function is the logit function, which means that the linear part of the model predicts the logit of <em>p<sub>i</sub></em>. The model can also be written as:</p>
<p><span class="math display">\[Y_i~Bernoulli\left(p_i\right)\]</span>
<span class="math display">\[logit\left(p_i\right)=\beta_0+\beta_1X_i\]</span></p>
</div>
</div>
<div id="glm-families" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> GLM families</h3>
<p>The <strong>family</strong> of a GLM refers to the distribution that observations follow. GLMs use distributions from the <strong>exponential family</strong> of distributions. The exponential family is a class of distributions whose PDF or PMF can be written in a particular form that includes the exponential function <span class="math inline">\(e^x\)</span> or <span class="math inline">\(exp(x)\)</span>. The exponential family includes many well-known distributions such as the normal, exponential<a href="literature-cited.html#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a>, gamma, beta, Poisson, and many others. Two other common distributions, the binomial and negative binomial, can be included in the exponential family under certain conditions.
Which family to use in your GLM analysis depends on what kind of data you are trying to model. It turns out that certain kinds of data tend to follow certain distributions. For example, counts often follow a Poisson distribution. The figure below shows the typical use cases of some common distributions:</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_05.jpg" /></p>
<p>In addition to <em>a priori</em> ideas about the nature of a response variable, we also need to consider how the data are distributed in reality. The most common reason that data do not conform to their expected distribution is probably <strong>overdispersion</strong>. This means that the data have a greater variance than expected. How to deal with overdispersion depends on the expected response distribution.</p>
<p>For normally distributed data, overdispersion is usually not a problem. Note that the term for residual variation <span class="math inline">\(\sigma^2\)</span> is independent of the expected value <span class="math inline">\(\mu\)</span>. This means that a dataset with a large variance isn’t necessarily overdispersed. However, large skewness (another kind of apparent overdispersion) in the response variable may indicate that a log-normal or gamma distribution is more appropriate than a normal distribution.</p>
<p>For Poisson-distributed data (counts), overdispersion can be an issue. This is because part of the definition of the Poisson distribution is that the mean and variance are the same parameter (i.e., <span class="math inline">\(\lambda=\mu=\sigma^2\)</span>). In real datasets, the variance is often larger than the mean…sometimes much larger! If this is the case, then it might make sense to fit a GLM with a quasi-Poisson or a negative binomial family instead of a Poisson family. Both of these options include an extra parameter to account for overdispersion.</p>
<p>Another form of overdispersion in count data that makes them not conform to the Poisson distribution is <strong>zero-inflation</strong>. This is a situation where a response variable has many more 0 values than would be expected based on the Poisson distribution. Mild to moderate zero inflation can be modeled by the negative binomial. Severe zero-inflation might require using zero-inflated models, an extension of GLM<a href="literature-cited.html#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a>.</p>
</div>
<div id="glm-link-functions" class="section level3" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> GLM link functions</h3>
<p>Unlike the family component, choosing a link function for your GLM is relatively straightforward. Most families have <strong>canonical</strong> link functions that should be used unless you have a very good reason not to. What makes these link functions “canonical” is that they are derived from the PDF or PMF of the response distributions in such a way as to relate an expected value or central tendency of the distribution to a linear function of the predictor variables. In addition to relating different parts of a GLM, link functions are kind of like transformations<a href="literature-cited.html#fn54" class="footnote-ref" id="fnref54"><sup>54</sup></a>. This means that using a link function can help put your data on a scale that is more amenable to analysis. However, there is a key difference between using a link function and using a transformation: with a link function, variance is estimated on the response scale, while with a transformation, variance is estimated on the transformed scale. This can have huge consequences depending on the data and the link/transformation function.</p>
<p>The table below shows the link functions and inverse link functions of some common distributions. The link functions are presented as the relationship between the linear predictor <span class="math inline">\(\textbf{X}\beta\)</span>, the expected value on the link scale <span class="math inline">\(\eta\)</span>, and the expected value on the response scale <span class="math inline">\(\mu\)</span>.</p>
<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Distribution</th>
<th>Link name</th>
<th>Link function</th>
<th>Inverse link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Normal</td>
<td>Identity</td>
<td><span class="math inline">\(X\beta=\mu\)</span></td>
<td><span class="math inline">\(\mu=X\beta\)</span></td>
</tr>
<tr class="even">
<td>Poisson</td>
<td>Log</td>
<td><span class="math inline">\(X\beta=\log{\left(\mu\right)}\)</span></td>
<td><span class="math inline">\(\mu=e^{X\beta}\)</span></td>
</tr>
<tr class="odd">
<td>Binomial</td>
<td>Logit</td>
<td><span class="math inline">\(X\beta=\log{\left(\frac{\mu}{1-\mu}\right)}\)</span></td>
<td><span class="math inline">\(\mu=\frac{e^{X\beta}}{1+e^{X\beta}}=\frac{1}{1+e^{-X\beta}}\)</span></td>
</tr>
<tr class="even">
<td>Exponential and gamma</td>
<td>Inverse<a href="literature-cited.html#fn55" class="footnote-ref" id="fnref55"><sup>55</sup></a></td>
<td><span class="math inline">\(X\beta=\mu^{-1}=\frac{1}{\mu}\)</span></td>
<td><span class="math inline">\(\mu=\left(X\beta\right)^{-1}=\frac{1}{X\beta}\)</span></td>
</tr>
</tbody>
</table>
<p>It is important to remember that GLMs are linear on the link scale, not necessarily on the scale in which the data are recorded. When raw response variables are plotted against predictor variables, the plot may not be linear. The plot below shows how a relationship can appear linear on the link (i.e., transformed) scale (left), but nonlinear on the original scale (right).</p>
<p><img src="_main_files/figure-html/unnamed-chunk-463-1.png" width="768" /></p>
</div>
<div id="deviance-and-other-glm-diagnostics" class="section level3" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Deviance and other GLM diagnostics</h3>
<p>One aspect of GLMs that confuses some people is how to measure how well the model fits the data. That is, how to calculate an <em>R</em><sup>2</sup> value. In linear regression (and other linear models such as ANOVA), the coefficient of determination <em>R</em><sup>2</sup> expresses the proportion of variation in the response variable that is attributable to variation in the predictor variable(s). <em>R</em><sup>2</sup> is a widely-known and useful metric of model fit. However, <em>R</em><sup>2</sup> is not defined for GLMs. This is because of the way <em>R</em><sup>2</sup> is defined:</p>
<p><span class="math display">\[R^2=1-\frac{{SS}_{res}}{{SS}_{tot}}=1-\frac{\sum_{i=1}^{n}\left(y_i-\mu_i\right)^2}{\sum_{i=1}^{n}\left(y_i-\bar{y}\right)^2} \]</span></p>
<p>This can be visualized in the figure below. Notice how the minimum possible sum of squared deviations is 0, and <em>R</em><sup>2</sup> is the proportion of how much variation (in terms of sums of squares) is reduced by the model. In other words, the performance of the model falls somewhere between the worst possible value and the best possible value. A key property of this calculation is that both the worst possible value, <span class="math inline">\({SS}_{null}\)</span>, and the best possible value, 0, are easily defined.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_06.jpg" /></p>
<p>This definition assumes a normal distribution of residuals, because the variance of a normal distribution <em>X</em> is</p>
<p><span class="math display">\[Var\left(x\right)=\frac{\sum\left(x_i-\bar{x}\right)^2}{n-1}\]</span></p>
<p>However, the variance for other distributions is something else. This means that the denominator in <em>R</em><sup>2</sup> (total sum of squared deviations) is often not an appropriate measure of variation. Instead of using <em>R</em><sup>2</sup>, we have to use a more generalized way to measure model fit.</p>
<p><strong>Deviance</strong> is a quantity that generalizes the concept of sum of squared residuals (<span class="math inline">\({SS}_{res}\)</span>) to models that were fit using maximum likelihood estimation (MLE) instead of classical least squares estimation. For linear regression and other models fit using least squares estimation (which is basically just a solving some linear algebra problems), calculating <span class="math inline">\({SS}_{res}\)</span> is straightforward. This is because of the overlap between the definitions of <span class="math inline">\({SS}_{res}\)</span> and the variance of the normal distribution. However, models fit by MLE work by searching for combinations of values of model terms (the “parameter space”) for combinations that maximize a “likelihood function” . Because residuals are not used in the parameter estimation process, evaluating model fit based on <span class="math inline">\({SS}_{res}\)</span> doesn’t make sense.</p>
<p>Just like least squares methods partition total sums of squared errors into “total” and “residual” sums of squared errors (<span class="math inline">\({SS}_{tot}\)</span> and <span class="math inline">\({SS}_{res}\)</span> in the figure above), other methods partition total deviance into “residual deviance” (<span class="math inline">\(D_{res}\)</span>) and the deviance explained by the model. However, calculating total deviance is not as straightforward as calculating <span class="math inline">\({SS}_{tot}\)</span> because there is no natural minimum against which to compare. Recall that in linear models, the minimum sum of squared residuals was 0. In GLM terms, this creates a natural upper bound to the likelihood function. However, for most GLMs the theoretical upper bound cannot be calculated <em>a priori</em> the way it can with linear regression.</p>
<p>Deviance is defined by comparing the likelihood of the data under the fitted model to the likelihood of the data under the <strong>saturated model</strong><a href="literature-cited.html#fn56" class="footnote-ref" id="fnref56"><sup>56</sup></a>. A saturated model is one that incorporates all of the information in the dataset by having as many parameters as it does observations<a href="literature-cited.html#fn57" class="footnote-ref" id="fnref57"><sup>57</sup></a>. This model is guaranteed to have the closest possible fit to the data. This means that the saturated model will have the greatest possible likelihood function. Any other model will have a smaller likelihood function. The difference between the likelihood of the saturated model and the likelihood of another model tells us something about how much explanatory power that the fitted model has, relative to a hypothetical model with perfect explanatory power.</p>
<p>Residual deviance (<span class="math inline">\(D_{res}\)</span>) is calculated as twice the difference between the likelihood of the saturated model (<span class="math inline">\(L_{sat}\)</span>) and the likelihood of the fitted model (<span class="math inline">\(L_{fitted}\)</span>). For convenience, we usually work with the log of the likelihood (LL).</p>
<p><span class="math display">\[D_{resid}=2\left({LL}_{sat}-{LL}_{fitted}\right)\]</span></p>
<p>Null deviance (<span class="math inline">\(D_{null}\)</span>) is similar, but compares the saturated model to the null model. The null model is a model with no predictor variables, which predicts the same value (usually the mean) for all observations.</p>
<p><span class="math display">\[D_{null}=2\left({LL}_{sat}-{LL}_{null}\right)\]</span></p>
<p>The relationship between these deviances can be seen in the figure below. The null deviance is the difference in log-likelihood between the model that contains none of the information in the data (the null model) and the model that contains all of it (the saturated model). This makes the null deviance the baseline for the best that a model could possibly be. A well-fitting model should have very little residual deviance, because it performs similarly to the saturated model while having fewer parameters. Even though the log-likelihood scale includes 0, this is only to show that log-likelihood values are almost always negative.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_07.jpg" /></p>
<p>Compare this figure to the one above that illustrates <em>R</em><sup>2</sup>. Unlike the log-likelihood, there is a natural minimum of 0 for sums of squares in the best possible model. This is analogous to the log-likelihood of the saturated model. Without considering the saturated model, we can’t calculate null deviance, and thus can’t calculate how much of that deviance is explained by the fitted model.</p>
<p>Why does the formula for deviance includes a factor of 2? That factor is there to make it so that the deviance follows a chi-squared distribution with a number of degrees of freedom equal to the difference in the number of parameters between the models. We’ll explore what that means later when we work through some GLM examples.</p>
</div>
<div id="to-pseudo-r2-or-not-to-pseudo-r2" class="section level3" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> To pseudo-<em>R</em><sup>2</sup> or not to pseudo-<em>R</em><sup>2</sup>?</h3>
<p>One final note about goodness of fit in GLMs: no single measure of goodness of fit is universally agreed upon or appropriate for all situations. The pseudo-<em>R</em><sup>2</sup> presented in subsequent sections is widely used, but some authors disagree about what it represents or measures. Other methods for evaluating GLM goodness of fit include:</p>
<ul>
<li><strong>Cross-validation</strong>: measures the ability of the model to accurately predict data that were not used fit the model. This is widely used in by machine learning methods, and can be useful when predictive ability is the desired endpoint.</li>
<li><strong>Receiver operating characteristic (ROC) and area under curve (AUC)</strong>: measures the predictive accuracy of models used for classification, especially logistic regression. For logistic regression, AUC can be more informative than pseudo-<em>R</em><sup>2</sup>.</li>
</ul>
</div>
<div id="common-glms" class="section level3" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Common GLMs</h3>
<p>This site has worked examples of several GLMs commonly encountered by biologists. The links below will take you to the GLM flavor that you’re interested in. The options are:</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Typical use case</th>
<th>Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Log-linear GLM</td>
<td>Models for continuous values with non-normal errors</td>
<td><a href="5-mod-05.html#mod-05-loglin">Click here!</a></td>
</tr>
<tr class="even">
<td>Poisson GLM</td>
<td>Models for count data</td>
<td><a href="5-mod-05.html#mod-05-poisson">Click here!</a></td>
</tr>
<tr class="odd">
<td>Quasi-Poisson and negative binomial GLM</td>
<td>Models for overdispersed count data</td>
<td><a href="5-mod-05.html#mod-05-quasi">Click here!</a></td>
</tr>
<tr class="even">
<td>Logistic regression</td>
<td>Models for binary outcomes</td>
<td><a href="5-mod-05.html#mod-05-logistic">Click here!</a></td>
</tr>
<tr class="odd">
<td>Binomial GLM</td>
<td>Models for proportional data</td>
<td><a href="5-mod-05.html#mod-05-binom">Click here!</a></td>
</tr>
<tr class="even">
<td>Gamma GLM</td>
<td>Models for heteroscedastic and right-skewed data</td>
<td><a href="5-mod-05.html#mod-05-gamma">Click here!</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="mod-05-loglin" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Log-linear models</h2>
<p>This is one of several sections exploring some common GLM applications. For most of these applications we will work through two examples. First, an analysis of simulated data, and second, an analysis of a real dataset. Simulating a dataset suitable for an analysis is an excellent way to learn about the analysis method, because it helps you see the relationship between the data-generating process and the analysis.</p>
<p>This module explores GLMs with a log link function and Gaussian (normal) family: a log-linear model. Log-linear models are models with a linear relationship between the logarithm of the response variable and the predictor variables. While “log-linear” often describes GLMs with Poisson families, it can mean any GLM with a log link function.</p>
<div id="mod-05-loglin-examp" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Example with simulated data</h3>
<p>This example was designed to illustrate the difference between a log-linear GLM and a linear model on log-transformed data.</p>
<div class="sourceCode" id="cb1159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1159-1"><a href="5-mod-05.html#cb1159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random number seed for reproducibility</span></span>
<span id="cb1159-2"><a href="5-mod-05.html#cb1159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1159-3"><a href="5-mod-05.html#cb1159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-4"><a href="5-mod-05.html#cb1159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sample size</span></span>
<span id="cb1159-5"><a href="5-mod-05.html#cb1159-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1159-6"><a href="5-mod-05.html#cb1159-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-7"><a href="5-mod-05.html#cb1159-7" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients and residual SD</span></span>
<span id="cb1159-8"><a href="5-mod-05.html#cb1159-8" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">2.5</span></span>
<span id="cb1159-9"><a href="5-mod-05.html#cb1159-9" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb1159-10"><a href="5-mod-05.html#cb1159-10" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1159-11"><a href="5-mod-05.html#cb1159-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-12"><a href="5-mod-05.html#cb1159-12" aria-hidden="true" tabindex="-1"></a><span class="co"># x values</span></span>
<span id="cb1159-13"><a href="5-mod-05.html#cb1159-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb1159-14"><a href="5-mod-05.html#cb1159-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-15"><a href="5-mod-05.html#cb1159-15" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor</span></span>
<span id="cb1159-16"><a href="5-mod-05.html#cb1159-16" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb1159-17"><a href="5-mod-05.html#cb1159-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-18"><a href="5-mod-05.html#cb1159-18" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1159-19"><a href="5-mod-05.html#cb1159-19" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta)</span>
<span id="cb1159-20"><a href="5-mod-05.html#cb1159-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-21"><a href="5-mod-05.html#cb1159-21" aria-hidden="true" tabindex="-1"></a><span class="co"># response variable</span></span>
<span id="cb1159-22"><a href="5-mod-05.html#cb1159-22" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, mu, sigma)</span>
<span id="cb1159-23"><a href="5-mod-05.html#cb1159-23" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb1159-24"><a href="5-mod-05.html#cb1159-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1159-25"><a href="5-mod-05.html#cb1159-25" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data:</span></span>
<span id="cb1159-26"><a href="5-mod-05.html#cb1159-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-464-1.png" width="576" /></p>
<p>The relationship looks somewhat linear, but we might have some reason to suspect that it is not either because we have a biological reason or because we can see the slight curve characteristic of exponential functions. Let’s try two models: a log-linear GLM, and a LM on log-transformed data.</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="5-mod-05.html#cb1160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model 1: GLM with log link</span></span>
<span id="cb1160-2"><a href="5-mod-05.html#cb1160-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>))</span>
<span id="cb1160-3"><a href="5-mod-05.html#cb1160-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model 2: LM on log-transformed data</span></span>
<span id="cb1160-4"><a href="5-mod-05.html#cb1160-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>logy <span class="ot">&lt;-</span> <span class="fu">log</span>(dat<span class="sc">$</span>y)</span>
<span id="cb1160-5"><a href="5-mod-05.html#cb1160-5" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logy<span class="sc">~</span>x, <span class="at">data=</span>dat)</span></code></pre></div>
<p>You may get an error message that illustrates a problem with fitting GLMs that doesn’t come up with linear models: starting values. Recall that linear models are fit by essentially solving linear algebra problems. GLMs are fit using an iterative process. This iterative process needs reasonable starting values in order to have a good chance of finding a good solution. R can figure out good starting values for many GLMs, particularly GLMs that use the canonical link function for the family (see table in <a href="5-mod-05.html#mod-05-basic">previous section</a>). Because the canonical link for the Gaussian family is the identity function, not log, R may need you to provide the starting values. One way to find good starting values is to find a way to linearize the model. In this case, we can simply log-transform the response and use the coefficients as starting values for our GLM.</p>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="5-mod-05.html#cb1161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not run:</span></span>
<span id="cb1161-2"><a href="5-mod-05.html#cb1161-2" aria-hidden="true" tabindex="-1"></a>starts <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(<span class="fu">log</span>(y)<span class="sc">~</span>x))</span>
<span id="cb1161-3"><a href="5-mod-05.html#cb1161-3" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>),</span>
<span id="cb1161-4"><a href="5-mod-05.html#cb1161-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">start=</span>starts)</span></code></pre></div>
<p>Interestingly, both models estimated model parameters that were pretty close to the true values.</p>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="5-mod-05.html#cb1162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = gaussian(link = &quot;log&quot;), data = dat, 
##     start = starts)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -5.7735  -1.1230   0.4361   1.4853   3.1162  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.478735   0.025559   96.98   &lt;2e-16 ***
## x           0.252960   0.003716   68.07   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 3.806117)
## 
##     Null deviance: 27488.14  on 49  degrees of freedom
## Residual deviance:   182.69  on 48  degrees of freedom
## AIC: 212.68
## 
## Number of Fisher Scoring iterations: 3</code></pre>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="5-mod-05.html#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = logy ~ x, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.22312 -0.01971  0.01146  0.02941  0.11028 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.510009   0.022596  111.08   &lt;2e-16 ***
## x           0.247561   0.004033   61.38   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.06001 on 48 degrees of freedom
## Multiple R-squared:  0.9874, Adjusted R-squared:  0.9872 
## F-statistic:  3767 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The <em>R</em><sup>2</sup> for the LM fit is very high, 0.987. We can use the deviance of the fitted model to calculate a pseudo-<em>R</em><sup>2</sup> for the GLM fit. The result, 0.933, is also pretty good!</p>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="5-mod-05.html#cb1166-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>(mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance)</span></code></pre></div>
<pre><code>## [1] 0.9933537</code></pre>
<p>As a final check, let’s look at the residuals and other diagnostic plots for our models.</p>
<div class="sourceCode" id="cb1168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1168-1"><a href="5-mod-05.html#cb1168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod1))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-469-1.png" width="576" /></p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="5-mod-05.html#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb1169-2"><a href="5-mod-05.html#cb1169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod1)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-470-1.png" width="768" /></p>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="5-mod-05.html#cb1170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod2))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-471-1.png" width="576" /></p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="5-mod-05.html#cb1171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb1171-2"><a href="5-mod-05.html#cb1171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod2)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-472-1.png" width="768" /></p>
<p>The plots for the GLM fit look pretty good. There is no evidence of heteroscedasticity, and no evidence of nonnormality in the residuals. The same plots for the LM fit, however, do show some potential problems with heteroscedasticity. In particular, the scale-location plot shows evidence that the size of the residuals varies with the fitted value.</p>
<p>The last step is to plot the data and the predicted values. When plotting predicted values (and their 95% confidence interval) from GLMs, the procedure is similar to that for linear models. However, we need to be careful not to treat variation on the response scale the same as variation on the link scale. R can generate predictions either scale, but the uncertainty it calculates for those predictions may or may not be reasonable for your situation. For this example, both methods below will produce the same predictions; with other families and link functions, that might not be the case.</p>
<p>Notice that the code below looks very similar to that used with the linear model output.</p>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="5-mod-05.html#cb1172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new data for prediction</span></span>
<span id="cb1172-2"><a href="5-mod-05.html#cb1172-2" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length=</span><span class="dv">50</span>)</span>
<span id="cb1172-3"><a href="5-mod-05.html#cb1172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1172-4"><a href="5-mod-05.html#cb1172-4" aria-hidden="true" tabindex="-1"></a><span class="co"># GLM prediction (mod1)</span></span>
<span id="cb1172-5"><a href="5-mod-05.html#cb1172-5" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1172-6"><a href="5-mod-05.html#cb1172-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1172-7"><a href="5-mod-05.html#cb1172-7" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, pred1<span class="sc">$</span>fit, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1172-8"><a href="5-mod-05.html#cb1172-8" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, pred1<span class="sc">$</span>fit, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1172-9"><a href="5-mod-05.html#cb1172-9" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1172-10"><a href="5-mod-05.html#cb1172-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1172-11"><a href="5-mod-05.html#cb1172-11" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1172-12"><a href="5-mod-05.html#cb1172-12" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo1)</span>
<span id="cb1172-13"><a href="5-mod-05.html#cb1172-13" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up1)</span>
<span id="cb1172-14"><a href="5-mod-05.html#cb1172-14" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn1)</span>
<span id="cb1172-15"><a href="5-mod-05.html#cb1172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1172-16"><a href="5-mod-05.html#cb1172-16" aria-hidden="true" tabindex="-1"></a><span class="co"># LM prediction (mod2)</span></span>
<span id="cb1172-17"><a href="5-mod-05.html#cb1172-17" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1172-18"><a href="5-mod-05.html#cb1172-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1172-19"><a href="5-mod-05.html#cb1172-19" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.025</span>, pred2<span class="sc">$</span>fit, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1172-20"><a href="5-mod-05.html#cb1172-20" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.975</span>, pred2<span class="sc">$</span>fit, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1172-21"><a href="5-mod-05.html#cb1172-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1172-22"><a href="5-mod-05.html#cb1172-22" aria-hidden="true" tabindex="-1"></a><span class="co"># backtransform</span></span>
<span id="cb1172-23"><a href="5-mod-05.html#cb1172-23" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(pred2<span class="sc">$</span>fit)</span></code></pre></div>
<p>The code below plots the predicted values, 95% CI, and optionally the original data. The commands to plot the original data are commented out to make it easier to see the confidence intervals (which are very narrow).</p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="5-mod-05.html#cb1173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1173-2"><a href="5-mod-05.html#cb1173-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">lend=</span><span class="dv">1</span>,</span>
<span id="cb1173-3"><a href="5-mod-05.html#cb1173-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">1.2</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>)</span>
<span id="cb1173-4"><a href="5-mod-05.html#cb1173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb1173-5"><a href="5-mod-05.html#cb1173-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>,</span>
<span id="cb1173-6"><a href="5-mod-05.html#cb1173-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;GLM predictions&quot;</span>)</span>
<span id="cb1173-7"><a href="5-mod-05.html#cb1173-7" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1173-8"><a href="5-mod-05.html#cb1173-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1173-9"><a href="5-mod-05.html#cb1173-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>) </span>
<span id="cb1173-10"><a href="5-mod-05.html#cb1173-10" aria-hidden="true" tabindex="-1"></a><span class="co">#points(dat$x, dat$y, pch=16, cex=0.8)</span></span>
<span id="cb1173-11"><a href="5-mod-05.html#cb1173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1173-12"><a href="5-mod-05.html#cb1173-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb1173-13"><a href="5-mod-05.html#cb1173-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>,</span>
<span id="cb1173-14"><a href="5-mod-05.html#cb1173-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;LM predictions&quot;</span>)</span>
<span id="cb1173-15"><a href="5-mod-05.html#cb1173-15" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1173-16"><a href="5-mod-05.html#cb1173-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>) </span>
<span id="cb1173-17"><a href="5-mod-05.html#cb1173-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-474-1.png" width="864" /></p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="5-mod-05.html#cb1174-1" aria-hidden="true" tabindex="-1"></a><span class="co">#points(dat$x, dat$y, pch=16, cex=0.8) </span></span></code></pre></div>
<p>The figure shows that both models predicted the mean quite well. Notice what happens at the far right of each plot: the 95% CI for the LM predictions starts to get wider, while the interval for the GLM predictions does not. In other words, the LM fit is heteroscedastic, while the GLM fit was not. Were the original data heteroscedastic? No. The GLM accurately captured the homoscedastic nature of the data.</p>
</div>
<div id="example-with-real-data" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Example with real data</h3>
<p><span class="citation">Chivers and Hladik (<a href="#ref-chivers1980" role="doc-biblioref">1980</a>)</span> investigated the morphology of the gut in primates and other mammals to see if there was a correlation with diet. They examined digestive tracts from 78 mammal species (50 of them primates) and measured the length, surface area, volume, and weight of different components of each species’ gut. Each species was classified initially into one of three diet classes:
- Faunivore: consumes primarily animals (i.e., a carnivore)
- Frugivore: consumes primarily fruits, but could also eat a varied diet
- Foliovore: consumes primarily leaves and grasses</p>
<p>The variables in this dataset are:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>spp</td>
<td>Taxon as genus (if only one member of genus present in dataset) or binomen (if &gt;1 member of genus in dataset)</td>
</tr>
<tr class="even">
<td>order</td>
<td>Taxonomic order</td>
</tr>
<tr class="odd">
<td>diet</td>
<td>Frugivore, foliovore, or faunivore</td>
</tr>
<tr class="even">
<td>sex</td>
<td>Sex: f = female, m = male</td>
</tr>
<tr class="odd">
<td>len</td>
<td>Body length (cm)</td>
</tr>
<tr class="even">
<td>sa_stom</td>
<td>Internal surface area of the stomach (cm<sup>2</sup>)</td>
</tr>
<tr class="odd">
<td>sa_si</td>
<td>Internal surface area of the small intestine (cm<sup>2</sup>)</td>
</tr>
<tr class="even">
<td>sa_caec</td>
<td>Internal surface area of the cecum (cm<sup>2</sup>)</td>
</tr>
<tr class="odd">
<td>sa_col</td>
<td>Internal surface area of the colon (cm<sup>2</sup>)</td>
</tr>
<tr class="even">
<td>vol_stom</td>
<td>Volume of the stomach (cm<sup>3</sup>)</td>
</tr>
<tr class="odd">
<td>vol_si</td>
<td>Volume of the small intestine (cm<sup>3</sup>)</td>
</tr>
<tr class="even">
<td>vol_caec</td>
<td>Volume of the cecum (cm<sup>3</sup>)</td>
</tr>
<tr class="odd">
<td>vol_col</td>
<td>Volume of the colon (cm<sup>3</sup>)</td>
</tr>
</tbody>
</table>
<p>Import the dataset <a href="https://greenquanteco.github.io/chivers1980data.csv">chivers1980data.csv</a>. The code below requires that you put the file in your R working directory.</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="5-mod-05.html#cb1175-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;chivers1980data.csv&quot;</span></span>
<span id="cb1175-2"><a href="5-mod-05.html#cb1175-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>For this example, we will analyze the relationship between stomach size and body length. Examine both variables and their relationship to see what we’re dealing with:</p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="5-mod-05.html#cb1176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1176-2"><a href="5-mod-05.html#cb1176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>len)</span>
<span id="cb1176-3"><a href="5-mod-05.html#cb1176-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>vol_stom)</span>
<span id="cb1176-4"><a href="5-mod-05.html#cb1176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>len, dat<span class="sc">$</span>vol_stom)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-476-1.png" width="864" /></p>
<p>The histograms for both variables suggest that they are highly nonnormal and right-skewed. They are also continuous variables. This suggests that log-transforming them would be helpful.</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="5-mod-05.html#cb1177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1177-2"><a href="5-mod-05.html#cb1177-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(dat<span class="sc">$</span>len))</span>
<span id="cb1177-3"><a href="5-mod-05.html#cb1177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(dat<span class="sc">$</span>vol_stom))</span>
<span id="cb1177-4"><a href="5-mod-05.html#cb1177-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(dat<span class="sc">$</span>len), <span class="fu">log</span>(dat<span class="sc">$</span>vol_stom))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-477-1.png" width="864" /></p>
<p>Log-transforming the variables made it easier to see the relationship between body length and stomach volume. On a log-log scale, the relationship looks linear. At this point we could simply perform linear regression on the log-transformed variables. Instead, we will fit a “log-linear” model using GLM.</p>
<p>Remember that in a GLM the link function is what “transforms” the response variable. So, we only need to transform the predictor variable. We’ll use log<sub>10</sub> instead of log so that plotting will be easier later.</p>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="5-mod-05.html#cb1178-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>len.tr <span class="ot">&lt;-</span> <span class="fu">log10</span>(dat<span class="sc">$</span>len)</span></code></pre></div>
<p>Next, fit the model using function <code>glm()</code>. We are using the Gaussian (aka: normal) family with a log link function. Notice that the formula and data arguments are the same as for <code>lm()</code>.</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="5-mod-05.html#cb1179-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vol_stom<span class="sc">~</span>len.tr, <span class="at">data=</span>dat,</span>
<span id="cb1179-2"><a href="5-mod-05.html#cb1179-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span>
<span id="cb1179-3"><a href="5-mod-05.html#cb1179-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = vol_stom ~ len.tr, family = gaussian(link = &quot;log&quot;), 
##     data = dat)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -6813.5   -890.5   -528.0   -288.2  15418.2  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.5356     0.6813   2.254   0.0254 *  
## len.tr        3.2709     0.3307   9.892   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 3992734)
## 
##     Null deviance: 1092527506  on 178  degrees of freedom
## Residual deviance:  706707651  on 177  degrees of freedom
## AIC: 3232.8
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>The coefficients part of the output looks similar to that of a linear model. The bottom part displays information about deviance rather than calculations related to <em>R</em><sup>2</sup>. We can use those values to calculate a pseudo-<em>R</em><sup>2</sup>.</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="5-mod-05.html#cb1181-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>(mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance)</span></code></pre></div>
<pre><code>## [1] 0.3531443</code></pre>
<p>That’s not great but not bad either. Let’s plot the data and model predictions to see what might have gone wrong. We’ll use <code>predict()</code> like we do with linear models, but with a few added wrinkles.</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="5-mod-05.html#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new data for prediction</span></span>
<span id="cb1183-2"><a href="5-mod-05.html#cb1183-2" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>len.tr), <span class="fu">max</span>(dat<span class="sc">$</span>len.tr), <span class="at">length=</span><span class="dv">50</span>)</span>
<span id="cb1183-3"><a href="5-mod-05.html#cb1183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1183-4"><a href="5-mod-05.html#cb1183-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions</span></span>
<span id="cb1183-5"><a href="5-mod-05.html#cb1183-5" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">len.tr=</span>px),</span>
<span id="cb1183-6"><a href="5-mod-05.html#cb1183-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">se.fit=</span><span class="cn">TRUE</span>,</span>
<span id="cb1183-7"><a href="5-mod-05.html#cb1183-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1183-8"><a href="5-mod-05.html#cb1183-8" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> pred<span class="sc">$</span>fit</span>
<span id="cb1183-9"><a href="5-mod-05.html#cb1183-9" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1183-10"><a href="5-mod-05.html#cb1183-10" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1183-11"><a href="5-mod-05.html#cb1183-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1183-12"><a href="5-mod-05.html#cb1183-12" aria-hidden="true" tabindex="-1"></a><span class="co"># reset plot layout</span></span>
<span id="cb1183-13"><a href="5-mod-05.html#cb1183-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1183-14"><a href="5-mod-05.html#cb1183-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1183-15"><a href="5-mod-05.html#cb1183-15" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot</span></span>
<span id="cb1183-16"><a href="5-mod-05.html#cb1183-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb1183-17"><a href="5-mod-05.html#cb1183-17" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>)), <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>))</span>
<span id="cb1183-18"><a href="5-mod-05.html#cb1183-18" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">200</span>)), <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.3</span>)</span>
<span id="cb1183-19"><a href="5-mod-05.html#cb1183-19" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1183-20"><a href="5-mod-05.html#cb1183-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1183-21"><a href="5-mod-05.html#cb1183-21" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-481-1.png" width="672" /></p>
<p>The model does reasonably well below 100 cm length, but there is quite a bit of spread as animals get larger. Let’s superimpose the factor <code>diet</code> on the plot to see if that might help.</p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="5-mod-05.html#cb1184-1" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="dv">3</span>)</span>
<span id="cb1184-2"><a href="5-mod-05.html#cb1184-2" aria-hidden="true" tabindex="-1"></a>diets <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>diet))</span>
<span id="cb1184-3"><a href="5-mod-05.html#cb1184-3" aria-hidden="true" tabindex="-1"></a>use.cols <span class="ot">&lt;-</span> cols[<span class="fu">match</span>(dat<span class="sc">$</span>diet, diets)]</span>
<span id="cb1184-4"><a href="5-mod-05.html#cb1184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-5"><a href="5-mod-05.html#cb1184-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb1184-6"><a href="5-mod-05.html#cb1184-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>)), <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>))</span>
<span id="cb1184-7"><a href="5-mod-05.html#cb1184-7" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">200</span>)), <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.3</span>)</span>
<span id="cb1184-8"><a href="5-mod-05.html#cb1184-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1184-9"><a href="5-mod-05.html#cb1184-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1184-10"><a href="5-mod-05.html#cb1184-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1184-11"><a href="5-mod-05.html#cb1184-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>use.cols)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-482-1.png" width="672" /></p>
<p>It looks like some of the variation might be driven by diet. To investigate, we’ll refit the model with the factor diet. We will fit two versions of the model with diet: one where the effects of diet and length are separate, and another where the effects of diet and length interact. We’ll then use information theoretic inference to determine which model works best.</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="5-mod-05.html#cb1185-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vol_stom<span class="sc">~</span>len.tr<span class="sc">+</span>diet, <span class="at">data=</span>dat,</span>
<span id="cb1185-2"><a href="5-mod-05.html#cb1185-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span>
<span id="cb1185-3"><a href="5-mod-05.html#cb1185-3" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(vol_stom<span class="sc">~</span>len.tr<span class="sc">*</span>diet, <span class="at">data=</span>dat,</span>
<span id="cb1185-4"><a href="5-mod-05.html#cb1185-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<p>The pseudo-<em>R</em><sup>2</sup> increased from model 1 to model 2, but not from model 2 to model 3. This suggests that adding the interaction didn’t improve the fit much, but adding the factor diet did.</p>
<div class="sourceCode" id="cb1186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1186-1"><a href="5-mod-05.html#cb1186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check pseudo R squared (heuristic only)</span></span>
<span id="cb1186-2"><a href="5-mod-05.html#cb1186-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>(mod2<span class="sc">$</span>deviance<span class="sc">/</span>mod2<span class="sc">$</span>null.deviance)</span></code></pre></div>
<pre><code>## [1] 0.5342784</code></pre>
<div class="sourceCode" id="cb1188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1188-1"><a href="5-mod-05.html#cb1188-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>(mod3<span class="sc">$</span>deviance<span class="sc">/</span>mod3<span class="sc">$</span>null.deviance)</span></code></pre></div>
<pre><code>## [1] 0.5359137</code></pre>
<p>We can use Akaike’s information criterion (AIC) and AIC weight to compare the models.</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="5-mod-05.html#cb1190-1" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod1, mod2, mod3)</span>
<span id="cb1190-2"><a href="5-mod-05.html#cb1190-2" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>delta <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">min</span>(aic.df<span class="sc">$</span>AIC)</span>
<span id="cb1190-3"><a href="5-mod-05.html#cb1190-3" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aic.df<span class="sc">$</span>delta)</span>
<span id="cb1190-4"><a href="5-mod-05.html#cb1190-4" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aic.df<span class="sc">$</span>wt)</span>
<span id="cb1190-5"><a href="5-mod-05.html#cb1190-5" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> aic.df[<span class="fu">order</span>(<span class="sc">-</span>aic.df<span class="sc">$</span>wt),]</span>
<span id="cb1190-6"><a href="5-mod-05.html#cb1190-6" aria-hidden="true" tabindex="-1"></a>aic.df</span></code></pre></div>
<pre><code>##      df      AIC     delta           wt
## mod2  5 3177.957  0.000000 8.435910e-01
## mod3  7 3181.327  3.370387 1.564090e-01
## mod1  3 3232.765 54.807812 1.058685e-12</code></pre>
<p>The AIC weights suggest that model 2 is likely to be the best model <strong><em>of these 3 models</em></strong>. So, let’s remake the figure with model predictions using the new model 2. This figure will be a little more complicated, because we need to show predictions within each of 3 levels of diet, while also being careful not to make predictions outside of the domain of length within any diet.</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="5-mod-05.html#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of points</span></span>
<span id="cb1192-2"><a href="5-mod-05.html#cb1192-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1192-3"><a href="5-mod-05.html#cb1192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-4"><a href="5-mod-05.html#cb1192-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get range of X for each level of diet</span></span>
<span id="cb1192-5"><a href="5-mod-05.html#cb1192-5" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(len.tr<span class="sc">~</span>diet, <span class="at">data=</span>dat, range)</span>
<span id="cb1192-6"><a href="5-mod-05.html#cb1192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-7"><a href="5-mod-05.html#cb1192-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define a sequence of X values for each diet</span></span>
<span id="cb1192-8"><a href="5-mod-05.html#cb1192-8" aria-hidden="true" tabindex="-1"></a>px1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(agg<span class="sc">$</span>len.tr[<span class="dv">1</span>,<span class="dv">1</span>], agg<span class="sc">$</span>len.tr[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">length=</span>n)</span>
<span id="cb1192-9"><a href="5-mod-05.html#cb1192-9" aria-hidden="true" tabindex="-1"></a>px2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(agg<span class="sc">$</span>len.tr[<span class="dv">2</span>,<span class="dv">1</span>], agg<span class="sc">$</span>len.tr[<span class="dv">2</span>,<span class="dv">2</span>], <span class="at">length=</span>n)</span>
<span id="cb1192-10"><a href="5-mod-05.html#cb1192-10" aria-hidden="true" tabindex="-1"></a>px3 <span class="ot">&lt;-</span> <span class="fu">seq</span>(agg<span class="sc">$</span>len.tr[<span class="dv">3</span>,<span class="dv">1</span>], agg<span class="sc">$</span>len.tr[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">length=</span>n)</span>
<span id="cb1192-11"><a href="5-mod-05.html#cb1192-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-12"><a href="5-mod-05.html#cb1192-12" aria-hidden="true" tabindex="-1"></a><span class="co"># combine together to single data frame</span></span>
<span id="cb1192-13"><a href="5-mod-05.html#cb1192-13" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">diet=</span><span class="fu">rep</span>(agg<span class="sc">$</span>diet, <span class="at">each=</span>n),</span>
<span id="cb1192-14"><a href="5-mod-05.html#cb1192-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">len.tr=</span><span class="fu">c</span>(px1, px2, px3))</span>
<span id="cb1192-15"><a href="5-mod-05.html#cb1192-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-16"><a href="5-mod-05.html#cb1192-16" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions and 95% CI</span></span>
<span id="cb1192-17"><a href="5-mod-05.html#cb1192-17" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata=</span>dx,</span>
<span id="cb1192-18"><a href="5-mod-05.html#cb1192-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">se.fit=</span><span class="cn">TRUE</span>,</span>
<span id="cb1192-19"><a href="5-mod-05.html#cb1192-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1192-20"><a href="5-mod-05.html#cb1192-20" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> pred<span class="sc">$</span>fit</span>
<span id="cb1192-21"><a href="5-mod-05.html#cb1192-21" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1192-22"><a href="5-mod-05.html#cb1192-22" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1192-23"><a href="5-mod-05.html#cb1192-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-24"><a href="5-mod-05.html#cb1192-24" aria-hidden="true" tabindex="-1"></a><span class="co"># put everything in a single data frame for convenience</span></span>
<span id="cb1192-25"><a href="5-mod-05.html#cb1192-25" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>mn <span class="ot">&lt;-</span> mn</span>
<span id="cb1192-26"><a href="5-mod-05.html#cb1192-26" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>lo <span class="ot">&lt;-</span> lo</span>
<span id="cb1192-27"><a href="5-mod-05.html#cb1192-27" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>up <span class="ot">&lt;-</span> up</span>
<span id="cb1192-28"><a href="5-mod-05.html#cb1192-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-29"><a href="5-mod-05.html#cb1192-29" aria-hidden="true" tabindex="-1"></a><span class="co"># unique diets</span></span>
<span id="cb1192-30"><a href="5-mod-05.html#cb1192-30" aria-hidden="true" tabindex="-1"></a>diets <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dx<span class="sc">$</span>diet))</span>
<span id="cb1192-31"><a href="5-mod-05.html#cb1192-31" aria-hidden="true" tabindex="-1"></a>ndiets <span class="ot">&lt;-</span> <span class="fu">length</span>(diets)</span>
<span id="cb1192-32"><a href="5-mod-05.html#cb1192-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-33"><a href="5-mod-05.html#cb1192-33" aria-hidden="true" tabindex="-1"></a><span class="co"># define a color palette and add to dat for plotting</span></span>
<span id="cb1192-34"><a href="5-mod-05.html#cb1192-34" aria-hidden="true" tabindex="-1"></a><span class="co"># https://colorbrewer2.org/#type=qualitative&amp;scheme=Dark2&amp;n=3</span></span>
<span id="cb1192-35"><a href="5-mod-05.html#cb1192-35" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#1b9e77&quot;</span>, <span class="st">&quot;#d95f02&quot;</span>, <span class="st">&quot;#7570b3&quot;</span>)</span>
<span id="cb1192-36"><a href="5-mod-05.html#cb1192-36" aria-hidden="true" tabindex="-1"></a>cols2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(cols, <span class="st">&quot;30&quot;</span>)</span>
<span id="cb1192-37"><a href="5-mod-05.html#cb1192-37" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[<span class="fu">match</span>(dat<span class="sc">$</span>diet, diets)]</span></code></pre></div>
<p>Now we’re ready to make our plot. As before, we’ll assemble the plot piece by piece. The preliminary code above seems like a lot of trouble, but it will allow us to make the plot very efficiently. First we’ll make the plot and add the log X-axis. Then, we’ll use a <code>for()</code> loop to plot the predicted mean and CI for each diet. Using a loop allows us to repeat commands many times, without having to type the commands over and over.</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="5-mod-05.html#cb1193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1193-2"><a href="5-mod-05.html#cb1193-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Stomach volume (ml)&quot;</span>,</span>
<span id="cb1193-3"><a href="5-mod-05.html#cb1193-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Body length (cm)&quot;</span>,</span>
<span id="cb1193-4"><a href="5-mod-05.html#cb1193-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb1193-5"><a href="5-mod-05.html#cb1193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>)), <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>))</span>
<span id="cb1193-6"><a href="5-mod-05.html#cb1193-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">200</span>)), <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.3</span>)</span>
<span id="cb1193-7"><a href="5-mod-05.html#cb1193-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiets){</span>
<span id="cb1193-8"><a href="5-mod-05.html#cb1193-8" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx<span class="sc">$</span>diet <span class="sc">==</span> diets[i])</span>
<span id="cb1193-9"><a href="5-mod-05.html#cb1193-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(dx<span class="sc">$</span>len.tr[flag], <span class="fu">rev</span>(dx<span class="sc">$</span>len.tr[flag])),</span>
<span id="cb1193-10"><a href="5-mod-05.html#cb1193-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">y=</span><span class="fu">c</span>(dx<span class="sc">$</span>lo[flag], <span class="fu">rev</span>(dx<span class="sc">$</span>up[flag])),</span>
<span id="cb1193-11"><a href="5-mod-05.html#cb1193-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span>cols2[i])</span>
<span id="cb1193-12"><a href="5-mod-05.html#cb1193-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx<span class="sc">$</span>len.tr[flag], dx<span class="sc">$</span>mn[flag],</span>
<span id="cb1193-13"><a href="5-mod-05.html#cb1193-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span>cols[i])</span>
<span id="cb1193-14"><a href="5-mod-05.html#cb1193-14" aria-hidden="true" tabindex="-1"></a>}<span class="co">#i</span></span>
<span id="cb1193-15"><a href="5-mod-05.html#cb1193-15" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb1193-16"><a href="5-mod-05.html#cb1193-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">legend=</span>diets, <span class="at">col=</span>cols, <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-487-1.png" width="672" /></p>
<p>Here is an alternative version with each diet in its own panel:</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="5-mod-05.html#cb1194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative version in 3 panels:</span></span>
<span id="cb1194-2"><a href="5-mod-05.html#cb1194-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1194-3"><a href="5-mod-05.html#cb1194-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ndiets){</span>
<span id="cb1194-4"><a href="5-mod-05.html#cb1194-4" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx<span class="sc">$</span>diet <span class="sc">==</span> diets[i])</span>
<span id="cb1194-5"><a href="5-mod-05.html#cb1194-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(dat<span class="sc">$</span>len.tr, dat<span class="sc">$</span>vol_stom, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1194-6"><a href="5-mod-05.html#cb1194-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">&quot;Stomach volume (ml)&quot;</span>,</span>
<span id="cb1194-7"><a href="5-mod-05.html#cb1194-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;Body length (cm)&quot;</span>,</span>
<span id="cb1194-8"><a href="5-mod-05.html#cb1194-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb1194-9"><a href="5-mod-05.html#cb1194-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>)),</span>
<span id="cb1194-10"><a href="5-mod-05.html#cb1194-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">250</span>))</span>
<span id="cb1194-11"><a href="5-mod-05.html#cb1194-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">200</span>)),</span>
<span id="cb1194-12"><a href="5-mod-05.html#cb1194-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.3</span>)</span>
<span id="cb1194-13"><a href="5-mod-05.html#cb1194-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(dx<span class="sc">$</span>len.tr[flag], <span class="fu">rev</span>(dx<span class="sc">$</span>len.tr[flag])),</span>
<span id="cb1194-14"><a href="5-mod-05.html#cb1194-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">y=</span><span class="fu">c</span>(dx<span class="sc">$</span>lo[flag], <span class="fu">rev</span>(dx<span class="sc">$</span>up[flag])),</span>
<span id="cb1194-15"><a href="5-mod-05.html#cb1194-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1194-16"><a href="5-mod-05.html#cb1194-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx<span class="sc">$</span>len.tr[flag], dx<span class="sc">$</span>mn[flag],</span>
<span id="cb1194-17"><a href="5-mod-05.html#cb1194-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1194-18"><a href="5-mod-05.html#cb1194-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main=</span>diets[i])</span>
<span id="cb1194-19"><a href="5-mod-05.html#cb1194-19" aria-hidden="true" tabindex="-1"></a>    flag2 <span class="ot">&lt;-</span> <span class="fu">which</span>(dat<span class="sc">$</span>diet <span class="sc">==</span> diets[i])</span>
<span id="cb1194-20"><a href="5-mod-05.html#cb1194-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dat<span class="sc">$</span>len.tr[flag2], dat<span class="sc">$</span>vol_stom[flag2],</span>
<span id="cb1194-21"><a href="5-mod-05.html#cb1194-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch=</span><span class="dv">16</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb1194-22"><a href="5-mod-05.html#cb1194-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-488-1.png" width="864" /></p>
</div>
</div>
<div id="mod-05-poisson" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Poisson GLM for counts</h2>
<p>This is one of several sections exploring some common GLM applications. For most of these applications we will work through two examples. First, an analysis of simulated data, and second, an analysis of a real dataset. Simulating a dataset suitable for an analysis is an excellent way to learn about the analysis method, because it helps you see the relationship between the data-generating process and the analysis.</p>
<p>This module explores GLMs for <strong>count</strong> data. Count data are exactly what they sound like: values resulting from counting things. Count data take the form of non-negative integers. Non-negative integers, however, are not necessarily count data. For example, values can be rounded to the nearest integer, but they will not be counts.</p>
<p>Count data are usually well-modeled by a kind of GLM called <strong>Poisson regression</strong>. The “Poisson” part comes from the <strong>Poisson distribution</strong>, which describes counts and events that occur at a constant rate. The “regression” part of the name comes from the fact that the technique involves a linear relationship between the predictors and some function of the response.</p>
<p>In the <a href="5-mod-05.html#mod-05-quasi">next section</a> we will explore another class of models for count data that do <em>not</em> follow the Poisson distribution. These models, the <strong>quasi-Poisson</strong> and <strong>negative binomial</strong> GLMs, have an extra term that accounts for overdispersion.</p>
<p><strong>Poisson regression</strong> describes a GLM with a Poisson family and log link function. As with other GLMs, we do not fit an equation for the response values directly. Instead, we fit a linear model for the log of the expected value, and assume that the actual observed counts follow a Poisson distribution. To see what this means in practice, let’s simulate some data that might be modeled by Poisson regression.</p>
<div id="example-with-simulated-data" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Example with simulated data</h3>
<p>In this example Poisson GLM workflow we will simulate some data, analyze it, and interpret the results.</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="5-mod-05.html#cb1195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random number seed for reproducibility</span></span>
<span id="cb1195-2"><a href="5-mod-05.html#cb1195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1195-3"><a href="5-mod-05.html#cb1195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-4"><a href="5-mod-05.html#cb1195-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sample size</span></span>
<span id="cb1195-5"><a href="5-mod-05.html#cb1195-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1195-6"><a href="5-mod-05.html#cb1195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-7"><a href="5-mod-05.html#cb1195-7" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients</span></span>
<span id="cb1195-8"><a href="5-mod-05.html#cb1195-8" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb1195-9"><a href="5-mod-05.html#cb1195-9" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1195-10"><a href="5-mod-05.html#cb1195-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-11"><a href="5-mod-05.html#cb1195-11" aria-hidden="true" tabindex="-1"></a><span class="co"># x values</span></span>
<span id="cb1195-12"><a href="5-mod-05.html#cb1195-12" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb1195-13"><a href="5-mod-05.html#cb1195-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-14"><a href="5-mod-05.html#cb1195-14" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor</span></span>
<span id="cb1195-15"><a href="5-mod-05.html#cb1195-15" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb1195-16"><a href="5-mod-05.html#cb1195-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-17"><a href="5-mod-05.html#cb1195-17" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1195-18"><a href="5-mod-05.html#cb1195-18" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta)</span>
<span id="cb1195-19"><a href="5-mod-05.html#cb1195-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-20"><a href="5-mod-05.html#cb1195-20" aria-hidden="true" tabindex="-1"></a><span class="co"># response variable</span></span>
<span id="cb1195-21"><a href="5-mod-05.html#cb1195-21" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n, lambda)</span>
<span id="cb1195-22"><a href="5-mod-05.html#cb1195-22" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb1195-23"><a href="5-mod-05.html#cb1195-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-489-1.png" width="576" /></p>
<p>The relationship between <em>Y</em> and <em>X</em> looks linear, but because we are clever biologists, we know that linear models are not appropriate for two reasons. First, linear models predict continuous responses, and counts are not continuous (they are discrete). Second, linear models can predict negative responses, and counts cannot be negative. So, we will try Poisson regression because the Poisson distribution is so good at handling counts.</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="5-mod-05.html#cb1196-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1196-2"><a href="5-mod-05.html#cb1196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = poisson, data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.06284  -0.46194  -0.06797   0.39314   2.18201  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   0.9258     0.1447   6.397 1.59e-10 ***
## x             0.2089     0.0183  11.415  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 194.34  on 49  degrees of freedom
## Residual deviance:  37.16  on 48  degrees of freedom
## AIC: 241.37
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The estimated parameters are very close to the correct values! The model also explains a lot of the variation in <em>Y</em>, as seen by the pseudo-<em>R</em><sup>2</sup> of &gt; 0.8.</p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="5-mod-05.html#cb1198-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.8087827</code></pre>
<p>The next step is to plot predicted values and the original data. If you have visited any of the other modules in this course, you should be familiar with the process by now. Even if you feel comfortable generating model predictions, there are some wrinkles to be aware of when working with non-normal models. We’re going to present predictions in several ways, to illustrate the relationship between the GLM and the data.</p>
<p>First, let’s present the 95% prediction interval (PI). The PI is an interval in which 95% of values should fall. It is necessarily larger than the 95% confidence interval (CI), which is the interval where the expected value should fall. Both intervals have their uses; just be clear about which one you are using.</p>
<p>Notice that we do not request <code>se.fit=TRUE</code> in the commands below, because it is not needed to get the PI of the Poisson distribution. This is because for the Poisson distribution the expected value, mean, and variance are all the same value (i.e., <span class="math inline">\(\lambda=\mu=\sigma^2\)</span>).</p>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="5-mod-05.html#cb1200-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1200-2"><a href="5-mod-05.html#cb1200-2" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>x), <span class="fu">max</span>(dat<span class="sc">$</span>x), <span class="at">length=</span>n)</span>
<span id="cb1200-3"><a href="5-mod-05.html#cb1200-3" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1200-4"><a href="5-mod-05.html#cb1200-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1200-5"><a href="5-mod-05.html#cb1200-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1200-6"><a href="5-mod-05.html#cb1200-6" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1</span>
<span id="cb1200-7"><a href="5-mod-05.html#cb1200-7" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qpois</span>(<span class="fl">0.025</span>, mn1)</span>
<span id="cb1200-8"><a href="5-mod-05.html#cb1200-8" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qpois</span>(<span class="fl">0.975</span>, mn1)</span>
<span id="cb1200-9"><a href="5-mod-05.html#cb1200-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1200-10"><a href="5-mod-05.html#cb1200-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot:</span></span>
<span id="cb1200-11"><a href="5-mod-05.html#cb1200-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1200-12"><a href="5-mod-05.html#cb1200-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb1200-13"><a href="5-mod-05.html#cb1200-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1200-14"><a href="5-mod-05.html#cb1200-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1200-15"><a href="5-mod-05.html#cb1200-15" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1200-16"><a href="5-mod-05.html#cb1200-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-492-1.png" width="576" /></p>
<p>Notice anything odd? The 95% prediction limits increase in discrete steps rather than as smooth curves. This is because we calculated them as quantiles from the Poisson distribution, which can only take on integer values. This means that the PI can only be bounded by integer values. The plotted PI is correct, but looks odd because we are used to seeing smooth curves. It also looks odd because it includes most (if not all) values, which CI do not do.</p>
<p>The second method is a more traditional 95% CI. Unlike the PI, the CI shows the uncertainty associated with the expected value. This means that the relationship between the PI and CI is similar to the relationship between the SD and SE.</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="5-mod-05.html#cb1201-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1201-2"><a href="5-mod-05.html#cb1201-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1201-3"><a href="5-mod-05.html#cb1201-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1201-4"><a href="5-mod-05.html#cb1201-4" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1201-5"><a href="5-mod-05.html#cb1201-5" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> mn2 <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>pred2<span class="sc">$</span>se.fit</span>
<span id="cb1201-6"><a href="5-mod-05.html#cb1201-6" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> mn2 <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>pred2<span class="sc">$</span>se.fit</span>
<span id="cb1201-7"><a href="5-mod-05.html#cb1201-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1201-8"><a href="5-mod-05.html#cb1201-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1201-9"><a href="5-mod-05.html#cb1201-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb1201-10"><a href="5-mod-05.html#cb1201-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1201-11"><a href="5-mod-05.html#cb1201-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1201-12"><a href="5-mod-05.html#cb1201-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1201-13"><a href="5-mod-05.html#cb1201-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-493-1.png" width="576" /></p>
<p>Given that the Poisson distribution is defined by a single parameter that is both the mean and variance, it is worth wondering what the SE estimated by <code>se.fit=TRUE</code> in the command that created <code>pred2</code> really is (after all, it is separate from the mean!). In a nutshell, it is the SE of the expected value assuming that the expected value follows a normal distribution. This assumption turns out to be appropriate for many situations. Taking advantage of the properties of the normal distribution allowed us to use <span class="math inline">\(\pm\)</span> 1.96 SE to approximate the 95% CI (verify this with <code>qnorm(c(0.025, 0.975))</code>). Alternatively, we could have used:</p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1202-1"><a href="5-mod-05.html#cb1202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not run:</span></span>
<span id="cb1202-2"><a href="5-mod-05.html#cb1202-2" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1202-3"><a href="5-mod-05.html#cb1202-3" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span></code></pre></div>
<p>Finally, we could have also generated predictions on the link scale and transformed them to the response scale. This method is often safer than using <code>type="response</code> because the resulting predictions are <strong><em>guaranteed</em></strong> to be inside the domain of the response variable.</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="5-mod-05.html#cb1203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getting CI from link scale</span></span>
<span id="cb1203-2"><a href="5-mod-05.html#cb1203-2" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1203-3"><a href="5-mod-05.html#cb1203-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1203-4"><a href="5-mod-05.html#cb1203-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1203-5"><a href="5-mod-05.html#cb1203-5" aria-hidden="true" tabindex="-1"></a>mn3 <span class="ot">&lt;-</span> pred3<span class="sc">$</span>fit</span>
<span id="cb1203-6"><a href="5-mod-05.html#cb1203-6" aria-hidden="true" tabindex="-1"></a>lo3 <span class="ot">&lt;-</span> mn3 <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>pred3<span class="sc">$</span>se.fit</span>
<span id="cb1203-7"><a href="5-mod-05.html#cb1203-7" aria-hidden="true" tabindex="-1"></a>up3 <span class="ot">&lt;-</span> mn3 <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>pred3<span class="sc">$</span>se.fit</span>
<span id="cb1203-8"><a href="5-mod-05.html#cb1203-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-9"><a href="5-mod-05.html#cb1203-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use inverse link function from model object</span></span>
<span id="cb1203-10"><a href="5-mod-05.html#cb1203-10" aria-hidden="true" tabindex="-1"></a>mn3 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn3)</span>
<span id="cb1203-11"><a href="5-mod-05.html#cb1203-11" aria-hidden="true" tabindex="-1"></a>lo3 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo3)</span>
<span id="cb1203-12"><a href="5-mod-05.html#cb1203-12" aria-hidden="true" tabindex="-1"></a>up3 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up3)</span>
<span id="cb1203-13"><a href="5-mod-05.html#cb1203-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-14"><a href="5-mod-05.html#cb1203-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make plot</span></span>
<span id="cb1203-15"><a href="5-mod-05.html#cb1203-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1203-16"><a href="5-mod-05.html#cb1203-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb1203-17"><a href="5-mod-05.html#cb1203-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo3, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1203-18"><a href="5-mod-05.html#cb1203-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up3, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1203-19"><a href="5-mod-05.html#cb1203-19" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn3, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1203-20"><a href="5-mod-05.html#cb1203-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-495-1.png" width="576" /></p>
</div>
<div id="example-with-real-data-1" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Example with real data</h3>
<p>The study of statistical patterns in biodiversity, abundance, and ecological function across large spatial scales is called <strong>macroecology</strong>. Rather than study individual species and sites, macroecologists integrate data across many studies and databases to search for broadly applicable patterns. <span class="citation">Faurby et al. (<a href="#ref-faurby2018" role="doc-biblioref">2018</a>)</span> compiled basic biogeographic, conservation, and life history data for &gt;5800 species of mammals and published them as the database PHYLACINE. We will use the data from PHYLACINE to explore the relationship between mammal species richness and geography in the western hemisphere. The figure below shows the species richness data at 2075 systematically placed points in mainland North America and South America.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_08.jpg" /></p>
<p>The dataset <a href="https://greenquanteco.github.io/mammal_data_2021-09-08.csv">mammal_data_2021-09-08.csv</a> contains mammal species richness at about 2000 locations throughout North and South America. These points were defined by longitude and latitude in a regular grid that covered both continents. The PHYLACINE database was then queried to determine which species’ ranges overlapped each point. The result is a data frame with the species richness of each point related to its geographic coordinates<a href="literature-cited.html#fn58" class="footnote-ref" id="fnref58"><sup>58</sup></a>.</p>
<p>First, download the data and put it in your R home directory. We’ll do some data exploration before jumping into the analysis.</p>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="5-mod-05.html#cb1204-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;mammal_data_2021-09-08.csv&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb1204-2"><a href="5-mod-05.html#cb1204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##   X      long       lat rich
## 1 1 -72.50909 -52.49019   58
## 2 2 -70.99915 -52.49019   56
## 3 3 -73.26407 -51.18254   55
## 4 4 -71.75412 -51.18254   31
## 5 5 -70.24417 -51.18254   24
## 6 6 -74.01904 -49.87489   43</code></pre>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="5-mod-05.html#cb1206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1206-2"><a href="5-mod-05.html#cb1206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>rich)</span>
<span id="cb1206-3"><a href="5-mod-05.html#cb1206-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>lat)</span>
<span id="cb1206-4"><a href="5-mod-05.html#cb1206-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>lat, dat<span class="sc">$</span>rich)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-496-1.png" width="864" /></p>
<p>At first glance, it looks like mammal species richness peaks near the equator (0 = equator, + = north latitude, and - = south latitude). It also looks like the response to latitude is the same whether going north or south. So, let’s use the absolute value of latitude instead. While we’re at it, let’s try out a log-transform on richness. This makes sense because richness (1) appears highly right-skewed; and (2) must be nonnegative.</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="5-mod-05.html#cb1207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transform:</span></span>
<span id="cb1207-2"><a href="5-mod-05.html#cb1207-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>xlat <span class="ot">&lt;-</span> <span class="fu">abs</span>(dat<span class="sc">$</span>lat)</span>
<span id="cb1207-3"><a href="5-mod-05.html#cb1207-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>logrich <span class="ot">&lt;-</span> <span class="fu">log</span>(dat<span class="sc">$</span>rich)</span>
<span id="cb1207-4"><a href="5-mod-05.html#cb1207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-5"><a href="5-mod-05.html#cb1207-5" aria-hidden="true" tabindex="-1"></a><span class="co"># look again:</span></span>
<span id="cb1207-6"><a href="5-mod-05.html#cb1207-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1207-7"><a href="5-mod-05.html#cb1207-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>logrich)</span>
<span id="cb1207-8"><a href="5-mod-05.html#cb1207-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>xlat)</span>
<span id="cb1207-9"><a href="5-mod-05.html#cb1207-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>xlat, dat<span class="sc">$</span>logrich)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-497-1.png" width="864" /></p>
<p>The rightmost plot shows that there is a linear relationship between the log-transformed response variable, which represents counts, and the explanatory variable. This means we should try modeling this relationship with a GLM, with a Poisson family and log link function. The Poisson distribution is because the data are counts. The log link is used because it is the canonical link function for the Poisson family.</p>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="5-mod-05.html#cb1208-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>xlat, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1208-2"><a href="5-mod-05.html#cb1208-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1208-3"><a href="5-mod-05.html#cb1208-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check model terms:</span></span>
<span id="cb1208-4"><a href="5-mod-05.html#cb1208-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rich ~ xlat, family = poisson, data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -11.2645   -1.4664    0.0785    1.4371    8.4076  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  5.2859143  0.0038991  1355.7   &lt;2e-16 ***
## xlat        -0.0282742  0.0001219  -231.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 69333  on 2074  degrees of freedom
## Residual deviance: 11653  on 2073  degrees of freedom
## AIC: 24186
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="5-mod-05.html#cb1210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pseudo R squared:</span></span>
<span id="cb1210-2"><a href="5-mod-05.html#cb1210-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.8319267</code></pre>
<p>As before, we want to present the data with the predictions of the model, and the 95% CI of the predictions. As before, we’ll explore different ways of calculating and presenting uncertainty about the predictions. First, we’ll use the Poisson distribution to get the 95% prediction interval (the interval where 95% of values should fall). Then, we’ll use the normal approximation to get the 95% confidence interval of <span class="math inline">\(\lambda\)</span> (i.e., the interval where we are 95% certain that the true <span class="math inline">\(\lambda\)</span> falls).</p>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1212-1"><a href="5-mod-05.html#cb1212-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1212-2"><a href="5-mod-05.html#cb1212-2" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>xlat), <span class="fu">max</span>(dat<span class="sc">$</span>xlat), <span class="at">length=</span>n)</span>
<span id="cb1212-3"><a href="5-mod-05.html#cb1212-3" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xlat=</span>px)</span>
<span id="cb1212-4"><a href="5-mod-05.html#cb1212-4" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1212-5"><a href="5-mod-05.html#cb1212-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(dx),</span>
<span id="cb1212-6"><a href="5-mod-05.html#cb1212-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1212-7"><a href="5-mod-05.html#cb1212-7" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1212-8"><a href="5-mod-05.html#cb1212-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1212-9"><a href="5-mod-05.html#cb1212-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson prediction interval:</span></span>
<span id="cb1212-10"><a href="5-mod-05.html#cb1212-10" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qpois</span>(<span class="fl">0.025</span>, mn1)</span>
<span id="cb1212-11"><a href="5-mod-05.html#cb1212-11" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qpois</span>(<span class="fl">0.975</span>, mn1)</span>
<span id="cb1212-12"><a href="5-mod-05.html#cb1212-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1212-13"><a href="5-mod-05.html#cb1212-13" aria-hidden="true" tabindex="-1"></a><span class="co"># normal approximation confidence interval:</span></span>
<span id="cb1212-14"><a href="5-mod-05.html#cb1212-14" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1212-15"><a href="5-mod-05.html#cb1212-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(dx),</span>
<span id="cb1212-16"><a href="5-mod-05.html#cb1212-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1212-17"><a href="5-mod-05.html#cb1212-17" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1212-18"><a href="5-mod-05.html#cb1212-18" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1212-19"><a href="5-mod-05.html#cb1212-19" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1212-20"><a href="5-mod-05.html#cb1212-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1212-21"><a href="5-mod-05.html#cb1212-21" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1212-22"><a href="5-mod-05.html#cb1212-22" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn2)</span>
<span id="cb1212-23"><a href="5-mod-05.html#cb1212-23" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo2)</span>
<span id="cb1212-24"><a href="5-mod-05.html#cb1212-24" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up2)</span>
<span id="cb1212-25"><a href="5-mod-05.html#cb1212-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1212-26"><a href="5-mod-05.html#cb1212-26" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.main=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1212-27"><a href="5-mod-05.html#cb1212-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>xlat, dat<span class="sc">$</span>rich,</span>
<span id="cb1212-28"><a href="5-mod-05.html#cb1212-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Poisson 95% PI&quot;</span>,</span>
<span id="cb1212-29"><a href="5-mod-05.html#cb1212-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Absolute latitude (deg.)&quot;</span>,</span>
<span id="cb1212-30"><a href="5-mod-05.html#cb1212-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Species richness (R)&quot;</span>)</span>
<span id="cb1212-31"><a href="5-mod-05.html#cb1212-31" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1212-32"><a href="5-mod-05.html#cb1212-32" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1212-33"><a href="5-mod-05.html#cb1212-33" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1212-34"><a href="5-mod-05.html#cb1212-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>xlat, dat<span class="sc">$</span>rich,</span>
<span id="cb1212-35"><a href="5-mod-05.html#cb1212-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Normal approx. 95% CI&quot;</span>,</span>
<span id="cb1212-36"><a href="5-mod-05.html#cb1212-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Absolute latitude (deg.)&quot;</span>,</span>
<span id="cb1212-37"><a href="5-mod-05.html#cb1212-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Species richness (R)&quot;</span>)</span>
<span id="cb1212-38"><a href="5-mod-05.html#cb1212-38" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1212-39"><a href="5-mod-05.html#cb1212-39" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1212-40"><a href="5-mod-05.html#cb1212-40" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-499-1.png" width="864" /></p>
<p>The expected value <span class="math inline">\(\lambda\)</span> is the same for both uncertainty estimations. As expected, the PI is wider than the CI. Why is the CI so narrow? Remember that the SE is proportional to the inverse square root of the sample size (<span class="math inline">\(SE\left(x\right)=\sigma/\sqrt{n}\)</span>). The <em>n</em> of this model was very large, 2075 (try <code>nrow(dat)</code>). A model fit with smaller <em>n</em> would have a wider CI. We can see this for ourselves by refitting the model with fewer observations.</p>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="5-mod-05.html#cb1213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of x values for CI</span></span>
<span id="cb1213-2"><a href="5-mod-05.html#cb1213-2" aria-hidden="true" tabindex="-1"></a>n.pred <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1213-3"><a href="5-mod-05.html#cb1213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-4"><a href="5-mod-05.html#cb1213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of observations in each simulation</span></span>
<span id="cb1213-5"><a href="5-mod-05.html#cb1213-5" aria-hidden="true" tabindex="-1"></a>use.n <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span><span class="sc">*</span><span class="dv">10</span></span>
<span id="cb1213-6"><a href="5-mod-05.html#cb1213-6" aria-hidden="true" tabindex="-1"></a>n.sims <span class="ot">&lt;-</span> <span class="fu">length</span>(use.n)</span>
<span id="cb1213-7"><a href="5-mod-05.html#cb1213-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-8"><a href="5-mod-05.html#cb1213-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lists to hold data, models, and predicted values/CI</span></span>
<span id="cb1213-9"><a href="5-mod-05.html#cb1213-9" aria-hidden="true" tabindex="-1"></a>mod.list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, n.sims)</span>
<span id="cb1213-10"><a href="5-mod-05.html#cb1213-10" aria-hidden="true" tabindex="-1"></a>dat.list <span class="ot">&lt;-</span> mod.list</span>
<span id="cb1213-11"><a href="5-mod-05.html#cb1213-11" aria-hidden="true" tabindex="-1"></a>pred.list <span class="ot">&lt;-</span> mod.list</span>
<span id="cb1213-12"><a href="5-mod-05.html#cb1213-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-13"><a href="5-mod-05.html#cb1213-13" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models and calculate predictions in a loop</span></span>
<span id="cb1213-14"><a href="5-mod-05.html#cb1213-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb1213-15"><a href="5-mod-05.html#cb1213-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># randomly select rows from full dataset</span></span>
<span id="cb1213-16"><a href="5-mod-05.html#cb1213-16" aria-hidden="true" tabindex="-1"></a>    use.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat), use.n[i])</span>
<span id="cb1213-17"><a href="5-mod-05.html#cb1213-17" aria-hidden="true" tabindex="-1"></a>    curr.d <span class="ot">&lt;-</span> dat[use.rows,]</span>
<span id="cb1213-18"><a href="5-mod-05.html#cb1213-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1213-19"><a href="5-mod-05.html#cb1213-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model to current subset of data</span></span>
<span id="cb1213-20"><a href="5-mod-05.html#cb1213-20" aria-hidden="true" tabindex="-1"></a>    curr.m <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>xlat, <span class="at">data=</span>curr.d, <span class="at">family=</span>poisson)</span>
<span id="cb1213-21"><a href="5-mod-05.html#cb1213-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-22"><a href="5-mod-05.html#cb1213-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate predictions on current model</span></span>
<span id="cb1213-23"><a href="5-mod-05.html#cb1213-23" aria-hidden="true" tabindex="-1"></a>    curr.px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(curr.d<span class="sc">$</span>xlat), </span>
<span id="cb1213-24"><a href="5-mod-05.html#cb1213-24" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">max</span>(curr.d<span class="sc">$</span>xlat),</span>
<span id="cb1213-25"><a href="5-mod-05.html#cb1213-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length=</span>n.pred)</span>
<span id="cb1213-26"><a href="5-mod-05.html#cb1213-26" aria-hidden="true" tabindex="-1"></a>    curr.pr <span class="ot">&lt;-</span> <span class="fu">predict</span>(curr.m,</span>
<span id="cb1213-27"><a href="5-mod-05.html#cb1213-27" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">data.frame</span>(<span class="at">xlat=</span>px),</span>
<span id="cb1213-28"><a href="5-mod-05.html#cb1213-28" aria-hidden="true" tabindex="-1"></a>                       <span class="at">type=</span><span class="st">&quot;link&quot;</span>,</span>
<span id="cb1213-29"><a href="5-mod-05.html#cb1213-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1213-30"><a href="5-mod-05.html#cb1213-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store mean, upper, and lower conf. limits in a matrix</span></span>
<span id="cb1213-31"><a href="5-mod-05.html#cb1213-31" aria-hidden="true" tabindex="-1"></a>    curr.ci <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span>n.pred, <span class="at">ncol=</span><span class="dv">3</span>)</span>
<span id="cb1213-32"><a href="5-mod-05.html#cb1213-32" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">1</span>] <span class="ot">&lt;-</span> curr.pr<span class="sc">$</span>fit</span>
<span id="cb1213-33"><a href="5-mod-05.html#cb1213-33" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, curr.ci[,<span class="dv">1</span>], curr.pr<span class="sc">$</span>se.fit)</span>
<span id="cb1213-34"><a href="5-mod-05.html#cb1213-34" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, curr.ci[,<span class="dv">1</span>], curr.pr<span class="sc">$</span>se.fit)</span>
<span id="cb1213-35"><a href="5-mod-05.html#cb1213-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-36"><a href="5-mod-05.html#cb1213-36" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">1</span>] <span class="ot">&lt;-</span> curr.m<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(curr.ci[,<span class="dv">1</span>])</span>
<span id="cb1213-37"><a href="5-mod-05.html#cb1213-37" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">2</span>] <span class="ot">&lt;-</span> curr.m<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(curr.ci[,<span class="dv">2</span>])</span>
<span id="cb1213-38"><a href="5-mod-05.html#cb1213-38" aria-hidden="true" tabindex="-1"></a>    curr.ci[,<span class="dv">3</span>] <span class="ot">&lt;-</span> curr.m<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(curr.ci[,<span class="dv">3</span>])</span>
<span id="cb1213-39"><a href="5-mod-05.html#cb1213-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-40"><a href="5-mod-05.html#cb1213-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save everything to the lists</span></span>
<span id="cb1213-41"><a href="5-mod-05.html#cb1213-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (note double brackets for accessing elements of a list)</span></span>
<span id="cb1213-42"><a href="5-mod-05.html#cb1213-42" aria-hidden="true" tabindex="-1"></a>    mod.list[[i]] <span class="ot">&lt;-</span> curr.m</span>
<span id="cb1213-43"><a href="5-mod-05.html#cb1213-43" aria-hidden="true" tabindex="-1"></a>    dat.list[[i]] <span class="ot">&lt;-</span> curr.d</span>
<span id="cb1213-44"><a href="5-mod-05.html#cb1213-44" aria-hidden="true" tabindex="-1"></a>    pred.list[[i]] <span class="ot">&lt;-</span> curr.ci   </span>
<span id="cb1213-45"><a href="5-mod-05.html#cb1213-45" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Inspect the outputs to see what the simulations did. Now let’s plot the predicted values and CI for the models fitted to subsets of the data.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="5-mod-05.html#cb1214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">5.1</span>),</span>
<span id="cb1214-2"><a href="5-mod-05.html#cb1214-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>,</span>
<span id="cb1214-3"><a href="5-mod-05.html#cb1214-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1214-4"><a href="5-mod-05.html#cb1214-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.sims){</span>
<span id="cb1214-5"><a href="5-mod-05.html#cb1214-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(dat.list[[i]]<span class="sc">$</span>xlat, dat.list[[i]]<span class="sc">$</span>rich,</span>
<span id="cb1214-6"><a href="5-mod-05.html#cb1214-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>),</span>
<span id="cb1214-7"><a href="5-mod-05.html#cb1214-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;Abs. latitude&quot;</span>,</span>
<span id="cb1214-8"><a href="5-mod-05.html#cb1214-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">&quot;Species richness&quot;</span>)</span>
<span id="cb1214-9"><a href="5-mod-05.html#cb1214-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(px, pred.list[[i]][,<span class="dv">2</span>],</span>
<span id="cb1214-10"><a href="5-mod-05.html#cb1214-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1214-11"><a href="5-mod-05.html#cb1214-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(px, pred.list[[i]][,<span class="dv">3</span>],</span>
<span id="cb1214-12"><a href="5-mod-05.html#cb1214-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1214-13"><a href="5-mod-05.html#cb1214-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(px, pred.list[[i]][,<span class="dv">1</span>],</span>
<span id="cb1214-14"><a href="5-mod-05.html#cb1214-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1214-15"><a href="5-mod-05.html#cb1214-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main=</span><span class="fu">paste</span>(<span class="st">&quot;n =&quot;</span>, use.n[i]), <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb1214-16"><a href="5-mod-05.html#cb1214-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-501-1.png" width="864" /></p>
<p>The simulations show that the 95% CI of <span class="math inline">\(\lambda\)</span> narrows down very quickly as sample size increases from 10 to 60. No wonder we can’t even see the interval when the model is fit with 2075 observations!</p>
<p>Just as linear regression can be extended to multiple linear regression, Poisson regression can be extended with additional predictor variables. Remember how earlier we lumped the northern and southern hemispheres together by taking the absolute value of latitude? Let’s see if treating the hemispheres separately can improve the model fit.</p>
<p>First, make a factor that will identify the hemisphere of each observation.</p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="5-mod-05.html#cb1215-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>hemi <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dat<span class="sc">$</span>lat <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&quot;south&quot;</span>, <span class="st">&quot;north&quot;</span>)</span></code></pre></div>
<p>Next, refit the model with the new variable. We’ll test whether latitude and hemisphere interact. In other words, we’ll see whether the relationship between latitude and species richness varies by hemisphere.</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="5-mod-05.html#cb1216-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>xlat<span class="sc">*</span>hemi, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1216-2"><a href="5-mod-05.html#cb1216-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check model terms:</span></span>
<span id="cb1216-3"><a href="5-mod-05.html#cb1216-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = rich ~ xlat * hemi, family = poisson, data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -10.4317   -1.5948   -0.0442    1.3691    9.5437  
## 
## Coefficients:
##                  Estimate Std. Error  z value Pr(&gt;|z|)    
## (Intercept)     5.3418617  0.0063816  837.073   &lt;2e-16 ***
## xlat           -0.0287144  0.0001573 -182.532   &lt;2e-16 ***
## hemisouth      -0.0163170  0.0085718   -1.904    0.057 .  
## xlat:hemisouth -0.0057775  0.0003667  -15.757   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 69333  on 2074  degrees of freedom
## Residual deviance: 10964  on 2071  degrees of freedom
## AIC: 23501
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Sure enough, the interaction appears significant. The coefficients tell us that in the baseline group (northern hemisphere), <span class="math inline">\(\log(R)\)</span> decreases by 0.0287 for every extra degree of latitude away from the equator. In the southern hemisphere, the effect is stronger: for every additional degree of latitude, <span class="math inline">\(\log(R)\)</span> decreases by <span class="math inline">\((-0.0287) + (-0.0058) = 0.0345\)</span>. The coefficient for the interaction <code>xlat:hemisouth</code> is the effect on the slope (<code>xlat</code>) of being in a group other than the baseline. The fact that the effect of <code>hemisouth</code> was nonsignificant just means that the intercept of the relationship for the southern hemisphere is not significantly different than the intercept of the relationship for the northern hemisphere (can you think of a biological reason why this should be the case?).</p>
<p>Did the additional term improve the model? Not much. Recall that the model without the interaction had a pseudo-<em>R</em><sup>2</sup> of about 0.832. Still, the new model appears to be an improvement because of its much smaller AIC.</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="5-mod-05.html#cb1218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pseudo R squared:</span></span>
<span id="cb1218-2"><a href="5-mod-05.html#cb1218-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod2<span class="sc">$</span>deviance<span class="sc">/</span>mod2<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.8418692</code></pre>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="5-mod-05.html#cb1220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod1, mod2)</span></code></pre></div>
<pre><code>##      df      AIC
## mod1  2 24186.10
## mod2  4 23500.75</code></pre>
<p>We can confirm that model 2 is a better fit using a <strong>likelihood ratio test (LR test)</strong>. The easiest way is with function <code>lrtest()</code> in package <code>lmtest</code>. A LR test tests the null hypothesis that the ratio of the likelihood functions of two models is equal to 1 (or, that the natural log of this ratio is different than 0). LR tests can be used to compare GLMs that are nested: the more complicated model can be converted into the simpler model by constraining some of its parameters. In our example, model 2 can be converted into model 1 by setting the coefficients for hemisphere and latitude × hemisphere to 0. Thus, model 1 is nested within model 2. If models are not nested, then the LR test will not be valid.</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="5-mod-05.html#cb1222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code></pre></div>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre><code>## 
## Attaching package: &#39;lmtest&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     ip</code></pre>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1228-1"><a href="5-mod-05.html#cb1228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(mod1, mod2)</span></code></pre></div>
<pre><code>## Likelihood ratio test
## 
## Model 1: rich ~ xlat
## Model 2: rich ~ xlat * hemi
##   #Df LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   2 -12091                         
## 2   4 -11746  2 689.35  &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The fact that the LR test was significant shows that the fit of model 2 is significantly better than that of model 1, after penalizing for the number of parameters.</p>
<p>As always, let’s calculate the model predictions and present them with the original data. We’ll skip presenting the 95% CI, because it was so small in the previous example and won’t tell us much. In the code below we need to define predictor variables in the range actually seen for each factor.</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1230-1"><a href="5-mod-05.html#cb1230-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1230-2"><a href="5-mod-05.html#cb1230-2" aria-hidden="true" tabindex="-1"></a>flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dat<span class="sc">$</span>hemi<span class="sc">==</span><span class="st">&quot;south&quot;</span>)</span>
<span id="cb1230-3"><a href="5-mod-05.html#cb1230-3" aria-hidden="true" tabindex="-1"></a>px1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1230-4"><a href="5-mod-05.html#cb1230-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hemi=</span><span class="st">&quot;south&quot;</span>,</span>
<span id="cb1230-5"><a href="5-mod-05.html#cb1230-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlat=</span><span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>xlat[flag]),</span>
<span id="cb1230-6"><a href="5-mod-05.html#cb1230-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">max</span>(dat<span class="sc">$</span>xlat[flag]), <span class="at">length=</span>n))</span>
<span id="cb1230-7"><a href="5-mod-05.html#cb1230-7" aria-hidden="true" tabindex="-1"></a>px2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1230-8"><a href="5-mod-05.html#cb1230-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">hemi=</span><span class="st">&quot;north&quot;</span>,</span>
<span id="cb1230-9"><a href="5-mod-05.html#cb1230-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlat=</span><span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>xlat[<span class="sc">-</span>flag]),</span>
<span id="cb1230-10"><a href="5-mod-05.html#cb1230-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">max</span>(dat<span class="sc">$</span>xlat[<span class="sc">-</span>flag]), <span class="at">length=</span>n))</span>
<span id="cb1230-11"><a href="5-mod-05.html#cb1230-11" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">rbind</span>(px1, px2)</span>
<span id="cb1230-12"><a href="5-mod-05.html#cb1230-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1230-13"><a href="5-mod-05.html#cb1230-13" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, </span>
<span id="cb1230-14"><a href="5-mod-05.html#cb1230-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(dx),</span>
<span id="cb1230-15"><a href="5-mod-05.html#cb1230-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>)</span>
<span id="cb1230-16"><a href="5-mod-05.html#cb1230-16" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(pred2)</span>
<span id="cb1230-17"><a href="5-mod-05.html#cb1230-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1230-18"><a href="5-mod-05.html#cb1230-18" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>,</span>
<span id="cb1230-19"><a href="5-mod-05.html#cb1230-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1230-20"><a href="5-mod-05.html#cb1230-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb1230-21"><a href="5-mod-05.html#cb1230-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>xlat, dat<span class="sc">$</span>rich, <span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb1230-22"><a href="5-mod-05.html#cb1230-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">ifelse</span>(dat<span class="sc">$</span>hemi <span class="sc">==</span> <span class="st">&quot;south&quot;</span>, <span class="st">&quot;#FF000020&quot;</span>, <span class="st">&quot;#0000FF20&quot;</span>),</span>
<span id="cb1230-23"><a href="5-mod-05.html#cb1230-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Absolute latitude (deg.)&quot;</span>,</span>
<span id="cb1230-24"><a href="5-mod-05.html#cb1230-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Species richness (R)&quot;</span>)</span>
<span id="cb1230-25"><a href="5-mod-05.html#cb1230-25" aria-hidden="true" tabindex="-1"></a>flag1 <span class="ot">&lt;-</span> <span class="fu">which</span>(dx<span class="sc">$</span>hemi <span class="sc">==</span> <span class="st">&quot;south&quot;</span>)</span>
<span id="cb1230-26"><a href="5-mod-05.html#cb1230-26" aria-hidden="true" tabindex="-1"></a>flag2 <span class="ot">&lt;-</span> <span class="fu">which</span>(dx<span class="sc">$</span>hemi <span class="sc">!=</span> <span class="st">&quot;south&quot;</span>)</span>
<span id="cb1230-27"><a href="5-mod-05.html#cb1230-27" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px1<span class="sc">$</span>xlat, mn2[flag1], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1230-28"><a href="5-mod-05.html#cb1230-28" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px2<span class="sc">$</span>xlat, mn2[flag2], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1230-29"><a href="5-mod-05.html#cb1230-29" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,</span>
<span id="cb1230-30"><a href="5-mod-05.html#cb1230-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Northern hemisphere&quot;</span>, <span class="st">&quot;Southern hemisphere&quot;</span>),</span>
<span id="cb1230-31"><a href="5-mod-05.html#cb1230-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">cex=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-506-1.png" width="576" /></p>
<p>The figure below above that species richness falls off with distance from the equator slightly faster in the southern hemisphere than in the northern hemisphere.</p>
</div>
</div>
<div id="mod-05-quasi" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Quasi-Poisson and negative binomial GLM</h2>
<p>This section explores GLMs for <strong>overdispersed count data</strong>. Count data are exactly what they sound like: values resulting from counting things. Count data are usually well-modeled by the Poisson distribution. In the Poisson distribution, the mean and variance are the same value (i.e., <span class="math inline">\(\mu=\sigma^2\)</span>). Sometimes count data are <strong>overdispersed</strong>, which means that the variance is greater than would be expected for a Poisson distribution (i.e., <span class="math inline">\(\sigma^{2}&gt;\mu\)</span>)<a href="literature-cited.html#fn59" class="footnote-ref" id="fnref59"><sup>59</sup></a>. These data can still be modeled with GLM, but a different family is necessary to account for the overdispersion. The most common options for modeling overdispersed counts are the <strong>quasi-Poisson distribution</strong> and the <strong>negative binomial distribution</strong>. These are different distributions, and GLMs using them are technically different models, but we will see below that any situation where one is appropriate, the other is as well.</p>
<p>As useful as the Poisson distribution is for modeling counts, it has a serious limitation: the assumption that its single parameter <span class="math inline">\(\lambda\)</span> is both the mean and variance (i.e., <span class="math inline">\(\lambda=\mu=\sigma^2\)</span>). However, this is not always the case in real datasets. Many biological processes that produce counts have a variance much greater than their mean. This phenomenon is called “overdispersion” . The “over” in “overdispersion” is defined relative to the Poisson distribution. Using a different distribution in our GLM will account for the “over”. The two most common options for modeling overdispersed counts are the quasi-Poisson family and the negative binomial family.</p>
<p>The quasi-Poisson family is part of a class of <strong>quasi-likelihood</strong> models that inflate the variance to account for overdispersion <span class="citation">(<a href="#ref-bolker2008ecological" role="doc-biblioref">Bolker 2008</a>)</span>. Quasi-likelihoods add a parameter that increases the variance in a distribution. This parameter is usually called <span class="math inline">\(\phi\)</span> (Greek letter “phi”) or <span class="math inline">\(\hat{c}\)</span> (“c-hat”). This parameter is typically added as a scalar to the expression for variance, so it tends to be &gt;1. For example, the variance of a Poisson distribution is the same as its mean, <span class="math inline">\(\lambda\)</span>. The variance of a quasi-Poisson distribution is <span class="math inline">\(\phi\lambda\)</span>. The overdispersion parameter <span class="math inline">\(\phi\)</span> will be estimated by R as it fits the GLM. The disadvantage of using quasi-likelihood models is that the likelihood functions are never explicitly defined, which means that many goodness of fit measures like deviance and AIC cannot be easily calculated. <span class="citation">Burnham and Anderson (<a href="#ref-burnham2004multimodel" role="doc-biblioref">2004</a>)</span> defined a <strong>quasi-AIC (qAIC)</strong> that can be used in place of ordinary AIC for model selection procedures.</p>
<p>The <strong>negative binomial distribution</strong> can also be used as a response distribution for overdispersed count data. The negative binomial distribution has two definitions. The original definition describes the number of failures that occur in a series of Bernoulli trials until some predetermined number of successes is observed. The version of the negative binomial that biologists use is parameterized by its mean <span class="math inline">\(\mu\)</span> and its overdispersion <em>k</em>. This definition reframes the negative binomial as a Poisson distribution with parameter <span class="math inline">\(\lambda\)</span>, where <span class="math inline">\(\lambda\)</span> is a random variable that follows a Gamma distribution. In practice this is sort of like a quasi-Poisson distribution, but turns out to be easier to work with in R. Compare the variance for a quasi-Poisson distribution, <span class="math inline">\(\phi\lambda\)</span>, to the variance of a negative binomial distribution:</p>
<p><span class="math display">\[Var\left(X\right)=\mu+\frac{\mu^2}{k}\]</span></p>
<p>If the mean of a quasi-Poisson distribution is <span class="math inline">\(\lambda\)</span>, then we can do some rearranging to find that the <em>k</em> parameter of a negative binomial is equivalent to</p>
<p><span class="math display">\[k=\frac{\lambda}{\phi-1}\]</span></p>
<p>In practical terms, this means that the quasi-Poisson <span class="math inline">\(\phi\)</span> and the negative binomial <em>k</em> have opposite effects on the variance. This also means that any situation where one of these models is appropriate, the other is also appropriate. Personally, I tend to use the negative binomial because it has a well-defined likelihood (unlike quasi-Poisson) and is thus easier to work with in R.</p>
<div id="example-with-simulated-data-1" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Example with simulated data</h3>
<p>R does not have a function for drawing random numbers from a quasi-Poisson distribution, but it does have a function for drawing random numbers from a negative binomial distribution. We can take advantage of the relationship between the quasi-Poisson <span class="math inline">\(\phi\)</span> and the negative binomial <em>k</em> to define our own quasi-Poisson function:</p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="5-mod-05.html#cb1231-1" aria-hidden="true" tabindex="-1"></a>rqpois <span class="ot">&lt;-</span> <span class="cf">function</span>(n, lambda, phi){</span>
<span id="cb1231-2"><a href="5-mod-05.html#cb1231-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rnbinom</span>(<span class="at">n=</span>n, <span class="at">mu=</span>lambda, <span class="at">size=</span>lambda<span class="sc">/</span>(phi<span class="dv">-1</span>))</span>
<span id="cb1231-3"><a href="5-mod-05.html#cb1231-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1231-4"><a href="5-mod-05.html#cb1231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1231-5"><a href="5-mod-05.html#cb1231-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the variances of these distributions:</span></span>
<span id="cb1231-6"><a href="5-mod-05.html#cb1231-6" aria-hidden="true" tabindex="-1"></a>rand.pois <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">5</span>)</span>
<span id="cb1231-7"><a href="5-mod-05.html#cb1231-7" aria-hidden="true" tabindex="-1"></a>rand.qpois <span class="ot">&lt;-</span> <span class="fu">rqpois</span>(<span class="dv">100</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb1231-8"><a href="5-mod-05.html#cb1231-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rand.pois)</span></code></pre></div>
<pre><code>## [1] 4.68</code></pre>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="5-mod-05.html#cb1233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(rand.pois)</span></code></pre></div>
<pre><code>## [1] 5.351111</code></pre>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="5-mod-05.html#cb1235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(rand.qpois)</span></code></pre></div>
<pre><code>## [1] 5.66</code></pre>
<div class="sourceCode" id="cb1237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1237-1"><a href="5-mod-05.html#cb1237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(rand.qpois)</span></code></pre></div>
<pre><code>## [1] 35.11556</code></pre>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="5-mod-05.html#cb1239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb1239-2"><a href="5-mod-05.html#cb1239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rand.pois, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>), <span class="at">main=</span><span class="st">&quot;Random Poisson&quot;</span>)</span>
<span id="cb1239-3"><a href="5-mod-05.html#cb1239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(rand.qpois, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>), <span class="at">main=</span><span class="st">&quot;Random quasi-Poisson&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-507-1.png" width="768" /></p>
<p>Now let’s simulate some overdispersed count data.</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="5-mod-05.html#cb1240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1240-2"><a href="5-mod-05.html#cb1240-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb1240-3"><a href="5-mod-05.html#cb1240-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb1240-4"><a href="5-mod-05.html#cb1240-4" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">1.1</span></span>
<span id="cb1240-5"><a href="5-mod-05.html#cb1240-5" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">0.72</span></span>
<span id="cb1240-6"><a href="5-mod-05.html#cb1240-6" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb1240-7"><a href="5-mod-05.html#cb1240-7" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb1240-8"><a href="5-mod-05.html#cb1240-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-9"><a href="5-mod-05.html#cb1240-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson data</span></span>
<span id="cb1240-10"><a href="5-mod-05.html#cb1240-10" aria-hidden="true" tabindex="-1"></a>yp <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n, eta)</span>
<span id="cb1240-11"><a href="5-mod-05.html#cb1240-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-12"><a href="5-mod-05.html#cb1240-12" aria-hidden="true" tabindex="-1"></a><span class="co"># quasi-Poisson data</span></span>
<span id="cb1240-13"><a href="5-mod-05.html#cb1240-13" aria-hidden="true" tabindex="-1"></a>yq <span class="ot">&lt;-</span> <span class="fu">rqpois</span>(n, eta, phi)</span>
<span id="cb1240-14"><a href="5-mod-05.html#cb1240-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1240-15"><a href="5-mod-05.html#cb1240-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the data</span></span>
<span id="cb1240-16"><a href="5-mod-05.html#cb1240-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, yp, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>),</span>
<span id="cb1240-17"><a href="5-mod-05.html#cb1240-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>)</span>
<span id="cb1240-18"><a href="5-mod-05.html#cb1240-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, yq, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1240-19"><a href="5-mod-05.html#cb1240-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, </span>
<span id="cb1240-20"><a href="5-mod-05.html#cb1240-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Poisson&quot;</span>, <span class="st">&quot;Quasipoisson&quot;</span>),</span>
<span id="cb1240-21"><a href="5-mod-05.html#cb1240-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-508-1.png" width="576" /></p>
<p>See what the overdispersion term did? The data simulated using a quasi-Poisson distribution are much more spread out than the data simulated using the Poisson distribution. Analyzing the quasi-Poisson data as if they were Poisson distributed might lead to underestimating the variance, especially at greater <em>X</em> values.</p>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="5-mod-05.html#cb1241-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>yq)</span>
<span id="cb1241-2"><a href="5-mod-05.html#cb1241-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1241-3"><a href="5-mod-05.html#cb1241-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1241-4"><a href="5-mod-05.html#cb1241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1241-5"><a href="5-mod-05.html#cb1241-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = poisson, data = dat)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -5.223  -2.174  -1.024   1.405   5.439  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.12441    0.20218   0.615    0.538    
## x            0.15343    0.01236  12.416   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 487.11  on 39  degrees of freedom
## Residual deviance: 274.66  on 38  degrees of freedom
## AIC: 398.22
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="5-mod-05.html#cb1243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = quasipoisson, data = dat)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -5.223  -2.174  -1.024   1.405   5.439  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.12441    0.53258   0.234    0.817    
## x            0.15343    0.03255   4.713 3.24e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for quasipoisson family taken to be 6.939018)
## 
##     Null deviance: 487.11  on 39  degrees of freedom
## Residual deviance: 274.66  on 38  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>The model fits, parameter estimates, and diagnostics like deviance are essentially identical. But, as the figures below show, the Poisson GLM predicted much less variation about the mean than did the quasi-Poisson model.</p>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="5-mod-05.html#cb1245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># values for prediction</span></span>
<span id="cb1245-2"><a href="5-mod-05.html#cb1245-2" aria-hidden="true" tabindex="-1"></a>n.pr <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1245-3"><a href="5-mod-05.html#cb1245-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length=</span>n.pr)</span>
<span id="cb1245-4"><a href="5-mod-05.html#cb1245-4" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1245-5"><a href="5-mod-05.html#cb1245-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1245-6"><a href="5-mod-05.html#cb1245-6" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1245-7"><a href="5-mod-05.html#cb1245-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;response&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1245-8"><a href="5-mod-05.html#cb1245-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-9"><a href="5-mod-05.html#cb1245-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pull out predictions and calculate CI</span></span>
<span id="cb1245-10"><a href="5-mod-05.html#cb1245-10" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1245-11"><a href="5-mod-05.html#cb1245-11" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1245-12"><a href="5-mod-05.html#cb1245-12" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1245-13"><a href="5-mod-05.html#cb1245-13" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1245-14"><a href="5-mod-05.html#cb1245-14" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1245-15"><a href="5-mod-05.html#cb1245-15" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1245-16"><a href="5-mod-05.html#cb1245-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-17"><a href="5-mod-05.html#cb1245-17" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plots</span></span>
<span id="cb1245-18"><a href="5-mod-05.html#cb1245-18" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1245-19"><a href="5-mod-05.html#cb1245-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1245-20"><a href="5-mod-05.html#cb1245-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1245-21"><a href="5-mod-05.html#cb1245-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, yq, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb1245-22"><a href="5-mod-05.html#cb1245-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>,</span>
<span id="cb1245-23"><a href="5-mod-05.html#cb1245-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Poisson GLM fit&quot;</span>)</span>
<span id="cb1245-24"><a href="5-mod-05.html#cb1245-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1245-25"><a href="5-mod-05.html#cb1245-25" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1245-26"><a href="5-mod-05.html#cb1245-26" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1245-27"><a href="5-mod-05.html#cb1245-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1245-28"><a href="5-mod-05.html#cb1245-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, yq, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb1245-29"><a href="5-mod-05.html#cb1245-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>,</span>
<span id="cb1245-30"><a href="5-mod-05.html#cb1245-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Quasi-Poisson fit&quot;</span>)</span>
<span id="cb1245-31"><a href="5-mod-05.html#cb1245-31" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1245-32"><a href="5-mod-05.html#cb1245-32" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1245-33"><a href="5-mod-05.html#cb1245-33" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-510-1.png" width="768" /></p>
<p>The right plot looks reasonable, but there is one small problem: the 95% CI calculated on the response scale extends below 0, which is not defined for a Poisson distribution. So, we should have calculated the CI on the link scale and back-transformed to get values on the response scale.</p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="5-mod-05.html#cb1246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict on link scale instead:</span></span>
<span id="cb1246-2"><a href="5-mod-05.html#cb1246-2" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1246-3"><a href="5-mod-05.html#cb1246-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1246-4"><a href="5-mod-05.html#cb1246-4" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1246-5"><a href="5-mod-05.html#cb1246-5" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1246-6"><a href="5-mod-05.html#cb1246-6" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1246-7"><a href="5-mod-05.html#cb1246-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-8"><a href="5-mod-05.html#cb1246-8" aria-hidden="true" tabindex="-1"></a><span class="co"># back-transform:</span></span>
<span id="cb1246-9"><a href="5-mod-05.html#cb1246-9" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn2)</span>
<span id="cb1246-10"><a href="5-mod-05.html#cb1246-10" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo2)</span>
<span id="cb1246-11"><a href="5-mod-05.html#cb1246-11" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> mod2<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up2)</span>
<span id="cb1246-12"><a href="5-mod-05.html#cb1246-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-13"><a href="5-mod-05.html#cb1246-13" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plots</span></span>
<span id="cb1246-14"><a href="5-mod-05.html#cb1246-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1246-15"><a href="5-mod-05.html#cb1246-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1246-16"><a href="5-mod-05.html#cb1246-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.lab=</span><span class="fl">1.3</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1246-17"><a href="5-mod-05.html#cb1246-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, yq, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb1246-18"><a href="5-mod-05.html#cb1246-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>,</span>
<span id="cb1246-19"><a href="5-mod-05.html#cb1246-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Poisson GLM fit&quot;</span>)</span>
<span id="cb1246-20"><a href="5-mod-05.html#cb1246-20" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1246-21"><a href="5-mod-05.html#cb1246-21" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1246-22"><a href="5-mod-05.html#cb1246-22" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1246-23"><a href="5-mod-05.html#cb1246-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1246-24"><a href="5-mod-05.html#cb1246-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, yq, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb1246-25"><a href="5-mod-05.html#cb1246-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>,</span>
<span id="cb1246-26"><a href="5-mod-05.html#cb1246-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">&quot;Quasi-Poisson fit&quot;</span>)</span>
<span id="cb1246-27"><a href="5-mod-05.html#cb1246-27" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1246-28"><a href="5-mod-05.html#cb1246-28" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1246-29"><a href="5-mod-05.html#cb1246-29" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-511-1.png" width="768" /></p>
<p>Notice that the lower confidence limit does not dip below 0 in the revised quasi-Poisson plot. The CI is somewhat asymmetrical, but that’s okay and not at all uncommon with log-transformed data or in models with log-link functions.</p>
</div>
<div id="example-with-real-data-2" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Example with real data</h3>
<p>The US National Oceanic and Atmospheric Administration (NOAA) conducts periodic coral reef surveys in the Atlantic and Caribbean to monitor coral status (NOAA 2018). For this example, we will use <a href="https://www.coris.noaa.gov/monitoring/biological.html">data from 2016-2018</a> to explore the relationship between coral species richness and environmental factors. The survey sites are shown on the map below in relation to mainland Florida, the Keys, and the Tortugas<a href="literature-cited.html#fn60" class="footnote-ref" id="fnref60"><sup>60</sup></a>.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_09.jpg" /></p>
<p>Download the dataset <a href="https://greenquanteco.github.io/coral_glm_example.csv">coral_glm_example.csv</a> and put it in your R home directory.</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="5-mod-05.html#cb1247-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;coral_glm_example.csv&quot;</span></span>
<span id="cb1247-2"><a href="5-mod-05.html#cb1247-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The dataset contains many variables, but we are interested in the following:</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Units</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>date</code></td>
<td>Days</td>
<td>Date sample was taken</td>
</tr>
<tr class="even">
<td><code>lat</code></td>
<td>°N</td>
<td>North latitude</td>
</tr>
<tr class="odd">
<td><code>long</code></td>
<td>°E</td>
<td>Degrees east longitude</td>
</tr>
<tr class="even">
<td><code>rugo</code></td>
<td>Unitless</td>
<td>Index of bottom roughness (rugosity)</td>
</tr>
<tr class="odd">
<td><code>dep</code></td>
<td>m</td>
<td>Mean depth of coral transect</td>
</tr>
<tr class="even">
<td><code>region</code></td>
<td>Unitless</td>
<td>Geographic region where sample was taken</td>
</tr>
<tr class="odd">
<td><code>rich</code></td>
<td>Species</td>
<td>Number of coral species recorded on transect</td>
</tr>
</tbody>
</table>
<p>Let’s start by using histograms and scatterplot matrices to get a sense of what patterns might exist in the data.</p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="5-mod-05.html#cb1248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##        date      lat      long      rugo     dep   region rich
## 1 5/12/2016 24.72435 -82.81070 0.8433333 16.3068 Tortugas    8
## 2 5/12/2016 24.72367 -82.78785 0.4900000 16.3068 Tortugas    8
## 3 5/12/2016 24.72623 -82.80449 0.1766667 17.0688 Tortugas    1
## 4 5/12/2016 24.71759 -82.80542 0.2966667 13.4112 Tortugas    7
## 5 5/12/2016 24.71971 -82.81462 0.6300000 11.1252 Tortugas    5
## 6 5/12/2016 24.72118 -82.80761 0.8833333 12.4968 Tortugas    9</code></pre>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="5-mod-05.html#cb1250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb1250-2"><a href="5-mod-05.html#cb1250-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>lat)</span>
<span id="cb1250-3"><a href="5-mod-05.html#cb1250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>long)</span>
<span id="cb1250-4"><a href="5-mod-05.html#cb1250-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>rugo)</span>
<span id="cb1250-5"><a href="5-mod-05.html#cb1250-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>dep)</span>
<span id="cb1250-6"><a href="5-mod-05.html#cb1250-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>rich)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-513-1.png" width="864" /></p>
<p>The histograms suggest that latitude and rugosity might cause problems because of how many observations are clustered around a few values. Perhaps a log-transform would help? The plots from the commands below suggest not.</p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="5-mod-05.html#cb1251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb1251-2"><a href="5-mod-05.html#cb1251-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>lat)</span>
<span id="cb1251-3"><a href="5-mod-05.html#cb1251-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(dat<span class="sc">$</span>lat))</span>
<span id="cb1251-4"><a href="5-mod-05.html#cb1251-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>rugo)</span>
<span id="cb1251-5"><a href="5-mod-05.html#cb1251-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(dat<span class="sc">$</span>rugo))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-514-1.png" width="576" /></p>
<p>Next, search for patterns in the dataset using some scatterplot matrices. We will make use of the custom function <code>panel.cor()</code>, which can be found in the examples in the help page for function <code>pairs()</code>.</p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="5-mod-05.html#cb1252-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make day of year a number</span></span>
<span id="cb1252-2"><a href="5-mod-05.html#cb1252-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>doy <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(dat<span class="sc">$</span>date), <span class="st">&quot;%j&quot;</span>))</span>
<span id="cb1252-3"><a href="5-mod-05.html#cb1252-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1252-4"><a href="5-mod-05.html#cb1252-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scatterplot matrices to explore</span></span>
<span id="cb1252-5"><a href="5-mod-05.html#cb1252-5" aria-hidden="true" tabindex="-1"></a>panel.cor <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">digits =</span> <span class="dv">2</span>, <span class="at">prefix =</span> <span class="st">&quot;&quot;</span>, cex.cor, ...)</span>
<span id="cb1252-6"><a href="5-mod-05.html#cb1252-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb1252-7"><a href="5-mod-05.html#cb1252-7" aria-hidden="true" tabindex="-1"></a>    usr <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="st">&quot;usr&quot;</span>); <span class="fu">on.exit</span>(<span class="fu">par</span>(usr))</span>
<span id="cb1252-8"><a href="5-mod-05.html#cb1252-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">usr =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1252-9"><a href="5-mod-05.html#cb1252-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">cor</span>(x, y))</span>
<span id="cb1252-10"><a href="5-mod-05.html#cb1252-10" aria-hidden="true" tabindex="-1"></a>    txt <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">c</span>(r, <span class="fl">0.123456789</span>), <span class="at">digits =</span> digits)[<span class="dv">1</span>]</span>
<span id="cb1252-11"><a href="5-mod-05.html#cb1252-11" aria-hidden="true" tabindex="-1"></a>    txt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(prefix, txt)</span>
<span id="cb1252-12"><a href="5-mod-05.html#cb1252-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">missing</span>(cex.cor)) cex.cor <span class="ot">&lt;-</span> <span class="fl">0.8</span><span class="sc">/</span><span class="fu">strwidth</span>(txt)</span>
<span id="cb1252-13"><a href="5-mod-05.html#cb1252-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, txt, <span class="at">cex =</span> cex.cor <span class="sc">*</span> r)</span>
<span id="cb1252-14"><a href="5-mod-05.html#cb1252-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1252-15"><a href="5-mod-05.html#cb1252-15" aria-hidden="true" tabindex="-1"></a>num.cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;rich&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;long&quot;</span>, <span class="st">&quot;rugo&quot;</span>, <span class="st">&quot;dep&quot;</span>, <span class="st">&quot;doy&quot;</span>)</span>
<span id="cb1252-16"><a href="5-mod-05.html#cb1252-16" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(dat[,num.cols], <span class="at">lower.panel =</span> panel.smooth,</span>
<span id="cb1252-17"><a href="5-mod-05.html#cb1252-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper.panel =</span> panel.cor, <span class="at">gap=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-515-1.png" width="768" /></p>
<p>It appears that richness is somewhat correlated with latitude, longitude, and rugosity. Interestingly, latitude and longitude appear correlated. Can you think of why? (Hint: plot the coordinates and compare to a map of the Florida Keys). Because latitude and longitude are correlated, we should probably not fit a model with both of these variables included.</p>
<p>Based on the scatterplot matrix, it appears that latitude, longitude, and rugosity are most likely to be the variables driving coral species richness. There is a factor in our dataset, region, that also appears to play a role. However, we won’t model region with latitude or longitude because it is confounded with both.</p>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="5-mod-05.html#cb1253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># possible effect of region, confounded with lat/long</span></span>
<span id="cb1253-2"><a href="5-mod-05.html#cb1253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb1253-3"><a href="5-mod-05.html#cb1253-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(rich<span class="sc">~</span>region, <span class="at">data=</span>dat)</span>
<span id="cb1253-4"><a href="5-mod-05.html#cb1253-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(lat<span class="sc">~</span>region, <span class="at">data=</span>dat)</span>
<span id="cb1253-5"><a href="5-mod-05.html#cb1253-5" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(long<span class="sc">~</span>region, <span class="at">data=</span>dat)</span>
<span id="cb1253-6"><a href="5-mod-05.html#cb1253-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(rugo<span class="sc">~</span>region, <span class="at">data=</span>dat)</span>
<span id="cb1253-7"><a href="5-mod-05.html#cb1253-7" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(dep<span class="sc">~</span>region, <span class="at">data=</span>dat)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-516-1.png" width="864" /></p>
<p>Finally, we suspect that there might be overdispersion in our response variable richness. This can be checked comparing the mean and variance of its distribution. Recall that a Poisson distribution has a single parameter <span class="math inline">\(\lambda\)</span> that is both its mean and variance. If the variance of a count variable is larger than its mean, overdispersion should be suspected.</p>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1254-1"><a href="5-mod-05.html#cb1254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># possible overdispersion because var() &gt; mean()</span></span>
<span id="cb1254-2"><a href="5-mod-05.html#cb1254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(dat<span class="sc">$</span>rich)</span></code></pre></div>
<pre><code>## [1] 11.15052</code></pre>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1256-1"><a href="5-mod-05.html#cb1256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat<span class="sc">$</span>rich)</span></code></pre></div>
<pre><code>## [1] 6.504601</code></pre>
<p>How much larger than the mean can variance be before we start to worry about overdispersion? Opinions differ. Some authors use the ratio <span class="math inline">\(\rho=\sigma^{2}/\mu\)</span> to define a rule of thumb (note that <span class="math inline">\(\rho\)</span> is the Greek letter “rho”, not the Latin letter “p”). The threshold <span class="math inline">\(\rho\)</span> varies by author: values as small as 2 and as large as 50 can be found in the literature! Our value, 1.71, is not very concerning but we should be aware of possible overdispersion anyway.</p>
<p>The commands below define some models that we will compare using information theoretic methods (i.e., AIC). We will not fit and compare every possible combination of predictors. Instead, we will fit only a narrow subset suggested by the exploratory data analysis. Julian date (<code>doy</code>, for “day of year”) is not considered. The only model with two continuous predictors has longitude and depth. Any other pair has some risk of collinearity. Region will only be tested by itself because the other variables appear to vary by region. Finally, we will test two versions of each model: one with a Poisson family, and another with a quasi-Poisson family that accounts for overdispersion.</p>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="5-mod-05.html#cb1258-1" aria-hidden="true" tabindex="-1"></a>mod01 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>lat, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-2"><a href="5-mod-05.html#cb1258-2" aria-hidden="true" tabindex="-1"></a>mod02 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>long, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-3"><a href="5-mod-05.html#cb1258-3" aria-hidden="true" tabindex="-1"></a>mod03 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>rugo, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-4"><a href="5-mod-05.html#cb1258-4" aria-hidden="true" tabindex="-1"></a>mod04 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>dep, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-5"><a href="5-mod-05.html#cb1258-5" aria-hidden="true" tabindex="-1"></a>mod05 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>long<span class="sc">+</span>dep, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-6"><a href="5-mod-05.html#cb1258-6" aria-hidden="true" tabindex="-1"></a>mod06 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>region, <span class="at">data=</span>dat, <span class="at">family=</span>poisson)</span>
<span id="cb1258-7"><a href="5-mod-05.html#cb1258-7" aria-hidden="true" tabindex="-1"></a>mod07 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>lat, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1258-8"><a href="5-mod-05.html#cb1258-8" aria-hidden="true" tabindex="-1"></a>mod08 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>long, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1258-9"><a href="5-mod-05.html#cb1258-9" aria-hidden="true" tabindex="-1"></a>mod09 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>rugo, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1258-10"><a href="5-mod-05.html#cb1258-10" aria-hidden="true" tabindex="-1"></a>mod10 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>dep, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1258-11"><a href="5-mod-05.html#cb1258-11" aria-hidden="true" tabindex="-1"></a>mod11 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>long<span class="sc">+</span>dep, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span>
<span id="cb1258-12"><a href="5-mod-05.html#cb1258-12" aria-hidden="true" tabindex="-1"></a>mod12 <span class="ot">&lt;-</span> <span class="fu">glm</span>(rich<span class="sc">~</span>region, <span class="at">data=</span>dat, <span class="at">family=</span>quasipoisson)</span></code></pre></div>
<p>Next, we will use Akaike’s information criterion (AIC) to compare the goodness-of-fit of the models. Recall that AIC rewards predictive ability and penalizes model complexity (i.e., number of parameters), with smaller AIC indicating better fit.</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="5-mod-05.html#cb1259-1" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod01, mod02, mod03,</span>
<span id="cb1259-2"><a href="5-mod-05.html#cb1259-2" aria-hidden="true" tabindex="-1"></a>             mod04, mod05, mod06,</span>
<span id="cb1259-3"><a href="5-mod-05.html#cb1259-3" aria-hidden="true" tabindex="-1"></a>             mod07, mod08, mod09,</span>
<span id="cb1259-4"><a href="5-mod-05.html#cb1259-4" aria-hidden="true" tabindex="-1"></a>             mod10, mod11, mod12)</span>
<span id="cb1259-5"><a href="5-mod-05.html#cb1259-5" aria-hidden="true" tabindex="-1"></a>aicdf</span></code></pre></div>
<pre><code>##       df      AIC
## mod01  2 3131.119
## mod02  2 3254.461
## mod03  2 3287.994
## mod04  2 3567.371
## mod05  3 3256.438
## mod06  3 3128.355
## mod07  2       NA
## mod08  2       NA
## mod09  2       NA
## mod10  2       NA
## mod11  3       NA
## mod12  3       NA</code></pre>
<p>The table of AIC values illustrates a downside of using quasi-likelihoods: because the likelihood is not actually defined, it is hard to calculate an AIC value (which depends on the likelihood function). There is such a thing as a “quasi-AIC” that you can use. But, we can take advantage of the fact that the quasi-Poisson and negative binomial are more or less interchangeable and refit models 7-12 using the negative binomial family. The base <code>glm()</code> function does not fit negative binomial GLMs, but there are a few options for negative binomial GLMs in add-on packages. We will use the function <code>glm.nb()</code> from package <code>MASS</code>.</p>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="5-mod-05.html#cb1261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1261-2"><a href="5-mod-05.html#cb1261-2" aria-hidden="true" tabindex="-1"></a>mod13 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(rich<span class="sc">~</span>lat, <span class="at">data=</span>dat)</span>
<span id="cb1261-3"><a href="5-mod-05.html#cb1261-3" aria-hidden="true" tabindex="-1"></a>mod14 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span> (rich<span class="sc">~</span>long, <span class="at">data=</span>dat)</span>
<span id="cb1261-4"><a href="5-mod-05.html#cb1261-4" aria-hidden="true" tabindex="-1"></a>mod15 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span> (rich<span class="sc">~</span>rugo, <span class="at">data=</span>dat)</span>
<span id="cb1261-5"><a href="5-mod-05.html#cb1261-5" aria-hidden="true" tabindex="-1"></a>mod16 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span> (rich<span class="sc">~</span>dep, <span class="at">data=</span>dat)</span>
<span id="cb1261-6"><a href="5-mod-05.html#cb1261-6" aria-hidden="true" tabindex="-1"></a>mod17 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span> (rich<span class="sc">~</span>long<span class="sc">+</span>dep, <span class="at">data=</span>dat)</span>
<span id="cb1261-7"><a href="5-mod-05.html#cb1261-7" aria-hidden="true" tabindex="-1"></a>mod18 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span> (rich<span class="sc">~</span>region, <span class="at">data=</span>dat)</span>
<span id="cb1261-8"><a href="5-mod-05.html#cb1261-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1261-9"><a href="5-mod-05.html#cb1261-9" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate AIC</span></span>
<span id="cb1261-10"><a href="5-mod-05.html#cb1261-10" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod01, mod02, mod03,</span>
<span id="cb1261-11"><a href="5-mod-05.html#cb1261-11" aria-hidden="true" tabindex="-1"></a>             mod04, mod05, mod06,</span>
<span id="cb1261-12"><a href="5-mod-05.html#cb1261-12" aria-hidden="true" tabindex="-1"></a>             mod13, mod14, mod15,</span>
<span id="cb1261-13"><a href="5-mod-05.html#cb1261-13" aria-hidden="true" tabindex="-1"></a>             mod16, mod17, mod18)</span>
<span id="cb1261-14"><a href="5-mod-05.html#cb1261-14" aria-hidden="true" tabindex="-1"></a>aicdf</span></code></pre></div>
<pre><code>##       df      AIC
## mod01  2 3131.119
## mod02  2 3254.461
## mod03  2 3287.994
## mod04  2 3567.371
## mod05  3 3256.438
## mod06  3 3128.355
## mod13  3 3126.964
## mod14  3 3235.538
## mod15  3 3260.363
## mod16  3 3439.161
## mod17  4 3237.537
## mod18  4 3126.858</code></pre>
<p>Next we calculate and use the <strong>AIC weight</strong> to determine which of these models is most likely to be best-fitting. <strong><em>This is not the same as calculating the probability that any particular model is correct</em></strong>. Rather, the AIC weight represents the probability that each model is the best-fitting of the models included in the AIC weight calculation.</p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="5-mod-05.html#cb1263-1" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> aicdf[<span class="fu">order</span>(aicdf<span class="sc">$</span>AIC),]</span>
<span id="cb1263-2"><a href="5-mod-05.html#cb1263-2" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>delta <span class="ot">&lt;-</span> aicdf<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">min</span>(aicdf<span class="sc">$</span>AIC)</span>
<span id="cb1263-3"><a href="5-mod-05.html#cb1263-3" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aicdf<span class="sc">$</span>delta)</span>
<span id="cb1263-4"><a href="5-mod-05.html#cb1263-4" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>wt <span class="ot">&lt;-</span> aicdf<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aicdf<span class="sc">$</span>wt)</span>
<span id="cb1263-5"><a href="5-mod-05.html#cb1263-5" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> aicdf[<span class="fu">order</span>(<span class="sc">-</span>aicdf<span class="sc">$</span>wt),]</span>
<span id="cb1263-6"><a href="5-mod-05.html#cb1263-6" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>cumsum <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(aicdf<span class="sc">$</span>wt)</span>
<span id="cb1263-7"><a href="5-mod-05.html#cb1263-7" aria-hidden="true" tabindex="-1"></a>aicdf</span></code></pre></div>
<pre><code>##       df      AIC       delta           wt    cumsum
## mod18  4 3126.858   0.0000000 3.937070e-01 0.3937070
## mod13  3 3126.964   0.1062192 3.733429e-01 0.7670499
## mod06  3 3128.355   1.4976903 1.861889e-01 0.9532388
## mod01  2 3131.119   4.2611044 4.676124e-02 1.0000000
## mod14  3 3235.538 108.6804455 9.897242e-25 1.0000000
## mod17  4 3237.537 110.6791284 3.643391e-25 1.0000000
## mod02  2 3254.461 127.6037518 7.697868e-29 1.0000000
## mod05  3 3256.438 129.5806317 2.864814e-29 1.0000000
## mod15  3 3260.363 133.5057437 4.025031e-30 1.0000000
## mod03  2 3287.994 161.1360641 4.026441e-36 1.0000000
## mod16  3 3439.161 312.3037967 6.015411e-69 1.0000000
## mod04  2 3567.371 440.5134831 8.687317e-97 1.0000000</code></pre>
<p>The AIC weights suggest that models 18 and 13 are most likely to be the best models, because they have the greatest AIC weights and their AIC weights are nearly equal. Model 18 is the negative binomial GLM with only region as a predictor; model 13 is the negative binomial GLM with only latitude as a predictor. Recall from above that latitude and region are strongly related to each other: latitude increases from the Tortugas to the Keys (FLK) and to southeast Florida (SEFCRI). So, it shouldn’t be surprising that these two models were nearly equivalent as measured by AIC. Because both models 18 and 13 have nearly equivalent support, we should present the predictions of both. In lieu of “predictions” of model 18, which has only factors as predictors, you can simply present the mean and SD or 95% CI within each group.</p>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1265-1"><a href="5-mod-05.html#cb1265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting values for groups (model 18)</span></span>
<span id="cb1265-2"><a href="5-mod-05.html#cb1265-2" aria-hidden="true" tabindex="-1"></a>agg1 <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(rich<span class="sc">~</span>region, <span class="at">data=</span>dat, mean)</span>
<span id="cb1265-3"><a href="5-mod-05.html#cb1265-3" aria-hidden="true" tabindex="-1"></a>agg1<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(lat<span class="sc">~</span>region, <span class="at">data=</span>dat, median)<span class="sc">$</span>lat</span>
<span id="cb1265-4"><a href="5-mod-05.html#cb1265-4" aria-hidden="true" tabindex="-1"></a>agg1<span class="sc">$</span>sd <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(rich<span class="sc">~</span>region, <span class="at">data=</span>dat, sd)<span class="sc">$</span>rich</span>
<span id="cb1265-5"><a href="5-mod-05.html#cb1265-5" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder by latitude</span></span>
<span id="cb1265-6"><a href="5-mod-05.html#cb1265-6" aria-hidden="true" tabindex="-1"></a>agg1<span class="ot">&lt;-</span> agg1[<span class="fu">order</span>(agg1<span class="sc">$</span>lat),]</span>
<span id="cb1265-7"><a href="5-mod-05.html#cb1265-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-8"><a href="5-mod-05.html#cb1265-8" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> agg1<span class="sc">$</span>rich <span class="sc">-</span> agg1<span class="sc">$</span>sd</span>
<span id="cb1265-9"><a href="5-mod-05.html#cb1265-9" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> agg1<span class="sc">$</span>rich <span class="sc">+</span> agg1<span class="sc">$</span>sd</span>
<span id="cb1265-10"><a href="5-mod-05.html#cb1265-10" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> agg1<span class="sc">$</span>rich</span>
<span id="cb1265-11"><a href="5-mod-05.html#cb1265-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-12"><a href="5-mod-05.html#cb1265-12" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted values for model 13 (continuous predictor)</span></span>
<span id="cb1265-13"><a href="5-mod-05.html#cb1265-13" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1265-14"><a href="5-mod-05.html#cb1265-14" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>lat), <span class="fu">max</span>(dat<span class="sc">$</span>lat), <span class="at">length=</span>n)</span>
<span id="cb1265-15"><a href="5-mod-05.html#cb1265-15" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod13, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">lat=</span>px),</span>
<span id="cb1265-16"><a href="5-mod-05.html#cb1265-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1265-17"><a href="5-mod-05.html#cb1265-17" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1265-18"><a href="5-mod-05.html#cb1265-18" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1265-19"><a href="5-mod-05.html#cb1265-19" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1265-20"><a href="5-mod-05.html#cb1265-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-21"><a href="5-mod-05.html#cb1265-21" aria-hidden="true" tabindex="-1"></a><span class="co"># back-transform to response scale</span></span>
<span id="cb1265-22"><a href="5-mod-05.html#cb1265-22" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> mod13<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn2)</span>
<span id="cb1265-23"><a href="5-mod-05.html#cb1265-23" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> mod13<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo2)</span>
<span id="cb1265-24"><a href="5-mod-05.html#cb1265-24" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> mod13<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up2)</span>
<span id="cb1265-25"><a href="5-mod-05.html#cb1265-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-26"><a href="5-mod-05.html#cb1265-26" aria-hidden="true" tabindex="-1"></a><span class="co"># define some colors for the model 13 plot</span></span>
<span id="cb1265-27"><a href="5-mod-05.html#cb1265-27" aria-hidden="true" tabindex="-1"></a>sites <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>region))</span>
<span id="cb1265-28"><a href="5-mod-05.html#cb1265-28" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">length</span>(sites))</span>
<span id="cb1265-29"><a href="5-mod-05.html#cb1265-29" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[<span class="fu">match</span>(dat<span class="sc">$</span>region, sites)]</span>
<span id="cb1265-30"><a href="5-mod-05.html#cb1265-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-31"><a href="5-mod-05.html#cb1265-31" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot</span></span>
<span id="cb1265-32"><a href="5-mod-05.html#cb1265-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">lend=</span><span class="dv">1</span>, </span>
<span id="cb1265-33"><a href="5-mod-05.html#cb1265-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>), <span class="at">cex.axis=</span><span class="fl">1.3</span>,</span>
<span id="cb1265-34"><a href="5-mod-05.html#cb1265-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.lab=</span><span class="fl">1.3</span>)</span>
<span id="cb1265-35"><a href="5-mod-05.html#cb1265-35" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, mn1, <span class="at">pch=</span><span class="dv">15</span>, <span class="at">cex=</span><span class="fl">1.3</span>, <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1265-36"><a href="5-mod-05.html#cb1265-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Region&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">3.5</span>),</span>
<span id="cb1265-37"><a href="5-mod-05.html#cb1265-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;Species richness&quot;</span>)</span>
<span id="cb1265-38"><a href="5-mod-05.html#cb1265-38" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, lo1, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, up1, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1265-39"><a href="5-mod-05.html#cb1265-39" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">labels=</span>agg1<span class="sc">$</span>region)</span>
<span id="cb1265-40"><a href="5-mod-05.html#cb1265-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-41"><a href="5-mod-05.html#cb1265-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Species richness&quot;</span>,</span>
<span id="cb1265-42"><a href="5-mod-05.html#cb1265-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>))</span>
<span id="cb1265-43"><a href="5-mod-05.html#cb1265-43" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">xlab=</span><span class="fu">expression</span>(Latitude<span class="sc">~</span>(degree<span class="sc">*</span>N)))</span>
<span id="cb1265-44"><a href="5-mod-05.html#cb1265-44" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1265-45"><a href="5-mod-05.html#cb1265-45" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1265-46"><a href="5-mod-05.html#cb1265-46" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1265-47"><a href="5-mod-05.html#cb1265-47" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>lat, dat<span class="sc">$</span>rich, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb1265-48"><a href="5-mod-05.html#cb1265-48" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span>sites, <span class="at">pch=</span><span class="dv">1</span>, <span class="at">col=</span>cols)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-522-1.png" width="768" /></p>
<p>The negative binomial model accounts for the fact that the data show more variability than would be expected under a Poisson distribution, and can be worked with in R much more easily than can the quasi-Poisson. The two fitted models should be presented together and compared. The authors should point out the relationship between latitude and region evident in the data. Another strategy for handling these data might be mixed models.</p>
</div>
</div>
<div id="mod-05-logistic" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Logistic regression for binary outcomes</h2>
<p>This section explores GLMs for <strong>binary outcomes</strong>. Binary outcomes are results that take one of two values: survival vs. non-survival, presence vs. absence, reproduction vs. not-reproducing, and so on. These data are usually coded as 1 and 0: 1 when the event occurs, and 0 when the event does not. No other values are allowed. The standard technique for modeling binary outcomes is <strong>logistic regression</strong>. This name refers to a GLM with a binomial family and logit link function.</p>
<p><strong>Logistic regression</strong> is a technique for modeling the probability of a binary outcome: survival vs. death, reproductive vs. not reproductive, present vs. absent, etc. The response variable <em>Y</em> takes value 1 when the event occurs, and value 0 when the event does not occur. For each observation <em>i</em>, success occurs as the outcome of a Bernoulli trial with probability <em>p</em><sub>i</sub>. The logit of <em>p</em><sub>i</sub> (i.e., the logarithm of the odds that <em>Y</em> = 1) is modeled as a linear function of the predictor variables.</p>
<p><span class="math display">\[Y_i \sim Bernoulli\left(p_i\right)\]</span>
<span class="math display">\[logit\left(p_i\right)=\log{\left(\frac{p_i}{1-p_i}\right)}=\beta_0+\beta_1X_i\]</span></p>
<p>The inverse link function is the <strong>logistic function</strong>, which is also where the name “logistic regression” comes from:</p>
<p><span class="math display">\[logistic\left(x\right)=\frac{e^x}{1+e^x}\]</span></p>
<p>The linear predictor in logistic regression predicts the “log-odds” of an event occurring. The unit of the log-odds scale is the <strong>logistic unit</strong>, or <strong>logit</strong>. The logit link function is useful because it allows the outcome of a linear function–which can take on any real value–to be mapped smoothly to the natural domain of probabilities, the open interval (0, 1). A key consequence of this link function is that increasing the value of one of the predictor variables by 1 will scale the log-odds by a constant. That constant is the coefficient estimated for the predictor.</p>
<p>The logistic regression model was developed in the 1940s, decades before the GLM was first proposed. Part of the development of the idea of the GLM was recognizing that many previously known models were actually special cases of a more general model. In GLM terms, we say that logistic regression is a GLM with a binomial family and logit link function.</p>
<div id="example-with-simulated-data-2" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Example with simulated data</h3>
<p>As with the other GLM applications, we’ll start by simulating a suitable dataset and analyzing it. The code below will execute the simulation. Remember to set the random number seed for reproducibility.</p>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="5-mod-05.html#cb1266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1266-2"><a href="5-mod-05.html#cb1266-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1266-3"><a href="5-mod-05.html#cb1266-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">12</span>), <span class="dv">1</span>)</span>
<span id="cb1266-4"><a href="5-mod-05.html#cb1266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-5"><a href="5-mod-05.html#cb1266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients</span></span>
<span id="cb1266-6"><a href="5-mod-05.html#cb1266-6" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb1266-7"><a href="5-mod-05.html#cb1266-7" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb1266-8"><a href="5-mod-05.html#cb1266-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-9"><a href="5-mod-05.html#cb1266-9" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor</span></span>
<span id="cb1266-10"><a href="5-mod-05.html#cb1266-10" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb1266-11"><a href="5-mod-05.html#cb1266-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-12"><a href="5-mod-05.html#cb1266-12" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic function (inverse link)</span></span>
<span id="cb1266-13"><a href="5-mod-05.html#cb1266-13" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(eta)</span>
<span id="cb1266-14"><a href="5-mod-05.html#cb1266-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-15"><a href="5-mod-05.html#cb1266-15" aria-hidden="true" tabindex="-1"></a><span class="co"># draw y values (stochastic part)</span></span>
<span id="cb1266-16"><a href="5-mod-05.html#cb1266-16" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, prob)</span>
<span id="cb1266-17"><a href="5-mod-05.html#cb1266-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-18"><a href="5-mod-05.html#cb1266-18" aria-hidden="true" tabindex="-1"></a><span class="co"># assemble dataset</span></span>
<span id="cb1266-19"><a href="5-mod-05.html#cb1266-19" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb1266-20"><a href="5-mod-05.html#cb1266-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-21"><a href="5-mod-05.html#cb1266-21" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the data:</span></span>
<span id="cb1266-22"><a href="5-mod-05.html#cb1266-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##      x y
## 1  3.5 1
## 2  9.5 1
## 3  4.9 1
## 4 10.6 1
## 5 11.3 1
## 6  0.5 0</code></pre>
<p>Unlike other sorts of regression problems, plotting <em>Y</em> vs. <em>X</em> isn’t very illuminating:</p>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="5-mod-05.html#cb1268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-524-1.png" width="480" /></p>
<p>If you have a lot of duplicate coordinates, it can be hard to get a sense of how many 0s and 1s are in the dataset. The scatterplot above is also a little silly because most of the <em>Y</em>-axis range is not occupied. We can use function <code>jitter()</code> to add some random noise to the <em>Y</em>-values; this will help us see what is going on.</p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="5-mod-05.html#cb1269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">jitter</span>(y))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-525-1.png" width="480" /></p>
<p>Another way to explore binary data is with a boxplot. A boxplot can show whether <em>X</em> tends to be smaller or greater when <em>Y</em> = 1; this is sort of the reverse of the question we are really asking, but it helps us make sense of the data as we explore.</p>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="5-mod-05.html#cb1270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(x<span class="sc">~</span>y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-526-1.png" width="480" /></p>
<p>The boxplot agrees with the scatterplot: <em>Y</em> seems more likely to occur at greater values of <em>X</em>. Making the boxplot horizontal makes the agreement more clear:</p>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="5-mod-05.html#cb1271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(x<span class="sc">~</span>y, <span class="at">horizontal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-527-1.png" width="480" /></p>
<p>Logistic regression is fit using the <code>glm()</code> function. By definition, logistic regression is a GLM with a binomial family and logit link function. You don’t need to specify the link function in R, as the binomial family uses the logit link function by default.</p>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="5-mod-05.html#cb1272-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span>binomial)</span>
<span id="cb1272-2"><a href="5-mod-05.html#cb1272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = binomial, data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -2.25927   0.02705   0.06648   0.29492   1.30865  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)  -3.7713     1.8349  -2.055   0.0399 *
## x             0.9909     0.4001   2.477   0.0133 *
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 32.596  on 29  degrees of freedom
## Residual deviance: 13.193  on 28  degrees of freedom
## AIC: 17.193
## 
## Number of Fisher Scoring iterations: 7</code></pre>
<p>The parameter estimates are pretty close to the correct values. We can calculate the pseudo-<em>R</em><sup>2</sup> as usual:</p>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1274-1"><a href="5-mod-05.html#cb1274-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.5952722</code></pre>
<p>The pseudo-<em>R</em><sup>2</sup> is pretty good for only having 30 observations. But, you should probably consider using AUC instead of pseudo-<em>R</em><sup>2</sup> (see below). The next step is to generate and plot the model predictions. For logistic regression models, predictions should be calculated on the link scale and back-transformed to get probabilities.</p>
<div class="sourceCode" id="cb1276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1276-1"><a href="5-mod-05.html#cb1276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># values for prediction</span></span>
<span id="cb1276-2"><a href="5-mod-05.html#cb1276-2" aria-hidden="true" tabindex="-1"></a>use.n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1276-3"><a href="5-mod-05.html#cb1276-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>x), <span class="fu">max</span>(dat<span class="sc">$</span>x), <span class="at">length=</span>use.n)</span>
<span id="cb1276-4"><a href="5-mod-05.html#cb1276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1276-5"><a href="5-mod-05.html#cb1276-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions and 95% CI (link scale)</span></span>
<span id="cb1276-6"><a href="5-mod-05.html#cb1276-6" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1276-7"><a href="5-mod-05.html#cb1276-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1276-8"><a href="5-mod-05.html#cb1276-8" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> pred<span class="sc">$</span>fit</span>
<span id="cb1276-9"><a href="5-mod-05.html#cb1276-9" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1276-10"><a href="5-mod-05.html#cb1276-10" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn, pred<span class="sc">$</span>se.fit)</span>
<span id="cb1276-11"><a href="5-mod-05.html#cb1276-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1276-12"><a href="5-mod-05.html#cb1276-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function to get probabilities</span></span>
<span id="cb1276-13"><a href="5-mod-05.html#cb1276-13" aria-hidden="true" tabindex="-1"></a>mn <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn)</span>
<span id="cb1276-14"><a href="5-mod-05.html#cb1276-14" aria-hidden="true" tabindex="-1"></a>lo <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo)</span>
<span id="cb1276-15"><a href="5-mod-05.html#cb1276-15" aria-hidden="true" tabindex="-1"></a>up <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up)</span></code></pre></div>
<p>Now make the plot. The argument <code>xpd=NA</code> to <code>points()</code> makes sure that all points are plotted, even those that fall outside of the plot area. This is needed because <code>plot()</code> defines the plot area using the maximum <em>Y</em> value (1), but some of the jittered <em>Y</em> values will be &lt;0 or &gt; 1 and thus won’t get plotted. We’ll use a polygon instead of the usual lines to show the 95% CI of the predicted probability.</p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="5-mod-05.html#cb1277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>), </span>
<span id="cb1277-2"><a href="5-mod-05.html#cb1277-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>,</span>
<span id="cb1277-3"><a href="5-mod-05.html#cb1277-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.lab=</span><span class="fl">1.3</span>)</span>
<span id="cb1277-4"><a href="5-mod-05.html#cb1277-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>x, dat<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, </span>
<span id="cb1277-5"><a href="5-mod-05.html#cb1277-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">&quot;p(Y)&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>))</span>
<span id="cb1277-6"><a href="5-mod-05.html#cb1277-6" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)), </span>
<span id="cb1277-7"><a href="5-mod-05.html#cb1277-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span><span class="fu">c</span>(lo, <span class="fu">rev</span>(up)), <span class="co"># REVerse either upper or lower</span></span>
<span id="cb1277-8"><a href="5-mod-05.html#cb1277-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1277-9"><a href="5-mod-05.html#cb1277-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1277-10"><a href="5-mod-05.html#cb1277-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>x, <span class="fu">jitter</span>(dat<span class="sc">$</span>y, <span class="at">amount=</span><span class="fl">0.05</span>),</span>
<span id="cb1277-11"><a href="5-mod-05.html#cb1277-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex=</span><span class="fl">1.1</span>, <span class="at">xpd=</span><span class="cn">NA</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-531-1.png" width="576" /></p>
</div>
<div id="example-with-real-data-3" class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Example with real data</h3>
<p><span class="citation">Bubrig et al. (<a href="#ref-bubrig2020" role="doc-biblioref">2020</a>)</span> studied the influence of bacteria on the emergence of nematodes (<em>Caenorhabditis elegans</em>) from their dormant state. <em>C</em>. <em>elegans</em> sometimes enter a dormant state called a <strong>dauer</strong> that permits larvae to survive long periods of adverse conditions and to disperse long distances by passive transportation. The figure below shows the place of the dauer state in the normal <em>C</em>. <em>elegans</em> life cycle <span class="citation">(<a href="#ref-bubrig2020" role="doc-biblioref">Bubrig et al. 2020</a>)</span>. Previous work had shown that successful colonization of new habitats by <em>C</em>. <em>elegans</em> is heavily influenced by the nearby bacterial community. The authors investigated whether the bacterial community could affect the emergence of individual worms from their dormant state.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/05_10.jpg" /></p>
<p>In their experiment, they inoculated plates with one of three strains of <em>C</em>. <em>elegans</em> and one of five species of bacteria (or no bacteria as a control). After some time, the plates were treated with a chemical known to kill worms not in the dauer stage. The researchers then surveyed the plates and recorded each dead worm (which had emerged) as 1 and each worm still in dauer state (i.e., not emerged) as 0.</p>
<p>Download the dataset <a href="https://greenquanteco.github.io/bubrig_2020_data.csv">bubrig_2020_data.csv</a> and put it in your R working directory.</p>
<div class="sourceCode" id="cb1278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1278-1"><a href="5-mod-05.html#cb1278-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;bubrig_2020_data.csv&quot;</span></span>
<span id="cb1278-2"><a href="5-mod-05.html#cb1278-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb1278-3"><a href="5-mod-05.html#cb1278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##   trial repl strain   treat     dose y   categ
## 1     1    1     N2 Control 418.3225 1 Control
## 2     1    1     N2 Control 418.3225 1 Control
## 3     1    2     N2 Control 418.3225 1 Control
## 4     1    3     N2 Control 418.3225 1 Control
## 5     1    3     N2 Control 418.3225 1 Control
## 6     1    3     N2 Control 418.3225 1 Control</code></pre>
<p>We suspect that the response variable <code>y</code> is related to the predictors <code>strain</code> (of worm) and <code>treat</code> (“treatment” of bacteria). Both of these predictor variables are factors, so scatterplots won’t be very helpful. Instead, we can try some methods for visualizing categorical data. The function <code>mosaicplot()</code> produces a plot that partitions the observations by different combinations of factors<a href="literature-cited.html#fn61" class="footnote-ref" id="fnref61"><sup>61</sup></a>:</p>
<div class="sourceCode" id="cb1280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1280-1"><a href="5-mod-05.html#cb1280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(strain<span class="sc">~</span>y, <span class="at">data=</span>dat, <span class="at">color=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-533-1.png" width="864" /></p>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="5-mod-05.html#cb1281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(treat<span class="sc">~</span>y, <span class="at">data=</span>dat, <span class="at">color=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-533-2.png" width="864" /></p>
<p>Observations can be split by an arbitrary number of factors:</p>
<div class="sourceCode" id="cb1282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1282-1"><a href="5-mod-05.html#cb1282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(strain<span class="sc">~</span>treat<span class="sc">+</span>y, <span class="at">data=</span>dat, <span class="at">color=</span><span class="cn">TRUE</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-534-1.png" width="864" /></p>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="5-mod-05.html#cb1283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(treat<span class="sc">~</span>strain<span class="sc">+</span>y, <span class="at">data=</span>dat, <span class="at">color=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-534-2.png" width="864" /></p>
<p>As you might have guessed, <strong>mosaic plots</strong> are a graphical way of representing a <strong>contingency table</strong>. Mosaic plots are great tools for data exploration, but don’t often make it into publications because they use a great deal of space and ink relative to the amount of information they convey. The equivalent contingency tables can be seen with the commands below:</p>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1284-1"><a href="5-mod-05.html#cb1284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(y<span class="sc">~</span>strain, <span class="at">data=</span>dat)</span></code></pre></div>
<pre><code>##        y    0    1
## strain            
## CB4856   3925 2527
## JU1395   3007 3890
## N2       3755 1967</code></pre>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1286-1"><a href="5-mod-05.html#cb1286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(y<span class="sc">~</span>treat, <span class="at">data=</span>dat)</span></code></pre></div>
<pre><code>##             y    0    1
## treat                  
## Control       1662 1051
## EColi         1539 1254
## Providencia   1533 1408
## Pseudomonas   1735 1260
## Raoultella    1973 1639
## Serratia      2245 1772</code></pre>
<div class="sourceCode" id="cb1288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1288-1"><a href="5-mod-05.html#cb1288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(y<span class="sc">~</span>strain<span class="sc">+</span>treat, <span class="at">data=</span>dat)</span></code></pre></div>
<pre><code>##                    y   0   1
## strain treat                
## CB4856 Control       681 330
##        EColi         548 406
##        Providencia   571 324
##        Pseudomonas   559 337
##        Raoultella    752 506
##        Serratia      814 624
## JU1395 Control       518 530
##        EColi         490 541
##        Providencia   375 750
##        Pseudomonas   519 593
##        Raoultella    594 780
##        Serratia      511 696
## N2     Control       463 191
##        EColi         501 307
##        Providencia   587 334
##        Pseudomonas   657 330
##        Raoultella    627 353
##        Serratia      920 452</code></pre>
<p>Because we have a binary response variable, our first option should be logistic regression. Notice that we still call this model logistic “regression” even though there are no continuous predictors. Another name might be a “Binomial ANOVA”, in the same way that a regular ANOVA is just a special case of linear models. Just as we did in the Poisson regression examples, we will fit several models with different predictors and compare their efficacy using information theoretic methods.</p>
<p>For this example, we’re going to define model formulas ahead of time and fit the models in a loop. This is because the code for each model differs only in one part, the formula. Having the formulas in a separate vector and the models in a list will also make it easier to construct the AIC table for model selection. To match the original analysis done by <span class="citation">Bubrig et al. (<a href="#ref-bubrig2020" role="doc-biblioref">2020</a>)</span>, we should treat strain <code>N2</code> as the baseline. To do this, we need to re-specify the factor strain.</p>
<div class="sourceCode" id="cb1290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1290-1"><a href="5-mod-05.html#cb1290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to factor if not already</span></span>
<span id="cb1290-2"><a href="5-mod-05.html#cb1290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dat<span class="sc">$</span>strain)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb1292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1292-1"><a href="5-mod-05.html#cb1292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if &quot;character&quot;, run next line:</span></span>
<span id="cb1292-2"><a href="5-mod-05.html#cb1292-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>strain <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(dat<span class="sc">$</span>strain)</span>
<span id="cb1292-3"><a href="5-mod-05.html#cb1292-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>strain <span class="ot">&lt;-</span> <span class="fu">relevel</span>(dat<span class="sc">$</span>strain, <span class="at">ref=</span><span class="st">&quot;N2&quot;</span>)</span></code></pre></div>
<p>Now we define the model formulas and fit the models.</p>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="5-mod-05.html#cb1293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define some model formulas</span></span>
<span id="cb1293-2"><a href="5-mod-05.html#cb1293-2" aria-hidden="true" tabindex="-1"></a>forms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;y~strain&quot;</span>, <span class="st">&quot;y~treat&quot;</span>, </span>
<span id="cb1293-3"><a href="5-mod-05.html#cb1293-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;y~strain+treat&quot;</span>, <span class="st">&quot;y~strain*treat&quot;</span>)</span>
<span id="cb1293-4"><a href="5-mod-05.html#cb1293-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1293-5"><a href="5-mod-05.html#cb1293-5" aria-hidden="true" tabindex="-1"></a><span class="co"># make a list to hold models</span></span>
<span id="cb1293-6"><a href="5-mod-05.html#cb1293-6" aria-hidden="true" tabindex="-1"></a>mlist <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(forms))</span>
<span id="cb1293-7"><a href="5-mod-05.html#cb1293-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1293-8"><a href="5-mod-05.html#cb1293-8" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models in a loop</span></span>
<span id="cb1293-9"><a href="5-mod-05.html#cb1293-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(forms)){</span>
<span id="cb1293-10"><a href="5-mod-05.html#cb1293-10" aria-hidden="true" tabindex="-1"></a>    mlist[[i]] <span class="ot">&lt;-</span> <span class="fu">glm</span>(forms[i], <span class="at">data=</span>dat, <span class="at">family=</span>binomial)</span>
<span id="cb1293-11"><a href="5-mod-05.html#cb1293-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Constructing the AIC table is made easy; all we have to do is pull AIC values from the list. Compare this to the method in the <a href="5-mod-05.html#mod-05-quasi">previous section</a>, where we had to type out each model’s name.</p>
<div class="sourceCode" id="cb1294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1294-1"><a href="5-mod-05.html#cb1294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># construct AIC table</span></span>
<span id="cb1294-2"><a href="5-mod-05.html#cb1294-2" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">mod=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(forms),</span>
<span id="cb1294-3"><a href="5-mod-05.html#cb1294-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">form=</span>forms,</span>
<span id="cb1294-4"><a href="5-mod-05.html#cb1294-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">aic=</span><span class="fu">sapply</span>(mlist, AIC))</span>
<span id="cb1294-5"><a href="5-mod-05.html#cb1294-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1294-6"><a href="5-mod-05.html#cb1294-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate AIC weights                 </span></span>
<span id="cb1294-7"><a href="5-mod-05.html#cb1294-7" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> aicdf[<span class="fu">order</span>(aicdf<span class="sc">$</span>aic),]</span>
<span id="cb1294-8"><a href="5-mod-05.html#cb1294-8" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>delta <span class="ot">&lt;-</span> aicdf<span class="sc">$</span>aic <span class="sc">-</span> <span class="fu">min</span>(aicdf<span class="sc">$</span>aic)</span>
<span id="cb1294-9"><a href="5-mod-05.html#cb1294-9" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aicdf<span class="sc">$</span>delta)</span>
<span id="cb1294-10"><a href="5-mod-05.html#cb1294-10" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>wt <span class="ot">&lt;-</span> aicdf<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aicdf<span class="sc">$</span>wt)</span>
<span id="cb1294-11"><a href="5-mod-05.html#cb1294-11" aria-hidden="true" tabindex="-1"></a>aicdf <span class="ot">&lt;-</span> aicdf[<span class="fu">order</span>(<span class="sc">-</span>aicdf<span class="sc">$</span>wt),]</span>
<span id="cb1294-12"><a href="5-mod-05.html#cb1294-12" aria-hidden="true" tabindex="-1"></a>aicdf<span class="sc">$</span>cumsum <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(aicdf<span class="sc">$</span>wt)</span>
<span id="cb1294-13"><a href="5-mod-05.html#cb1294-13" aria-hidden="true" tabindex="-1"></a>aicdf</span></code></pre></div>
<pre><code>##   mod           form      aic     delta            wt cumsum
## 4   4 y~strain*treat 25356.38   0.00000  1.000000e+00      1
## 3   3 y~strain+treat 25400.32  43.93681  2.879002e-10      1
## 1   1       y~strain 25457.15 100.76847  1.313424e-22      1
## 2   2        y~treat 26114.37 757.98983 2.538633e-165      1</code></pre>
<p>The AIC table suggests that the model with an interaction is by far the most likely to be the best-fitting model of these four. In a publication, the AIC weight for model 4 should be reported as <strong>&gt; 0.9999</strong> and the other models as <strong>&lt;0.0001</strong>, not the values shown here (the printed AIC = 1 for model 4 cannot be correct if any other model has a weight &gt; 0; there is an R precision issue here). Let’s check the summary table and see if that is reasonable. We should also compare the summary table to the mosaic plots. The command below shows another advantage of keeping models in a list: we can call models by their position in the ordered AIC table.</p>
<div class="sourceCode" id="cb1296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1296-1"><a href="5-mod-05.html#cb1296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlist[[aicdf<span class="sc">$</span>mod[<span class="dv">1</span>]]])</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = forms[i], family = binomial, data = dat)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.482  -1.014  -0.894   1.168   1.569  
## 
## Coefficients:
##                               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                   -0.88545    0.08600 -10.296  &lt; 2e-16 ***
## strainCB4856                   0.16098    0.10906   1.476 0.139917    
## strainJU1395                   0.90836    0.10589   8.578  &lt; 2e-16 ***
## treatEColi                     0.39570    0.11247   3.518 0.000434 ***
## treatProvidencia               0.32157    0.10997   2.924 0.003453 ** 
## treatPseudomonas               0.19686    0.10931   1.801 0.071700 .  
## treatRaoultella                0.31098    0.10873   2.860 0.004237 ** 
## treatSerratia                  0.17476    0.10342   1.690 0.091047 .  
## strainCB4856:treatEColi        0.02885    0.14641   0.197 0.843775    
## strainJU1395:treatEColi       -0.31958    0.14267  -2.240 0.025092 *  
## strainCB4856:treatProvidencia -0.16375    0.14639  -1.119 0.263322    
## strainJU1395:treatProvidencia  0.34868    0.14110   2.471 0.013471 *  
## strainCB4856:treatPseudomonas  0.02154    0.14561   0.148 0.882395    
## strainJU1395:treatPseudomonas -0.08647    0.13921  -0.621 0.534473    
## strainCB4856:treatRaoultella   0.01729    0.14010   0.123 0.901753    
## strainJU1395:treatRaoultella  -0.06146    0.13640  -0.451 0.652285    
## strainCB4856:treatSerratia     0.28390    0.13426   2.115 0.034464 *  
## strainJU1395:treatSerratia     0.11132    0.13381   0.832 0.405476    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 26159  on 19070  degrees of freedom
## Residual deviance: 25320  on 19053  degrees of freedom
## AIC: 25356
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>In a typical ANOVA, the coefficients for each factor represent the difference in means from the baseline. In this logistic regression model, the coefficients represent differences in the log of the odds ratio. Recall that the link scale for logistic regression is the log of the odds ratio. The odds ratio of an event with probability <em>p</em> is <span class="math inline">\(p/(1-p)\)</span>. In practical terms, this describes the relative likelihood of an event occurring. For example, if the odds ratio for treatment <em>A</em> vs. <em>control</em> is 1.8, then the event is 1.8 times more likely to occur in treatment group <em>A</em>. Alternatively, being in treatment <em>A</em> increases the probability of the event by a factor of 1.8. The SE of the coefficient can be used to estimate a 95% CI of the odds ratio.</p>
<div class="sourceCode" id="cb1298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1298-1"><a href="5-mod-05.html#cb1298-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">summary</span>(mlist[[<span class="dv">4</span>]])<span class="sc">$</span>coefficients</span>
<span id="cb1298-2"><a href="5-mod-05.html#cb1298-2" aria-hidden="true" tabindex="-1"></a>coefs</span></code></pre></div>
<pre><code>##                                  Estimate Std. Error     z value     Pr(&gt;|z|)
## (Intercept)                   -0.88545363 0.08599663 -10.2963755 7.316629e-25
## strainCB4856                   0.16098397 0.10906031   1.4761005 1.399169e-01
## strainJU1395                   0.90835539 0.10589011   8.5782836 9.629926e-18
## treatEColi                     0.39569527 0.11246670   3.5183329 4.342673e-04
## treatProvidencia               0.32156980 0.10996822   2.9242066 3.453355e-03
## treatPseudomonas               0.19686226 0.10930596   1.8010204 7.169966e-02
## treatRaoultella                0.31097514 0.10873444   2.8599508 4.237067e-03
## treatSerratia                  0.17476214 0.10341550   1.6899028 9.104656e-02
## strainCB4856:treatEColi        0.02885225 0.14640819   0.1970672 8.437750e-01
## strainJU1395:treatEColi       -0.31958315 0.14267199  -2.2399852 2.509188e-02
## strainCB4856:treatProvidencia -0.16374584 0.14638809  -1.1185735 2.633221e-01
## strainJU1395:treatProvidencia  0.34867562 0.14110387   2.4710563 1.347146e-02
## strainCB4856:treatPseudomonas  0.02154085 0.14561178   0.1479334 8.823953e-01
## strainJU1395:treatPseudomonas -0.08647351 0.13920564  -0.6211926 5.344729e-01
## strainCB4856:treatRaoultella   0.01729485 0.14009989   0.1234466 9.017535e-01
## strainJU1395:treatRaoultella  -0.06146231 0.13640390  -0.4505905 6.522847e-01
## strainCB4856:treatSerratia     0.28389752 0.13425558   2.1146050 3.446363e-02
## strainJU1395:treatSerratia     0.11131617 0.13381251   0.8318816 4.054758e-01</code></pre>
<p>In our model, we have an interaction, so interpreting the coefficients is tricky. The interaction term between strain and treatment means that the effects of strain and the effects of treatment should not be interpreted by themselves. Let’s start with the coefficients in a simpler version of the model, the one without the interaction:</p>
<p>Let’s interpret the terms from top to bottom. The <code>Intercept</code> term describes the expectation for an observation with all factors at their baseline values (strain = <code>N2</code>, treatment = <code>control</code>). We can translate this to a probability using the inverse logit function:</p>
<div class="sourceCode" id="cb1300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1300-1"><a href="5-mod-05.html#cb1300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(coefs[<span class="dv">1</span>,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 0.2920489</code></pre>
<p>So, an N2 worm in the control treatment has a 0.29 probability of emerging from dauer.</p>
<p>The next two coefficients, <code>strainCB4856</code> and <code>strainJU1395</code>, describe the odds ratios of animals from the other worm strains, in the control group. The odds ratios for emerging from dauer while being in one of those strains instead of the baseline strain are obtained by exponentiating the estimates.</p>
<div class="sourceCode" id="cb1302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1302-1"><a href="5-mod-05.html#cb1302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## strainCB4856 strainJU1395 
##     1.174666     2.480240</code></pre>
<p>This means that a CB4856 worm in the control treatment would be 1.17 times more likely to emerge than an N2 worm in the control group, and a JU1395 worm in the control treatment would be 2.48 times as likely to emerge as an N2 worm in the control group. The 95% CI for those odds ratios are:</p>
<div class="sourceCode" id="cb1304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1304-1"><a href="5-mod-05.html#cb1304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## strainCB4856 strainJU1395 
##    0.9485942    2.0153861</code></pre>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1306-1"><a href="5-mod-05.html#cb1306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## strainCB4856 strainJU1395 
##     1.454616     3.052314</code></pre>
<p>So, within the control treatment, CB4856 worms are 1.17 times more likely to emerge, and we are 95% confident that the odds ratio is in the interval [0.948, 1.455].</p>
<p>The next set of coefficients, <code>treatEColi</code>, <code>treatProvidencia</code>, <code>treatPseudomonas</code>, <code>treatRaoultella</code>, and <code>treatSerratia</code>, are the effects of the bacterial treatments for worms in the control strain <code>N2</code>. So, N2 worms exposed to <em>E</em>. <em>coli</em> are 1.485 times as likely to emerge as control worms, with a 95% CI of [1.19, 1.85].</p>
<div class="sourceCode" id="cb1308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1308-1"><a href="5-mod-05.html#cb1308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">4</span>,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 1.485417</code></pre>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1310-1"><a href="5-mod-05.html#cb1310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">4</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">4</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 1.191557</code></pre>
<div class="sourceCode" id="cb1312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1312-1"><a href="5-mod-05.html#cb1312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">4</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">4</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 1.851748</code></pre>
<p>Now that we understand what the main effects represent, we need to understand what the main effects are not. The coefficients for the main effects (i.e., effects that are not part of the interaction) are the effects of changing one factor with the other factor held at its baseline. The main effects coefficients are <strong><em>NOT</em></strong> the overall effect of any factor. Talking about the “overall effect of a factor” or “independent effect of a factor” doesn’t even make sense in the presence of an interaction. This is because the effect of each factor affects the effects of the other. <em>This is the definition of an interaction</em>. In our example, the coefficient <code>0.16098397</code> estimated for strainCB4856 applies only for worms in the baseline strain, not for worms in other strains.</p>
<p>The interaction coefficients describe the changes in odds ratio for observations when both the strain and treatment factors are different from their baselines. For example, <code>strainCB4856:treatEColi</code> is the effect of worm strain CB4856 and treatment <em>E</em>. <em>coli</em> relative to worm strain N2 and the control treatment: 1.02 times, 95% CI [0.77, 1.37].</p>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1314-1"><a href="5-mod-05.html#cb1314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">9</span>,<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## [1] 1.029273</code></pre>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1316-1"><a href="5-mod-05.html#cb1316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">9</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">9</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 0.7725119</code></pre>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="5-mod-05.html#cb1318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(coefs[<span class="dv">9</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">1.96</span><span class="sc">*</span>coefs[<span class="dv">9</span>,<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## [1] 1.371373</code></pre>
<p>We can use R to construct a table of the odds ratios for each treatment; this table can be presented as a result or used to build a figure.</p>
<div class="sourceCode" id="cb1320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1320-1"><a href="5-mod-05.html#cb1320-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">summary</span>(mlist[[<span class="dv">4</span>]])<span class="sc">$</span>coefficients</span>
<span id="cb1320-2"><a href="5-mod-05.html#cb1320-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(coefs)</span>
<span id="cb1320-3"><a href="5-mod-05.html#cb1320-3" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> coefs[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>)]</span>
<span id="cb1320-4"><a href="5-mod-05.html#cb1320-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(coefs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;est&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;p&quot;</span>)</span>
<span id="cb1320-5"><a href="5-mod-05.html#cb1320-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-6"><a href="5-mod-05.html#cb1320-6" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>strain <span class="ot">&lt;-</span> <span class="st">&quot;N2&quot;</span></span>
<span id="cb1320-7"><a href="5-mod-05.html#cb1320-7" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>strain[<span class="fu">grep</span>(<span class="st">&quot;CB4856&quot;</span>, <span class="fu">rownames</span>(coefs))] <span class="ot">&lt;-</span> <span class="st">&quot;CB4856&quot;</span></span>
<span id="cb1320-8"><a href="5-mod-05.html#cb1320-8" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>strain[<span class="fu">grep</span>(<span class="st">&quot;JU1395&quot;</span>, <span class="fu">rownames</span>(coefs))] <span class="ot">&lt;-</span> <span class="st">&quot;JU1395&quot;</span></span>
<span id="cb1320-9"><a href="5-mod-05.html#cb1320-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-10"><a href="5-mod-05.html#cb1320-10" aria-hidden="true" tabindex="-1"></a>treats <span class="ot">&lt;-</span> mlist[[<span class="dv">4</span>]]<span class="sc">$</span>xlevels<span class="sc">$</span>treat</span>
<span id="cb1320-11"><a href="5-mod-05.html#cb1320-11" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>trt <span class="ot">&lt;-</span> <span class="st">&quot;Control&quot;</span></span>
<span id="cb1320-12"><a href="5-mod-05.html#cb1320-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(treats)){</span>
<span id="cb1320-13"><a href="5-mod-05.html#cb1320-13" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">grep</span>(treats[i], <span class="fu">rownames</span>(coefs))</span>
<span id="cb1320-14"><a href="5-mod-05.html#cb1320-14" aria-hidden="true" tabindex="-1"></a>    coefs<span class="sc">$</span>trt[flag] <span class="ot">&lt;-</span> treats[i]</span>
<span id="cb1320-15"><a href="5-mod-05.html#cb1320-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1320-16"><a href="5-mod-05.html#cb1320-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-17"><a href="5-mod-05.html#cb1320-17" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder using order from original factors</span></span>
<span id="cb1320-18"><a href="5-mod-05.html#cb1320-18" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>strain <span class="ot">&lt;-</span> <span class="fu">factor</span>(coefs<span class="sc">$</span>strain, <span class="at">levels=</span>mlist[[<span class="dv">4</span>]]<span class="sc">$</span>xlevels<span class="sc">$</span>strain)</span>
<span id="cb1320-19"><a href="5-mod-05.html#cb1320-19" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>trt <span class="ot">&lt;-</span> <span class="fu">factor</span>(coefs<span class="sc">$</span>trt, <span class="at">levels=</span>treats)</span>
<span id="cb1320-20"><a href="5-mod-05.html#cb1320-20" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> coefs[<span class="fu">order</span>(coefs<span class="sc">$</span>strain, coefs<span class="sc">$</span>trt),]</span>
<span id="cb1320-21"><a href="5-mod-05.html#cb1320-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-22"><a href="5-mod-05.html#cb1320-22" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate odds ratios</span></span>
<span id="cb1320-23"><a href="5-mod-05.html#cb1320-23" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>or <span class="ot">&lt;-</span> <span class="fu">exp</span>(coefs<span class="sc">$</span>est)</span>
<span id="cb1320-24"><a href="5-mod-05.html#cb1320-24" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>lo <span class="ot">&lt;-</span> coefs<span class="sc">$</span>or <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>coefs<span class="sc">$</span>se</span>
<span id="cb1320-25"><a href="5-mod-05.html#cb1320-25" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>up <span class="ot">&lt;-</span> coefs<span class="sc">$</span>or <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>coefs<span class="sc">$</span>se</span>
<span id="cb1320-26"><a href="5-mod-05.html#cb1320-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-27"><a href="5-mod-05.html#cb1320-27" aria-hidden="true" tabindex="-1"></a><span class="co"># significant?</span></span>
<span id="cb1320-28"><a href="5-mod-05.html#cb1320-28" aria-hidden="true" tabindex="-1"></a>coefs<span class="sc">$</span>sig <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(coefs<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1320-29"><a href="5-mod-05.html#cb1320-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-30"><a href="5-mod-05.html#cb1320-30" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up</span></span>
<span id="cb1320-31"><a href="5-mod-05.html#cb1320-31" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> coefs</span>
<span id="cb1320-32"><a href="5-mod-05.html#cb1320-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(res) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb1320-33"><a href="5-mod-05.html#cb1320-33" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> res[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb1320-34"><a href="5-mod-05.html#cb1320-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-35"><a href="5-mod-05.html#cb1320-35" aria-hidden="true" tabindex="-1"></a><span class="co"># by definition:</span></span>
<span id="cb1320-36"><a href="5-mod-05.html#cb1320-36" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>or[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1320-37"><a href="5-mod-05.html#cb1320-37" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>lo[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1320-38"><a href="5-mod-05.html#cb1320-38" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>up[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1320-39"><a href="5-mod-05.html#cb1320-39" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>sig[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1320-40"><a href="5-mod-05.html#cb1320-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1320-41"><a href="5-mod-05.html#cb1320-41" aria-hidden="true" tabindex="-1"></a><span class="co"># admire your handiwork:</span></span>
<span id="cb1320-42"><a href="5-mod-05.html#cb1320-42" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>##    strain         trt        or        lo       up sig
## 1      N2     Control 1.0000000 1.0000000 1.000000  NA
## 2      N2       EColi 1.4854166 1.2649819 1.705851   1
## 3      N2 Providencia 1.3792913 1.1637536 1.594829   1
## 4      N2 Pseudomonas 1.2175763 1.0033366 1.431816   0
## 5      N2  Raoultella 1.3647553 1.1516358 1.577875   1
## 6      N2    Serratia 1.1909629 0.9882685 1.393657   0
## 7  CB4856     Control 1.1746661 0.9609079 1.388424   0
## 8  CB4856       EColi 1.0292725 0.7423125 1.316233   0
## 9  CB4856 Providencia 0.8489578 0.5620371 1.135878   0
## 10 CB4856 Pseudomonas 1.0217745 0.7363754 1.307174   0
## 11 CB4856  Raoultella 1.0174453 0.7428495 1.292041   0
## 12 CB4856    Serratia 1.3282968 1.0651559 1.591438   1
## 13 JU1395     Control 2.4802402 2.2726955 2.687785   1
## 14 JU1395       EColi 0.7264518 0.4468147 1.006089   1
## 15 JU1395 Providencia 1.4171894 1.1406258 1.693753   1
## 16 JU1395 Pseudomonas 0.9171598 0.6443168 1.190003   0
## 17 JU1395  Raoultella 0.9403884 0.6730367 1.207740   0
## 18 JU1395    Serratia 1.1177482 0.8554757 1.380021   0</code></pre>
<p>We can use the table <code>res</code> to make a nice figure that distills the entire model down to the effect sizes (i.e., odds ratios):</p>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="5-mod-05.html#cb1322-1" aria-hidden="true" tabindex="-1"></a>use.y <span class="ot">&lt;-</span> <span class="fu">length</span>(treats)<span class="sc">:</span><span class="dv">1</span></span>
<span id="cb1322-2"><a href="5-mod-05.html#cb1322-2" aria-hidden="true" tabindex="-1"></a>strains <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(res<span class="sc">$</span>strain))</span>
<span id="cb1322-3"><a href="5-mod-05.html#cb1322-3" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>col <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(res<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>)</span>
<span id="cb1322-4"><a href="5-mod-05.html#cb1322-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1322-5"><a href="5-mod-05.html#cb1322-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1322-6"><a href="5-mod-05.html#cb1322-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">las=</span><span class="dv">1</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1322-7"><a href="5-mod-05.html#cb1322-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strains)){</span>
<span id="cb1322-8"><a href="5-mod-05.html#cb1322-8" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(res<span class="sc">$</span>strain <span class="sc">==</span> strains[i])</span>
<span id="cb1322-9"><a href="5-mod-05.html#cb1322-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(res<span class="sc">$</span>or[flag], use.y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1322-10"><a href="5-mod-05.html#cb1322-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlab=</span><span class="st">&quot;Odds ratio&quot;</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1322-11"><a href="5-mod-05.html#cb1322-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1322-12"><a href="5-mod-05.html#cb1322-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span>use.y, <span class="at">labels=</span>treats)</span>
<span id="cb1322-13"><a href="5-mod-05.html#cb1322-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">segments</span>(res<span class="sc">$</span>lo[flag], use.y,</span>
<span id="cb1322-14"><a href="5-mod-05.html#cb1322-14" aria-hidden="true" tabindex="-1"></a>             res<span class="sc">$</span>up[flag], use.y, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1322-15"><a href="5-mod-05.html#cb1322-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main=</span><span class="fu">paste</span>(<span class="st">&quot;Strain&quot;</span>, strains[i]), <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb1322-16"><a href="5-mod-05.html#cb1322-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">segments</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">length</span>(treats), <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1322-17"><a href="5-mod-05.html#cb1322-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(res<span class="sc">$</span>or[flag], use.y, <span class="at">cex=</span><span class="fl">1.5</span>,</span>
<span id="cb1322-18"><a href="5-mod-05.html#cb1322-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch=</span><span class="dv">21</span>, <span class="at">bg=</span>res<span class="sc">$</span>col[flag])</span>
<span id="cb1322-19"><a href="5-mod-05.html#cb1322-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1322-20"><a href="5-mod-05.html#cb1322-20" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="cb1322-21"><a href="5-mod-05.html#cb1322-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Significant&quot;</span>, <span class="st">&quot;Nonsignificant&quot;</span>),</span>
<span id="cb1322-22"><a href="5-mod-05.html#cb1322-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">21</span>, <span class="at">pt.bg=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>),</span>
<span id="cb1322-23"><a href="5-mod-05.html#cb1322-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">pt.cex=</span><span class="fl">1.5</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-547-1.png" width="576" /></p>
<p>Or even better, combine the three strains onto a single panel. You can adjust the <em>Y</em> coordinate offsets (<code>res$yoff</code>) and other inputs to fine-tune the plot.</p>
<div class="sourceCode" id="cb1323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1323-1"><a href="5-mod-05.html#cb1323-1" aria-hidden="true" tabindex="-1"></a>shps <span class="ot">&lt;-</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">23</span></span>
<span id="cb1323-2"><a href="5-mod-05.html#cb1323-2" aria-hidden="true" tabindex="-1"></a>matchx <span class="ot">&lt;-</span> <span class="fu">match</span>(res<span class="sc">$</span>strain, <span class="fu">unique</span>(res<span class="sc">$</span>strain))</span>
<span id="cb1323-3"><a href="5-mod-05.html#cb1323-3" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>shape <span class="ot">&lt;-</span> shps[matchx]</span>
<span id="cb1323-4"><a href="5-mod-05.html#cb1323-4" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>yoff <span class="ot">&lt;-</span> matchx<span class="dv">-1</span></span>
<span id="cb1323-5"><a href="5-mod-05.html#cb1323-5" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>y <span class="ot">&lt;-</span> use.y[<span class="fu">match</span>(res<span class="sc">$</span>trt, <span class="fu">unique</span>(res<span class="sc">$</span>trt))]</span>
<span id="cb1323-6"><a href="5-mod-05.html#cb1323-6" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>y <span class="ot">&lt;-</span> res<span class="sc">$</span>y <span class="sc">+</span> res<span class="sc">$</span>yoff<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb1323-7"><a href="5-mod-05.html#cb1323-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1323-8"><a href="5-mod-05.html#cb1323-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">1</span>,<span class="dv">1</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1323-9"><a href="5-mod-05.html#cb1323-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">las=</span><span class="dv">1</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">cex.lab=</span><span class="fl">1.2</span>, <span class="at">cex.axis=</span><span class="fl">1.3</span>)</span>
<span id="cb1323-10"><a href="5-mod-05.html#cb1323-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res<span class="sc">$</span>or, res<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1323-11"><a href="5-mod-05.html#cb1323-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span>res<span class="sc">$</span>shape, <span class="at">cex=</span><span class="fl">1.3</span>,</span>
<span id="cb1323-12"><a href="5-mod-05.html#cb1323-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg=</span><span class="fu">ifelse</span>(res<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>),</span>
<span id="cb1323-13"><a href="5-mod-05.html#cb1323-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Odds ratio&quot;</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1323-14"><a href="5-mod-05.html#cb1323-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="at">ylab=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1323-15"><a href="5-mod-05.html#cb1323-15" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb1323-16"><a href="5-mod-05.html#cb1323-16" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(res<span class="sc">$</span>lo, res<span class="sc">$</span>y, res<span class="sc">$</span>up, res<span class="sc">$</span>y, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1323-17"><a href="5-mod-05.html#cb1323-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(res<span class="sc">$</span>or, res<span class="sc">$</span>y,</span>
<span id="cb1323-18"><a href="5-mod-05.html#cb1323-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span>res<span class="sc">$</span>shape, <span class="at">cex=</span><span class="fl">1.3</span>,</span>
<span id="cb1323-19"><a href="5-mod-05.html#cb1323-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg=</span><span class="fu">ifelse</span>(res<span class="sc">$</span>sig <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>))</span>
<span id="cb1323-20"><a href="5-mod-05.html#cb1323-20" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span>use.y, <span class="at">labels=</span><span class="fu">unique</span>(res<span class="sc">$</span>trt))</span>
<span id="cb1323-21"><a href="5-mod-05.html#cb1323-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1323-22"><a href="5-mod-05.html#cb1323-22" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, </span>
<span id="cb1323-23"><a href="5-mod-05.html#cb1323-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Significant&quot;</span>, <span class="st">&quot;Nonsignificant&quot;</span>),</span>
<span id="cb1323-24"><a href="5-mod-05.html#cb1323-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span><span class="dv">21</span>, <span class="at">pt.bg=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;white&quot;</span>),</span>
<span id="cb1323-25"><a href="5-mod-05.html#cb1323-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">pt.cex=</span><span class="fl">1.5</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span>
<span id="cb1323-26"><a href="5-mod-05.html#cb1323-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;right&quot;</span>, <span class="at">legend=</span><span class="fu">unique</span>(res<span class="sc">$</span>strain),</span>
<span id="cb1323-27"><a href="5-mod-05.html#cb1323-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch=</span>shps, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">pt.cex=</span><span class="fl">1.5</span>,</span>
<span id="cb1323-28"><a href="5-mod-05.html#cb1323-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">pt.bg=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-548-1.png" width="576" /></p>
</div>
<div id="mod-05-auc" class="section level3" number="5.6.3">
<h3><span class="header-section-number">5.6.3</span> Logistic GLM diagnostics: AUC and ROC</h3>
<p>Logistic regression is one way of solving what statisticians sometimes call a <strong>classification problem</strong>, where we want to use some set of predictor variables to classify observations into one category or another. The binary case is the simplest classification problem. The predictions of a logistic regression model will predict each observation to either be 0 or 1. We can use those predictions, and how often they are correct, to evaluate the efficacy of a logistic regression model.</p>
<p>First let’s define a function to get the predictions for a logistic regression model for its input data, with user-specified “cut-off” value that determines how great the predicted probability needs to be before declaring the prediction a 1 instead of a 0. The default, 0.5, means that any observation with a predicted probability &gt;0.5 will be counted as 1.</p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1324-1"><a href="5-mod-05.html#cb1324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to get prediction:</span></span>
<span id="cb1324-2"><a href="5-mod-05.html#cb1324-2" aria-hidden="true" tabindex="-1"></a>pred.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, data, <span class="at">res =</span> <span class="st">&quot;y&quot;</span>, </span>
<span id="cb1324-3"><a href="5-mod-05.html#cb1324-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pos =</span> <span class="dv">1</span>, <span class="at">neg =</span> <span class="dv">0</span>, <span class="at">cut =</span> <span class="fl">0.5</span>) {</span>
<span id="cb1324-4"><a href="5-mod-05.html#cb1324-4" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> data, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb1324-5"><a href="5-mod-05.html#cb1324-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(probs <span class="sc">&gt;</span> cut, pos, neg)</span>
<span id="cb1324-6"><a href="5-mod-05.html#cb1324-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1324-7"><a href="5-mod-05.html#cb1324-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1324-8"><a href="5-mod-05.html#cb1324-8" aria-hidden="true" tabindex="-1"></a><span class="co"># test it out:</span></span>
<span id="cb1324-9"><a href="5-mod-05.html#cb1324-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">pred.fun</span>(mlist[[<span class="dv">4</span>]])</span>
<span id="cb1324-10"><a href="5-mod-05.html#cb1324-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ftable</span>(p1<span class="sc">~</span>dat<span class="sc">$</span>y) </span></code></pre></div>
<pre><code>##       p1    0    1
## dat$y             
## 0        7680 3007
## 1        4494 3890</code></pre>
<p>This contingency table is called a <strong>confusion matrix</strong> and it summarizes how often the model is correct for a given cutoff value. Here, when the model predicts a success (y = 1), it is correct for 3890 out of (3890+3007) = 6897 observations. Confusion matrices are usually summarized by two measures, sensitivity and specificity.</p>
<p><strong>Sensitivity</strong> measures what proportion of successes were correctly identified. This is also called the <strong>true positive rate</strong>. Sensitivity answer the question, “What proportion of observations predicted to have y = 1 were actually 1? Sensitivity is calculated as:</p>
<p><span class="math display">\[Sensitivity=\frac{n(true\ positives)}{n(true\ positives)+n(false\ negatives)}\]</span></p>
<p>In our example, the sensitivity is 3890 / (3890 + 4494) = 0.463.</p>
<p><strong>Specificity</strong> measures what proportion of failures (y = 0) were correctly identified. It is also called the <strong>true negative rate</strong>. It is calculated as:</p>
<p><span class="math display">\[Specificity=\frac{n(true\ negatives)}{n(true\ negatives)+n(false\ positives)}\]</span></p>
<p>In our example, the specificity was 7680 / (7680 + 3007) = 0.718.</p>
<p>The characteristics of the study system, the dataset, and the analysis can affect the sensitivity and the specificity of a model. If correctly identifying true positives is important (e.g., in disease screenings), then a model with greater sensitivity is preferred. If correctly identifying true negatives is important, then a model with greater specificity is preferred. The sensitivity and specificity can be varied by changing the threshold for 1 vs. 0.</p>
<p>A <strong>receiver operating characteristic (ROC) curve</strong> shows how sensitivity and specificity covary at different cut-off thresholds. We can construct an ROC curve by summarizing the confusion matrix at different cut-offs. The code below shows how to do this manually, so you can see for yourself how AUC is calculated. Afterwards, we’ll use functions from an add-on package to save some work.</p>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1326-1"><a href="5-mod-05.html#cb1326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vector of cut offs to test</span></span>
<span id="cb1326-2"><a href="5-mod-05.html#cb1326-2" aria-hidden="true" tabindex="-1"></a>co <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.01</span>)</span>
<span id="cb1326-3"><a href="5-mod-05.html#cb1326-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-4"><a href="5-mod-05.html#cb1326-4" aria-hidden="true" tabindex="-1"></a><span class="co"># vectors to hold specificity and sensitivity</span></span>
<span id="cb1326-5"><a href="5-mod-05.html#cb1326-5" aria-hidden="true" tabindex="-1"></a>sen <span class="ot">&lt;-</span> spe <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(co))</span>
<span id="cb1326-6"><a href="5-mod-05.html#cb1326-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-7"><a href="5-mod-05.html#cb1326-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate sensitivity and specificity in a loop</span></span>
<span id="cb1326-8"><a href="5-mod-05.html#cb1326-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(co)){</span>
<span id="cb1326-9"><a href="5-mod-05.html#cb1326-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># predictions for current cutoff value</span></span>
<span id="cb1326-10"><a href="5-mod-05.html#cb1326-10" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> <span class="fu">pred.fun</span>(mlist[[<span class="dv">4</span>]], <span class="at">cut=</span>co[i])</span>
<span id="cb1326-11"><a href="5-mod-05.html#cb1326-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1326-12"><a href="5-mod-05.html#cb1326-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rearrange to data frame</span></span>
<span id="cb1326-13"><a href="5-mod-05.html#cb1326-13" aria-hidden="true" tabindex="-1"></a>    con.mat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">ftable</span>(dat<span class="sc">$</span>y<span class="sc">~</span>pred))</span>
<span id="cb1326-14"><a href="5-mod-05.html#cb1326-14" aria-hidden="true" tabindex="-1"></a>    con.mat<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(con.mat<span class="sc">$</span>pred))</span>
<span id="cb1326-15"><a href="5-mod-05.html#cb1326-15" aria-hidden="true" tabindex="-1"></a>    con.mat<span class="sc">$</span>dat.y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(con.mat<span class="sc">$</span>dat.y))</span>
<span id="cb1326-16"><a href="5-mod-05.html#cb1326-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-17"><a href="5-mod-05.html#cb1326-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># special case: no predicted 1s</span></span>
<span id="cb1326-18"><a href="5-mod-05.html#cb1326-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span> <span class="dv">1</span> <span class="sc">%in%</span> con.mat<span class="sc">$</span>pred){</span>
<span id="cb1326-19"><a href="5-mod-05.html#cb1326-19" aria-hidden="true" tabindex="-1"></a>        add.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred=</span><span class="dv">1</span>, <span class="at">dat.y=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">Freq=</span><span class="dv">0</span>)        </span>
<span id="cb1326-20"><a href="5-mod-05.html#cb1326-20" aria-hidden="true" tabindex="-1"></a>        con.mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(con.mat, add.df)                         </span>
<span id="cb1326-21"><a href="5-mod-05.html#cb1326-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1326-22"><a href="5-mod-05.html#cb1326-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1326-23"><a href="5-mod-05.html#cb1326-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># special case: no predicted 0s</span></span>
<span id="cb1326-24"><a href="5-mod-05.html#cb1326-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span> <span class="dv">0</span> <span class="sc">%in%</span> con.mat<span class="sc">$</span>pred){</span>
<span id="cb1326-25"><a href="5-mod-05.html#cb1326-25" aria-hidden="true" tabindex="-1"></a>        add.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred=</span><span class="dv">0</span>, <span class="at">dat.y=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">Freq=</span><span class="dv">0</span>)        </span>
<span id="cb1326-26"><a href="5-mod-05.html#cb1326-26" aria-hidden="true" tabindex="-1"></a>        con.mat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(con.mat, add.df)                         </span>
<span id="cb1326-27"><a href="5-mod-05.html#cb1326-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1326-28"><a href="5-mod-05.html#cb1326-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-29"><a href="5-mod-05.html#cb1326-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sensitivity:</span></span>
<span id="cb1326-30"><a href="5-mod-05.html#cb1326-30" aria-hidden="true" tabindex="-1"></a>    tp <span class="ot">&lt;-</span> <span class="fu">which</span>(con.mat<span class="sc">$</span>pred <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> con.mat<span class="sc">$</span>dat.y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb1326-31"><a href="5-mod-05.html#cb1326-31" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">which</span>(con.mat<span class="sc">$</span>pred <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> con.mat<span class="sc">$</span>dat.y <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb1326-32"><a href="5-mod-05.html#cb1326-32" aria-hidden="true" tabindex="-1"></a>    sen[i] <span class="ot">&lt;-</span> con.mat<span class="sc">$</span>Freq[tp] <span class="sc">/</span> (</span>
<span id="cb1326-33"><a href="5-mod-05.html#cb1326-33" aria-hidden="true" tabindex="-1"></a>                  con.mat<span class="sc">$</span>Freq[tp] <span class="sc">+</span> con.mat<span class="sc">$</span>Freq[fn])</span>
<span id="cb1326-34"><a href="5-mod-05.html#cb1326-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-35"><a href="5-mod-05.html#cb1326-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specificity:</span></span>
<span id="cb1326-36"><a href="5-mod-05.html#cb1326-36" aria-hidden="true" tabindex="-1"></a>    tn <span class="ot">&lt;-</span> <span class="fu">which</span>(con.mat<span class="sc">$</span>pred <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> con.mat<span class="sc">$</span>dat.y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb1326-37"><a href="5-mod-05.html#cb1326-37" aria-hidden="true" tabindex="-1"></a>    fp <span class="ot">&lt;-</span> <span class="fu">which</span>(con.mat<span class="sc">$</span>pred <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> con.mat<span class="sc">$</span>dat.y <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb1326-38"><a href="5-mod-05.html#cb1326-38" aria-hidden="true" tabindex="-1"></a>    spe[i] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>con.mat<span class="sc">$</span>Freq[tn] <span class="sc">/</span></span>
<span id="cb1326-39"><a href="5-mod-05.html#cb1326-39" aria-hidden="true" tabindex="-1"></a>                  (con.mat<span class="sc">$</span>Freq[tn] <span class="sc">+</span> con.mat<span class="sc">$</span>Freq[fp])</span>
<span id="cb1326-40"><a href="5-mod-05.html#cb1326-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1326-41"><a href="5-mod-05.html#cb1326-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-42"><a href="5-mod-05.html#cb1326-42" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spe, sen, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb1326-43"><a href="5-mod-05.html#cb1326-43" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1326-44"><a href="5-mod-05.html#cb1326-44" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;False positive rate&quot;</span>,</span>
<span id="cb1326-45"><a href="5-mod-05.html#cb1326-45" aria-hidden="true" tabindex="-1"></a>     <span class="at">yla=</span><span class="st">&quot;True positive rate&quot;</span>)</span>
<span id="cb1326-46"><a href="5-mod-05.html#cb1326-46" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-550-1.png" width="576" /></p>
<p>The diagonal red line shows the case of a model where predictions of 1 are just a likely to be true positives as false positives. Obviously, the curve for your model should fall above this line! The curve for a well-fitting model should increase quickly as false positive rate increases from 0, and reach a y value of 1 very quickly. A model that perfectly classifies observations should have an area under the curve (AUC) of 1 (can you see why?). A model that predicts an equal number of true positives and false positives has an AUC of 0.5. This represents a model that is no better than random chance at being correct, and is the “worst case scenario” for a classification model like logistic regression. We can approximate the AUC using rectangles:</p>
<div class="sourceCode" id="cb1327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1327-1"><a href="5-mod-05.html#cb1327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(spe, sen, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb1327-2"><a href="5-mod-05.html#cb1327-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1327-3"><a href="5-mod-05.html#cb1327-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;False positive rate&quot;</span>,</span>
<span id="cb1327-4"><a href="5-mod-05.html#cb1327-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">yla=</span><span class="st">&quot;True positive rate&quot;</span>)</span>
<span id="cb1327-5"><a href="5-mod-05.html#cb1327-5" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1327-6"><a href="5-mod-05.html#cb1327-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1327-7"><a href="5-mod-05.html#cb1327-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add to previous plot:</span></span>
<span id="cb1327-8"><a href="5-mod-05.html#cb1327-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rect</span>(spe[<span class="sc">-</span><span class="fu">length</span>(spe)], <span class="dv">0</span>,</span>
<span id="cb1327-9"><a href="5-mod-05.html#cb1327-9" aria-hidden="true" tabindex="-1"></a>     spe[<span class="sc">-</span><span class="dv">1</span>], sen, <span class="at">border=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb1327-10"><a href="5-mod-05.html#cb1327-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col=</span><span class="st">&quot;#0000FF20&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-551-1.png" width="576" /></p>
<p>And the numerical integration (lazy way):</p>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1328-1"><a href="5-mod-05.html#cb1328-1" aria-hidden="true" tabindex="-1"></a>auc1 <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="fu">diff</span>(spe)<span class="sc">*-</span><span class="dv">1</span>) <span class="sc">*</span> sen[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb1328-2"><a href="5-mod-05.html#cb1328-2" aria-hidden="true" tabindex="-1"></a>auc2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((<span class="fu">diff</span>(spe)<span class="sc">*-</span><span class="dv">1</span>) <span class="sc">*</span> sen[<span class="sc">-</span><span class="fu">length</span>(sen)])</span>
<span id="cb1328-3"><a href="5-mod-05.html#cb1328-3" aria-hidden="true" tabindex="-1"></a>(auc1<span class="sc">+</span>auc2)<span class="sc">/</span><span class="dv">2</span></span></code></pre></div>
<pre><code>## [1] 0.6172765</code></pre>
<p>The AUC of 0.617 is not too bad, but not great either. Remember that 0.5 is model no better than a coin flip, and 1 is perfect.
As much fun as it is to manually calculate ROC curves and definite integrals, we can get the ROC and AUC much more quickly using the functions in package <code>pROC</code>.</p>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1330-1"><a href="5-mod-05.html#cb1330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code></pre></div>
<pre><code>## Type &#39;citation(&quot;pROC&quot;)&#39; for a citation.</code></pre>
<pre><code>## 
## Attaching package: &#39;pROC&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     cov, smooth, var</code></pre>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="5-mod-05.html#cb1334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate predictions (probabilities)</span></span>
<span id="cb1334-2"><a href="5-mod-05.html#cb1334-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mlist[[<span class="dv">4</span>]], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1334-3"><a href="5-mod-05.html#cb1334-3" aria-hidden="true" tabindex="-1"></a>roc1 <span class="ot">&lt;-</span> <span class="fu">roc</span>(dat<span class="sc">$</span>y <span class="sc">~</span> p1, <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="at">print.auc =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Setting levels: control = 0, case = 1</code></pre>
<pre><code>## Setting direction: controls &lt; cases</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-553-1.png" width="480" /></p>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1337-1"><a href="5-mod-05.html#cb1337-1" aria-hidden="true" tabindex="-1"></a>roc1</span></code></pre></div>
<pre><code>## 
## Call:
## roc.formula(formula = dat$y ~ p1, plot = TRUE, print.auc = TRUE)
## 
## Data: p1 in 10687 controls (dat$y 0) &lt; 8384 cases (dat$y 1).
## Area under the curve: 0.6173</code></pre>
<p>The AUC calculated by package <code>pROC</code> (0.6173) is close to the value we calculated by hand. If you don’t like the default figure produced by <code>roc()</code>, you can extract the sensitivity and sensitivity scores and make your own plot.</p>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1339-1"><a href="5-mod-05.html#cb1339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1- to orient axis correct way:</span></span>
<span id="cb1339-2"><a href="5-mod-05.html#cb1339-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>roc1<span class="sc">$</span>specificities</span>
<span id="cb1339-3"><a href="5-mod-05.html#cb1339-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> roc1<span class="sc">$</span>sensitivities</span>
<span id="cb1339-4"><a href="5-mod-05.html#cb1339-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-554-1.png" width="480" /></p>
</div>
</div>
<div id="mod-05-binom" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Binomial GLM for proportional data</h2>
<p>This module explores GLMs for <strong>proportional data</strong>. Proportional data describe the number of times that some event occurs, relative to the total number of times it could occur. Many phenomena that biologists study are expressed as proportions: proportion of individuals surviving, proportion of individuals with trait <em>A</em>, proportion of area covered by species <em>X</em>, and so on. Analyzing proportions is a lot like <a href="5-mod-05.html#mod-05-logistic">analyzing binary outcomes</a>; i.e., logistic regression. In fact, they are both GLMs with a binomial family. All that differs is the <em>n</em> term. In logistic regression the interest is in predicting the outcomes of single trials, while in binomial regression the interest is in predicting the <strong>proportion</strong> of observations in a certain state. Any dataset suitable for logistic regression can be converted to a dataset suitable for binomial regression. How you should analyze your data depends on your question:</p>
<ul>
<li>If the question is about outcomes at the individual observation level, then use logistic regression.</li>
<li>If the question is about rates or probabilities of an event occurring, then use binomial regression.</li>
</ul>
<p>One good clue is to consider the level at which predictor variables are measured. If many observations share the same value of a predictor variable (or the same values of many predictor variables), then binomial regression might be the right approach because the sample unit is really the group. For example, if you want to model nestling survival in birds, all of the chicks within a nest would have the same values of any predictor variable that applied to the nest. Thus, binomial regression would be appropriate. If, however, there were chick-level predictors, then logistic regression would be appropriate. Think about what level of organization your predictor and response variables occur at, and what question you are really asking.</p>
<div id="binomial-glm" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Binomial GLM</h3>
<p><strong>Binomial regression</strong> or <strong>binomial GLM</strong> is related to logistic regression. Both are models for binary outcomes. Binary outcomes are those resulting from <strong>trials</strong> in which some event can either occur or not. When the event occurs, the trial is counted as a <strong>success</strong>. For example, if you flip a fair coin one time, that is one trial. The coin will come up heads with probability 0.5. If you flip the coin 10 times and get heads 4 times, then your observation (10 coin flips) had 10 trials (each flip) and 4 successes (times that heads came up). In logistic regression, each observation represents the outcome of one and only one trial (i.e., <em>n</em> = 1). In binomial regression, each observation can represent the outcome of many trials. This means that logistic regression is a special case of binomial regression.</p>
<p>Binary data can be represented in more than one way, so long as the number of trials and successes are known. Consider a study where researchers want to model the probability of a fish spawning in relation to environmental conditions. Their data will consist of the number of female fish in a population that spawn and the total number of female fish in the population.</p>
<ul>
<li>The number of <strong>trials (<em>n</em>)</strong> is the number of fish that could have spawned.</li>
<li>The number of <strong>successes</strong> is the number of fish that spawned.</li>
<li>The <strong>probability of success (<em>p</em>)</strong> is ratio of successes to trials; in this case, the number of spawning fish divided by the number of potential spawners.</li>
</ul>
<p>If the same number of fish were sampled in each stream reach, then the researchers could use the number fo spawning fish as their response variable (i.e., number of successes). If the number of fish varied between observations, then they should use the proportion of spawners (<em>p</em>) as their response variable. Both ways of expressing the data are correct, but one may be more useful.</p>
<p>Binary data are usually modeled as coming from a <strong>binomial distribution</strong>. The binomial distribution describes the number of successes, or times an event occurs, in <em>n</em> trials with probability <em>p</em> in each trial. For example, if you flip a fair coin 10 times, the number of heads <span class="math inline">\(n_{heads}\)</span> will follow the distribution:</p>
<p><span class="math display">\[n_{heads}\sim Binomial\left(10,\ 0.5\right) \]</span></p>
<p>The distribution of outcomes is shown below:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-555-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Proportional data can be expressed in two ways: as the number of successes observed out of <em>n</em> trials, or as the proportion of successes (i.e., <em>p</em>). This proportion can be thought of as the <strong>probability</strong> that a success will occur. Both ways emphasize different components of the binomial distribution that generated the data.</p>
<p>When analyzing proportional data, we have the option of using one of two equivalent representations of the model.</p>
<p><strong>Form 1: Response variable as number of occurrences</strong></p>
<p>The first form frames the model in terms of the number of successes:</p>
<p><span class="math display">\[y_i \sim Binomial\left(n_i,\ p_i\right)\]</span></p>
<p><span class="math display">\[logit\left(p_i\right)=\beta_0+\beta_1\]</span></p>
<p>In these equations,</p>
<ul>
<li><span class="math inline">\(y_i\)</span> is the number of trials in observation <em>i</em> in which some event occurs.</li>
<li><span class="math inline">\(n_i\)</span> is the number of trials included in observation <em>i</em>.</li>
<li><span class="math inline">\(p_i\)</span> is the probability of some event occurring in observation <em>i</em>.</li>
<li><span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are the regression intercept and slope.</li>
</ul>
<p>The response variable <span class="math inline">\(y_i\)</span> in this form is a non-negative integer. For example, if a toxicity trial exposes midges to 6 different concentrations of a toxin, and 20 organisms are exposed per concentration, then the number of organisms in each group that dies would be the response variable.</p>
<p><strong>Form 2: Response variable as proportion of successes</strong></p>
<p>The second way a binomial GLM can be expressed is in terms of the proportion of trials in which an event occurs:</p>
<p><span class="math display">\[y_i=\frac{z_i}{n_i}\]</span></p>
<p><span class="math display">\[z_i \sim Binomial\left(n_i,\ p_i\right)\]</span></p>
<p><span class="math display">\[logit\left(p_i\right)=\beta_0+\beta_1\]</span></p>
<p>In this form:</p>
<ul>
<li><span class="math inline">\(y_i\)</span> is the proportion of trials in observation <em>i</em> in which some event occurs.</li>
<li><span class="math inline">\(z_i\)</span> is the number of trials in observation <em>i</em> in which some event occurs.</li>
<li><span class="math inline">\(n_i\)</span> is the number of trials included in observation <em>i</em>.</li>
<li><span class="math inline">\(p_i\)</span> is the probability of some event occurring in observation <em>i</em>.</li>
<li><span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are the regression intercept and slope.</li>
</ul>
<p>The response variable <span class="math inline">\(y_i\)</span> in this form is a proportion in the interval [0, 1], and represents the probability <span class="math inline">\(p_i\)</span>. For example, if a toxicity trial exposes midges to 6 different concentrations of a toxin, and 20 organisms are exposed per concentration, then the proportion of organisms in each group that dies would be the response variable.</p>
<p>You can think of your binomial regression model in either format. Notice that the deterministic part of the model is exactly the same in both forms of the binomial GLM, and the same as in logistic regression. The stochastic part is also the same in both forms of the binomial GLM. The stochastic part of logistic regression is <a href="5-mod-05.html#mod-05-logistic">usually written</a> with the Bernoulli distribution, but could be rewritten as <span class="math inline">\(y_i \sim Binomial\left(1,\ p_i\right)\)</span> to emphasize its status as a special case of binomial regression.</p>
<p>If you have proportional data, the proportion version (form 2) is more straightforward to fit in R. The regression coefficients will be the same no matter which format you use. The examples below use the proportion format.</p>
</div>
<div id="example-with-simulated-data-3" class="section level3" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Example with simulated data</h3>
<p>The example below shows how to simulate and fit a binomial GLM on proportions. First, let’s simulate the data.</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="5-mod-05.html#cb1340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1340-2"><a href="5-mod-05.html#cb1340-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1340-3"><a href="5-mod-05.html#cb1340-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb1340-4"><a href="5-mod-05.html#cb1340-4" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="sc">-</span><span class="fl">0.75</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1340-5"><a href="5-mod-05.html#cb1340-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse logit</span></span>
<span id="cb1340-6"><a href="5-mod-05.html#cb1340-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">plogis</span>(z), <span class="dv">1</span>)</span>
<span id="cb1340-7"><a href="5-mod-05.html#cb1340-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1340-8"><a href="5-mod-05.html#cb1340-8" aria-hidden="true" tabindex="-1"></a><span class="co"># weights = sample sizes</span></span>
<span id="cb1340-9"><a href="5-mod-05.html#cb1340-9" aria-hidden="true" tabindex="-1"></a><span class="co"># use same size for each observation for simplicity</span></span>
<span id="cb1340-10"><a href="5-mod-05.html#cb1340-10" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">10</span>, n)</span>
<span id="cb1340-11"><a href="5-mod-05.html#cb1340-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1340-12"><a href="5-mod-05.html#cb1340-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of a proportion (y) vs. a predictor (x)</span></span>
<span id="cb1340-13"><a href="5-mod-05.html#cb1340-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-556-1.png" width="480" /></p>
<p>We use GLM to fit the binomial model. The command below will specify a binomial GLM with the default logit link. In <a href="5-mod-05.html#mod-05-logistic">another context</a> this is how we fit a logistic regression. Adding the argument <code>weights</code>, which defines the sample sizes represented by each probability (<em>Y</em> value) converts the model to a binomial regression. For example, an observation with <em>Y</em> = 0.3 and <code>weights</code> = 10 represents a trial or group of observations with 3 successes in 10 trials. There are other ways of specifying these weights (see <code>?family</code>) but this is the simplest. Note that if you try to do this analysis without supplying weights, R will return a warning (because it expects 1s and 0s for logistic regression) and will not calculate the deviance correctly (because it doesn’t know how many trials each probability represents).</p>
<div class="sourceCode" id="cb1341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1341-1"><a href="5-mod-05.html#cb1341-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">family=</span>binomial, <span class="at">weights=</span>wts)</span>
<span id="cb1341-2"><a href="5-mod-05.html#cb1341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = binomial, weights = wts)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.8868  -0.7281  -0.2132   0.7710   2.0987  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.52369    0.26503   9.522   &lt;2e-16 ***
## x           -0.63974    0.05588 -11.449   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 288.207  on 49  degrees of freedom
## Residual deviance:  57.294  on 48  degrees of freedom
## AIC: 150.55
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The parameter estimates are close to the true values and the pseudo-<em>R</em><sup>2</sup> is pretty good:</p>
<div class="sourceCode" id="cb1343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1343-1"><a href="5-mod-05.html#cb1343-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.8012043</code></pre>
<p>Let’s generate predicted values and plot them in the usual way:</p>
<div class="sourceCode" id="cb1345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1345-1"><a href="5-mod-05.html#cb1345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># values for prediction</span></span>
<span id="cb1345-2"><a href="5-mod-05.html#cb1345-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1345-3"><a href="5-mod-05.html#cb1345-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length=</span>n)</span>
<span id="cb1345-4"><a href="5-mod-05.html#cb1345-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1345-5"><a href="5-mod-05.html#cb1345-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions on link scale</span></span>
<span id="cb1345-6"><a href="5-mod-05.html#cb1345-6" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, </span>
<span id="cb1345-7"><a href="5-mod-05.html#cb1345-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1345-8"><a href="5-mod-05.html#cb1345-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1345-9"><a href="5-mod-05.html#cb1345-9" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1345-10"><a href="5-mod-05.html#cb1345-10" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1345-11"><a href="5-mod-05.html#cb1345-11" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1345-12"><a href="5-mod-05.html#cb1345-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1345-13"><a href="5-mod-05.html#cb1345-13" aria-hidden="true" tabindex="-1"></a><span class="co"># backtransform with inverse link function</span></span>
<span id="cb1345-14"><a href="5-mod-05.html#cb1345-14" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn1)</span>
<span id="cb1345-15"><a href="5-mod-05.html#cb1345-15" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo1)</span>
<span id="cb1345-16"><a href="5-mod-05.html#cb1345-16" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up1)</span>
<span id="cb1345-17"><a href="5-mod-05.html#cb1345-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1345-18"><a href="5-mod-05.html#cb1345-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot:</span></span>
<span id="cb1345-19"><a href="5-mod-05.html#cb1345-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">&quot;X&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Y&quot;</span>, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1345-20"><a href="5-mod-05.html#cb1345-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb1345-21"><a href="5-mod-05.html#cb1345-21" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, lo1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1345-22"><a href="5-mod-05.html#cb1345-22" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, up1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1345-23"><a href="5-mod-05.html#cb1345-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb1345-24"><a href="5-mod-05.html#cb1345-24" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-559-1.png" width="576" /></p>
<p>Remember that logistic regression and binomial regression are <em>the same model</em>. Both address a binary outcome, but at different levels. Which of the two you should use depends on the nature of your question, the way in which data were collected, and the kind of prediction you are trying to make.</p>
</div>
</div>
<div id="mod-05-gamma" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> Gamma models for overdispersed data</h2>
<p>This section explores GLMs for data following a <strong>gamma distribution</strong>. Gamma-distributed data can show up in two ways in biology: waiting times, or overdispersed continuous data (i.e., data where <span class="math inline">\(\sigma &gt; \mu\)</span>). The latter case can also be well-modeled by a <a href="5-mod-05.html#mod-05-loglin">log-linear GLM</a>, but the gamma GLM offers an elegant (and under-utilized) alternative.</p>
<p><strong>Gamma regression</strong> is a GLM where response values follow a gamma distribution. The gamma distribution usually describes one of two kinds of data: waiting times until a certain number of events occur, or right-skewed continuous data. The gamma distribution is the continuous analogue of the negative binomial distribution. The figure below shows this:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-560-1.png" width="768" /></p>
<p>A gamma distribution with shape <em>a</em> and scale <em>s</em> is basically a continuous version of a negative binomial distribution with size <em>n</em> and probability <em>p</em> according to the following relationships:</p>
<p><span class="math display">\[a=\frac{\mu^2}{\sigma^2}\]</span>
<span class="math display">\[s=\frac{\mu}{a}\]</span></p>
<p>Where <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span> can be calculated from the parameters of the negative binomial distribution as:</p>
<p><span class="math display">\[\mu=\frac{n\left(1-p\right)}{p},\ \sigma^2=\frac{n\left(1-p\right)}{p^2}\]</span></p>
<p>The relationships above can be used to convert between gamma distributions and negative binomial distributions with other parameterizations. For example, ecologists often use an alternate version of the negative binomial with mean <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^{2}=\mu + (\mu^{2}/k)\)</span>.</p>
<p>Like the negative binomial, biologists can take advantage of the numerical properties of the gamma to model phenomena for which the variance is much greater than the mean. The <strong>log-normal distribution</strong> is another option for right-skewed data. Neither the log-normal nor the gamma distribution can take the value 0, so users of the gamma distribution may need to adjust their data so that 0s do not occur. Of the GLMs described in this guide, gamma models are probably the most under-utilized by biologists.</p>
<div id="example-with-simulated-data-4" class="section level3" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> Example with simulated data</h3>
<p>As always, we will start with analysis of simulated data. Notice that we are using <strong>log link function</strong>. The canonical link for the gamma distribution is the <strong>reciprocal function</strong> (<span class="math inline">\(f(x)=1/x\)</span>). However, the reciprocal function is more applicable for the “waiting time” interpretation of the distribution. For the “right-skewed non-negative distribution” interpretation, the log or identity links can be appropriate. However, the log-link cannot be used if your data contain 0s.</p>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1346-1"><a href="5-mod-05.html#cb1346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1346-2"><a href="5-mod-05.html#cb1346-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1346-3"><a href="5-mod-05.html#cb1346-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">4</span>), <span class="dv">1</span>)</span>
<span id="cb1346-4"><a href="5-mod-05.html#cb1346-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-5"><a href="5-mod-05.html#cb1346-5" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients</span></span>
<span id="cb1346-6"><a href="5-mod-05.html#cb1346-6" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb1346-7"><a href="5-mod-05.html#cb1346-7" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb1346-8"><a href="5-mod-05.html#cb1346-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-9"><a href="5-mod-05.html#cb1346-9" aria-hidden="true" tabindex="-1"></a><span class="co"># linear predictor</span></span>
<span id="cb1346-10"><a href="5-mod-05.html#cb1346-10" aria-hidden="true" tabindex="-1"></a>eta <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x</span>
<span id="cb1346-11"><a href="5-mod-05.html#cb1346-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-12"><a href="5-mod-05.html#cb1346-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link</span></span>
<span id="cb1346-13"><a href="5-mod-05.html#cb1346-13" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(eta)</span>
<span id="cb1346-14"><a href="5-mod-05.html#cb1346-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-15"><a href="5-mod-05.html#cb1346-15" aria-hidden="true" tabindex="-1"></a><span class="co"># gamma parameter</span></span>
<span id="cb1346-16"><a href="5-mod-05.html#cb1346-16" aria-hidden="true" tabindex="-1"></a>shape <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1346-17"><a href="5-mod-05.html#cb1346-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-18"><a href="5-mod-05.html#cb1346-18" aria-hidden="true" tabindex="-1"></a><span class="co"># draw y values (stochastic part)</span></span>
<span id="cb1346-19"><a href="5-mod-05.html#cb1346-19" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(n, <span class="at">rate=</span>shape<span class="sc">/</span>y, <span class="at">shape=</span>shape)</span>
<span id="cb1346-20"><a href="5-mod-05.html#cb1346-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-21"><a href="5-mod-05.html#cb1346-21" aria-hidden="true" tabindex="-1"></a><span class="co"># assemble dataset</span></span>
<span id="cb1346-22"><a href="5-mod-05.html#cb1346-22" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span>x, <span class="at">y=</span>y)</span>
<span id="cb1346-23"><a href="5-mod-05.html#cb1346-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1346-24"><a href="5-mod-05.html#cb1346-24" aria-hidden="true" tabindex="-1"></a><span class="co"># take a look at the data:</span></span>
<span id="cb1346-25"><a href="5-mod-05.html#cb1346-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##     x          y
## 1 1.2  19.831466
## 2 3.2 128.548423
## 3 1.6   3.303748
## 4 3.5  89.653108
## 5 3.8 105.050148
## 6 0.2   2.268062</code></pre>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="5-mod-05.html#cb1348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-561-1.png" width="480" /></p>
<p>The data look like they might be log-linear—i.e., linear on a logarithmic scale. We can check that with another scatterplot:</p>
<div class="sourceCode" id="cb1349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1349-1"><a href="5-mod-05.html#cb1349-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(y))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-562-1.png" width="480" /></p>
<p>When <em>y</em> is log-transformed, things look linear. We will try a Gaussian GLM with log link function. Because the variance looks like it increases at larger <em>X</em> values, we will also try a gamma GLM. One characteristic of the gamma distribution is that the variance is proportional to the mean squared, which might be the case here.</p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1350-1"><a href="5-mod-05.html#cb1350-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span>
<span id="cb1350-2"><a href="5-mod-05.html#cb1350-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>dat, <span class="at">family=</span><span class="fu">Gamma</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span>
<span id="cb1350-3"><a href="5-mod-05.html#cb1350-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = gaussian(link = &quot;log&quot;), data = dat)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -52.584  -18.722   -8.663   -4.337  143.577  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.8969     0.6141   3.089   0.0045 ** 
## x             0.8122     0.1725   4.708 6.16e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 1650.88)
## 
##     Null deviance: 128445  on 29  degrees of freedom
## Residual deviance:  46225  on 28  degrees of freedom
## AIC: 311.34
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1352-1"><a href="5-mod-05.html#cb1352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ x, family = Gamma(link = &quot;log&quot;), data = dat)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -1.23251  -0.35454  -0.05758   0.13402   0.76848  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.99844    0.17787   5.613 5.21e-06 ***
## x            1.08949    0.06932  15.717 2.02e-15 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Gamma family taken to be 0.1887889)
## 
##     Null deviance: 41.3449  on 29  degrees of freedom
## Residual deviance:  5.4667  on 28  degrees of freedom
## AIC: 245.54
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Notice that the parameter estimates from the gamma GLM were much closer to “reality” than those of the Gaussian GLM. Which model performed better? The pseudo-<em>R</em><sup>2</sup> suggests the gamma:</p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1354-1"><a href="5-mod-05.html#cb1354-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod1<span class="sc">$</span>deviance<span class="sc">/</span>mod1<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.6401217</code></pre>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1356-1"><a href="5-mod-05.html#cb1356-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>mod2<span class="sc">$</span>deviance<span class="sc">/</span>mod2<span class="sc">$</span>null.deviance</span></code></pre></div>
<pre><code>## [1] 0.8677773</code></pre>
<p>The best test is to plot the predicted values against the actual values and compare the models.</p>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1358-1"><a href="5-mod-05.html#cb1358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># values for prediction</span></span>
<span id="cb1358-2"><a href="5-mod-05.html#cb1358-2" aria-hidden="true" tabindex="-1"></a>use.n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1358-3"><a href="5-mod-05.html#cb1358-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(x), <span class="fu">max</span>(x), <span class="at">length=</span>use.n)</span>
<span id="cb1358-4"><a href="5-mod-05.html#cb1358-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-5"><a href="5-mod-05.html#cb1358-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions and CI</span></span>
<span id="cb1358-6"><a href="5-mod-05.html#cb1358-6" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1358-7"><a href="5-mod-05.html#cb1358-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1358-8"><a href="5-mod-05.html#cb1358-8" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1358-9"><a href="5-mod-05.html#cb1358-9" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1358-10"><a href="5-mod-05.html#cb1358-10" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn1, pred1<span class="sc">$</span>se.fit)</span>
<span id="cb1358-11"><a href="5-mod-05.html#cb1358-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-12"><a href="5-mod-05.html#cb1358-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1358-13"><a href="5-mod-05.html#cb1358-13" aria-hidden="true" tabindex="-1"></a>mn1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn1)</span>
<span id="cb1358-14"><a href="5-mod-05.html#cb1358-14" aria-hidden="true" tabindex="-1"></a>lo1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo1)</span>
<span id="cb1358-15"><a href="5-mod-05.html#cb1358-15" aria-hidden="true" tabindex="-1"></a>up1 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up1)</span>
<span id="cb1358-16"><a href="5-mod-05.html#cb1358-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-17"><a href="5-mod-05.html#cb1358-17" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions and CI for gamma model</span></span>
<span id="cb1358-18"><a href="5-mod-05.html#cb1358-18" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">x=</span>px),</span>
<span id="cb1358-19"><a href="5-mod-05.html#cb1358-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1358-20"><a href="5-mod-05.html#cb1358-20" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1358-21"><a href="5-mod-05.html#cb1358-21" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1358-22"><a href="5-mod-05.html#cb1358-22" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, mn2, pred2<span class="sc">$</span>se.fit)</span>
<span id="cb1358-23"><a href="5-mod-05.html#cb1358-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-24"><a href="5-mod-05.html#cb1358-24" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1358-25"><a href="5-mod-05.html#cb1358-25" aria-hidden="true" tabindex="-1"></a>mn2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(mn2)</span>
<span id="cb1358-26"><a href="5-mod-05.html#cb1358-26" aria-hidden="true" tabindex="-1"></a>lo2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(lo2)</span>
<span id="cb1358-27"><a href="5-mod-05.html#cb1358-27" aria-hidden="true" tabindex="-1"></a>up2 <span class="ot">&lt;-</span> mod1<span class="sc">$</span>family<span class="sc">$</span><span class="fu">linkinv</span>(up2)</span>
<span id="cb1358-28"><a href="5-mod-05.html#cb1358-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-29"><a href="5-mod-05.html#cb1358-29" aria-hidden="true" tabindex="-1"></a><span class="co"># make plot</span></span>
<span id="cb1358-30"><a href="5-mod-05.html#cb1358-30" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb1358-31"><a href="5-mod-05.html#cb1358-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">main=</span><span class="st">&quot;Normal GLM&quot;</span>)</span>
<span id="cb1358-32"><a href="5-mod-05.html#cb1358-32" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)), <span class="at">y=</span><span class="fu">c</span>(lo1, <span class="fu">rev</span>(up1)),</span>
<span id="cb1358-33"><a href="5-mod-05.html#cb1358-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1358-34"><a href="5-mod-05.html#cb1358-34" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn1, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1358-35"><a href="5-mod-05.html#cb1358-35" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, y)</span>
<span id="cb1358-36"><a href="5-mod-05.html#cb1358-36" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">main=</span><span class="st">&quot;Gamma GLM&quot;</span>)</span>
<span id="cb1358-37"><a href="5-mod-05.html#cb1358-37" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(px, <span class="fu">rev</span>(px)), <span class="at">y=</span><span class="fu">c</span>(lo2, <span class="fu">rev</span>(up2)),</span>
<span id="cb1358-38"><a href="5-mod-05.html#cb1358-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb1358-39"><a href="5-mod-05.html#cb1358-39" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(px, mn2, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1358-40"><a href="5-mod-05.html#cb1358-40" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(x, y)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-565-1.png" width="768" /></p>
<p>The gamma GLM captured the heteroscedasticity in the data (non-constant variance) better than the Gaussian (normal) GLM. We should conclude that the gamma GLM better represents the data. If you have a heteroscedastic relationship that isn’t well-modeled by other GLMs, the gamma GLM might be worth a try.</p>
</div>
</div>
<div id="mod-05-beyond" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Beyond GLM: Overview of GAM and GEE</h2>
<p>In other sections we have explored the power and utility of GLMs for biological data. This page describes two methods that can be thought of as extensions of GLM: generalized additive models (GAM) and generalized estimating equations (GEE). GAM will get a more thorough treatment in their own section in the future.</p>
<div id="mod-05-gam" class="section level3" number="5.9.1">
<h3><span class="header-section-number">5.9.1</span> Generalized additive models (GAM)</h3>
<p><strong>Generalized additive models (GAM)</strong> go one step further than GLMs by relaxing an additional assumption: the assumption of a linear relationship between the response variable on the link scale and the predictors. GAMs fit a curve to data that can vary in complexity. These curves are commonly called <strong>smoothers</strong>. However, the parameters of the curve are not tested individually in the way that the parameters in something like a quadratic model or non-linear model would be. Instead, the curve itself is treated as a regression coefficient. Compare the equation for the linear predictor of a GLM with <em>k</em> predictors</p>
<p><span class="math display">\[g\left(E\left(Y\right)\right)=\beta_0+\beta_1X_1+\beta_1X_1+\ldots+\beta_kX_k\]</span></p>
<p>to the equation of the predictor of a GAM with k predictors:</p>
<p><span class="math display">\[g\left(E\left(Y\right)\right)=\beta_0+f_1\left(X_1\right)+f_2\left(X_2\right)+\ldots+f_k\left(X_k\right)\]</span></p>
<p>Instead of each predictor being multiplied by a coefficient, a smoothing function of each predictor is estimated.</p>
<p>When should you use GAM? The most common application is situations where the response is not linearly related to the predictors, or if the response curve takes on a complicated shape. As you might suspect, the smoothers fitted in a GAM can be vulnerable to overfitting just as can be polynomial models or multiple regression models. Researchers usually control for this overfitting of the smoothers by limiting the complexity of the curves; this parameter is usually called the number of “knots”.</p>
<p>GAMs will get a more thorough treatment later in the context of nonlinear models. Some good references to get you started are <span class="citation">Wood (<a href="#ref-wood2017generalized" role="doc-biblioref">2017</a>)</span> and <span class="citation">Zuur et al. (<a href="#ref-zuur2007analysing" role="doc-biblioref">2007</a>)</span>. The best-known R package for fitting GAMs is mgcv (<a href="https://cran.r-project.org/web/packages/mgcv/index.html">CRAN page</a>, accessed 2021-09-17).</p>
</div>
<div id="mod-05-gee" class="section level3" number="5.9.2">
<h3><span class="header-section-number">5.9.2</span> Generalized estimating equations (GEE)</h3>
<p>All GLMs assume that observations are independent of each other. However, this cannot always be assumed in biological data. Observations may by correlated with each other across time and space, or within treatment or blocking groups. Such violations of the independence assumption can often be handled well by mixed models, which are described in their own pages elsewhere on this site. However, the technique of <strong>generalized estimating equations (GEE)</strong> is another way to analyze data with inherent correlations between observations. Some references to start with if you are interested are <span class="citation">Liang and Zeger (<a href="#ref-liang1986longitudinal" role="doc-biblioref">1986</a>)</span> and <span class="citation">Højsgaard et al. (<a href="#ref-hojsgaard2006" role="doc-biblioref">2006</a>)</span>. Two important packages used with GEE are <code>gee</code> <span class="citation">(<a href="#ref-geepackage" role="doc-biblioref">Carey 2019</a>)</span> and <code>geepack</code> <span class="citation">(<a href="#ref-hojsgaard2006" role="doc-biblioref">Højsgaard et al. 2006</a>)</span>.</p>

</div>
</div>
</div>
<h3>Literature Cited</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-bolker2008ecological" class="csl-entry">
Bolker, B. M. 2008. Ecological models and data in <span>R</span>. Princeton University Press, Princeton, New Jersey, USA.
</div>
<div id="ref-bolker2009" class="csl-entry">
Bolker, B. M., M. E. Brooks, C. J. Clark, S. W. Geange, J. R. Poulsen, M. H. H. Stevens, and J.-S. S. White. 2009. <a href="https://doi.org/10.1016/j.tree.2008.10.008">Generalized linear mixed models: A practical guide for ecology and evolution</a>. Trends in Ecology &amp; Evolution 24:127–135.
</div>
<div id="ref-bubrig2020" class="csl-entry">
Bubrig, L. T., J. M. Sutton, and J. L. Fierst. 2020. <a href="https://doi.org/10.1002/ece3.6646"><em><span>C</span>aenorhabditis elegans</em> dauers vary recovery in response to bacteria from natural habitat</a>. Ecology and Evolution 10:9886–9895.
</div>
<div id="ref-burnham2004multimodel" class="csl-entry">
Burnham, K. P., and D. R. Anderson. 2004. Multimodel inference: Understanding <span>AIC</span> and <span>BIC</span> in model selection. Sociological methods &amp; research 33:261–304.
</div>
<div id="ref-geepackage" class="csl-entry">
Carey, V. J. 2019. <a href="https://CRAN.R-project.org/package=gee"><span class="nocase">g</span>ee: Generalized estimation equation solver</a>.
</div>
<div id="ref-chivers1980" class="csl-entry">
Chivers, D. J., and C. M. Hladik. 1980. <a href="https://doi.org/10.1002/jmor.1051660306">Morphology of the gastrointestinal tract in primates: Comparisons with other mammals in relation to diet</a>. Journal of Morphology 166:337–386.
</div>
<div id="ref-faurby2018" class="csl-entry">
Faurby, S., M. Davis, R. Ø. Pedersen, S. D. Schowanek, A. Antonelli, and J.-C. Svenning. 2018. <a href="https://doi.org/10.1002/ecy.2443"><span>PHYLACINE</span> 1.2: The phylogenetic atlas of mammal macroecology</a>. Ecology 99:2626.
</div>
<div id="ref-hojsgaard2006" class="csl-entry">
Højsgaard, S., U. Halekoh, and J. Yan. 2006. <a href="https://doi.org/10.18637/jss.v015.i02">The <span>R</span> package geepack for generalized estimating equations</a>. Journal of statistical software 15:1–11.
</div>
<div id="ref-liang1986longitudinal" class="csl-entry">
Liang, K.-Y., and S. L. Zeger. 1986. Longitudinal data analysis using generalized linear models. Biometrika 73:13–22.
</div>
<div id="ref-nelder1972" class="csl-entry">
Nelder, J. A., and R. W. M. Wedderburn. 1972. <a href="https://doi.org/10.2307/2344614">Generalized linear models</a>. Journal of the Royal Statistical Society: Series A (General) 135:370.
</div>
<div id="ref-wood2017generalized" class="csl-entry">
Wood, S. N. 2017. Generalized additive models: An introduction with <span>R</span>. 2nd edition. CRC press.
</div>
<div id="ref-zuur2007analysing" class="csl-entry">
Zuur, A. F., E. N. Ieno, and G. M. Smith. 2007. Analysing ecological data. Springer Science+Business Media, New York.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-mod-04.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-mod-06.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
