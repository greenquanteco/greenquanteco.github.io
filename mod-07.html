<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 7 Mixed models | Applied Biological Data Analysis</title>
  <meta name="description" content="Helping biologists to become more informed users of R and statistical methods." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 7 Mixed models | Applied Biological Data Analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://greenquanteco.github.io/index.html" />
  <meta property="og:image" content="https://greenquanteco.github.io/index.html/C:/Users/ngreen62/OneDrive - Kennesaw State University/ksu/website/lab_logo_02.jpg" />
  <meta property="og:description" content="Helping biologists to become more informed users of R and statistical methods." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 7 Mixed models | Applied Biological Data Analysis" />
  
  <meta name="twitter:description" content="Helping biologists to become more informed users of R and statistical methods." />
  <meta name="twitter:image" content="https://greenquanteco.github.io/index.html/C:/Users/ngreen62/OneDrive - Kennesaw State University/ksu/website/lab_logo_02.jpg" />

<meta name="author" content="Nick Green, Kennesaw State University" />


<meta name="date" content="2022-01-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mod-06.html"/>
<link rel="next" href="mod-08.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license-and-permissions"><i class="fa fa-check"></i>License and permissions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-objectives"><i class="fa fa-check"></i>Course objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-requirements"><i class="fa fa-check"></i>Course requirements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#recommended-reading"><i class="fa fa-check"></i>Recommended reading</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-organization"><i class="fa fa-check"></i>Course organization</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-the-author"><i class="fa fa-check"></i>About the author</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="mod-01.html"><a href="mod-01.html"><i class="fa fa-check"></i><b>1</b> Statistics in modern biology</a>
<ul>
<li class="chapter" data-level="1.1" data-path="mod-01.html"><a href="mod-01.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="mod-01.html"><a href="mod-01.html#statistics-in-modern-biology"><i class="fa fa-check"></i><b>1.2</b> Statistics in modern biology</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="mod-01.html"><a href="mod-01.html#the-scientific-method"><i class="fa fa-check"></i><b>1.2.1</b> The scientific method</a></li>
<li class="chapter" data-level="1.2.2" data-path="mod-01.html"><a href="mod-01.html#example-data-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Example data analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="mod-01.html"><a href="mod-01.html#misuses-of-statistics"><i class="fa fa-check"></i><b>1.3</b> Misuses of statistics</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="mod-01.html"><a href="mod-01.html#proving-the-trivial-and-meaningless-hypotheses"><i class="fa fa-check"></i><b>1.3.1</b> “Proving” the trivial and meaningless hypotheses</a></li>
<li class="chapter" data-level="1.3.2" data-path="mod-01.html"><a href="mod-01.html#inappropriate-methods"><i class="fa fa-check"></i><b>1.3.2</b> Inappropriate methods</a></li>
<li class="chapter" data-level="1.3.3" data-path="mod-01.html"><a href="mod-01.html#p-hacking-and-data-dredging"><i class="fa fa-check"></i><b>1.3.3</b> <em>P</em>-hacking and data dredging</a></li>
<li class="chapter" data-level="1.3.4" data-path="mod-01.html"><a href="mod-01.html#inadequate-sample-sizes-and-pseudoreplication"><i class="fa fa-check"></i><b>1.3.4</b> Inadequate sample sizes and pseudoreplication</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="mod-01.html"><a href="mod-01.html#p-values-and-null-hypothesis-significance-testing-nhst"><i class="fa fa-check"></i><b>1.4</b> <em>P</em>-values and null hypothesis significance testing (NHST)</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="mod-01.html"><a href="mod-01.html#definition"><i class="fa fa-check"></i><b>1.4.1</b> Definition</a></li>
<li class="chapter" data-level="1.4.2" data-path="mod-01.html"><a href="mod-01.html#history-and-status-of-p-values"><i class="fa fa-check"></i><b>1.4.2</b> History and status of <em>P</em>-values</a></li>
<li class="chapter" data-level="1.4.3" data-path="mod-01.html"><a href="mod-01.html#where-p-values-come-from"><i class="fa fa-check"></i><b>1.4.3</b> Where <em>P</em>-values come from</a></li>
<li class="chapter" data-level="1.4.4" data-path="mod-01.html"><a href="mod-01.html#what-p-values-mean-and-do-not-mean"><i class="fa fa-check"></i><b>1.4.4</b> What <em>P</em>-values mean and do not mean</a></li>
<li class="chapter" data-level="1.4.5" data-path="mod-01.html"><a href="mod-01.html#do-you-need-a-p-value"><i class="fa fa-check"></i><b>1.4.5</b> Do you need a <em>P</em>-value?</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="mod-01.html"><a href="mod-01.html#alternatives-to-nhst"><i class="fa fa-check"></i><b>1.5</b> Alternatives to NHST</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="mod-01.html"><a href="mod-01.html#bayesian-inference"><i class="fa fa-check"></i><b>1.5.1</b> Bayesian inference</a></li>
<li class="chapter" data-level="1.5.2" data-path="mod-01.html"><a href="mod-01.html#information-theoretic-methods"><i class="fa fa-check"></i><b>1.5.2</b> Information-theoretic methods</a></li>
<li class="chapter" data-level="1.5.3" data-path="mod-01.html"><a href="mod-01.html#machine-learning"><i class="fa fa-check"></i><b>1.5.3</b> Machine learning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mod-02.html"><a href="mod-02.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mod-02.html"><a href="mod-02.html#getting-started-with-r"><i class="fa fa-check"></i><b>2.1</b> Getting started with R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="mod-02.html"><a href="mod-02.html#what-is-r"><i class="fa fa-check"></i><b>2.1.1</b> What is R?</a></li>
<li class="chapter" data-level="2.1.2" data-path="mod-02.html"><a href="mod-02.html#advantages-of-r"><i class="fa fa-check"></i><b>2.1.2</b> Advantages of R</a></li>
<li class="chapter" data-level="2.1.3" data-path="mod-02.html"><a href="mod-02.html#disadvantages-of-r"><i class="fa fa-check"></i><b>2.1.3</b> Disadvantages of R</a></li>
<li class="chapter" data-level="2.1.4" data-path="mod-02.html"><a href="mod-02.html#base-r-and-vs.-tidyverse"><i class="fa fa-check"></i><b>2.1.4</b> Base R and (vs.?) <code>tidyverse</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="mod-02.html"><a href="mod-02.html#download-and-install-r-and-rstudio"><i class="fa fa-check"></i><b>2.2</b> Download and install R (and RStudio)</a></li>
<li class="chapter" data-level="2.3" data-path="mod-02.html"><a href="mod-02.html#using-r"><i class="fa fa-check"></i><b>2.3</b> Using R</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="mod-02.html"><a href="mod-02.html#using-the-base-r-gui"><i class="fa fa-check"></i><b>2.3.1</b> Using the base R GUI</a></li>
<li class="chapter" data-level="2.3.2" data-path="mod-02.html"><a href="mod-02.html#using-r-in-rstudio"><i class="fa fa-check"></i><b>2.3.2</b> Using R in RStudio</a></li>
<li class="chapter" data-level="2.3.3" data-path="mod-02.html"><a href="mod-02.html#using-r-with-other-programs"><i class="fa fa-check"></i><b>2.3.3</b> Using R with other programs</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="mod-02.html"><a href="mod-02.html#mod-02-first"><i class="fa fa-check"></i><b>2.4</b> A first R session</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="mod-02.html"><a href="mod-02.html#import-data"><i class="fa fa-check"></i><b>2.4.1</b> Import data</a></li>
<li class="chapter" data-level="2.4.2" data-path="mod-02.html"><a href="mod-02.html#explore-and-visualize-data"><i class="fa fa-check"></i><b>2.4.2</b> Explore and visualize data</a></li>
<li class="chapter" data-level="2.4.3" data-path="mod-02.html"><a href="mod-02.html#transform-data"><i class="fa fa-check"></i><b>2.4.3</b> Transform data</a></li>
<li class="chapter" data-level="2.4.4" data-path="mod-02.html"><a href="mod-02.html#analyze-data"><i class="fa fa-check"></i><b>2.4.4</b> Analyze data</a></li>
<li class="chapter" data-level="2.4.5" data-path="mod-02.html"><a href="mod-02.html#write-out-results"><i class="fa fa-check"></i><b>2.4.5</b> Write out results</a></li>
<li class="chapter" data-level="2.4.6" data-path="mod-02.html"><a href="mod-02.html#save-your-work"><i class="fa fa-check"></i><b>2.4.6</b> Save your work?</a></li>
<li class="chapter" data-level="2.4.7" data-path="mod-02.html"><a href="mod-02.html#whats-next"><i class="fa fa-check"></i><b>2.4.7</b> What’s next?</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="mod-02.html"><a href="mod-02.html#write-and-execute-commands-in-the-r-console"><i class="fa fa-check"></i><b>2.5</b> Write and execute commands in the R console</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="mod-02.html"><a href="mod-02.html#r-commandsbasics"><i class="fa fa-check"></i><b>2.5.1</b> R commands–basics</a></li>
<li class="chapter" data-level="2.5.2" data-path="mod-02.html"><a href="mod-02.html#elements-of-r-code"><i class="fa fa-check"></i><b>2.5.2</b> Elements of R code</a></li>
<li class="chapter" data-level="2.5.3" data-path="mod-02.html"><a href="mod-02.html#the-r-workspace"><i class="fa fa-check"></i><b>2.5.3</b> The R workspace</a></li>
<li class="chapter" data-level="2.5.4" data-path="mod-02.html"><a href="mod-02.html#r-code-basics-assignment-and-operators"><i class="fa fa-check"></i><b>2.5.4</b> R code basics: assignment and operators</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="mod-02.html"><a href="mod-02.html#mod-02-struct"><i class="fa fa-check"></i><b>2.6</b> Basic R data structures</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="mod-02.html"><a href="mod-02.html#vectors"><i class="fa fa-check"></i><b>2.6.1</b> Vectors</a></li>
<li class="chapter" data-level="2.6.2" data-path="mod-02.html"><a href="mod-02.html#data-frames"><i class="fa fa-check"></i><b>2.6.2</b> Data frames</a></li>
<li class="chapter" data-level="2.6.3" data-path="mod-02.html"><a href="mod-02.html#matrices-and-arrays"><i class="fa fa-check"></i><b>2.6.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="2.6.4" data-path="mod-02.html"><a href="mod-02.html#lists"><i class="fa fa-check"></i><b>2.6.4</b> Lists</a></li>
<li class="chapter" data-level="2.6.5" data-path="mod-02.html"><a href="mod-02.html#s4-objects"><i class="fa fa-check"></i><b>2.6.5</b> S4 objects</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="mod-02.html"><a href="mod-02.html#r-data-types"><i class="fa fa-check"></i><b>2.7</b> R data types</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="mod-02.html"><a href="mod-02.html#character-type"><i class="fa fa-check"></i><b>2.7.1</b> Character type</a></li>
<li class="chapter" data-level="2.7.2" data-path="mod-02.html"><a href="mod-02.html#numeric-type"><i class="fa fa-check"></i><b>2.7.2</b> Numeric type</a></li>
<li class="chapter" data-level="2.7.3" data-path="mod-02.html"><a href="mod-02.html#integer-type"><i class="fa fa-check"></i><b>2.7.3</b> Integer type</a></li>
<li class="chapter" data-level="2.7.4" data-path="mod-02.html"><a href="mod-02.html#logical-type"><i class="fa fa-check"></i><b>2.7.4</b> Logical type</a></li>
<li class="chapter" data-level="2.7.5" data-path="mod-02.html"><a href="mod-02.html#special-values"><i class="fa fa-check"></i><b>2.7.5</b> Special values</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="mod-02.html"><a href="mod-02.html#manage-r-code-as-scripts-.r-files"><i class="fa fa-check"></i><b>2.8</b> Manage R code as scripts (.r files)</a></li>
<li class="chapter" data-level="2.9" data-path="mod-02.html"><a href="mod-02.html#manage-and-use-r-packages"><i class="fa fa-check"></i><b>2.9</b> Manage and use R packages</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="mod-02.html"><a href="mod-02.html#your-r-library"><i class="fa fa-check"></i><b>2.9.1</b> Your R library</a></li>
<li class="chapter" data-level="2.9.2" data-path="mod-02.html"><a href="mod-02.html#installing-packages-using-the-r-gui"><i class="fa fa-check"></i><b>2.9.2</b> Installing packages using the R GUI</a></li>
<li class="chapter" data-level="2.9.3" data-path="mod-02.html"><a href="mod-02.html#installing-packages-in-rstudio"><i class="fa fa-check"></i><b>2.9.3</b> Installing packages in RStudio</a></li>
<li class="chapter" data-level="2.9.4" data-path="mod-02.html"><a href="mod-02.html#installing-packages-using-the-r-console"><i class="fa fa-check"></i><b>2.9.4</b> Installing packages using the R console</a></li>
<li class="chapter" data-level="2.9.5" data-path="mod-02.html"><a href="mod-02.html#working-with-packages-in-r"><i class="fa fa-check"></i><b>2.9.5</b> Working with packages in R</a></li>
<li class="chapter" data-level="2.9.6" data-path="mod-02.html"><a href="mod-02.html#package-dependencies"><i class="fa fa-check"></i><b>2.9.6</b> Package dependencies</a></li>
<li class="chapter" data-level="2.9.7" data-path="mod-02.html"><a href="mod-02.html#citing-packages"><i class="fa fa-check"></i><b>2.9.7</b> Citing packages</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="mod-02.html"><a href="mod-02.html#r-documentation"><i class="fa fa-check"></i><b>2.10</b> R documentation</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="mod-02.html"><a href="mod-02.html#documentation-help-files"><i class="fa fa-check"></i><b>2.10.1</b> Documentation (help) files</a></li>
<li class="chapter" data-level="2.10.2" data-path="mod-02.html"><a href="mod-02.html#r-vignettes"><i class="fa fa-check"></i><b>2.10.2</b> R vignettes</a></li>
<li class="chapter" data-level="2.10.3" data-path="mod-02.html"><a href="mod-02.html#official-r-project-resources"><i class="fa fa-check"></i><b>2.10.3</b> Official R Project resources</a></li>
<li class="chapter" data-level="2.10.4" data-path="mod-02.html"><a href="mod-02.html#unofficial-online-resources"><i class="fa fa-check"></i><b>2.10.4</b> Unofficial online resources</a></li>
<li class="chapter" data-level="2.10.5" data-path="mod-02.html"><a href="mod-02.html#r-books"><i class="fa fa-check"></i><b>2.10.5</b> R books</a></li>
<li class="chapter" data-level="2.10.6" data-path="mod-02.html"><a href="mod-02.html#two-reminders"><i class="fa fa-check"></i><b>2.10.6</b> Two reminders</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mod-03.html"><a href="mod-03.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mod-03.html"><a href="mod-03.html#mod-03-inout"><i class="fa fa-check"></i><b>3.1</b> Data import and export</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="mod-03.html"><a href="mod-03.html#importing-data-preliminaries"><i class="fa fa-check"></i><b>3.1.1</b> Importing data: preliminaries</a></li>
<li class="chapter" data-level="3.1.2" data-path="mod-03.html"><a href="mod-03.html#importing-data-from-text-files-with-read.csv-and-read.table"><i class="fa fa-check"></i><b>3.1.2</b> Importing data from text files with <code>read.csv()</code> and <code>read.table()</code></a></li>
<li class="chapter" data-level="3.1.3" data-path="mod-03.html"><a href="mod-03.html#importing-data-from-saved-workspaces"><i class="fa fa-check"></i><b>3.1.3</b> Importing data from saved workspaces</a></li>
<li class="chapter" data-level="3.1.4" data-path="mod-03.html"><a href="mod-03.html#importing-data-special-cases"><i class="fa fa-check"></i><b>3.1.4</b> Importing data: special cases:</a></li>
<li class="chapter" data-level="3.1.5" data-path="mod-03.html"><a href="mod-03.html#export-data-from-r"><i class="fa fa-check"></i><b>3.1.5</b> Export data from R</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="mod-03.html"><a href="mod-03.html#making-values-in-r"><i class="fa fa-check"></i><b>3.2</b> Making values in R</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mod-03.html"><a href="mod-03.html#producing-arbitrary-values-with-c"><i class="fa fa-check"></i><b>3.2.1</b> Producing arbitrary values with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="mod-03.html"><a href="mod-03.html#generating-regular-values"><i class="fa fa-check"></i><b>3.2.2</b> Generating regular values</a></li>
<li class="chapter" data-level="3.2.3" data-path="mod-03.html"><a href="mod-03.html#generating-random-values"><i class="fa fa-check"></i><b>3.2.3</b> Generating random values</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="mod-03.html"><a href="mod-03.html#selecting-data-with"><i class="fa fa-check"></i><b>3.3</b> Selecting data with <code>[]</code></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="mod-03.html"><a href="mod-03.html#mod-03-brackets"><i class="fa fa-check"></i><b>3.3.1</b> Basics of brackets</a></li>
<li class="chapter" data-level="3.3.2" data-path="mod-03.html"><a href="mod-03.html#extracting-and-selecting-data-with-logical-tests"><i class="fa fa-check"></i><b>3.3.2</b> Extracting and selecting data with logical tests</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="mod-03.html"><a href="mod-03.html#managing-dates-and-characters"><i class="fa fa-check"></i><b>3.4</b> Managing dates and characters</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="mod-03.html"><a href="mod-03.html#temporal-data-and-dates"><i class="fa fa-check"></i><b>3.4.1</b> Temporal data and dates</a></li>
<li class="chapter" data-level="3.4.2" data-path="mod-03.html"><a href="mod-03.html#character-data-text"><i class="fa fa-check"></i><b>3.4.2</b> Character data (text)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="mod-03.html"><a href="mod-03.html#mod-03-dataframe"><i class="fa fa-check"></i><b>3.5</b> Data frame management</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="mod-03.html"><a href="mod-03.html#data-frame-structure"><i class="fa fa-check"></i><b>3.5.1</b> Data frame structure</a></li>
<li class="chapter" data-level="3.5.2" data-path="mod-03.html"><a href="mod-03.html#common-data-frame-operations"><i class="fa fa-check"></i><b>3.5.2</b> Common data frame operations</a></li>
<li class="chapter" data-level="3.5.3" data-path="mod-03.html"><a href="mod-03.html#other-data-frame-operations"><i class="fa fa-check"></i><b>3.5.3</b> Other data frame operations</a></li>
<li class="chapter" data-level="3.5.4" data-path="mod-03.html"><a href="mod-03.html#mod-03-reshape"><i class="fa fa-check"></i><b>3.5.4</b> Reshaping data frames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mod-04.html"><a href="mod-04.html"><i class="fa fa-check"></i><b>4</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mod-04.html"><a href="mod-04.html#descriptive-and-summary-statistics"><i class="fa fa-check"></i><b>4.1</b> Descriptive and summary statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="mod-04.html"><a href="mod-04.html#basic-summary-statistics"><i class="fa fa-check"></i><b>4.1.1</b> Basic summary statistics</a></li>
<li class="chapter" data-level="4.1.2" data-path="mod-04.html"><a href="mod-04.html#summarizing-data-with-the-apply-family"><i class="fa fa-check"></i><b>4.1.2</b> Summarizing data with the <code>apply()</code> family</a></li>
<li class="chapter" data-level="4.1.3" data-path="mod-04.html"><a href="mod-04.html#mod-04-tabagg"><i class="fa fa-check"></i><b>4.1.3</b> Tabulation and aggregation</a></li>
<li class="chapter" data-level="4.1.4" data-path="mod-04.html"><a href="mod-04.html#aggregation-aka-pivot-tables"><i class="fa fa-check"></i><b>4.1.4</b> Aggregation (aka: pivot tables)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mod-04.html"><a href="mod-04.html#mod-04-vis"><i class="fa fa-check"></i><b>4.2</b> Visualizing data distributions</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mod-04.html"><a href="mod-04.html#boxplots-aka-box-and-whisker-plots"><i class="fa fa-check"></i><b>4.2.1</b> Boxplots (aka: box-and-whisker plots)</a></li>
<li class="chapter" data-level="4.2.2" data-path="mod-04.html"><a href="mod-04.html#histograms"><i class="fa fa-check"></i><b>4.2.2</b> Histograms</a></li>
<li class="chapter" data-level="4.2.3" data-path="mod-04.html"><a href="mod-04.html#kernel-density-plots"><i class="fa fa-check"></i><b>4.2.3</b> Kernel density plots</a></li>
<li class="chapter" data-level="4.2.4" data-path="mod-04.html"><a href="mod-04.html#empirical-cumulative-distribution-plots-ecdf"><i class="fa fa-check"></i><b>4.2.4</b> Empirical cumulative distribution plots (ECDF)</a></li>
<li class="chapter" data-level="4.2.5" data-path="mod-04.html"><a href="mod-04.html#quantile-quantile-qq-plots"><i class="fa fa-check"></i><b>4.2.5</b> Quantile-quantile (QQ) plots</a></li>
<li class="chapter" data-level="4.2.6" data-path="mod-04.html"><a href="mod-04.html#how-should-i-plot-my-data"><i class="fa fa-check"></i><b>4.2.6</b> How should I plot my data?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="mod-04.html"><a href="mod-04.html#mod-04-dists1"><i class="fa fa-check"></i><b>4.3</b> Statistical distributions</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="mod-04.html"><a href="mod-04.html#probability-distributions"><i class="fa fa-check"></i><b>4.3.1</b> Probability distributions</a></li>
<li class="chapter" data-level="4.3.2" data-path="mod-04.html"><a href="mod-04.html#probability-distributions-in-r"><i class="fa fa-check"></i><b>4.3.2</b> Probability distributions in R</a></li>
<li class="chapter" data-level="4.3.3" data-path="mod-04.html"><a href="mod-04.html#discrete-distributions"><i class="fa fa-check"></i><b>4.3.3</b> Discrete distributions</a></li>
<li class="chapter" data-level="4.3.4" data-path="mod-04.html"><a href="mod-04.html#continuous-distributions"><i class="fa fa-check"></i><b>4.3.4</b> Continuous distributions</a></li>
<li class="chapter" data-level="4.3.5" data-path="mod-04.html"><a href="mod-04.html#distributions-summary"><i class="fa fa-check"></i><b>4.3.5</b> Distributions summary</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="mod-04.html"><a href="mod-04.html#mod-04-dists2"><i class="fa fa-check"></i><b>4.4</b> Fitting and testing distributions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="mod-04.html"><a href="mod-04.html#estimating-distributional-parameters"><i class="fa fa-check"></i><b>4.4.1</b> Estimating distributional parameters</a></li>
<li class="chapter" data-level="4.4.2" data-path="mod-04.html"><a href="mod-04.html#graphical-methods-for-examining-distributions"><i class="fa fa-check"></i><b>4.4.2</b> Graphical methods for examining distributions</a></li>
<li class="chapter" data-level="4.4.3" data-path="mod-04.html"><a href="mod-04.html#formal-tests-for-distributions"><i class="fa fa-check"></i><b>4.4.3</b> Formal tests for distributions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="mod-04.html"><a href="mod-04.html#mod-04-trans"><i class="fa fa-check"></i><b>4.5</b> Data transformations</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="mod-04.html"><a href="mod-04.html#why-transform"><i class="fa fa-check"></i><b>4.5.1</b> Why transform?</a></li>
<li class="chapter" data-level="4.5.2" data-path="mod-04.html"><a href="mod-04.html#transforms-vs.-link-functions"><i class="fa fa-check"></i><b>4.5.2</b> Transforms vs. link functions</a></li>
<li class="chapter" data-level="4.5.3" data-path="mod-04.html"><a href="mod-04.html#log-transformation"><i class="fa fa-check"></i><b>4.5.3</b> Log transformation</a></li>
<li class="chapter" data-level="4.5.4" data-path="mod-04.html"><a href="mod-04.html#rank-transformation"><i class="fa fa-check"></i><b>4.5.4</b> Rank transformation</a></li>
<li class="chapter" data-level="4.5.5" data-path="mod-04.html"><a href="mod-04.html#other-transforms-less-common"><i class="fa fa-check"></i><b>4.5.5</b> Other transforms (less common)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="mod-04.html"><a href="mod-04.html#multivariate-data-exploration"><i class="fa fa-check"></i><b>4.6</b> Multivariate data exploration</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="mod-04.html"><a href="mod-04.html#scatterplots-for-two-variables"><i class="fa fa-check"></i><b>4.6.1</b> Scatterplots for two variables</a></li>
<li class="chapter" data-level="4.6.2" data-path="mod-04.html"><a href="mod-04.html#mod-04-smat"><i class="fa fa-check"></i><b>4.6.2</b> Scatterplot matrices for many variables</a></li>
<li class="chapter" data-level="4.6.3" data-path="mod-04.html"><a href="mod-04.html#lattice-plots-for-hierarchical-data"><i class="fa fa-check"></i><b>4.6.3</b> Lattice plots for hierarchical data</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="mod-04.html"><a href="mod-04.html#ordination-brief-introduction"><i class="fa fa-check"></i><b>4.7</b> Ordination (brief introduction)</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="mod-04.html"><a href="mod-04.html#principal-components-analysis-pca"><i class="fa fa-check"></i><b>4.7.1</b> Principal components analysis (PCA)</a></li>
<li class="chapter" data-level="4.7.2" data-path="mod-04.html"><a href="mod-04.html#nonmetric-multidimensional-scaling-nmds"><i class="fa fa-check"></i><b>4.7.2</b> Nonmetric multidimensional scaling (NMDS)</a></li>
<li class="chapter" data-level="4.7.3" data-path="mod-04.html"><a href="mod-04.html#plotting-ordinations"><i class="fa fa-check"></i><b>4.7.3</b> Plotting ordinations</a></li>
<li class="chapter" data-level="4.7.4" data-path="mod-04.html"><a href="mod-04.html#ordination-wrap-up-for-now"><i class="fa fa-check"></i><b>4.7.4</b> Ordination wrap-up (for now)</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="mod-04.html"><a href="mod-04.html#mod-04-prob"><i class="fa fa-check"></i><b>4.8</b> Common statistical problems</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="mod-04.html"><a href="mod-04.html#outliers-and-erroneous-values"><i class="fa fa-check"></i><b>4.8.1</b> Outliers and erroneous values</a></li>
<li class="chapter" data-level="4.8.2" data-path="mod-04.html"><a href="mod-04.html#autocorrelation"><i class="fa fa-check"></i><b>4.8.2</b> Autocorrelation</a></li>
<li class="chapter" data-level="4.8.3" data-path="mod-04.html"><a href="mod-04.html#mod-04-multicol"><i class="fa fa-check"></i><b>4.8.3</b> Collinearity</a></li>
<li class="chapter" data-level="4.8.4" data-path="mod-04.html"><a href="mod-04.html#missing-data"><i class="fa fa-check"></i><b>4.8.4</b> Missing data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mod-05.html"><a href="mod-05.html"><i class="fa fa-check"></i><b>5</b> Generalized linear models (GLM)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="mod-05.html"><a href="mod-05.html#mod-05-lm"><i class="fa fa-check"></i><b>5.1</b> Prelude with linear models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="mod-05.html"><a href="mod-05.html#assumptions-of-linear-models"><i class="fa fa-check"></i><b>5.1.1</b> Assumptions of linear models</a></li>
<li class="chapter" data-level="5.1.2" data-path="mod-05.html"><a href="mod-05.html#linear-regression-in-r"><i class="fa fa-check"></i><b>5.1.2</b> Linear regression in R</a></li>
<li class="chapter" data-level="5.1.3" data-path="mod-05.html"><a href="mod-05.html#multiple-linear-regression"><i class="fa fa-check"></i><b>5.1.3</b> Multiple linear regression</a></li>
<li class="chapter" data-level="5.1.4" data-path="mod-05.html"><a href="mod-05.html#mod-05-anova"><i class="fa fa-check"></i><b>5.1.4</b> ANOVA and ANCOVA with <code>lm()</code></a></li>
<li class="chapter" data-level="5.1.5" data-path="mod-05.html"><a href="mod-05.html#variations-on-linear-models"><i class="fa fa-check"></i><b>5.1.5</b> Variations on linear models</a></li>
<li class="chapter" data-level="5.1.6" data-path="mod-05.html"><a href="mod-05.html#example-linear-regression-workflow"><i class="fa fa-check"></i><b>5.1.6</b> Example linear regression workflow</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="mod-05.html"><a href="mod-05.html#mod-05-basic"><i class="fa fa-check"></i><b>5.2</b> GLM basics</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="mod-05.html"><a href="mod-05.html#example-glms"><i class="fa fa-check"></i><b>5.2.1</b> Example GLMS</a></li>
<li class="chapter" data-level="5.2.2" data-path="mod-05.html"><a href="mod-05.html#glm-families"><i class="fa fa-check"></i><b>5.2.2</b> GLM families</a></li>
<li class="chapter" data-level="5.2.3" data-path="mod-05.html"><a href="mod-05.html#glm-link-functions"><i class="fa fa-check"></i><b>5.2.3</b> GLM link functions</a></li>
<li class="chapter" data-level="5.2.4" data-path="mod-05.html"><a href="mod-05.html#deviance-and-other-glm-diagnostics"><i class="fa fa-check"></i><b>5.2.4</b> Deviance and other GLM diagnostics</a></li>
<li class="chapter" data-level="5.2.5" data-path="mod-05.html"><a href="mod-05.html#to-pseudo-r2-or-not-to-pseudo-r2"><i class="fa fa-check"></i><b>5.2.5</b> To pseudo-<em>R</em><sup>2</sup> or not to pseudo-<em>R</em><sup>2</sup>?</a></li>
<li class="chapter" data-level="5.2.6" data-path="mod-05.html"><a href="mod-05.html#common-glms"><i class="fa fa-check"></i><b>5.2.6</b> Common GLMs</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="mod-05.html"><a href="mod-05.html#mod-05-loglin"><i class="fa fa-check"></i><b>5.3</b> Log-linear models</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="mod-05.html"><a href="mod-05.html#mod-05-loglin-examp"><i class="fa fa-check"></i><b>5.3.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.3.2" data-path="mod-05.html"><a href="mod-05.html#example-with-real-data"><i class="fa fa-check"></i><b>5.3.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="mod-05.html"><a href="mod-05.html#mod-05-poisson"><i class="fa fa-check"></i><b>5.4</b> Poisson GLM for counts</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="mod-05.html"><a href="mod-05.html#example-with-simulated-data"><i class="fa fa-check"></i><b>5.4.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.4.2" data-path="mod-05.html"><a href="mod-05.html#example-with-real-data-1"><i class="fa fa-check"></i><b>5.4.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="mod-05.html"><a href="mod-05.html#mod-05-quasi"><i class="fa fa-check"></i><b>5.5</b> Quasi-Poisson and negative binomial GLM</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="mod-05.html"><a href="mod-05.html#example-with-simulated-data-1"><i class="fa fa-check"></i><b>5.5.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.5.2" data-path="mod-05.html"><a href="mod-05.html#example-with-real-data-2"><i class="fa fa-check"></i><b>5.5.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="mod-05.html"><a href="mod-05.html#mod-05-logistic"><i class="fa fa-check"></i><b>5.6</b> Logistic regression for binary outcomes</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="mod-05.html"><a href="mod-05.html#example-with-simulated-data-2"><i class="fa fa-check"></i><b>5.6.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="5.6.2" data-path="mod-05.html"><a href="mod-05.html#example-with-real-data-3"><i class="fa fa-check"></i><b>5.6.2</b> Example with real data</a></li>
<li class="chapter" data-level="5.6.3" data-path="mod-05.html"><a href="mod-05.html#mod-05-auc"><i class="fa fa-check"></i><b>5.6.3</b> Logistic GLM diagnostics: AUC and ROC</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="mod-05.html"><a href="mod-05.html#mod-05-binom"><i class="fa fa-check"></i><b>5.7</b> Binomial GLM for proportional data</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="mod-05.html"><a href="mod-05.html#binomial-glm"><i class="fa fa-check"></i><b>5.7.1</b> Binomial GLM</a></li>
<li class="chapter" data-level="5.7.2" data-path="mod-05.html"><a href="mod-05.html#example-with-simulated-data-3"><i class="fa fa-check"></i><b>5.7.2</b> Example with simulated data</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="mod-05.html"><a href="mod-05.html#mod-05-gamma"><i class="fa fa-check"></i><b>5.8</b> Gamma models for overdispersed data</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="mod-05.html"><a href="mod-05.html#example-with-simulated-data-4"><i class="fa fa-check"></i><b>5.8.1</b> Example with simulated data</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="mod-05.html"><a href="mod-05.html#mod-05-beyond"><i class="fa fa-check"></i><b>5.9</b> Beyond GLM: Overview of GAM and GEE</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="mod-05.html"><a href="mod-05.html#mod-05-gam"><i class="fa fa-check"></i><b>5.9.1</b> Generalized additive models (GAM)</a></li>
<li class="chapter" data-level="5.9.2" data-path="mod-05.html"><a href="mod-05.html#mod-05-gee"><i class="fa fa-check"></i><b>5.9.2</b> Generalized estimating equations (GEE)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mod-06.html"><a href="mod-06.html"><i class="fa fa-check"></i><b>6</b> Nonlinear models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mod-06.html"><a href="mod-06.html#background"><i class="fa fa-check"></i><b>6.1</b> Background</a></li>
<li class="chapter" data-level="6.2" data-path="mod-06.html"><a href="mod-06.html#mod-06-intro"><i class="fa fa-check"></i><b>6.2</b> Nonlinear least squares (NLS)</a></li>
<li class="chapter" data-level="6.3" data-path="mod-06.html"><a href="mod-06.html#mod-06-micmen"><i class="fa fa-check"></i><b>6.3</b> Michaelis-Menten curves</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="mod-06.html"><a href="mod-06.html#mod-06-micmen-sim"><i class="fa fa-check"></i><b>6.3.1</b> Example with simulated data</a></li>
<li class="chapter" data-level="6.3.2" data-path="mod-06.html"><a href="mod-06.html#example-with-real-data-4"><i class="fa fa-check"></i><b>6.3.2</b> Example with real data</a></li>
<li class="chapter" data-level="6.3.3" data-path="mod-06.html"><a href="mod-06.html#alternative-strategies-for-the-analysis"><i class="fa fa-check"></i><b>6.3.3</b> Alternative strategies for the analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="mod-06.html"><a href="mod-06.html#mod-06-grow"><i class="fa fa-check"></i><b>6.4</b> Biological growth curves</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="mod-06.html"><a href="mod-06.html#gompertz-and-von-bertalanffy-curves"><i class="fa fa-check"></i><b>6.4.1</b> Gompertz and von Bertalanffy curves</a></li>
<li class="chapter" data-level="6.4.2" data-path="mod-06.html"><a href="mod-06.html#example-with-real-data-5"><i class="fa fa-check"></i><b>6.4.2</b> Example with real data</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mod-06.html"><a href="mod-06.html#dose-response-curves"><i class="fa fa-check"></i><b>6.5</b> Dose response curves</a></li>
<li class="chapter" data-level="6.6" data-path="mod-06.html"><a href="mod-06.html#alternatives-to-nls"><i class="fa fa-check"></i><b>6.6</b> Alternatives to NLS</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="mod-06.html"><a href="mod-06.html#generalized-nonlinear-models"><i class="fa fa-check"></i><b>6.6.1</b> Generalized nonlinear models</a></li>
<li class="chapter" data-level="6.6.2" data-path="mod-06.html"><a href="mod-06.html#quantile-regression"><i class="fa fa-check"></i><b>6.6.2</b> Quantile regression</a></li>
<li class="chapter" data-level="6.6.3" data-path="mod-06.html"><a href="mod-06.html#mod-06-gam"><i class="fa fa-check"></i><b>6.6.3</b> Generalized additive models (GAM)</a></li>
<li class="chapter" data-level="6.6.4" data-path="mod-06.html"><a href="mod-06.html#classification-and-regression-trees-cart"><i class="fa fa-check"></i><b>6.6.4</b> Classification and regression trees (CART)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mod-07.html"><a href="mod-07.html"><i class="fa fa-check"></i><b>7</b> Mixed models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mod-07.html"><a href="mod-07.html#prelude-glm"><i class="fa fa-check"></i><b>7.1</b> Prelude (GLM)</a></li>
<li class="chapter" data-level="7.2" data-path="mod-07.html"><a href="mod-07.html#mod-07-lmm"><i class="fa fa-check"></i><b>7.2</b> Linear mixed models (LMM)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="mod-07.html"><a href="mod-07.html#formal-definition-and-example"><i class="fa fa-check"></i><b>7.2.1</b> Formal definition and example</a></li>
<li class="chapter" data-level="7.2.2" data-path="mod-07.html"><a href="mod-07.html#example-with-simulated-data-5"><i class="fa fa-check"></i><b>7.2.2</b> Example with simulated data</a></li>
<li class="chapter" data-level="7.2.3" data-path="mod-07.html"><a href="mod-07.html#p-values-in-lmm"><i class="fa fa-check"></i><b>7.2.3</b> <em>P</em>-values in LMM</a></li>
<li class="chapter" data-level="7.2.4" data-path="mod-07.html"><a href="mod-07.html#specifying-random-effects"><i class="fa fa-check"></i><b>7.2.4</b> Specifying random effects</a></li>
<li class="chapter" data-level="7.2.5" data-path="mod-07.html"><a href="mod-07.html#lmm-example-with-real-data"><i class="fa fa-check"></i><b>7.2.5</b> LMM example with real data</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="mod-07.html"><a href="mod-07.html#mod-07-glmm"><i class="fa fa-check"></i><b>7.3</b> Generalized linear mixed models (GLMM)</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="mod-07.html"><a href="mod-07.html#definition-1"><i class="fa fa-check"></i><b>7.3.1</b> Definition</a></li>
<li class="chapter" data-level="7.3.2" data-path="mod-07.html"><a href="mod-07.html#glmm-on-simulated-data"><i class="fa fa-check"></i><b>7.3.2</b> GLMM on simulated data</a></li>
<li class="chapter" data-level="7.3.3" data-path="mod-07.html"><a href="mod-07.html#glmm-on-real-data"><i class="fa fa-check"></i><b>7.3.3</b> GLMM on real data</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="mod-07.html"><a href="mod-07.html#mod-07-nlme"><i class="fa fa-check"></i><b>7.4</b> Nonlinear mixed models (NLME)</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mod-07.html"><a href="mod-07.html#definition-and-background"><i class="fa fa-check"></i><b>7.4.1</b> Definition and background</a></li>
<li class="chapter" data-level="7.4.2" data-path="mod-07.html"><a href="mod-07.html#nlme-on-simulated-data"><i class="fa fa-check"></i><b>7.4.2</b> NLME on simulated data</a></li>
<li class="chapter" data-level="7.4.3" data-path="mod-07.html"><a href="mod-07.html#nlme-on-real-data"><i class="fa fa-check"></i><b>7.4.3</b> NLME on real data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mod-07.html"><a href="mod-07.html#mod-07-gamm"><i class="fa fa-check"></i><b>7.5</b> (Generalized) additive mixed models (AMM/GAMM)</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="mod-07.html"><a href="mod-07.html#example-gamm-with-real-data"><i class="fa fa-check"></i><b>7.5.1</b> Example GAMM with real data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mod-08.html"><a href="mod-08.html"><i class="fa fa-check"></i><b>8</b> Multivariate data analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mod-08.html"><a href="mod-08.html#multivariate-data"><i class="fa fa-check"></i><b>8.1</b> Multivariate data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="mod-08.html"><a href="mod-08.html#univariate-vs.-multivariate-data"><i class="fa fa-check"></i><b>8.1.1</b> Univariate vs. multivariate data</a></li>
<li class="chapter" data-level="8.1.2" data-path="mod-08.html"><a href="mod-08.html#components-of-multivariate-data"><i class="fa fa-check"></i><b>8.1.2</b> Components of multivariate data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="mod-08.html"><a href="mod-08.html#mod-08-dist"><i class="fa fa-check"></i><b>8.2</b> Distance metrics: biological (dis)similarity</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mod-08.html"><a href="mod-08.html#euclidean-distance"><i class="fa fa-check"></i><b>8.2.1</b> Euclidean distance</a></li>
<li class="chapter" data-level="8.2.2" data-path="mod-08.html"><a href="mod-08.html#bray-curtis-and-other-distance-metrics"><i class="fa fa-check"></i><b>8.2.2</b> Bray-Curtis and other distance metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mod-08.html"><a href="mod-08.html#clustering"><i class="fa fa-check"></i><b>8.3</b> Clustering</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="mod-08.html"><a href="mod-08.html#k-means-clustering"><i class="fa fa-check"></i><b>8.3.1</b> <em>K</em>-means clustering</a></li>
<li class="chapter" data-level="8.3.2" data-path="mod-08.html"><a href="mod-08.html#hierarchical-agglomerative-clustering"><i class="fa fa-check"></i><b>8.3.2</b> Hierarchical agglomerative clustering</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="mod-08.html"><a href="mod-08.html#mod-08-sims"><i class="fa fa-check"></i><b>8.4</b> Analyzing dissimilarity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="mod-08.html"><a href="mod-08.html#mantel-tests-distance-vs.-distance"><i class="fa fa-check"></i><b>8.4.1</b> Mantel tests: distance vs. distance</a></li>
<li class="chapter" data-level="8.4.2" data-path="mod-08.html"><a href="mod-08.html#comparing-dissimilarity-between-groups"><i class="fa fa-check"></i><b>8.4.2</b> Comparing dissimilarity between groups</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="mod-08.html"><a href="mod-08.html#mod-08-ord"><i class="fa fa-check"></i><b>8.5</b> Ordination</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="mod-08.html"><a href="mod-08.html#principal-components-analysis-pca-1"><i class="fa fa-check"></i><b>8.5.1</b> Principal components analysis (PCA)</a></li>
<li class="chapter" data-level="8.5.2" data-path="mod-08.html"><a href="mod-08.html#nmds-and-other-ordination-methods"><i class="fa fa-check"></i><b>8.5.2</b> NMDS and other ordination methods</a></li>
<li class="chapter" data-level="8.5.3" data-path="mod-08.html"><a href="mod-08.html#other-ordination-techniques"><i class="fa fa-check"></i><b>8.5.3</b> Other ordination techniques</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mod-09.html"><a href="mod-09.html"><i class="fa fa-check"></i><b>9</b> Planning your analysis (what test?)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="mod-09.html"><a href="mod-09.html#how-to-use-this-guide"><i class="fa fa-check"></i><b>9.1</b> How to use this guide</a></li>
<li class="chapter" data-level="9.2" data-path="mod-09.html"><a href="mod-09.html#what-question-are-you-trying-to-answer"><i class="fa fa-check"></i><b>9.2</b> What question are you trying to answer?</a></li>
<li class="chapter" data-level="9.3" data-path="mod-09.html"><a href="mod-09.html#testing-for-a-difference-in-mean-or-location"><i class="fa fa-check"></i><b>9.3</b> Testing for a difference in mean or location</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="mod-09.html"><a href="mod-09.html#additional-considerations"><i class="fa fa-check"></i><b>9.3.1</b> Additional considerations</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mod-09.html"><a href="mod-09.html#testing-for-a-continuous-relationship-between-two-or-more-variables"><i class="fa fa-check"></i><b>9.4</b> Testing for a continuous relationship between two or more variables</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="mod-09.html"><a href="mod-09.html#additional-considerations-1"><i class="fa fa-check"></i><b>9.4.1</b> Additional considerations</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="mod-09.html"><a href="mod-09.html#classifying-observations"><i class="fa fa-check"></i><b>9.5</b> Classifying observations</a></li>
<li class="chapter" data-level="9.6" data-path="mod-09.html"><a href="mod-09.html#conclusions"><i class="fa fa-check"></i><b>9.6</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="literature-cited.html"><a href="literature-cited.html"><i class="fa fa-check"></i>Literature Cited</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Biological Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mod-07" class="section level1" number="7">
<h1><span class="header-section-number">Module 7</span> Mixed models</h1>
<div id="prelude-glm" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Prelude (GLM)</h2>
<p>So far in this course we have explored ways to model data by breaking them down into a deterministic part (that defines the expected value) and a stochastic part (that defines the variability or uncertainty). This culminated in the generalized linear model (GLM), a powerful framework for analyzing biological data.</p>
<p>Sometimes our data contain variability that we want to account for, without necessarily explaining. Some of this variability is described by <strong>random effects</strong>. Random effects describe variation due to unobserved or uncontrolled factors. As we will see below, random effects have a very different mathematical relationship to the data than the more familiar <strong>fixed effects</strong> such as intercept and slope. Models that contain both fixed and random effects are called <strong>mixed effects models</strong>, <strong>hierarchical models</strong>, or <strong>multi-level models</strong>. Just like GLMs, we will introduce mixed effects models as if they were extensions of ordinary linear models.</p>
<p>In the <a href="mod-05.html#mod-05-basic">previous module</a> we explored the generalized linear model (GLM), which unites many previously separate models into a single framework. A GLM is used to describe a system where there is a linear relationship between the predictor variables and some transformed version of the response variable, and a probability distribution that accounts for variability about the expected value of the response. This is a flexible generalization of the linear model. The linear model is presented below in the format of a GLM to illustrate the basic idea:</p>
<p><span class="math display">\[Y~Normal\left(\mu,\sigma^2\right)\]</span>
<span class="math display">\[\mu=\eta\]</span>
<span class="math display">\[\eta=\beta_0+\beta_1X\]</span></p>
<p>In a GLM there is a linear predictor <span class="math inline">\(\eta\)</span> (“eta”) that is a linear function of the predictor variable (or variables). The expected value of <em>Y</em>, <span class="math inline">\(\mu\)</span>, is related to <span class="math inline">\(\eta\)</span> by a deterministic and invertible function (in this case, identity). The actual values of <em>Y</em> come from a probability distribution defined by the expected value <span class="math inline">\(\mu\)</span> and potentially other parameters (<span class="math inline">\(\sigma^2\)</span>, in this case). The equation for the linear predictor is also called the <strong>deterministic part</strong> of the model, and the expression for the distribution of the response variable is called the <strong>stochastic part</strong> of the model. Understanding how to think about statistical models in the language of their deterministic and stochastic parts is the key to understanding mixed models.</p>
</div>
<div id="mod-07-lmm" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Linear mixed models (LMM)</h2>
<p>A LM or GLM like the linear regression model shown above has exactly 1 stochastic component: the distribution of <em>Y</em> with parameters <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma^2\)</span>. In the absence of an interaction term, a LM or GLM implicitly assumes that the deterministic part of the model is the same for all observations, and for all groups of observations. In reality, this is not always the case. The relationship between a response <em>Y</em> and predictor <em>X</em> might have a different slope within different experimental populations, or cell strains, or plant cultivars…pick any grouping variable you like. Or, the intercept of the relationship might vary by group. Even worse, the intercept <em>and</em> slope might vary by group<a href="literature-cited.html#fn64" class="footnote-ref" id="fnref64"><sup>64</sup></a>. The figure below shows a dataset where each group has a separate intercept and slope:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-635-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As a researcher you may or may not be interested in how the slopes and intercepts differ between groups. If the slopes and intercepts associated with particular groups are of interest, then you should include the interaction between that grouping variable and other variables–i.e., an analysis of covariance (ANCOVA) with interaction.</p>
<p>However, sometimes the variation between groups is variation that we are not interested in. This might be because the groups themselves are not of primary interest. For example, a botanist who measures growth rates from five individual trees is probably not interested in fitting growth constants specific to those particular trees. But, she might still want to account for variability between trees in her dataset. In that case, “tree” would be a random effect in her analysis. In her model, the botanist would let the growth rate vary randomly between trees.</p>
<p>As noted by <span class="citation">Bolker (<a href="#ref-bolker2008ecological" role="doc-biblioref">2008</a>)</span>, the distinction between fixed and random effects is often very murky and the subject of intense (and confusing) debates among statisticians. The table below summarizes some of the key differences between fixed and random effects. See the footnote<a href="literature-cited.html#fn65" class="footnote-ref" id="fnref65"><sup>65</sup></a> for some good online and offline discussions of the meanings of fixed and random effects.</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Condition</th>
<th>Fixed effects</th>
<th>Random effects</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Research objective</td>
<td>Interested in predicting response for these specific levels of factor.</td>
<td>Interested in predicting response while accounting for variation between levels of factor.</td>
</tr>
<tr class="even">
<td>Assumption about parameters</td>
<td>Coefficients fixed for all groups or individuals.</td>
<td>Coefficients come from a random distribution.</td>
</tr>
<tr class="odd">
<td>Hypothesis testing</td>
<td>Can get a <em>P</em>-value for coefficient estimates</td>
<td>Cannot formally test that coefficients different from 0.</td>
</tr>
<tr class="even">
<td>Origin of variation</td>
<td>Values of factor set by experimenter</td>
<td>Values of factor drawn at random from underlying population.</td>
</tr>
</tbody>
</table>
<p>When should you use a random effect in your analysis? The short answer is when some of the conditions in the right column apply to your data. As long as your choice is biologically defensible and statistically defensible, it is probably okay. There is no single agreed-upon standard for when a factor should be treated as a fixed or random effect.</p>
<p>There is one more aspect of random effects that is less widely appreciated than its implications for the variance structure. Fitting models with random effects between groups allows groups with fewer observations to “borrow” information from groups with more observations. The estimated group-level parameters (aka: BLUPs; see below) depend both on patterns within a group and on patterns that operate on all groups. This property of mixed models can be very useful for situations with unbalanced designs or where insufficient data are collected within all combinations of treatment factors<a href="literature-cited.html#fn66" class="footnote-ref" id="fnref66"><sup>66</sup></a>.</p>
<div id="formal-definition-and-example" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Formal definition and example</h3>
<p>Mixed models can be described in several forms. Many biologists use a state-space format similar to the presentation of the GLM seen above. I prefer this form because it makes clear what the random effect is doing in the model: allowing the model intercept, slope, or both to vary random by a grouping factor. The form below also uses the observation-wise notation to make the model structure a little clearer.</p>
<p><span class="math display">\[Y_{ij} \sim Normal\left(\mu_{ij},\sigma\right)\]</span>
<span class="math display">\[\mu_{ij}=\beta_0+\beta_1X_{ij}+a_i\]</span>
<span class="math display">\[a_i \sim Normal\left(0,\sigma_a\right)\]</span></p>
<p>In this model, response variable <em>Y</em> for observation <em>j</em> in group <em>i</em> is drawn from a normal distribution with mean <span class="math inline">\(\mu_{ij}\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>. The expected value is a linear function of a predictor variable <em>X</em> (measured for observation <em>j</em> in group <em>i</em>) and the effect of belonging to group <em>i</em>, <em>a<sub>i</sub></em>. The group effects are random, drawn from a normal distribution with mean 0 and SD <span class="math inline">\(\sigma_a\)</span>. Notice that this model has the same slope for each group, but effectively different intercepts. The same model could also be written as:</p>
<p><span class="math display">\[Y_{ij} \sim Normal\left(\mu_{ij},\sigma\right)\]</span>
<span class="math display">\[\mu_{ij}=\beta_{0,i}+\beta_1X_{ij}\]</span>
<span class="math display">\[\beta_{0,i} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\]</span></p>
<p>The model above, where the intercept varies randomly between groups, is sometimes called a <strong>random intercept model</strong>. A similar model could be defined that has a different slope in each group, but with a common intercept. Not surprisingly, this is called a <strong>random slope model</strong>:</p>
<p><span class="math display">\[Y_{ij} \sim Normal\left(\mu_{ij},\sigma\right)\]</span>
<span class="math display">\[\mu_{ij}=\beta_0+\beta_{1,i}X_{ij}\]</span>
<span class="math display">\[\beta_{1,i} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}\right)\]</span></p>
<p>Or we can get crazy and have a model where both the intercept and slope are random variables:</p>
<p><span class="math display">\[Y_{ij} \sim Normal\left(\mu_{ij},\sigma\right)\]</span>
<span class="math display">\[\mu_{ij}=\beta_{0,i}+\beta_{1,i}X_{ij}\]</span>
<span class="math display">\[\beta_{0,i} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\]</span>
<span class="math display">\[\beta_{1,i} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}\right)\]</span></p>
<p>The figure below shows what these three types of models look like in practice.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-636-1.png" width="864" style="display: block; margin: auto;" /></p>
<ul>
<li>In the random intercept model (left), all groups have the same slope but different intercepts. This looks visually like an ANCOVA without interaction, but there is a key difference: instead of being estimated for each group level by least squares, the intercepts of each group (i.e., the effects of being in each group) are assumed to come from a random distribution.</li>
<li>In the random slope model (center), the groups all have the same intercept but have different slopes.</li>
<li>In the random intercept and slope model (right), each group has its own intercept and slope. This looks visually like an ANCOVA with interaction, but with a key difference: instead of being estimated for each group level by least squares, the intercepts and slopes are assumed to come from a random distribution.</li>
</ul>
</div>
<div id="example-with-simulated-data-5" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Example with simulated data</h3>
<p>The best way to understand the structure of the LMM is to simulate some data suitable for this type of analysis. This example is adapted from one in chapter 12 of <span class="citation">Kéry (<a href="#ref-kery2010" role="doc-biblioref">2010</a>)</span>, which was apparently adapted from <span class="citation">Kéry (<a href="#ref-kery2002" role="doc-biblioref">2002</a>)</span><a href="literature-cited.html#fn67" class="footnote-ref" id="fnref67"><sup>67</sup></a>.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-637-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>What a mess! It looks like population might affect mass, but it’s hard to be sure. We can try fitting an ANCOVA model, but the sheer number of populations might make it difficult to get much out of it.</p>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1472-1"><a href="mod-07.html#cb1472-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mass<span class="sc">~</span>len.sc<span class="sc">*</span><span class="fu">factor</span>(group), <span class="at">data=</span>sim)</span>
<span id="cb1472-2"><a href="mod-07.html#cb1472-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mass ~ len.sc * factor(group), data = sim)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -28.181  -5.755   0.236   6.404  31.993 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)             191.054      2.461  77.634  &lt; 2e-16 ***
## len.sc                   69.219      2.488  27.824  &lt; 2e-16 ***
## factor(group)2           46.999      3.372  13.936  &lt; 2e-16 ***
## factor(group)3           61.753      3.348  18.444  &lt; 2e-16 ***
## factor(group)4           79.475      3.368  23.599  &lt; 2e-16 ***
## factor(group)5           10.422      3.343   3.117  0.00197 ** 
## factor(group)6           16.211      3.361   4.824 2.08e-06 ***
## factor(group)7           22.669      3.596   6.304 8.48e-10 ***
## factor(group)8           21.630      3.347   6.461 3.37e-10 ***
## factor(group)9           22.693      3.341   6.793 4.56e-11 ***
## factor(group)10          34.157      3.342  10.220  &lt; 2e-16 ***
## factor(group)11          17.508      3.348   5.230 2.89e-07 ***
## factor(group)12          78.423      3.372  23.255  &lt; 2e-16 ***
## factor(group)13          39.791      3.486  11.414  &lt; 2e-16 ***
## factor(group)14          38.247      3.338  11.458  &lt; 2e-16 ***
## factor(group)15          48.387      3.493  13.851  &lt; 2e-16 ***
## factor(group)16          42.141      3.338  12.625  &lt; 2e-16 ***
## factor(group)17          35.137      3.338  10.526  &lt; 2e-16 ***
## factor(group)18          66.286      3.338  19.857  &lt; 2e-16 ***
## factor(group)19          36.231      3.338  10.853  &lt; 2e-16 ***
## factor(group)20          14.415      3.343   4.312 2.09e-05 ***
## len.sc:factor(group)2   -18.619      3.195  -5.827 1.26e-08 ***
## len.sc:factor(group)3   -23.177      3.378  -6.861 3.00e-11 ***
## len.sc:factor(group)4   -40.542      3.320 -12.210  &lt; 2e-16 ***
## len.sc:factor(group)5     6.079      3.429   1.773  0.07713 .  
## len.sc:factor(group)6   -16.020      3.464  -4.625 5.23e-06 ***
## len.sc:factor(group)7    10.699      3.766   2.841  0.00475 ** 
## len.sc:factor(group)8   -15.346      3.347  -4.584 6.29e-06 ***
## len.sc:factor(group)9   -27.713      3.711  -7.468 6.22e-13 ***
## len.sc:factor(group)10   27.793      3.236   8.588 2.71e-16 ***
## len.sc:factor(group)11  -16.138      3.618  -4.460 1.09e-05 ***
## len.sc:factor(group)12   20.837      3.307   6.301 8.64e-10 ***
## len.sc:factor(group)13  -42.091      3.598 -11.699  &lt; 2e-16 ***
## len.sc:factor(group)14  -22.964      3.369  -6.816 3.95e-11 ***
## len.sc:factor(group)15  -18.634      3.391  -5.495 7.40e-08 ***
## len.sc:factor(group)16  -21.612      3.237  -6.677 9.27e-11 ***
## len.sc:factor(group)17   27.873      3.527   7.902 3.38e-14 ***
## len.sc:factor(group)18   -7.946      3.327  -2.389  0.01743 *  
## len.sc:factor(group)19    2.053      3.316   0.619  0.53630    
## len.sc:factor(group)20  -36.396      3.376 -10.781  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 10.09 on 360 degrees of freedom
## Multiple R-squared:  0.9779, Adjusted R-squared:  0.9756 
## F-statistic: 409.3 on 39 and 360 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The fitted model above has 20 intercepts and 20 slopes. Such a model will be difficult to make sense of because of how each factor changes the slope and intercept, and the fact that there is no overall effect of length on mass in the model (at least not explicitly). Before accepting this monstrosity, it’s worth asking whether we really care about the difference in parameters between populations. After all, these 20 populations are not the only 20 populations of this species. They are a random subsample of a much larger set of populations. If we want our results to apply to populations that are not in our dataset, we need to take a different approach.</p>
<p>We can account for population-level differences with a linear mixed model. For this system we can fit 3 different models: a random intercept model, a random slope model, and a random slope and intercept model. The code below will do this using R package <code>lme4</code>.</p>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1474-1"><a href="mod-07.html#cb1474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># package for fitting LMM</span></span>
<span id="cb1474-2"><a href="mod-07.html#cb1474-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1474-3"><a href="mod-07.html#cb1474-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading required package: Matrix</span></span>
<span id="cb1474-4"><a href="mod-07.html#cb1474-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1474-5"><a href="mod-07.html#cb1474-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Attaching package: &#39;lme4&#39;</span></span>
<span id="cb1474-6"><a href="mod-07.html#cb1474-6" aria-hidden="true" tabindex="-1"></a><span class="do">## The following object is masked from &#39;package:nlme&#39;:</span></span>
<span id="cb1474-7"><a href="mod-07.html#cb1474-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb1474-8"><a href="mod-07.html#cb1474-8" aria-hidden="true" tabindex="-1"></a><span class="do">##     lmList</span></span>
<span id="cb1474-9"><a href="mod-07.html#cb1474-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1474-10"><a href="mod-07.html#cb1474-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models</span></span>
<span id="cb1474-11"><a href="mod-07.html#cb1474-11" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>group), <span class="at">data=</span>sim)</span>
<span id="cb1474-12"><a href="mod-07.html#cb1474-12" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(<span class="dv">0</span><span class="sc">+</span>len.sc<span class="sc">|</span>group), <span class="at">data=</span>sim)</span>
<span id="cb1474-13"><a href="mod-07.html#cb1474-13" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(len.sc<span class="sc">|</span>group), <span class="at">data=</span>sim)</span></code></pre></div>
<p>Below is the summary for model 3. This is different than the output for <code>lm()</code> or <code>glm()</code>. The summary separates the estimates into the fixed effects and random effects.</p>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="mod-07.html#cb1475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: mass ~ len.sc + (len.sc | group)
##    Data: sim
## 
## REML criterion at convergence: 3151.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.7807 -0.5698  0.0403  0.6265  3.1840 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  group    (Intercept) 484.3    22.01         
##           len.sc      438.5    20.94    -0.09
##  Residual             101.7    10.09         
## Number of obs: 400, groups:  group, 20
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  227.702      4.948   46.02
## len.sc        58.604      4.712   12.44
## 
## Correlation of Fixed Effects:
##        (Intr)
## len.sc -0.085</code></pre>
<ul>
<li>The fixed effects are presented as estimates with SE and a t-value (but no <em>P</em>-value…we’ll come back to that later).</li>
<li>The random effects are presented as the variance and SD of the random effects. The output above shows that the intercepts in model 3 had mean 0 and SD 22.01. This is pretty close to the true value of 20. Likewise, the slopes had mean 0 and SD = 20.94. This is not very close to the true value of 30.</li>
<li>Across groups, the intercepts and slopes are not correlated with each other (<em>r</em> = -0.09). In other words, variation in intercept appears unrelated to variation in slope. This is fine, because that is how the data were simulated.</li>
<li>Finally, the output tells us that the residual SD was 10.09, very close to the true value of 10.</li>
</ul>
<p>We can extract the results of a mixed model in several ways. We might ask what the random effects are. These are the differences between the group-specific parameters and the mean parameter. E.g., the difference between the overall estimated intercept (227.702) and the intercepts estimated for each group. The random effects can be accessed with the command <code>ranef()</code>. This returns a list with one element for each factor treated as a random effect. The elements are named according to the name of the factor, so the command below will get us a data frame of the random effects on the intercept and slope of each group.</p>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="mod-07.html#cb1477-1" aria-hidden="true" tabindex="-1"></a>re <span class="ot">&lt;-</span> <span class="fu">ranef</span>(mod3)<span class="sc">$</span>group</span>
<span id="cb1477-2"><a href="mod-07.html#cb1477-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(re)</span></code></pre></div>
<pre><code>##   (Intercept)     len.sc
## 1   -36.16209  10.330202
## 2    10.23061  -7.919170
## 3    24.83656 -12.408188
## 4    42.44908 -29.716640
## 5   -25.97902  16.531595
## 6   -20.22579  -5.352089</code></pre>
<p>The output shows us that group 1 had an intercept 36.16 smaller than the overall intercept, and a slope 10.33 greater than the overall slope; group 2 had an intercept 10.23 larger than the overall intercept and a slope 7.92 smaller than the overall slope; and so on.</p>
<p>A more useful output is the one containing the estimated intercepts and slopes for each group, not just their differences from the overall parameters. These can be accessed using the command <code>coef()</code>. As before we will extract the component of the list by name.</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="mod-07.html#cb1479-1" aria-hidden="true" tabindex="-1"></a>blup <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod3)<span class="sc">$</span>group</span>
<span id="cb1479-2"><a href="mod-07.html#cb1479-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(blup)</span></code></pre></div>
<pre><code>##   (Intercept)   len.sc
## 1    191.5397 68.93397
## 2    237.9324 50.68460
## 3    252.5384 46.19558
## 4    270.1509 28.88713
## 5    201.7228 75.13536
## 6    207.4760 53.25168</code></pre>
<p>The output tells us that group 1 had an intercept of 191.54 and a slope of 68.93; that group 2 had an intercept of 237.93 and slope of 50.68; and so on. The name of the object, <code>blup</code>, is short for <strong>best unbiased linear predictor</strong>. These are the estimates of the parameters for each group. The name BLUP is retained for historical reasons, although these values are not guaranteed to be “best” or “unbiased”<a href="literature-cited.html#fn68" class="footnote-ref" id="fnref68"><sup>68</sup></a>. Some authors prefer to call them <strong>conditional modes</strong>. This name denotes that they are the most likely value (“mode”), conditional on the data.</p>
</div>
<div id="p-values-in-lmm" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> <em>P</em>-values in LMM</h3>
<p>The authors of the <code>lme4</code> package made a conscious decision to not present <em>P</em>-values for model parameters. Their reasons are <a href="https://stat.ethz.ch/pipermail/r-help/2006-May/094765.html">highly technical and statistically sound</a>, but these facts are often lost on journal reviewers. To make a long story short, <code>lme4</code> does not calculate <em>P</em>-values because it is not always clear what the correct number of degrees of freedom a model has, and so it is not clear what a <em>P</em>-value would even represent. On top of this, approximating <em>P</em>-values is computationally intractable in many situations, but that’s not a real excuse. That being said, in later work the <code>lme4</code> authors provide <a href="https://rdrr.io/cran/lme4/man/pvalues.html">several suggestions</a> for obtaining <em>P</em>-values. We will try the easiest method. In a later example, we try MCMC sampling with JAGS to get another angle on a significance test.</p>
<p>If all you need to know is whether a fixed effect is different from 0, you can calculate the 95% CI using function <code>confint()</code>. This will estimate the 95% CI of each fixed effect. If that CI does not include 0, then the parameter is “statistically significant” even though you don’t know the <em>P</em>-value. The result below shows that both the intercept and slope of the model are likely to be statistically significant.</p>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="mod-07.html#cb1481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod3)</span></code></pre></div>
<pre><code>## Computing profile confidence intervals ...</code></pre>
<pre><code>##                   2.5 %      97.5 %
## .sig01       16.1187537  30.3787564
## .sig02       -0.4902622   0.3495054
## .sig03       15.3285043  28.9189751
## .sigma        9.3916449  10.8699356
## (Intercept) 217.7777253 237.6268196
## len.sc       49.1511687  68.0536264</code></pre>
<p>If you, your advisor, or a reviewer insist on getting <em>P</em>-values for a mixed effects model, there are some ways. The package <code>lmerTest</code> <span class="citation">(<a href="#ref-JSSv082i13" role="doc-biblioref">Kuznetsova et al. 2017</a>)</span> provides utility functions for working with mixed models. Included are methods for getting <em>P</em>-values from <code>lmer()</code> objects. This package extends the methods in <code>lme4</code>, so it needs to be loaded <em>after</em> <code>lme4</code> in your workspace. The model fitting functions and syntax are the same. But a model fit using <code>lmerTest</code> can output <em>P</em>-values for the fixed effects.</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1484-1"><a href="mod-07.html#cb1484-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest) <span class="co"># AFTER loading lme4</span></span></code></pre></div>
<pre><code>## Warning: package &#39;lmerTest&#39; was built under R version 4.1.2</code></pre>
<pre><code>## 
## Attaching package: &#39;lmerTest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmer</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     step</code></pre>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1489-1"><a href="mod-07.html#cb1489-1" aria-hidden="true" tabindex="-1"></a><span class="co"># refit models using lmerTest::lmer</span></span>
<span id="cb1489-2"><a href="mod-07.html#cb1489-2" aria-hidden="true" tabindex="-1"></a><span class="do">## lmerTest version of lmer() will mask lme4 version of lmer()</span></span>
<span id="cb1489-3"><a href="mod-07.html#cb1489-3" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>group), <span class="at">data=</span>sim)</span>
<span id="cb1489-4"><a href="mod-07.html#cb1489-4" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(<span class="dv">0</span><span class="sc">+</span>len.sc<span class="sc">|</span>group), <span class="at">data=</span>sim)</span>
<span id="cb1489-5"><a href="mod-07.html#cb1489-5" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mass<span class="sc">~</span>len.sc<span class="sc">+</span>(len.sc<span class="sc">|</span>group), <span class="at">data=</span>sim)</span>
<span id="cb1489-6"><a href="mod-07.html#cb1489-6" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(mod1)</span></span>
<span id="cb1489-7"><a href="mod-07.html#cb1489-7" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(mod2)</span></span>
<span id="cb1489-8"><a href="mod-07.html#cb1489-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: mass ~ len.sc + (len.sc | group)
##    Data: sim
## 
## REML criterion at convergence: 3151.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.7807 -0.5698  0.0403  0.6265  3.1840 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr 
##  group    (Intercept) 484.3    22.01         
##           len.sc      438.5    20.94    -0.09
##  Residual             101.7    10.09         
## Number of obs: 400, groups:  group, 20
## 
## Fixed effects:
##             Estimate Std. Error      df t value Pr(&gt;|t|)    
## (Intercept)  227.702      4.948  19.000   46.02  &lt; 2e-16 ***
## len.sc        58.604      4.712  18.999   12.44 1.41e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##        (Intr)
## len.sc -0.085</code></pre>
<p>The estimates for the fixed and random effects are basically the same as before. What is different is that the <em>P</em>-value for the <em>t</em>-statistics are provided. If you want the random effects or the BLUPs, the <code>ranef()</code> and <code>coef()</code> methods will work as before.</p>
</div>
<div id="specifying-random-effects" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Specifying random effects</h3>
<p>In R, you can specify many kinds of random effects. The syntax for random effects models differs slightly between the two most popular mixed models packages, <code>lme4</code> and <code>nlme</code>. The table below shows some example random effects structures in <code>lme4</code>:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Formula</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>(1 \|   g)</code></td>
<td>Random intercept by grouping variable <code>g</code>. Single fixed slope for all groups.</td>
</tr>
<tr class="even">
<td><code>(1 \|   g1 / g2)</code></td>
<td>Random intercepts among grouping variables <code>g1</code> and <code>g2</code>, with <code>g2</code> nested within <code>g1</code>. Single fixed slope for all groups.</td>
</tr>
<tr class="odd">
<td><code>(1 \|   g1) + (1 \| g2)</code></td>
<td>Random intercepts among <code>g1</code> and <code>g2</code>, not nested. Single fixed slope for all groups.</td>
</tr>
<tr class="even">
<td><code>(x \|   g)</code></td>
<td>Random slope (effect of <code>x</code>) and intercept by grouping variable <code>g</code>. Intercepts and slopes can be correlated with each other.</td>
</tr>
<tr class="odd">
<td><code>(x \|\|   g)</code></td>
<td>Random slope (effect of <code>x</code>) and intercept by grouping variable <code>g</code>. Intercepts and slopes are not assumed to be correlated with each other. Try this if a model with correlated random effects (<code>(x \| g)</code>) cannot converge.</td>
</tr>
<tr class="even">
<td><code>(0 +   x \| g)</code></td>
<td>Random slope by grouping variable <code>g</code>. Single fixed intercept for all groups.</td>
</tr>
</tbody>
</table>
<p>In <code>lme4</code>, the random effects are added to a model formula as terms after the fixed effects. So, a model of <code>y</code> with an effect of continuous predictor <code>x</code> and random slope by group <code>g</code> would have formula <code>y ~ x + (0 + x | g)</code>. You can define a huge variety of random effects structures, but probably shouldn’t. As with defining potential regression models or GLMs, it is incumbent on you as a biologist to think critically about what models represent biologically reasonable hypotheses.</p>
<p>The syntax for random effects in package <code>nlme</code> works a little differently. In <code>nlme</code>, the fixed and random parts of the model are defined by separate arguments, rather than as part of the model formula. The <code>nlme</code> equivalents to the structures above are:</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Formula</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>~1\|g</code></td>
<td>Random intercept by grouping variable <code>g</code>. Single fixed slope for all groups.</td>
</tr>
<tr class="even">
<td><code>~1\|g1/g2</code></td>
<td>Random intercepts among grouping variables <code>g1</code> and <code>g2</code>, with <code>g2</code> nested within <code>g1</code>. Single fixed slope for all groups.</td>
</tr>
<tr class="odd">
<td><code>list(~1\|g1,   ~1\|g2)</code></td>
<td>Random intercepts among <code>g1</code> and <code>g2</code>, not nested. Single fixed slope for all groups.</td>
</tr>
<tr class="even">
<td><code>~x\|g</code></td>
<td>Random slope (effect of <code>x</code>) and intercept by grouping variable <code>g</code>.</td>
</tr>
<tr class="odd">
<td><code>~0+x\|g</code></td>
<td>Random slope by grouping variable <code>g</code>. Single fixed intercept for all groups.</td>
</tr>
</tbody>
</table>
<p>The <code>nlme</code> equivalents to the example analysis above are:</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="mod-07.html#cb1491-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not run</span></span>
<span id="cb1491-2"><a href="mod-07.html#cb1491-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-3"><a href="mod-07.html#cb1491-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb1491-4"><a href="mod-07.html#cb1491-4" aria-hidden="true" tabindex="-1"></a>mod1.nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(mass<span class="sc">~</span>len.sc, <span class="at">random=</span><span class="sc">~</span><span class="dv">1</span><span class="sc">|</span>group, <span class="at">data=</span>sim)</span>
<span id="cb1491-5"><a href="mod-07.html#cb1491-5" aria-hidden="true" tabindex="-1"></a>mod2.nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(mass<span class="sc">~</span>len.sc, <span class="at">random=</span><span class="sc">~</span><span class="dv">0</span><span class="sc">+</span>len.sc<span class="sc">|</span>group, <span class="at">data=</span>sim)</span>
<span id="cb1491-6"><a href="mod-07.html#cb1491-6" aria-hidden="true" tabindex="-1"></a>mod3.nlme <span class="ot">&lt;-</span> <span class="fu">lme</span>(mass<span class="sc">~</span>len.sc, <span class="at">random=</span><span class="sc">~</span>len.sc<span class="sc">|</span>group, <span class="at">data=</span>sim)</span></code></pre></div>
</div>
<div id="lmm-example-with-real-data" class="section level3" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> LMM example with real data</h3>
<p>Despite a wealth of fossil remains and intensive study, many basic questions about the biology of the non-avian dinosaurs remain unanswered. <span class="citation">Werner and Griebeler (<a href="#ref-werner2014" role="doc-biblioref">2014</a>)</span> used data on growth rates in modern vertebrates to investigate whether dinosaurs were endothermic or ectothermic. They collected data on maximal growth rates and body size for 1072 extant species of birds, mammals, reptiles, and fishes, and compared these to 19 dinosaurs. They modeled maximum growth rate against the body size at which each species attained the maximal growth rate. The idea was that if dinosaurs were endothermic, the allometric relationship between their growth rate and body size would match that of modern-day endotherms. We will use their dataset and replicate part of their analysis.</p>
<p>Download the <a href="https://greenquanteco.github.io/werner_2014_data_2021-10-19.csv">dataset</a> and save it in your R home directory. Then import the data:</p>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1492-1"><a href="mod-07.html#cb1492-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;werner_2014_data_2021-10-19.csv&quot;</span></span>
<span id="cb1492-2"><a href="mod-07.html#cb1492-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Next, let’s take a look at the data.</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="mod-07.html#cb1493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1493-2"><a href="mod-07.html#cb1493-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>agr)</span>
<span id="cb1493-3"><a href="mod-07.html#cb1493-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>bm)</span>
<span id="cb1493-4"><a href="mod-07.html#cb1493-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>bm, dat<span class="sc">$</span>agr)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-647-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>The histograms and the “dust bunny” pattern (i.e., little clump in the corner) in the scatterplot suggests that we should log-transform both variables.</p>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1494-1"><a href="mod-07.html#cb1494-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>logy <span class="ot">&lt;-</span> <span class="fu">log</span>(dat<span class="sc">$</span>agr)</span>
<span id="cb1494-2"><a href="mod-07.html#cb1494-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>logx <span class="ot">&lt;-</span> <span class="fu">log</span>(dat<span class="sc">$</span>bm)</span>
<span id="cb1494-3"><a href="mod-07.html#cb1494-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1494-4"><a href="mod-07.html#cb1494-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1494-5"><a href="mod-07.html#cb1494-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>logx)</span>
<span id="cb1494-6"><a href="mod-07.html#cb1494-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>logy)</span>
<span id="cb1494-7"><a href="mod-07.html#cb1494-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>logx, dat<span class="sc">$</span>logy)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-648-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>The log transform did the trick. For the analysis, let’s work with the log-transformed data. If we want to see how the dinosaurs compare to the other taxa, we’ll need to identify them in the plot somehow. In the code below, we will select a color for each unique group, then manually set the color for dinosaurs to be black (so they stand out on the plot).</p>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1495-1"><a href="mod-07.html#cb1495-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify groups of organisms</span></span>
<span id="cb1495-2"><a href="mod-07.html#cb1495-2" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>group1))</span>
<span id="cb1495-3"><a href="mod-07.html#cb1495-3" aria-hidden="true" tabindex="-1"></a>ngroup <span class="ot">&lt;-</span> <span class="fu">length</span>(groups)</span>
<span id="cb1495-4"><a href="mod-07.html#cb1495-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1495-5"><a href="mod-07.html#cb1495-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 40% opacity (alpha)</span></span>
<span id="cb1495-6"><a href="mod-07.html#cb1495-6" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(ngroup, <span class="at">alpha=</span><span class="fl">0.4</span>)</span>
<span id="cb1495-7"><a href="mod-07.html#cb1495-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1495-8"><a href="mod-07.html#cb1495-8" aria-hidden="true" tabindex="-1"></a><span class="co"># same colors but solid (for legend)</span></span>
<span id="cb1495-9"><a href="mod-07.html#cb1495-9" aria-hidden="true" tabindex="-1"></a>cols2 <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(ngroup)</span>
<span id="cb1495-10"><a href="mod-07.html#cb1495-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1495-11"><a href="mod-07.html#cb1495-11" aria-hidden="true" tabindex="-1"></a><span class="co"># change dinosaurs to black</span></span>
<span id="cb1495-12"><a href="mod-07.html#cb1495-12" aria-hidden="true" tabindex="-1"></a>cols[<span class="fu">which</span>(groups <span class="sc">==</span> <span class="st">&quot;dinosaurs&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb1495-13"><a href="mod-07.html#cb1495-13" aria-hidden="true" tabindex="-1"></a>cols2[<span class="fu">which</span>(groups <span class="sc">==</span> <span class="st">&quot;dinosaurs&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb1495-14"><a href="mod-07.html#cb1495-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1495-15"><a href="mod-07.html#cb1495-15" aria-hidden="true" tabindex="-1"></a><span class="co"># assign colors to observations in data frame</span></span>
<span id="cb1495-16"><a href="mod-07.html#cb1495-16" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[<span class="fu">match</span>(dat<span class="sc">$</span>group1, groups)]</span>
<span id="cb1495-17"><a href="mod-07.html#cb1495-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1495-18"><a href="mod-07.html#cb1495-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make the plot</span></span>
<span id="cb1495-19"><a href="mod-07.html#cb1495-19" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1495-20"><a href="mod-07.html#cb1495-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>bm, dat<span class="sc">$</span>agr,</span>
<span id="cb1495-21"><a href="mod-07.html#cb1495-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">log=</span><span class="st">&quot;xy&quot;</span>, <span class="co"># make x and y axes logarithmic</span></span>
<span id="cb1495-22"><a href="mod-07.html#cb1495-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Mass at max GR (g)&quot;</span>,</span>
<span id="cb1495-23"><a href="mod-07.html#cb1495-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Max growth rate (GR) (g/d)&quot;</span>,</span>
<span id="cb1495-24"><a href="mod-07.html#cb1495-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb1495-25"><a href="mod-07.html#cb1495-25" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span>groups,</span>
<span id="cb1495-26"><a href="mod-07.html#cb1495-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>cols2, <span class="at">cex=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-649-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The figure suggests that, overall, larger animals have faster growth rates. This by itself is not too surprising. What is interesting is how the different groups (birds, dinosaurs, etc.) appear to form different parallel bands in the scatterplot. For any given body mass, birds had the highest growth rate, followed by mammals, then dinosaurs, then fishes and reptiles. Remember that we are interested in how the growth rates of dinosaurs compare to those of other groups. Statistically, this means that we want to see how the intercept and slope for dinosaurs compares to the same parameters for other taxa.</p>
<p>One approach would be to fit an ANCOVA model with mass as the predictor variable and taxon as a factor. The model could be fit with and without interaction, to see whether the intercept and slope really vary by taxon. However, before fitting the ANCOVA, it’s worth asking whether these groups of vertebrates are really representative of vertebrate diversity. Sure, the list includes almost every extant class of Osteichthyes (bony fish). But, it ignores Chondrichthyes and Amphibia. It also ignores other extinct taxa, like Allotheria (extinct Mesozoic mammals), Temnospondyls (extinct large-bodied amphibians), and other groups that might have been included. The groupings here also ignore other ways that the species might have been grouped. For example, should <em>Archaeopteryx</em> be counted as a bird or a dinosaur?<a href="literature-cited.html#fn69" class="footnote-ref" id="fnref69"><sup>69</sup></a>.</p>
<p>From these perspectives, the taxonomic groupings in this dataset might be considered a <em>random subsampling</em> of vertebrate groups. Emphasis on the “might” in the previous sentence. There are other, completely legitimate and scientific ways that the species could have been grouped. So, we probably don’t want to waste statistical power (degrees of freedom) estimating coefficients that are specific to these and only these these groupings. A better strategy would be to let model parameters vary randomly by group, so we account for between-group variability, without tying our analysis to current opinions on taxonomy. So, the situation calls for mixed models rather than with ANCOVA.</p>
<p>The models to be fit are defined below. In each model <em>G</em> is growth rate, <em>M</em> is body mass at maximal growth rate, taxon is group, and <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are the intercept and slope. <span class="math inline">\(\varepsilon\)</span> represents the distribution of residuals with mean 0 and SD = <span class="math inline">\(\sigma\)</span>.</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Description</th>
<th>Model formula</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>LMM with random intercept by taxon</td>
<td><span class="math inline">\(\log{\left(G\right)=\beta_{0,Tax}+\beta_1\log{\left(M\right)}}+\varepsilon\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{0,Tax} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\)</span></td>
</tr>
<tr class="odd">
<td>2</td>
<td>LMM with random slope by taxon</td>
<td><span class="math inline">\(\log{\left(G\right)=\beta_0+\beta_{1,Tax}\log{\left(M\right)}}+\varepsilon\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{1,Tax} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}\right)\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>LMM with random intercept and slope by taxon</td>
<td><span class="math inline">\(\log{\left(G\right)=\beta_{0,Tax}+\beta_{1,Tax}\log{\left(M\right)}}+\varepsilon\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{0,Tax} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{1,Tax} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}\right)\)</span></td>
</tr>
<tr class="even">
<td>4</td>
<td>LMM with uncorrelated random intercepts and slopes by taxon</td>
<td><span class="math inline">\(\log{\left(G\right)=\beta_{0,Tax}+\beta_{1,Tax}\log{\left(M\right)}}+\varepsilon\)</span></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{0,Tax} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">\(\beta_{1,Tax} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}\right)\)</span></td>
</tr>
</tbody>
</table>
<p>The R code is straightforward. Notice that the first command (commented out) unloads package <code>lmerTest</code>. This package was loaded in the previous example so we could use its version of <code>lmer()</code>, which allowed us to calculate <em>P</em>-values. If you want the <code>lme4</code> version of <code>lmer()</code>, then you need to either unload <code>lmerTest</code>, or use the double-colon notation <code>::</code> to specify which package’s <code>lmer()</code> function you want: <code>lme4::lmer()</code> or <code>lmerTest::lmer()</code>. This document was rendered with <code>lmerTest</code> still loaded, so <code>summary(mod4)</code> will return the <code>lmerTest</code> version with <em>P</em>-values.</p>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1496-1"><a href="mod-07.html#cb1496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if desired:</span></span>
<span id="cb1496-2"><a href="mod-07.html#cb1496-2" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:lmerTest)</span></span>
<span id="cb1496-3"><a href="mod-07.html#cb1496-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1496-4"><a href="mod-07.html#cb1496-4" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(logy<span class="sc">~</span>logx<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>group1), <span class="at">data=</span>dat)</span>
<span id="cb1496-5"><a href="mod-07.html#cb1496-5" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(logy<span class="sc">~</span>logx<span class="sc">+</span>(<span class="dv">0</span><span class="sc">+</span>logx<span class="sc">|</span>group1), <span class="at">data=</span>dat)</span>
<span id="cb1496-6"><a href="mod-07.html#cb1496-6" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(logy<span class="sc">~</span>logx<span class="sc">+</span>(logx<span class="sc">|</span>group1), <span class="at">data=</span>dat)</span></code></pre></div>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl = control$checkConv, :
## Model failed to converge with max|grad| = 0.00274806 (tol = 0.002, component 1)</code></pre>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1498-1"><a href="mod-07.html#cb1498-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(logy<span class="sc">~</span>logx<span class="sc">+</span>(logx<span class="sc">||</span>group1), <span class="at">data=</span>dat)</span></code></pre></div>
<p>Notice that model 3 did not fit (<code>failed to converge</code>). This happens a lot in LMM with correlated random effects. If you think about it, assuming that random intercepts are correlated with random slopes “sneaks in” an extra parameter that has to be estimated: the correlation coefficient. There are plenty of situations where random effects should be correlated, but this may not be one of them. Because it did not converge, Model 3 can probably be safely discarded. That leaves us with models 1, 2, and 4. Model 4 is similar to model 3, but does <em>not</em> assume that the random intercepts and slopes are correlated with each other.</p>
<p>Use <code>summary()</code> to take a look at the models. We’ll look at model 1..</p>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1499-1"><a href="mod-07.html#cb1499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## Linear mixed model fit by REML. t-tests use Satterthwaite&#39;s method [
## lmerModLmerTest]
## Formula: logy ~ logx + (1 | group1)
##    Data: dat
## 
## REML criterion at convergence: 1850.6
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.0931 -0.5376  0.1150  0.6258  3.6284 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  group1   (Intercept) 2.7725   1.6651  
##  Residual             0.3079   0.5549  
## Number of obs: 1091, groups:  group1, 5
## 
## Fixed effects:
##               Estimate Std. Error         df t value Pr(&gt;|t|)    
## (Intercept) -3.327e+00  7.466e-01  4.037e+00  -4.456    0.011 *  
## logx         7.095e-01  6.596e-03  1.087e+03 107.574   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##      (Intr)
## logx -0.059</code></pre>
<p>The <code>lmerTest</code> summary includes <em>P</em>-values for fixed effects: both the intercept and slope were statistically significant. The random intercepts had mean 0 and SD = 1.665.</p>
<p>Next, compare the models using AIC weights. Notice that model 3, which did not converge, was left out of the AIC weight calculation.</p>
<div class="sourceCode" id="cb1501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1501-1"><a href="mod-07.html#cb1501-1" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod1, mod2, mod4)</span>
<span id="cb1501-2"><a href="mod-07.html#cb1501-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1501-3"><a href="mod-07.html#cb1501-3" aria-hidden="true" tabindex="-1"></a><span class="co"># delta-AIC is difference from smallest AIC</span></span>
<span id="cb1501-4"><a href="mod-07.html#cb1501-4" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>delta <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">min</span>(aic.df<span class="sc">$</span>AIC)</span>
<span id="cb1501-5"><a href="mod-07.html#cb1501-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1501-6"><a href="mod-07.html#cb1501-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use delta-AIC to calculate AIC_wt</span></span>
<span id="cb1501-7"><a href="mod-07.html#cb1501-7" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aic.df<span class="sc">$</span>delta)</span>
<span id="cb1501-8"><a href="mod-07.html#cb1501-8" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aic.df<span class="sc">$</span>wt)</span>
<span id="cb1501-9"><a href="mod-07.html#cb1501-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1501-10"><a href="mod-07.html#cb1501-10" aria-hidden="true" tabindex="-1"></a><span class="co"># order to see models ranked by AIC_wt</span></span>
<span id="cb1501-11"><a href="mod-07.html#cb1501-11" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> aic.df[<span class="fu">order</span>(<span class="sc">-</span>aic.df<span class="sc">$</span>wt),]</span>
<span id="cb1501-12"><a href="mod-07.html#cb1501-12" aria-hidden="true" tabindex="-1"></a>aic.df</span></code></pre></div>
<pre><code>##      df      AIC      delta            wt
## mod4  5 1850.173   0.000000  9.856884e-01
## mod1  4 1858.638   8.464541  1.431159e-02
## mod2  4 2825.160 974.987148 1.896577e-212</code></pre>
<p>The model with uncorrelated random effects of taxon, model 4, was by far the best-fitting model and the most likely of these 3 models to be the best-fitting one. We will interpret this model and plot its predictions in our write-up.</p>
<p>First, generate a data frame of taxon-specific <em>X</em> values at which to predict <em>Y</em> values. We’ll generate the data frames in a loop and save them to a list. Then, the elements of the list will be combined to a single data frame with <code>do.call()</code>. This is a little extra work, but worth it because our figure will only show model predictions within the observed <em>X</em> range for each group.</p>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1503-1"><a href="mod-07.html#cb1503-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get X range for each group</span></span>
<span id="cb1503-2"><a href="mod-07.html#cb1503-2" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(logx<span class="sc">~</span>group1, <span class="at">data=</span>dat, range)</span>
<span id="cb1503-3"><a href="mod-07.html#cb1503-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1503-4"><a href="mod-07.html#cb1503-4" aria-hidden="true" tabindex="-1"></a><span class="co"># number of values at which to predict</span></span>
<span id="cb1503-5"><a href="mod-07.html#cb1503-5" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1503-6"><a href="mod-07.html#cb1503-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1503-7"><a href="mod-07.html#cb1503-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make a list containing a dataframe for each group</span></span>
<span id="cb1503-8"><a href="mod-07.html#cb1503-8" aria-hidden="true" tabindex="-1"></a>px.list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, ngroup)</span>
<span id="cb1503-9"><a href="mod-07.html#cb1503-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ngroup){</span>
<span id="cb1503-10"><a href="mod-07.html#cb1503-10" aria-hidden="true" tabindex="-1"></a>    imin <span class="ot">&lt;-</span> agg[[<span class="dv">2</span>]][i,<span class="dv">1</span>]</span>
<span id="cb1503-11"><a href="mod-07.html#cb1503-11" aria-hidden="true" tabindex="-1"></a>    imax <span class="ot">&lt;-</span> agg[[<span class="dv">2</span>]][i,<span class="dv">2</span>]</span>
<span id="cb1503-12"><a href="mod-07.html#cb1503-12" aria-hidden="true" tabindex="-1"></a>    ix <span class="ot">&lt;-</span> <span class="fu">seq</span>(imin, imax, <span class="at">length=</span>pn)</span>
<span id="cb1503-13"><a href="mod-07.html#cb1503-13" aria-hidden="true" tabindex="-1"></a>    px.list[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">group1=</span>groups[i],<span class="at">logx=</span>ix)</span>
<span id="cb1503-14"><a href="mod-07.html#cb1503-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1503-15"><a href="mod-07.html#cb1503-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1503-16"><a href="mod-07.html#cb1503-16" aria-hidden="true" tabindex="-1"></a><span class="co"># combine to a single dataframe</span></span>
<span id="cb1503-17"><a href="mod-07.html#cb1503-17" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, px.list)</span></code></pre></div>
<p>Next, generate predictions. The predict method for LMM does not generate SE; this turns out to be rather difficult mathematically. We’ll plot the expected values first, then circle back and try to estimate some SE to get CI.</p>
<div class="sourceCode" id="cb1504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1504-1"><a href="mod-07.html#cb1504-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod4, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx))</span>
<span id="cb1504-2"><a href="mod-07.html#cb1504-2" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>y <span class="ot">&lt;-</span> pred</span></code></pre></div>
<p>The next block of code will produce some pretty axis tick marks. This is needed because the scales are logarithmic, but we want the <em>values</em> on the axes to be on the original scale. Manually constructing axes like this can be tedious (and a little confusing), but I think the payoff is worth it. The trick to remember that the plot is on the <em>natural log scale</em>, but the axes should be on the <span class="math inline">\(log_{10}\)</span> scale for interpretability. Most people intuitively understand <span class="math inline">\(10^2\)</span>, <span class="math inline">\(10^3\)</span>, etc., but <span class="math inline">\(e^2\)</span>, <span class="math inline">\(e^2\)</span>, and so on are not as clear.</p>
<p>The trick is to first define the values at which you want tick marks, THEN convert those values to natural log coordinates.</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1505-1"><a href="mod-07.html#cb1505-1" aria-hidden="true" tabindex="-1"></a><span class="co"># main tick marks for powers of 10:</span></span>
<span id="cb1505-2"><a href="mod-07.html#cb1505-2" aria-hidden="true" tabindex="-1"></a>xax1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb1505-3"><a href="mod-07.html#cb1505-3" aria-hidden="true" tabindex="-1"></a>xax1 <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>xax1</span>
<span id="cb1505-4"><a href="mod-07.html#cb1505-4" aria-hidden="true" tabindex="-1"></a>xax1 <span class="ot">&lt;-</span> <span class="fu">log</span>(xax1)</span>
<span id="cb1505-5"><a href="mod-07.html#cb1505-5" aria-hidden="true" tabindex="-1"></a><span class="co"># manually specify some labels for tick marks</span></span>
<span id="cb1505-6"><a href="mod-07.html#cb1505-6" aria-hidden="true" tabindex="-1"></a>xticks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;0.1 g&quot;</span>, <span class="st">&quot;1 g&quot;</span>, <span class="st">&quot;10 g&quot;</span>, <span class="st">&quot;100 g&quot;</span>,</span>
<span id="cb1505-7"><a href="mod-07.html#cb1505-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;1 kg&quot;</span>, <span class="st">&quot;10 kg&quot;</span>, <span class="st">&quot;100 kg&quot;</span>, <span class="st">&quot;1000 kg&quot;</span>, <span class="st">&quot;10000 kg&quot;</span>)</span>
<span id="cb1505-8"><a href="mod-07.html#cb1505-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1505-9"><a href="mod-07.html#cb1505-9" aria-hidden="true" tabindex="-1"></a><span class="co"># smaller tick marks for non-integer powers of 10</span></span>
<span id="cb1505-10"><a href="mod-07.html#cb1505-10" aria-hidden="true" tabindex="-1"></a>xax2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb1505-11"><a href="mod-07.html#cb1505-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">1000</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="fl">1e4</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="fl">1e5</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="fl">1e6</span>)</span>
<span id="cb1505-12"><a href="mod-07.html#cb1505-12" aria-hidden="true" tabindex="-1"></a>xax2 <span class="ot">&lt;-</span> <span class="fu">log</span>(xax2)</span>
<span id="cb1505-13"><a href="mod-07.html#cb1505-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1505-14"><a href="mod-07.html#cb1505-14" aria-hidden="true" tabindex="-1"></a><span class="co"># similar process for Y axis</span></span>
<span id="cb1505-15"><a href="mod-07.html#cb1505-15" aria-hidden="true" tabindex="-1"></a>yax1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">4</span>, <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb1505-16"><a href="mod-07.html#cb1505-16" aria-hidden="true" tabindex="-1"></a>yax1 <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">10</span><span class="sc">^</span>yax1)</span>
<span id="cb1505-17"><a href="mod-07.html#cb1505-17" aria-hidden="true" tabindex="-1"></a>yax2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">1000</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">100</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb1505-18"><a href="mod-07.html#cb1505-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">1000</span>)</span>
<span id="cb1505-19"><a href="mod-07.html#cb1505-19" aria-hidden="true" tabindex="-1"></a>yax2 <span class="ot">&lt;-</span> <span class="fu">log</span>(yax2)</span>
<span id="cb1505-20"><a href="mod-07.html#cb1505-20" aria-hidden="true" tabindex="-1"></a>yticks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)</span></code></pre></div>
<p>We should also change the group labels to be capitalized for the final figure. We could do this manually, but instead we’ll write a custom R function to capitalize the words. There is a function provided on the help page for <code>tolower()</code> that can do this<a href="literature-cited.html#fn70" class="footnote-ref" id="fnref70"><sup>70</sup></a>:</p>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1506-1"><a href="mod-07.html#cb1506-1" aria-hidden="true" tabindex="-1"></a>capwords <span class="ot">&lt;-</span> <span class="cf">function</span>(s, <span class="at">strict =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb1506-2"><a href="mod-07.html#cb1506-2" aria-hidden="true" tabindex="-1"></a>    cap <span class="ot">&lt;-</span> <span class="cf">function</span>(s) <span class="fu">paste</span>(<span class="fu">toupper</span>(<span class="fu">substring</span>(s, <span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb1506-3"><a href="mod-07.html#cb1506-3" aria-hidden="true" tabindex="-1"></a>                  {s <span class="ot">&lt;-</span> <span class="fu">substring</span>(s, <span class="dv">2</span>); <span class="cf">if</span>(strict) <span class="fu">tolower</span>(s) <span class="cf">else</span> s},</span>
<span id="cb1506-4"><a href="mod-07.html#cb1506-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">sep =</span> <span class="st">&quot;&quot;</span>, <span class="at">collapse =</span> <span class="st">&quot; &quot;</span> )</span>
<span id="cb1506-5"><a href="mod-07.html#cb1506-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(<span class="fu">strsplit</span>(s, <span class="at">split =</span> <span class="st">&quot; &quot;</span>), cap, <span class="at">USE.NAMES =</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(s)))</span>
<span id="cb1506-6"><a href="mod-07.html#cb1506-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1506-7"><a href="mod-07.html#cb1506-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1506-8"><a href="mod-07.html#cb1506-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now use the function</span></span>
<span id="cb1506-9"><a href="mod-07.html#cb1506-9" aria-hidden="true" tabindex="-1"></a>group.leg <span class="ot">&lt;-</span> <span class="fu">capwords</span>(groups)</span></code></pre></div>
<p>Now set some fancy plot options with <code>par()</code> and make the plot piece-by-piece<a href="literature-cited.html#fn71" class="footnote-ref" id="fnref71"><sup>71</sup></a>. Notice how the plot is set up with a log-log coordinate system (because <code>x</code> and <code>y</code> are given on log scale) and with no axes (<code>xaxt="n"</code> and <code>yaxt="n"</code>). The custom axes are added later. Then, a <code>for()</code> loop is used to plot the prediction lines for each group. Without that, we would have needed to write a separate <code>points()</code> command for each group. Finally, a legend shows the reader how to identify the groups.</p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1507-1"><a href="mod-07.html#cb1507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">6.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1507-2"><a href="mod-07.html#cb1507-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">las=</span><span class="dv">1</span>, <span class="at">lend=</span><span class="dv">1</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">cex.axis=</span><span class="fl">1.1</span>, <span class="at">cex.lab=</span><span class="fl">1.3</span>,</span>
<span id="cb1507-3"><a href="mod-07.html#cb1507-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xpd=</span><span class="cn">NA</span>)</span>
<span id="cb1507-4"><a href="mod-07.html#cb1507-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(dat<span class="sc">$</span>bm), <span class="fu">log</span>(dat<span class="sc">$</span>agr), <span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb1507-5"><a href="mod-07.html#cb1507-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span>dat<span class="sc">$</span>col,</span>
<span id="cb1507-6"><a href="mod-07.html#cb1507-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1507-7"><a href="mod-07.html#cb1507-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Mass at max GR&quot;</span>,</span>
<span id="cb1507-8"><a href="mod-07.html#cb1507-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Max growth rate (GR) (g/day)&quot;</span>)</span>
<span id="cb1507-9"><a href="mod-07.html#cb1507-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span>xax1,</span>
<span id="cb1507-10"><a href="mod-07.html#cb1507-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span>xticks)</span>
<span id="cb1507-11"><a href="mod-07.html#cb1507-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">1</span>, <span class="at">at=</span>xax2, <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.25</span>)</span>
<span id="cb1507-12"><a href="mod-07.html#cb1507-12" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span>yax1,</span>
<span id="cb1507-13"><a href="mod-07.html#cb1507-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span>yticks)</span>
<span id="cb1507-14"><a href="mod-07.html#cb1507-14" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span>yax2, <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.25</span>)</span>
<span id="cb1507-15"><a href="mod-07.html#cb1507-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ngroup){</span>
<span id="cb1507-16"><a href="mod-07.html#cb1507-16" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx<span class="sc">$</span>group <span class="sc">==</span> groups[i])</span>
<span id="cb1507-17"><a href="mod-07.html#cb1507-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx<span class="sc">$</span>logx[flag], dx<span class="sc">$</span>y[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">5</span>, <span class="at">col=</span>cols2[i])</span>
<span id="cb1507-18"><a href="mod-07.html#cb1507-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1507-19"><a href="mod-07.html#cb1507-19" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span>group.leg,</span>
<span id="cb1507-20"><a href="mod-07.html#cb1507-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd=</span><span class="dv">5</span>, <span class="at">col=</span>cols2, <span class="at">cex=</span><span class="fl">1.3</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-657-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The final model lets us see that dinosaur growth rates are somewhere in between those of modern endotherms and modern ectotherms. We can compare the coefficients directly by examining the BLUPs. The result shows us that dinosaurs have an intercept and slope intermediate to the other groups.</p>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1508-1"><a href="mod-07.html#cb1508-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod4)<span class="sc">$</span>group1</span></code></pre></div>
<pre><code>##           (Intercept)      logx
## birds       -1.019030 0.7111834
## dinosaurs   -3.940582 0.7474059
## fishes      -5.360802 0.7693490
## mammals     -2.356117 0.6958912
## reptiles    -4.571142 0.6812206</code></pre>
<p>If you want to examine the BLUPs or conditional modes and see how they vary between groups, you need to obtain the conditional SD as well as the conditional modes. The simplest way is to get them from the <code>ranef()</code> function (short for “<strong>ran</strong>dom <strong>ef</strong>fects”). The conditional SD are only returned when <code>as.data.frame()</code> is used on the results of <code>ranef()</code>, not when <code>ranef()</code> is used by itself.</p>
<p>The commands below will calculate the conditional mean and SD of each BLUP. We can use those results to estimate the 95% CI of each group-specific random parameter. This can also be used as a <em>heuristic</em> for interpreting the BLUPs, but <strong>does not tell you whether or not each random effect is “significant”</strong>. The framework of a “significant vs. nonsignificant” isn’t as well defined for random effects as it is for fixed effects. If the 95% CI of a random effect does not include 0, then its fine to say that that group’s random effect is not 0. Looking at which groups have nonzero random effects might give you some insight into what is driving the variability in your dataset. However, you should not use this method to say whether a random effect is statistically signficant or not, because you haven’t performed a significance test. More generally, <strong><em>you should not be making inferences based on conditional modes or BLUPs</em></strong>. If you were interested in predicting values for these particular levels of a random factor, then you should have fit it as a fixed effect in the first place!</p>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="mod-07.html#cb1510-1" aria-hidden="true" tabindex="-1"></a>re <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">ranef</span>(mod4, <span class="at">condVar=</span><span class="cn">TRUE</span>))</span>
<span id="cb1510-2"><a href="mod-07.html#cb1510-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1510-3"><a href="mod-07.html#cb1510-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 95% CI (normal approximation)</span></span>
<span id="cb1510-4"><a href="mod-07.html#cb1510-4" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, re<span class="sc">$</span>condval, re<span class="sc">$</span>condsd)</span>
<span id="cb1510-5"><a href="mod-07.html#cb1510-5" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, re<span class="sc">$</span>condval, re<span class="sc">$</span>condsd)</span>
<span id="cb1510-6"><a href="mod-07.html#cb1510-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1510-7"><a href="mod-07.html#cb1510-7" aria-hidden="true" tabindex="-1"></a><span class="co"># flag effects whose 95% CI includes 0</span></span>
<span id="cb1510-8"><a href="mod-07.html#cb1510-8" aria-hidden="true" tabindex="-1"></a><span class="co"># (indicates BLUP not very different from</span></span>
<span id="cb1510-9"><a href="mod-07.html#cb1510-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  fixed effect parameter)</span></span>
<span id="cb1510-10"><a href="mod-07.html#cb1510-10" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>inc<span class="fl">.0</span> <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="dv">0</span><span class="sc">&gt;=</span>re<span class="sc">$</span>low <span class="sc">&amp;</span> <span class="dv">0</span><span class="sc">&lt;=</span>re<span class="sc">$</span>upp, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1510-11"><a href="mod-07.html#cb1510-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1510-12"><a href="mod-07.html#cb1510-12" aria-hidden="true" tabindex="-1"></a><span class="co"># round to 2 decimal places</span></span>
<span id="cb1510-13"><a href="mod-07.html#cb1510-13" aria-hidden="true" tabindex="-1"></a>re[,<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">apply</span>(re[,<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>], <span class="dv">2</span>, round, <span class="dv">2</span>)</span>
<span id="cb1510-14"><a href="mod-07.html#cb1510-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1510-15"><a href="mod-07.html#cb1510-15" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect results</span></span>
<span id="cb1510-16"><a href="mod-07.html#cb1510-16" aria-hidden="true" tabindex="-1"></a>re</span></code></pre></div>
<pre><code>##    grpvar        term       grp condval condsd   low   upp inc.0
## 1  group1 (Intercept)     birds    2.43   0.05  2.32  2.54     0
## 2  group1 (Intercept) dinosaurs   -0.49   0.39 -1.26  0.27     1
## 3  group1 (Intercept)    fishes   -1.91   0.10 -2.11 -1.71     0
## 4  group1 (Intercept)   mammals    1.09   0.06  0.98  1.21     0
## 5  group1 (Intercept)  reptiles   -1.12   0.12 -1.36 -0.88     0
## 6  group1        logx     birds   -0.01   0.01 -0.03  0.01     1
## 7  group1        logx dinosaurs    0.03   0.03 -0.03  0.08     1
## 8  group1        logx    fishes    0.05   0.02  0.01  0.08     0
## 9  group1        logx   mammals   -0.03   0.01 -0.04 -0.01     0
## 10 group1        logx  reptiles   -0.04   0.02 -0.08  0.00     0</code></pre>
<p>The flag <code>inc.0</code> identifies which BLUPs have a 95% CI that includes 0. If the 95% CI includes 0, then we can infer that the BLUP for that group is not very different from the corresponding fixed effect–i.e., the overall estimate for that parameter. For example, the table above shows that the random effect on the intercept associated with dinosaurs, -0.49 with 95% CI [-1.26, 0.27], is similar to the overall intercept of -3.45 (see <code>summary(mod4)</code>). This is despite the fact that the BLUP for the intercept for dinosaurs was quite large: -3.94 (i.e., -3.45 + -0.49; see <code>coef(mod4)$group1</code>).</p>
<p>If you want the actual BLUPs for the groups and not just their differences from the mean, you can get them by adding estimates of the fixed effects to each parameter to the random effects associated with each group. Do this for every column except the SD. This works because one of the properties of the normal distribution is that its mean (i.e., location) is a separate parameter from its variance. So, adding a constant to the mean will shift the entire distribution, including its quantiles, by that constant while retaining the same variance.</p>
<div class="sourceCode" id="cb1512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1512-1"><a href="mod-07.html#cb1512-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod4)<span class="sc">$</span>coefficients</span>
<span id="cb1512-2"><a href="mod-07.html#cb1512-2" aria-hidden="true" tabindex="-1"></a>add.val <span class="ot">&lt;-</span> <span class="fu">rep</span>(coefs[,<span class="dv">1</span>], <span class="at">each=</span>ngroup)</span>
<span id="cb1512-3"><a href="mod-07.html#cb1512-3" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>condval <span class="ot">&lt;-</span> <span class="fu">round</span>(re<span class="sc">$</span>condval <span class="sc">+</span> add.val,<span class="dv">2</span>)</span>
<span id="cb1512-4"><a href="mod-07.html#cb1512-4" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">round</span>(re<span class="sc">$</span>low <span class="sc">+</span> add.val,<span class="dv">2</span>)</span>
<span id="cb1512-5"><a href="mod-07.html#cb1512-5" aria-hidden="true" tabindex="-1"></a>re<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">round</span>(re<span class="sc">$</span>upp <span class="sc">+</span> add.val,<span class="dv">2</span>)</span>
<span id="cb1512-6"><a href="mod-07.html#cb1512-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1512-7"><a href="mod-07.html#cb1512-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect results</span></span>
<span id="cb1512-8"><a href="mod-07.html#cb1512-8" aria-hidden="true" tabindex="-1"></a>re</span></code></pre></div>
<pre><code>##    grpvar        term       grp condval condsd   low   upp inc.0
## 1  group1 (Intercept)     birds   -1.02   0.05 -1.13 -0.91     0
## 2  group1 (Intercept) dinosaurs   -3.94   0.39 -4.71 -3.18     1
## 3  group1 (Intercept)    fishes   -5.36   0.10 -5.56 -5.16     0
## 4  group1 (Intercept)   mammals   -2.36   0.06 -2.47 -2.24     0
## 5  group1 (Intercept)  reptiles   -4.57   0.12 -4.81 -4.33     0
## 6  group1        logx     birds    0.71   0.01  0.69  0.73     1
## 7  group1        logx dinosaurs    0.75   0.03  0.69  0.80     1
## 8  group1        logx    fishes    0.77   0.02  0.73  0.80     0
## 9  group1        logx   mammals    0.69   0.01  0.68  0.71     0
## 10 group1        logx  reptiles    0.68   0.02  0.64  0.72     0</code></pre>
<p>There are other methods for getting confidence intervals on BLUPs that we will explore some of the other mixed model pages.</p>
</div>
</div>
<div id="mod-07-glmm" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Generalized linear mixed models (GLMM)</h2>
<div id="definition-1" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Definition</h3>
<p>Just as the linear mixed model (LMM) is an extension of the linear model, the <strong>generalized linear mixed model (GLMM)</strong> is an extension of the generalized linear model (GLM). The difference between the LMM and GLMM is the same as the difference between the LM and GLM: the response values can come from distributions other than the normal, and the model can be linear on a different scale than of the original scale (i.e., the link scale).</p>
<p>The equations for a simple GLMM, with normal (Gaussian) family and identify link function, one continuous predictor variable <em>X</em>, and random intercepts and slope by a factor <em>Z</em>, are shown below. The normal distributions of the random effects are presented as parameterized by a mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span> (or sometimes SD <span class="math inline">\(\sigma\)</span>)<a href="literature-cited.html#fn72" class="footnote-ref" id="fnref72"><sup>72</sup></a>.</p>
<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th>Component</th>
<th>Expression</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stochastic part (<em>Y</em> values)</td>
<td><span class="math inline">\(y_i \sim Normal\left(\mu_i,\sigma^2\right)\)</span></td>
</tr>
<tr class="even">
<td>Link function</td>
<td><span class="math inline">\(E\left(y_i\right)=\mu_i=\eta_i\)</span></td>
</tr>
<tr class="odd">
<td>Linear predictor</td>
<td><span class="math inline">\(\eta_i=\beta_{0,Z}+\beta_{1,Z}X_i\)</span></td>
</tr>
<tr class="even">
<td>Random intercepts</td>
<td><span class="math inline">\(\beta_{0,Z} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>Random slopes</td>
<td><span class="math inline">\(\beta_{1,Z} \sim Normal\left(\mu_{\beta_1},\sigma_{\beta_1}^2\right)\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="glmm-on-simulated-data" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> GLMM on simulated data</h3>
<p>Let’s explore the GLMM with a simulated example. We’ll simulate data for a simulated study of the occurrence (i.e., presence/absence) of an imaginary bird species along a gradient of urbanization. The imaginary study was conducted over 12 years. In each year, between 9 and 19 sites were surveyed and the presence or absence of an endangered bird was recorded. The researchers assumed that variation in environmental conditions from year to year affected bird presence, so they used a mixed effects model to analyze their data. The explanatory variable, <code>urb</code>, is an index of urbanization and land use intensity derived from satellite data. Because they are interested in modeling bird presence/absence, they used a logistic regression model, with a random effect for year. In ecology this sort of thing is called an <strong>occupancy model</strong>.</p>
<p>The code below simulates the dataset described above. First the dataset structure is defined. Then, the <strong>hyperparameters</strong>, which define the distribution of random effects, are set. These are then used to define the group-level parameters and the individual observations.</p>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1514-1"><a href="mod-07.html#cb1514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1514-2"><a href="mod-07.html#cb1514-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-3"><a href="mod-07.html#cb1514-3" aria-hidden="true" tabindex="-1"></a><span class="co"># years in study</span></span>
<span id="cb1514-4"><a href="mod-07.html#cb1514-4" aria-hidden="true" tabindex="-1"></a>n.groups <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1514-5"><a href="mod-07.html#cb1514-5" aria-hidden="true" tabindex="-1"></a><span class="co"># random number of sites each year</span></span>
<span id="cb1514-6"><a href="mod-07.html#cb1514-6" aria-hidden="true" tabindex="-1"></a>n.sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">20</span>, n.groups, <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb1514-7"><a href="mod-07.html#cb1514-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-8"><a href="mod-07.html#cb1514-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameters</span></span>
<span id="cb1514-9"><a href="mod-07.html#cb1514-9" aria-hidden="true" tabindex="-1"></a>mu.beta0 <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1514-10"><a href="mod-07.html#cb1514-10" aria-hidden="true" tabindex="-1"></a>sd.beta0 <span class="ot">&lt;-</span> <span class="fl">1.7</span></span>
<span id="cb1514-11"><a href="mod-07.html#cb1514-11" aria-hidden="true" tabindex="-1"></a>mu.beta1 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">6.8</span></span>
<span id="cb1514-12"><a href="mod-07.html#cb1514-12" aria-hidden="true" tabindex="-1"></a>sd.beta1 <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb1514-13"><a href="mod-07.html#cb1514-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-14"><a href="mod-07.html#cb1514-14" aria-hidden="true" tabindex="-1"></a><span class="co"># draw random effects</span></span>
<span id="cb1514-15"><a href="mod-07.html#cb1514-15" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n.groups, mu.beta0, sd.beta0)</span>
<span id="cb1514-16"><a href="mod-07.html#cb1514-16" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n.groups, mu.beta1, sd.beta1)</span>
<span id="cb1514-17"><a href="mod-07.html#cb1514-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-18"><a href="mod-07.html#cb1514-18" aria-hidden="true" tabindex="-1"></a><span class="co"># set up data frame with explanatory variable.</span></span>
<span id="cb1514-19"><a href="mod-07.html#cb1514-19" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, n.groups)</span>
<span id="cb1514-20"><a href="mod-07.html#cb1514-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.groups){</span>
<span id="cb1514-21"><a href="mod-07.html#cb1514-21" aria-hidden="true" tabindex="-1"></a>    dlist[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span>i, <span class="at">site=</span><span class="dv">1</span><span class="sc">:</span>n.sample[i])</span>
<span id="cb1514-22"><a href="mod-07.html#cb1514-22" aria-hidden="true" tabindex="-1"></a>    dlist[[i]]<span class="sc">$</span>urb <span class="ot">&lt;-</span> <span class="fu">runif</span>(n.sample[i], <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb1514-23"><a href="mod-07.html#cb1514-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1514-24"><a href="mod-07.html#cb1514-24" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, dlist)</span>
<span id="cb1514-25"><a href="mod-07.html#cb1514-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-26"><a href="mod-07.html#cb1514-26" aria-hidden="true" tabindex="-1"></a><span class="co"># add coefficients for each observation</span></span>
<span id="cb1514-27"><a href="mod-07.html#cb1514-27" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>beta0 <span class="ot">&lt;-</span> beta0[sim<span class="sc">$</span>year]</span>
<span id="cb1514-28"><a href="mod-07.html#cb1514-28" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>beta1 <span class="ot">&lt;-</span> beta1[sim<span class="sc">$</span>year]</span>
<span id="cb1514-29"><a href="mod-07.html#cb1514-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-30"><a href="mod-07.html#cb1514-30" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate linear predictor eta (logit scale)</span></span>
<span id="cb1514-31"><a href="mod-07.html#cb1514-31" aria-hidden="true" tabindex="-1"></a><span class="co"># and probability p (probability scale)</span></span>
<span id="cb1514-32"><a href="mod-07.html#cb1514-32" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>eta <span class="ot">&lt;-</span> sim<span class="sc">$</span>beta0<span class="sc">+</span>sim<span class="sc">$</span>beta1<span class="sc">*</span>sim<span class="sc">$</span>urb</span>
<span id="cb1514-33"><a href="mod-07.html#cb1514-33" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(sim<span class="sc">$</span>eta)</span>
<span id="cb1514-34"><a href="mod-07.html#cb1514-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1514-35"><a href="mod-07.html#cb1514-35" aria-hidden="true" tabindex="-1"></a><span class="co"># apply stochastic part of model (Bernoulli draws)</span></span>
<span id="cb1514-36"><a href="mod-07.html#cb1514-36" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">nrow</span>(sim), <span class="dv">1</span>, sim<span class="sc">$</span>p)</span></code></pre></div>
<p>Let’s start the analysis by examining the data:</p>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1515-1"><a href="mod-07.html#cb1515-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>))</span>
<span id="cb1515-2"><a href="mod-07.html#cb1515-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim<span class="sc">$</span>urb, <span class="fu">jitter</span>(sim<span class="sc">$</span>y))</span>
<span id="cb1515-3"><a href="mod-07.html#cb1515-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(sim<span class="sc">$</span>urb<span class="sc">~</span>sim<span class="sc">$</span>y, <span class="at">horizontal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-662-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The figure suggests that increasing urbanization tends to decrease occupancy by this bird species. This makes sense, biologically, but it also appears that there is a lot of variation in urbanization within the sites where the bird occurs and the sites where it doesn’t. Maybe there is some variation related to year?</p>
<div class="sourceCode" id="cb1516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1516-1"><a href="mod-07.html#cb1516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add colors for each year</span></span>
<span id="cb1516-2"><a href="mod-07.html#cb1516-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(n.groups)</span>
<span id="cb1516-3"><a href="mod-07.html#cb1516-3" aria-hidden="true" tabindex="-1"></a>sim<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[sim<span class="sc">$</span>year]</span>
<span id="cb1516-4"><a href="mod-07.html#cb1516-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1516-5"><a href="mod-07.html#cb1516-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>))</span>
<span id="cb1516-6"><a href="mod-07.html#cb1516-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim<span class="sc">$</span>urb, <span class="fu">jitter</span>(sim<span class="sc">$</span>y), <span class="at">col=</span>sim<span class="sc">$</span>col, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb1516-7"><a href="mod-07.html#cb1516-7" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(sim<span class="sc">$</span>urb<span class="sc">~</span>sim<span class="sc">$</span>y, <span class="at">horizontal=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-663-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>With so many groups (years) it’s hard to tell if year might be affecting the relationship between occupancy and urbanization. Let’s use package <code>lattice</code> to make a hierarchical plot that shows the groups separately.</p>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="mod-07.html#cb1517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb1517-2"><a href="mod-07.html#cb1517-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(y<span class="sc">~</span>urb<span class="sc">|</span><span class="fu">factor</span>(year), <span class="at">data=</span>sim)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-664-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>The figure shows that urbanization appears to decrease occupancy in almost every year. The bird was not observed at all in year 1. In some years, occupancy dropped off at low levels of urbanization (e.g., years 2, 6, and 7); in other years, the bird was found in sites with much higher levels of urbanization (e.g., years 3 and 9). These findings support the idea that year needs to be accounted for. We’ll fit three versions of the model, because we don’t know if the random effect of year should affect the intercept, slope, or intercept and slope of the linear predictor.</p>
<div class="sourceCode" id="cb1518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1518-1"><a href="mod-07.html#cb1518-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1518-2"><a href="mod-07.html#cb1518-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y<span class="sc">~</span>urb<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>year), <span class="at">data=</span>sim, <span class="at">family=</span>binomial)</span>
<span id="cb1518-3"><a href="mod-07.html#cb1518-3" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y<span class="sc">~</span>urb<span class="sc">+</span>(<span class="dv">0</span><span class="sc">+</span>urb<span class="sc">|</span>year), <span class="at">data=</span>sim, <span class="at">family=</span>binomial)</span>
<span id="cb1518-4"><a href="mod-07.html#cb1518-4" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y<span class="sc">~</span>urb<span class="sc">+</span>(urb<span class="sc">|</span>year), <span class="at">data=</span>sim, <span class="at">family=</span>binomial)</span>
<span id="cb1518-5"><a href="mod-07.html#cb1518-5" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y<span class="sc">~</span>urb<span class="sc">+</span>(urb<span class="sc">||</span>year), <span class="at">data=</span>sim, <span class="at">family=</span>binomial)</span></code></pre></div>
<p>All of the models converged<a href="literature-cited.html#fn73" class="footnote-ref" id="fnref73"><sup>73</sup></a>, so let’s use AIC to determine which model is the best supported by the data.</p>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1519-1"><a href="mod-07.html#cb1519-1" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod1, mod2, mod3, mod4)</span>
<span id="cb1519-2"><a href="mod-07.html#cb1519-2" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>delta <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">min</span>(aic.df<span class="sc">$</span>AIC)</span>
<span id="cb1519-3"><a href="mod-07.html#cb1519-3" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aic.df<span class="sc">$</span>delta)</span>
<span id="cb1519-4"><a href="mod-07.html#cb1519-4" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aic.df<span class="sc">$</span>wt)</span>
<span id="cb1519-5"><a href="mod-07.html#cb1519-5" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> aic.df[<span class="fu">order</span>(<span class="sc">-</span>aic.df<span class="sc">$</span>wt),]</span>
<span id="cb1519-6"><a href="mod-07.html#cb1519-6" aria-hidden="true" tabindex="-1"></a>aic.df</span></code></pre></div>
<pre><code>##      df      AIC    delta         wt
## mod1  3 139.7622 0.000000 0.50498148
## mod2  3 141.2993 1.537081 0.23415450
## mod4  4 141.7594 1.997213 0.18603135
## mod3  5 143.5807 3.818534 0.07483267</code></pre>
<p>Interestingly, AIC identifies model 1 (random intercept) as the best fitting model, when we know that model 4 (random uncorrelated slopes and intercepts) is the truth. Looking back at the simulation parameters, can you guess why this happened? However, <span class="math inline">\(\Delta\left(AIC\right)\)</span> was &lt;2 for models 1, 2, and 4, suggesting that any of them could be considered “best fitting”.</p>
<p>Inspect the outputs to see what the parameter estimates are. The estimated intercept and slope aren’t very close to the true values (<code>mu.beta0</code> and <code>mu.beta1</code>), but this might have something do with the large variability in the intercepts (<code>sd.beta0</code>).</p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1521-1"><a href="mod-07.html#cb1521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ urb + (1 | year)
##    Data: sim
## 
##      AIC      BIC   logLik deviance df.resid 
##    139.8    149.1    -66.9    133.8      161 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.8969 -0.4530 -0.1617  0.3846  4.1386 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  year   (Intercept) 1.137    1.066   
## Number of obs: 164, groups:  year, 12
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)    1.959      0.602   3.254  0.00114 ** 
## urb           -7.312      1.330  -5.496 3.88e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##     (Intr)
## urb -0.753</code></pre>
<p>The intercepts vary quite a bit between years:</p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1523-1"><a href="mod-07.html#cb1523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod1)<span class="sc">$</span>year</span></code></pre></div>
<pre><code>##    (Intercept)       urb
## 1    0.8792071 -7.312053
## 2    1.4874052 -7.312053
## 3    2.8794661 -7.312053
## 4    2.0679683 -7.312053
## 5    1.3682659 -7.312053
## 6    2.5975640 -7.312053
## 7    0.9167481 -7.312053
## 8    3.6762635 -7.312053
## 9    2.6771235 -7.312053
## 10   1.1477449 -7.312053
## 11   2.0878343 -7.312053
## 12   2.0208604 -7.312053</code></pre>
<p>Plotting the intercept vs. year (i.e., time) might tell us something about how environmental factors varied over time.</p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="mod-07.html#cb1525-1" aria-hidden="true" tabindex="-1"></a>ints <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod1)<span class="sc">$</span>year</span>
<span id="cb1525-2"><a href="mod-07.html#cb1525-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1525-3"><a href="mod-07.html#cb1525-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ints[,<span class="dv">1</span>], <span class="at">type=</span><span class="st">&quot;o&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">pch=</span><span class="dv">16</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-669-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>It appears that the intercept dropped precipitously 3 times: year 3, year 6, and years 8-10. Maybe something happened in those years that reduced the likelihood of the bird showing up. For example, maybe these were drought years. Or maybe those were the years when new cohorts of graduate students were recruited who weren’t as effective at finding the birds. Whatever the cause of the variation was, the GLMM accounted for it. Explaining and interpreting that variation it is the job of the biologist.</p>
<p>We’ll finish our example GLMM analysis by plotting the model predictions.</p>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="mod-07.html#cb1526-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of points and x values</span></span>
<span id="cb1526-2"><a href="mod-07.html#cb1526-2" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1526-3"><a href="mod-07.html#cb1526-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length=</span>pn)</span>
<span id="cb1526-4"><a href="mod-07.html#cb1526-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1526-5"><a href="mod-07.html#cb1526-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions by level (year)</span></span>
<span id="cb1526-6"><a href="mod-07.html#cb1526-6" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">year=</span><span class="dv">1</span><span class="sc">:</span>n.groups, <span class="at">urb=</span>px)</span>
<span id="cb1526-7"><a href="mod-07.html#cb1526-7" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> dx1[<span class="fu">order</span>(dx1<span class="sc">$</span>year, dx1<span class="sc">$</span>urb),]</span>
<span id="cb1526-8"><a href="mod-07.html#cb1526-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1526-9"><a href="mod-07.html#cb1526-9" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients (include random beta0)</span></span>
<span id="cb1526-10"><a href="mod-07.html#cb1526-10" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx1), <span class="at">type=</span><span class="st">&quot;link&quot;</span>)</span>
<span id="cb1526-11"><a href="mod-07.html#cb1526-11" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx1<span class="sc">$</span>y)</span>
<span id="cb1526-12"><a href="mod-07.html#cb1526-12" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[dx1<span class="sc">$</span>year]</span>
<span id="cb1526-13"><a href="mod-07.html#cb1526-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1526-14"><a href="mod-07.html#cb1526-14" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions for &quot;average&quot;</span></span>
<span id="cb1526-15"><a href="mod-07.html#cb1526-15" aria-hidden="true" tabindex="-1"></a>dx2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span><span class="cn">NA</span>, <span class="at">urb=</span>px)</span>
<span id="cb1526-16"><a href="mod-07.html#cb1526-16" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx2), </span>
<span id="cb1526-17"><a href="mod-07.html#cb1526-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">re.form=</span><span class="cn">NA</span>, <span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb1526-18"><a href="mod-07.html#cb1526-18" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx2<span class="sc">$</span>y)</span></code></pre></div>
<p>Now make the plot:</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="mod-07.html#cb1527-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1527-2"><a href="mod-07.html#cb1527-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1527-3"><a href="mod-07.html#cb1527-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.axis=</span><span class="fl">1.3</span>, <span class="at">cex.lab=</span><span class="fl">1.3</span>)</span>
<span id="cb1527-4"><a href="mod-07.html#cb1527-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dx1<span class="sc">$</span>urb, dx1<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1527-5"><a href="mod-07.html#cb1527-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">ylab=</span><span class="st">&quot;Occupancy probability&quot;</span>,</span>
<span id="cb1527-6"><a href="mod-07.html#cb1527-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Urbanization index&quot;</span>)</span>
<span id="cb1527-7"><a href="mod-07.html#cb1527-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.groups){</span>
<span id="cb1527-8"><a href="mod-07.html#cb1527-8" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx1<span class="sc">$</span>year<span class="sc">==</span>i)</span>
<span id="cb1527-9"><a href="mod-07.html#cb1527-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx1<span class="sc">$</span>urb[flag], dx1<span class="sc">$</span>y[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;grey60&quot;</span>)</span>
<span id="cb1527-10"><a href="mod-07.html#cb1527-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1527-11"><a href="mod-07.html#cb1527-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx2<span class="sc">$</span>urb, dx2<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-671-1.png" width="768" style="display: block; margin: auto;" /></p>
</div>
<div id="glmm-on-real-data" class="section level3" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> GLMM on real data</h3>
<p>This example is adapted from <span class="citation">Zuur et al. (<a href="#ref-zuur2009mixed" role="doc-biblioref">2009a</a>)</span>. <span class="citation">Vicente et al. (<a href="#ref-vicente2005" role="doc-biblioref">2005</a>)</span> studied the distribution of the parasitic nematode <em>Elaphostrongylus cervi</em> in red deer (<em>Cervus elephus</em>) in Spain (below)<a href="literature-cited.html#fn74" class="footnote-ref" id="fnref74"><sup>74</sup></a>. Red deer are the primary hosts of <em>E. cervi</em>, which primarily affect the hosts’ lung tissue. <span class="citation">Vicente et al. (<a href="#ref-vicente2005" role="doc-biblioref">2005</a>)</span> surveyed deer feces on many farms in Spain and tested droppings for <em>E. cervi</em> larvae. We will analyze part of their dataset, to see if red deer size and sex affect the occurrence of <em>E. cervi</em> larvae. We will use GLMM to account for potential variation in parasite occurrence between farms. GLMM is appropriate in this situation because we are not interested in the effects of particular farms, which are a subsample of the locations where red deer occur.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/07_01.jpg" /></p>
<p>Download the dataset and save it to your R home directory. This is a tab-delimited file (<code>.txt</code>), so you need to use <code>read.table()</code> instead of <code>read.csv()</code>.</p>
<div class="sourceCode" id="cb1528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1528-1"><a href="mod-07.html#cb1528-1" aria-hidden="true" tabindex="-1"></a>dat.name <span class="ot">&lt;-</span> <span class="st">&quot;DeerEcervi.txt&quot;</span></span>
<span id="cb1528-2"><a href="mod-07.html#cb1528-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(dat.name, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The dataset has the following variables:</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Farm</td>
<td>Farm (i.e., sampling site)</td>
</tr>
<tr class="even">
<td>Sex</td>
<td>Sex of deer (1 = female, 2 = male)</td>
</tr>
<tr class="odd">
<td>Length</td>
<td>Deer body length (cm)</td>
</tr>
<tr class="even">
<td>Ecervi</td>
<td>Parasite load in fecal sample</td>
</tr>
</tbody>
</table>
<p>Because we are interested in parasite occurrence, not abundance, we should use logistic regression. That is, a binomial GLM with a logit link. We will include a random effect associated with <code>farm</code>. Before running the analysis, let’s modify the variables in the dataset. First, define a response variable <code>y</code> that is 1 when parasites are present and 0 when parasite are absent. Then, center the deer lengths by subtracting the mean length. Finally, recode the sexes as <code>f</code> and <code>m</code> instead of 1 and 2. This is optional but will make things easier later.</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="mod-07.html#cb1529-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dat<span class="sc">$</span>Ecervi <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1529-2"><a href="mod-07.html#cb1529-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>len <span class="ot">&lt;-</span> dat<span class="sc">$</span>Length<span class="sc">-</span><span class="fu">mean</span>(dat<span class="sc">$</span>Length)</span>
<span id="cb1529-3"><a href="mod-07.html#cb1529-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(dat<span class="sc">$</span>Sex<span class="sc">==</span><span class="dv">1</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<p>Now we can fit a model. Like the original authors, we will investigate the effects of sex, size, and farm. The model for parasite presence <em>y</em> in individual <em>j</em> on farm <em>i</em>, with probability <span class="math inline">\(p_{ij}\)</span>, varies with length <span class="math inline">\(L_{ij}\)</span>, sex <span class="math inline">\(S_{ij}\)</span>, the interaction between sex and length <span class="math inline">\(S_{ij}L_{ij}\)</span>, and farm <span class="math inline">\(F_i\)</span> as:</p>
<p><span class="math display">\[y_i \sim Bernoulli\left(p_{ij}\right)\]</span>
<span class="math display">\[logit\left(p_{ij}\right)=\beta_0+\beta_1L_{ij}+\beta_2S_{ij}+\beta_3L_{ij}S_{ij}+\gamma_i\]</span>
<span class="math display">\[\gamma_i \sim Normal\left(\mu_\gamma,\sigma_{\gamma}\right)\]</span></p>
<p>In this model farm has a random effect on the intercept, <span class="math inline">\(\gamma_i\)</span>. The random effects on the intercepts are assumed to come from a normal distribution with mean <span class="math inline">\(\mu_{\gamma}\)</span> and SD <span class="math inline">\(\sigma_{\gamma}\)</span>. Some people prefer to write the model a slightly different way, which combines the overall intercept <span class="math inline">\(\beta_0\)</span> with the random effects on the intercept <span class="math inline">\(\gamma_i\)</span> as a single parameter <span class="math inline">\(\beta_{0,i}\)</span>:</p>
<p><span class="math display">\[logit\left(p_{ij}\right)=\beta_{0,i}+\beta_1L_{ij}+\beta_2S_{ij}+\beta_3L_{ij}S_{ij}+\gamma_i\]</span>
<span class="math display">\[\beta_{0,i} \sim Normal\left(\mu_{\beta_0},\sigma_{\beta_0}\right)\]</span></p>
<p>In this format, the combined intercept <span class="math inline">\(\beta_{0,i}\)</span>, is equivalent to <span class="math inline">\(\left( \beta_0 + \gamma_i \right)\)</span> for each group <em>i</em>. This is the way I prefer to write GLMM formulas because it makes it more clear what the random effects are really doing.</p>
<p>GLMM can be fit with <code>lme4::glmer()</code>:</p>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="mod-07.html#cb1530-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1530-2"><a href="mod-07.html#cb1530-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(y<span class="sc">~</span>len<span class="sc">*</span>sex<span class="sc">+</span>(<span class="dv">1</span><span class="sc">|</span>Farm), <span class="at">data=</span>dat, <span class="at">family=</span>binomial)</span>
<span id="cb1530-3"><a href="mod-07.html#cb1530-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ len * sex + (1 | Farm)
##    Data: dat
## 
##      AIC      BIC   logLik deviance df.resid 
##    832.6    856.1   -411.3    822.6      821 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -6.2678 -0.6090  0.2809  0.5022  3.4546 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  Farm   (Intercept) 2.391    1.546   
## Number of obs: 826, groups:  Farm, 24
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 0.938969   0.356004   2.638  0.00835 ** 
## len         0.038964   0.006917   5.633 1.77e-08 ***
## sexm        0.624487   0.222938   2.801  0.00509 ** 
## len:sexm    0.035859   0.011409   3.143  0.00167 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Correlation of Fixed Effects:
##          (Intr) len    sexm  
## len      -0.107              
## sexm     -0.189  0.238       
## len:sexm  0.091 -0.514  0.232</code></pre>
<p>The model is essentially an ANCOVA model (continuous predictor that interacts with a factor, <code>sex</code>) fit as a binomial GLM (logistic regression) with a random effect of another factor (<code>Farm</code>). Interpreting the fixed effects length (<code>len</code>) and <code>sex</code> is a little tricky because of the interaction. We have to be careful and think about which observations each coefficient applies to:</p>
<ul>
<li>The printed intercept, <code>(Intercept)</code>, of 0.939 is the intercept for the baseline <code>sex</code>, females, regardless of farm effects.</li>
<li>The printed coefficient for length (<code>len</code>), 0.038, is the slope for the baseline <code>sex</code> (females).</li>
<li>The intercept for males is the baseline intercept plus the effect of being male: 0.9389 + 0.6244 = 1.5634.</li>
<li>The slope for males is the baseline slope plus the effect of being male on the slope: 0.0389 + 0.0358 = 0.0748.</li>
</ul>
<p>Thus, the fixed effects for females are:</p>
<p><span class="math display">\[logit\left(p_j\right)=0.939+0.038L_j\]</span></p>
<p>And the fixed effects for males are:</p>
<p><span class="math display">\[logit\left(p_j\right)=\left(0.939+0.624\right)+\left(0.039+0.036\right)L_j=1.563+0.075L_j\]</span></p>
<p>Now let’s plot the model predictions against the original data. We’ll assemble a new dataset that covers the domain of <em>x</em> values (centered lengths), both sexes, and the 24 farms.</p>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1532-1"><a href="mod-07.html#cb1532-1" aria-hidden="true" tabindex="-1"></a>farms <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>Farm))</span>
<span id="cb1532-2"><a href="mod-07.html#cb1532-2" aria-hidden="true" tabindex="-1"></a>nfarm <span class="ot">&lt;-</span> <span class="fu">length</span>(farms)</span>
<span id="cb1532-3"><a href="mod-07.html#cb1532-3" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(len<span class="sc">~</span>sex, <span class="at">data=</span>dat, range)</span>
<span id="cb1532-4"><a href="mod-07.html#cb1532-4" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> agg[[<span class="dv">2</span>]]</span>
<span id="cb1532-5"><a href="mod-07.html#cb1532-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1532-6"><a href="mod-07.html#cb1532-6" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1532-7"><a href="mod-07.html#cb1532-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex=</span><span class="st">&quot;f&quot;</span>,</span>
<span id="cb1532-8"><a href="mod-07.html#cb1532-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">len=</span><span class="fu">seq</span>(agg[<span class="dv">1</span>,<span class="dv">1</span>], agg[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">length=</span>n),</span>
<span id="cb1532-9"><a href="mod-07.html#cb1532-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Farm=</span>farms)</span>
<span id="cb1532-10"><a href="mod-07.html#cb1532-10" aria-hidden="true" tabindex="-1"></a>dx2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb1532-11"><a href="mod-07.html#cb1532-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex=</span><span class="st">&quot;m&quot;</span>,</span>
<span id="cb1532-12"><a href="mod-07.html#cb1532-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">len=</span><span class="fu">seq</span>(agg[<span class="dv">2</span>,<span class="dv">1</span>], agg[<span class="dv">2</span>,<span class="dv">2</span>], <span class="at">length=</span>n),</span>
<span id="cb1532-13"><a href="mod-07.html#cb1532-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Farm=</span>farms)</span>
<span id="cb1532-14"><a href="mod-07.html#cb1532-14" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dx1, dx2)</span></code></pre></div>
<p>Now generate the predictions:</p>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="mod-07.html#cb1533-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx), <span class="at">type=</span><span class="st">&quot;link&quot;</span>)</span>
<span id="cb1533-2"><a href="mod-07.html#cb1533-2" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>y <span class="ot">&lt;-</span> pred</span>
<span id="cb1533-3"><a href="mod-07.html#cb1533-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1533-4"><a href="mod-07.html#cb1533-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1533-5"><a href="mod-07.html#cb1533-5" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>py <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx<span class="sc">$</span>y)</span></code></pre></div>
<p>The predictions we just calculated are specific to each farm. The “average” probability, which ignores farm, can be obtained either predicting without random effects (safest), by manual calculation using the fixed effects (more trouble but generally okay) or by averaging across levels of the random effect (not recommended). The first two methods are demonstrated below, but we’re going to use the outputs from the first.</p>
<div class="sourceCode" id="cb1534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1534-1"><a href="mod-07.html#cb1534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># method 1: predict with re.form=NA</span></span>
<span id="cb1534-2"><a href="mod-07.html#cb1534-2" aria-hidden="true" tabindex="-1"></a>dx3 <span class="ot">&lt;-</span> dx[<span class="fu">which</span>(dx<span class="sc">$</span>Farm <span class="sc">==</span> farms[<span class="dv">1</span>]),]</span>
<span id="cb1534-3"><a href="mod-07.html#cb1534-3" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1,</span>
<span id="cb1534-4"><a href="mod-07.html#cb1534-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span><span class="fu">data.frame</span>(dx3),</span>
<span id="cb1534-5"><a href="mod-07.html#cb1534-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">re.form=</span><span class="cn">NA</span>)</span>
<span id="cb1534-6"><a href="mod-07.html#cb1534-6" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>py <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx3<span class="sc">$</span>y)</span>
<span id="cb1534-7"><a href="mod-07.html#cb1534-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-8"><a href="mod-07.html#cb1534-8" aria-hidden="true" tabindex="-1"></a><span class="co"># method 1 ver. 2: predict to a new level of the random effect</span></span>
<span id="cb1534-9"><a href="mod-07.html#cb1534-9" aria-hidden="true" tabindex="-1"></a>dx5 <span class="ot">&lt;-</span> dx[<span class="fu">which</span>(dx<span class="sc">$</span>Farm <span class="sc">==</span> farms[<span class="dv">1</span>]),]</span>
<span id="cb1534-10"><a href="mod-07.html#cb1534-10" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>Farm <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1534-11"><a href="mod-07.html#cb1534-11" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1,</span>
<span id="cb1534-12"><a href="mod-07.html#cb1534-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span><span class="fu">data.frame</span>(dx5),</span>
<span id="cb1534-13"><a href="mod-07.html#cb1534-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">re.form=</span><span class="cn">NA</span>,</span>
<span id="cb1534-14"><a href="mod-07.html#cb1534-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb1534-15"><a href="mod-07.html#cb1534-15" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>py <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx5<span class="sc">$</span>y)</span>
<span id="cb1534-16"><a href="mod-07.html#cb1534-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-17"><a href="mod-07.html#cb1534-17" aria-hidden="true" tabindex="-1"></a><span class="co"># method 2: manually calculate</span></span>
<span id="cb1534-18"><a href="mod-07.html#cb1534-18" aria-hidden="true" tabindex="-1"></a>dx4 <span class="ot">&lt;-</span> dx3</span>
<span id="cb1534-19"><a href="mod-07.html#cb1534-19" aria-hidden="true" tabindex="-1"></a>flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx4<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;f&quot;</span>)</span>
<span id="cb1534-20"><a href="mod-07.html#cb1534-20" aria-hidden="true" tabindex="-1"></a>dx4<span class="sc">$</span>y[flag] <span class="ot">&lt;-</span> <span class="fl">0.939+0.038</span><span class="sc">*</span>dx4<span class="sc">$</span>len[flag]</span>
<span id="cb1534-21"><a href="mod-07.html#cb1534-21" aria-hidden="true" tabindex="-1"></a>dx4<span class="sc">$</span>y[<span class="sc">-</span>flag] <span class="ot">&lt;-</span> <span class="fl">1.563+0.075</span><span class="sc">*</span>dx4<span class="sc">$</span>len[<span class="sc">-</span>flag]</span></code></pre></div>
<p>For clarity, we will plot females and males on separate plots. Also for clarity, we will not plot the data and instead will plot the predicted probabilities.</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="mod-07.html#cb1535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb1535-2"><a href="mod-07.html#cb1535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dx<span class="sc">$</span>len, dx<span class="sc">$</span>py, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1535-3"><a href="mod-07.html#cb1535-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Centered length (cm)&quot;</span>,</span>
<span id="cb1535-4"><a href="mod-07.html#cb1535-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="fu">expression</span>(Probability<span class="sc">~</span>of<span class="sc">~</span><span class="fu">italic</span>(E)<span class="sc">*</span>.<span class="sc">~</span><span class="fu">italic</span>(cervi)<span class="sc">~</span>larvae))</span>
<span id="cb1535-5"><a href="mod-07.html#cb1535-5" aria-hidden="true" tabindex="-1"></a>use.dx <span class="ot">&lt;-</span> dx[<span class="fu">which</span>(dx<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;f&quot;</span>),]</span>
<span id="cb1535-6"><a href="mod-07.html#cb1535-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nfarm){</span>
<span id="cb1535-7"><a href="mod-07.html#cb1535-7" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(use.dx<span class="sc">$</span>Farm <span class="sc">==</span> farms[i])</span>
<span id="cb1535-8"><a href="mod-07.html#cb1535-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(use.dx<span class="sc">$</span>len[flag], use.dx<span class="sc">$</span>py[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1535-9"><a href="mod-07.html#cb1535-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1535-10"><a href="mod-07.html#cb1535-10" aria-hidden="true" tabindex="-1"></a>flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx3<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;f&quot;</span>)</span>
<span id="cb1535-11"><a href="mod-07.html#cb1535-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx3<span class="sc">$</span>len[flag], dx3<span class="sc">$</span>py[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">4</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1535-12"><a href="mod-07.html#cb1535-12" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">&quot;Female deer&quot;</span>)</span>
<span id="cb1535-13"><a href="mod-07.html#cb1535-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1535-14"><a href="mod-07.html#cb1535-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dx<span class="sc">$</span>len, dx<span class="sc">$</span>py, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1535-15"><a href="mod-07.html#cb1535-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Centered length (cm)&quot;</span>,</span>
<span id="cb1535-16"><a href="mod-07.html#cb1535-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="fu">expression</span>(Probability<span class="sc">~</span>of<span class="sc">~</span><span class="fu">italic</span>(E)<span class="sc">*</span>.<span class="sc">~</span><span class="fu">italic</span>(cervi)<span class="sc">~</span>larvae))</span>
<span id="cb1535-17"><a href="mod-07.html#cb1535-17" aria-hidden="true" tabindex="-1"></a>use.dx <span class="ot">&lt;-</span> dx[<span class="fu">which</span>(dx<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;m&quot;</span>),]</span>
<span id="cb1535-18"><a href="mod-07.html#cb1535-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nfarm){</span>
<span id="cb1535-19"><a href="mod-07.html#cb1535-19" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(use.dx<span class="sc">$</span>Farm <span class="sc">==</span> farms[i])</span>
<span id="cb1535-20"><a href="mod-07.html#cb1535-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(use.dx<span class="sc">$</span>len[flag], use.dx<span class="sc">$</span>py[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb1535-21"><a href="mod-07.html#cb1535-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1535-22"><a href="mod-07.html#cb1535-22" aria-hidden="true" tabindex="-1"></a>flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx3<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)</span>
<span id="cb1535-23"><a href="mod-07.html#cb1535-23" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx3<span class="sc">$</span>len[flag], dx3<span class="sc">$</span>py[flag], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">4</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1535-24"><a href="mod-07.html#cb1535-24" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">&quot;Male deer&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-678-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>It is worth asking what the 95% CI of the predicted probability for an “average” farm would be. We can calculate this using some information from the summary of model 1 (see above). The random effects on the intercept for each farm have mean 0 and SD = 1.546. Because this model has only a random intercept, and not a random slope, we can express uncertainty about the predicted value (on the logit scale) by shifting the predicted value up or down. This means that the predicted value (on the logit scale) has a confidence interval defined by a normal distribution with the predicted value as the mean, and a standard deviation of 1.546. For any predicted value <span class="math inline">\(E(logit(p))\)</span>, the 95% CI can be approximated as <span class="math inline">\(E(logit(p)) \pm 1.96\times1.546\)</span>.</p>
<p>In R we can calculate the CI directly using the normal distribution quantile functions:</p>
<div class="sourceCode" id="cb1536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1536-1"><a href="mod-07.html#cb1536-1" aria-hidden="true" tabindex="-1"></a>dx5 <span class="ot">&lt;-</span> dx[<span class="fu">which</span>(dx<span class="sc">$</span>Farm <span class="sc">==</span> farms[<span class="dv">1</span>]),]</span>
<span id="cb1536-2"><a href="mod-07.html#cb1536-2" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>Farm <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb1536-3"><a href="mod-07.html#cb1536-3" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1,</span>
<span id="cb1536-4"><a href="mod-07.html#cb1536-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata=</span><span class="fu">data.frame</span>(dx5),</span>
<span id="cb1536-5"><a href="mod-07.html#cb1536-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">re.form=</span><span class="cn">NA</span>,</span>
<span id="cb1536-6"><a href="mod-07.html#cb1536-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">allow.new.levels=</span><span class="cn">TRUE</span>)</span>
<span id="cb1536-7"><a href="mod-07.html#cb1536-7" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, dx5<span class="sc">$</span>y, <span class="fl">1.546</span>)</span>
<span id="cb1536-8"><a href="mod-07.html#cb1536-8" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, dx5<span class="sc">$</span>y, <span class="fl">1.546</span>)</span>
<span id="cb1536-9"><a href="mod-07.html#cb1536-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1536-10"><a href="mod-07.html#cb1536-10" aria-hidden="true" tabindex="-1"></a><span class="co"># inverse link function</span></span>
<span id="cb1536-11"><a href="mod-07.html#cb1536-11" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>py <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx5<span class="sc">$</span>y)</span>
<span id="cb1536-12"><a href="mod-07.html#cb1536-12" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>plo <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx5<span class="sc">$</span>lo)</span>
<span id="cb1536-13"><a href="mod-07.html#cb1536-13" aria-hidden="true" tabindex="-1"></a>dx5<span class="sc">$</span>pup <span class="ot">&lt;-</span> <span class="fu">plogis</span>(dx5<span class="sc">$</span>up)</span></code></pre></div>
<p>Finally, we can make the plot with the approximated 95% CI:</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="mod-07.html#cb1537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1537-2"><a href="mod-07.html#cb1537-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dx<span class="sc">$</span>len, dx<span class="sc">$</span>py, <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1537-3"><a href="mod-07.html#cb1537-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Centered length (cm)&quot;</span>,</span>
<span id="cb1537-4"><a href="mod-07.html#cb1537-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="fu">expression</span>(Probability<span class="sc">~</span>of<span class="sc">~</span><span class="fu">italic</span>(E)<span class="sc">*</span>.<span class="sc">~</span><span class="fu">italic</span>(cervi)<span class="sc">~</span>larvae))</span>
<span id="cb1537-5"><a href="mod-07.html#cb1537-5" aria-hidden="true" tabindex="-1"></a>flag1 <span class="ot">&lt;-</span> <span class="fu">which</span>(dx5<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;f&quot;</span>)</span>
<span id="cb1537-6"><a href="mod-07.html#cb1537-6" aria-hidden="true" tabindex="-1"></a>flag2 <span class="ot">&lt;-</span> <span class="fu">which</span>(dx5<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)</span>
<span id="cb1537-7"><a href="mod-07.html#cb1537-7" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(dx5<span class="sc">$</span>len[flag1], <span class="fu">rev</span>(dx5<span class="sc">$</span>len[flag1])),</span>
<span id="cb1537-8"><a href="mod-07.html#cb1537-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(dx5<span class="sc">$</span>plo[flag1], <span class="fu">rev</span>(dx5<span class="sc">$</span>pup[flag1])),</span>
<span id="cb1537-9"><a href="mod-07.html#cb1537-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;#FF000030&quot;</span>)</span>
<span id="cb1537-10"><a href="mod-07.html#cb1537-10" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(dx5<span class="sc">$</span>len[flag2], <span class="fu">rev</span>(dx5<span class="sc">$</span>len[flag2])),</span>
<span id="cb1537-11"><a href="mod-07.html#cb1537-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(dx5<span class="sc">$</span>plo[flag2], <span class="fu">rev</span>(dx5<span class="sc">$</span>pup[flag2])),</span>
<span id="cb1537-12"><a href="mod-07.html#cb1537-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;#0000FF30&quot;</span>)</span>
<span id="cb1537-13"><a href="mod-07.html#cb1537-13" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx5<span class="sc">$</span>len[flag1], dx5<span class="sc">$</span>py[flag1], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;red3&quot;</span>)</span>
<span id="cb1537-14"><a href="mod-07.html#cb1537-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx5<span class="sc">$</span>len[flag2], dx5<span class="sc">$</span>py[flag2], <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;blue3&quot;</span>)</span>
<span id="cb1537-15"><a href="mod-07.html#cb1537-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb1537-16"><a href="mod-07.html#cb1537-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;red3&quot;</span>, <span class="st">&quot;blue3&quot;</span>), <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-680-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Because the GLMM we fit was a logistic regression model, you could also calculate an <a href="mod-05.html#mod-05-auc">ROC curve and AUC</a>) to express the predictive accuracy of the model. For other GLMM, you could perform a cross-validation analysis to see how well the model predicts out-of-sample data.</p>
</div>
</div>
<div id="mod-07-nlme" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Nonlinear mixed models (NLME)</h2>
<div id="definition-and-background" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Definition and background</h3>
<p><strong>Nonlinear mixed effects models (NLME)</strong> extend the nonlinear model (NLS) to allow parameters to vary randomly by a factor. In an LMM or GLMM, the parameters that could vary randomly were the intercept and slope (or other coefficients). Because NLS models don’t always have intercepts and slopes, the random effects can potentially apply to any parameter in the model. For example, a mixed effects Michaelis-Menten model might have an asymptote, Michaelis constant, or both that vary randomly between levels of a factor:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-681-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>As you might expect, fitting NLME can be tricky: it combines all of the <a href="mod-06.html#mod-06">difficulties with nonlinear models</a> with those of mixed models! One of the most commonly used options is the <code>nlmer()</code> function from the <code>lme4</code> package. For complicated models you may want to consider using Bayesian inference with JAGS because of the added flexibility afforded by the Markov chain Monte Carlo (MCMC) paradigm.</p>
</div>
<div id="nlme-on-simulated-data" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> NLME on simulated data</h3>
<p>Let’s simulate data that might have come from an enzyme kinetics study. We’ll model reaction rate <em>y</em> as a function of concentration <em>x</em> for some family of substrates. NLME might be a better choice than NLS for such a problem because the selection of substrates is only a sampling of the potential substrates, and the researcher is interested in how reaction rate might vary with concentration for other, untested substrates.</p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1538-1"><a href="mod-07.html#cb1538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1538-2"><a href="mod-07.html#cb1538-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-3"><a href="mod-07.html#cb1538-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data structure: number of substates (nlev)</span></span>
<span id="cb1538-4"><a href="mod-07.html#cb1538-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and replicates per concentration</span></span>
<span id="cb1538-5"><a href="mod-07.html#cb1538-5" aria-hidden="true" tabindex="-1"></a><span class="co"># and substrate (nrep)</span></span>
<span id="cb1538-6"><a href="mod-07.html#cb1538-6" aria-hidden="true" tabindex="-1"></a>nlev <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb1538-7"><a href="mod-07.html#cb1538-7" aria-hidden="true" tabindex="-1"></a>nrep <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1538-8"><a href="mod-07.html#cb1538-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-9"><a href="mod-07.html#cb1538-9" aria-hidden="true" tabindex="-1"></a><span class="co"># concentrations:</span></span>
<span id="cb1538-10"><a href="mod-07.html#cb1538-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">by=</span><span class="fl">0.5</span>)</span>
<span id="cb1538-11"><a href="mod-07.html#cb1538-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-12"><a href="mod-07.html#cb1538-12" aria-hidden="true" tabindex="-1"></a><span class="co"># hyperparameters for a and b</span></span>
<span id="cb1538-13"><a href="mod-07.html#cb1538-13" aria-hidden="true" tabindex="-1"></a>avec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nlev, <span class="dv">129</span>, <span class="dv">12</span>)</span>
<span id="cb1538-14"><a href="mod-07.html#cb1538-14" aria-hidden="true" tabindex="-1"></a>bvec <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(nlev, <span class="dv">22</span>, <span class="dv">12</span>)</span>
<span id="cb1538-15"><a href="mod-07.html#cb1538-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-16"><a href="mod-07.html#cb1538-16" aria-hidden="true" tabindex="-1"></a><span class="co"># assemble dataframe of predictors and parameters</span></span>
<span id="cb1538-17"><a href="mod-07.html#cb1538-17" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">subs=</span><span class="dv">1</span><span class="sc">:</span>nlev, <span class="at">conc=</span>x, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span>nrep)</span>
<span id="cb1538-18"><a href="mod-07.html#cb1538-18" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>a <span class="ot">&lt;-</span> avec[dat<span class="sc">$</span>subs]</span>
<span id="cb1538-19"><a href="mod-07.html#cb1538-19" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>b <span class="ot">&lt;-</span> bvec[dat<span class="sc">$</span>subs]</span>
<span id="cb1538-20"><a href="mod-07.html#cb1538-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-21"><a href="mod-07.html#cb1538-21" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate expected value</span></span>
<span id="cb1538-22"><a href="mod-07.html#cb1538-22" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>mu <span class="ot">&lt;-</span> (dat<span class="sc">$</span>a<span class="sc">*</span>dat<span class="sc">$</span>conc)<span class="sc">/</span>(dat<span class="sc">$</span>b<span class="sc">+</span>dat<span class="sc">$</span>conc)</span>
<span id="cb1538-23"><a href="mod-07.html#cb1538-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-24"><a href="mod-07.html#cb1538-24" aria-hidden="true" tabindex="-1"></a><span class="co"># residual SD and residuals</span></span>
<span id="cb1538-25"><a href="mod-07.html#cb1538-25" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1538-26"><a href="mod-07.html#cb1538-26" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(dat), dat<span class="sc">$</span>mu, sigma)</span>
<span id="cb1538-27"><a href="mod-07.html#cb1538-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-28"><a href="mod-07.html#cb1538-28" aria-hidden="true" tabindex="-1"></a><span class="co"># can&#39;t have negative values</span></span>
<span id="cb1538-29"><a href="mod-07.html#cb1538-29" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, dat<span class="sc">$</span>y)</span>
<span id="cb1538-30"><a href="mod-07.html#cb1538-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-31"><a href="mod-07.html#cb1538-31" aria-hidden="true" tabindex="-1"></a><span class="co"># add colors for plotting</span></span>
<span id="cb1538-32"><a href="mod-07.html#cb1538-32" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(nlev)</span>
<span id="cb1538-33"><a href="mod-07.html#cb1538-33" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[dat<span class="sc">$</span>subs]</span></code></pre></div>
<p>Make a quick plot of expected value in each group (substrate):</p>
<p><img src="_main_files/figure-html/unnamed-chunk-683-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>We can also see the actual data:</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1539-1"><a href="mod-07.html#cb1539-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">jitter</span>(dat<span class="sc">$</span>conc), dat<span class="sc">$</span>y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>dat<span class="sc">$</span>col)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-684-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Faced with these data, we might suspect that the <em>y</em> variable (reaction rate) could be modeled by a Michaelis-Menten (MM) function. However, we might also suspect that there is a lot of variation due to substrate that is not accounted for by a garden variety MM model. If we are not interested in these substrates in particular, but only as representatives of all substrates, then a mixed model is called for. What is not clear is whether the asymptote, Michaelis constant, or both should be random. Fortunately, it is straightforward to test all three variations.</p>
<p>To use <code>nlmer()</code>, you need to specify the model in 3 parts: response, function, and random effects. The parts are separated by tildes (<code>~</code>). Unlike <code>nls()</code>, where the model formula can be provided directly, the model formula in <code>nlmer()</code> must be a function that takes in a predictor and uses named parameters to produce a numeric output. The self-start functions we saw in the <a href="mod-06.html#mod-06-micmen">NLS unit</a> can be used for this, but unlike in <code>nls()</code> you <em>always</em> need to provide starting values. The starting values can be estimated or guessed at by inspecting the scatterplot and thinking about the meaning of each parameter (<a href="mod-06.html#mod-06-micmen-sim">example</a>). Fortunately, the random effects syntax works in much the same way as it does in <code>lmer()</code>.</p>
<div class="sourceCode" id="cb1540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1540-1"><a href="mod-07.html#cb1540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1540-2"><a href="mod-07.html#cb1540-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-3"><a href="mod-07.html#cb1540-3" aria-hidden="true" tabindex="-1"></a><span class="co"># named vector of starting values</span></span>
<span id="cb1540-4"><a href="mod-07.html#cb1540-4" aria-hidden="true" tabindex="-1"></a>startvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a=</span><span class="dv">120</span>, <span class="at">b=</span><span class="dv">25</span>)</span>
<span id="cb1540-5"><a href="mod-07.html#cb1540-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-6"><a href="mod-07.html#cb1540-6" aria-hidden="true" tabindex="-1"></a><span class="co"># model 1: random asymptote</span></span>
<span id="cb1540-7"><a href="mod-07.html#cb1540-7" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(y<span class="sc">~</span><span class="fu">SSmicmen</span>(conc, a, b)<span class="sc">~</span>a<span class="sc">|</span>subs,</span>
<span id="cb1540-8"><a href="mod-07.html#cb1540-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1540-9"><a href="mod-07.html#cb1540-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-10"><a href="mod-07.html#cb1540-10" aria-hidden="true" tabindex="-1"></a><span class="co"># model 2: random Michaelis constant</span></span>
<span id="cb1540-11"><a href="mod-07.html#cb1540-11" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(y<span class="sc">~</span><span class="fu">SSmicmen</span>(conc, a, b)<span class="sc">~</span>b<span class="sc">|</span>subs,</span>
<span id="cb1540-12"><a href="mod-07.html#cb1540-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1540-13"><a href="mod-07.html#cb1540-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-14"><a href="mod-07.html#cb1540-14" aria-hidden="true" tabindex="-1"></a><span class="co"># model 3: random both parameters</span></span>
<span id="cb1540-15"><a href="mod-07.html#cb1540-15" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(y<span class="sc">~</span><span class="fu">SSmicmen</span>(conc, a, b)<span class="sc">~</span>(a<span class="sc">|</span>subs)<span class="sc">+</span>(b<span class="sc">|</span>subs),</span>
<span id="cb1540-16"><a href="mod-07.html#cb1540-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span></code></pre></div>
<p>The parameter estimates of all three models are close to the true values. We can compare the fit of the models using AIC and find that model 3 has the best fit. This should not be surprising because model 3 is the correct one.</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="mod-07.html#cb1541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod1, mod2, mod3)</span></code></pre></div>
<pre><code>##      df      AIC
## mod1  4 1563.909
## mod2  4 1573.510
## mod3  5 1561.939</code></pre>
<p>Unfortunately, generating predictions for <code>nlmer()</code> models is not straightforward<a href="literature-cited.html#fn75" class="footnote-ref" id="fnref75"><sup>75</sup></a>. So, let’s use a different method of model fitting: Markov chain Monte Carlo (MCMC). You’ll need a separate program, JAGS <span class="citation">(<a href="#ref-plummer2003jags" role="doc-biblioref">Plummer 2003</a>)</span>, and the R packages rjags <span class="citation">(<a href="#ref-plummer2021" role="doc-biblioref">Plummer 2021</a>)</span> and R2jags <span class="citation">(<a href="#ref-su2021" role="doc-biblioref">Su and Masanao Yajima 2021</a>)</span>. The general procedure for using JAGS is to first write the model to a text file using <code>sink()</code>, then call JAGS from within R. JAGS will then read the text file and fit the model. The code block below will write the model file to your current R working directory.</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1543-1"><a href="mod-07.html#cb1543-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write model file</span></span>
<span id="cb1543-2"><a href="mod-07.html#cb1543-2" aria-hidden="true" tabindex="-1"></a>mod.name <span class="ot">&lt;-</span> <span class="st">&quot;nlme_mod03.txt&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1544-1"><a href="mod-07.html#cb1544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sink</span>(mod.name)</span>
<span id="cb1544-2"><a href="mod-07.html#cb1544-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span></span>
<span id="cb1544-3"><a href="mod-07.html#cb1544-3" aria-hidden="true" tabindex="-1"></a><span class="st">    model{</span></span>
<span id="cb1544-4"><a href="mod-07.html#cb1544-4" aria-hidden="true" tabindex="-1"></a><span class="st">        # priors</span></span>
<span id="cb1544-5"><a href="mod-07.html#cb1544-5" aria-hidden="true" tabindex="-1"></a><span class="st">        ## hyperparameters</span></span>
<span id="cb1544-6"><a href="mod-07.html#cb1544-6" aria-hidden="true" tabindex="-1"></a><span class="st">        mu.a ~ dunif(1, 200)</span></span>
<span id="cb1544-7"><a href="mod-07.html#cb1544-7" aria-hidden="true" tabindex="-1"></a><span class="st">        sd.a ~ dunif(1, 20)</span></span>
<span id="cb1544-8"><a href="mod-07.html#cb1544-8" aria-hidden="true" tabindex="-1"></a><span class="st">        mu.b ~ dunif(1, 200)</span></span>
<span id="cb1544-9"><a href="mod-07.html#cb1544-9" aria-hidden="true" tabindex="-1"></a><span class="st">        sd.b ~ dunif(1, 20)</span></span>
<span id="cb1544-10"><a href="mod-07.html#cb1544-10" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1544-11"><a href="mod-07.html#cb1544-11" aria-hidden="true" tabindex="-1"></a><span class="st">        ## precision of a and b</span></span>
<span id="cb1544-12"><a href="mod-07.html#cb1544-12" aria-hidden="true" tabindex="-1"></a><span class="st">        tau.a &lt;- 1/(sd.a * sd.a)</span></span>
<span id="cb1544-13"><a href="mod-07.html#cb1544-13" aria-hidden="true" tabindex="-1"></a><span class="st">        tau.b &lt;- 1/(sd.b * sd.b)</span></span>
<span id="cb1544-14"><a href="mod-07.html#cb1544-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-15"><a href="mod-07.html#cb1544-15" aria-hidden="true" tabindex="-1"></a><span class="st">        ## parameters</span></span>
<span id="cb1544-16"><a href="mod-07.html#cb1544-16" aria-hidden="true" tabindex="-1"></a><span class="st">        for(i in 1:nlev){</span></span>
<span id="cb1544-17"><a href="mod-07.html#cb1544-17" aria-hidden="true" tabindex="-1"></a><span class="st">            a.vec[i]~dnorm(mu.a, tau.a)</span></span>
<span id="cb1544-18"><a href="mod-07.html#cb1544-18" aria-hidden="true" tabindex="-1"></a><span class="st">            b.vec[i]~dnorm(mu.b, tau.b)</span></span>
<span id="cb1544-19"><a href="mod-07.html#cb1544-19" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb1544-20"><a href="mod-07.html#cb1544-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-21"><a href="mod-07.html#cb1544-21" aria-hidden="true" tabindex="-1"></a><span class="st">        ## residual SD and precision (tau)</span></span>
<span id="cb1544-22"><a href="mod-07.html#cb1544-22" aria-hidden="true" tabindex="-1"></a><span class="st">        sigma ~ dunif(0, 1e4)</span></span>
<span id="cb1544-23"><a href="mod-07.html#cb1544-23" aria-hidden="true" tabindex="-1"></a><span class="st">        tau.y &lt;- 1 / (sigma * sigma)</span></span>
<span id="cb1544-24"><a href="mod-07.html#cb1544-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-25"><a href="mod-07.html#cb1544-25" aria-hidden="true" tabindex="-1"></a><span class="st">        # likelihood</span></span>
<span id="cb1544-26"><a href="mod-07.html#cb1544-26" aria-hidden="true" tabindex="-1"></a><span class="st">        for(i in 1:N){</span></span>
<span id="cb1544-27"><a href="mod-07.html#cb1544-27" aria-hidden="true" tabindex="-1"></a><span class="st">            y[i] ~ dnorm(eta[i], tau.y)</span></span>
<span id="cb1544-28"><a href="mod-07.html#cb1544-28" aria-hidden="true" tabindex="-1"></a><span class="st">            eta[i] &lt;- (a.vec[levs[i]] *</span></span>
<span id="cb1544-29"><a href="mod-07.html#cb1544-29" aria-hidden="true" tabindex="-1"></a><span class="st">                x[i])/(b.vec[levs[i]]+x[i])</span></span>
<span id="cb1544-30"><a href="mod-07.html#cb1544-30" aria-hidden="true" tabindex="-1"></a><span class="st">        }# i for N</span></span>
<span id="cb1544-31"><a href="mod-07.html#cb1544-31" aria-hidden="true" tabindex="-1"></a><span class="st">    }#model</span></span>
<span id="cb1544-32"><a href="mod-07.html#cb1544-32" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>, <span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb1544-33"><a href="mod-07.html#cb1544-33" aria-hidden="true" tabindex="-1"></a><span class="fu">sink</span>()</span></code></pre></div>
<p>Next, package the data up for JAGS. Any value or set of values used in the model must be included by name in a list.</p>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="mod-07.html#cb1545-1" aria-hidden="true" tabindex="-1"></a><span class="co"># package data for JAGS</span></span>
<span id="cb1545-2"><a href="mod-07.html#cb1545-2" aria-hidden="true" tabindex="-1"></a>in.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y=</span>dat<span class="sc">$</span>y,</span>
<span id="cb1545-3"><a href="mod-07.html#cb1545-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">x=</span>dat<span class="sc">$</span>conc,</span>
<span id="cb1545-4"><a href="mod-07.html#cb1545-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">levs=</span>dat<span class="sc">$</span>subs,</span>
<span id="cb1545-5"><a href="mod-07.html#cb1545-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">N=</span><span class="fu">nrow</span>(dat),</span>
<span id="cb1545-6"><a href="mod-07.html#cb1545-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">nlev=</span>nlev</span>
<span id="cb1545-7"><a href="mod-07.html#cb1545-7" aria-hidden="true" tabindex="-1"></a>                )</span></code></pre></div>
<p>Any value that is not fixed (i.e., part of the input data) must be supplied with an initial value. It doesn’t matter much what this value is, as long as it is within the proper domain of the variable. For example, initial values for the <span class="math inline">\(\lambda\)</span> parameter of a Poisson distribution must be <span class="math inline">\(\ge\)</span> 0. The initial values must be stored in a list that has one element for each MCMC chain. I prefer to define a function that generates initial values automatically, in case I ever want to change the number of chains.</p>
<div class="sourceCode" id="cb1546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1546-1"><a href="mod-07.html#cb1546-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define initial values for MCMC chains</span></span>
<span id="cb1546-2"><a href="mod-07.html#cb1546-2" aria-hidden="true" tabindex="-1"></a>init.fun <span class="ot">&lt;-</span> <span class="cf">function</span>(nc){</span>
<span id="cb1546-3"><a href="mod-07.html#cb1546-3" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="at">length=</span>nc)</span>
<span id="cb1546-4"><a href="mod-07.html#cb1546-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nc){</span>
<span id="cb1546-5"><a href="mod-07.html#cb1546-5" aria-hidden="true" tabindex="-1"></a>        res[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1546-6"><a href="mod-07.html#cb1546-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu.a=</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">200</span>),            </span>
<span id="cb1546-7"><a href="mod-07.html#cb1546-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd.a=</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">20</span>),</span>
<span id="cb1546-8"><a href="mod-07.html#cb1546-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu.b=</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">200</span>),            </span>
<span id="cb1546-9"><a href="mod-07.html#cb1546-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd.b=</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">20</span>), </span>
<span id="cb1546-10"><a href="mod-07.html#cb1546-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">a.vec=</span><span class="fu">runif</span>(nlev, <span class="dv">1</span>, <span class="dv">200</span>),</span>
<span id="cb1546-11"><a href="mod-07.html#cb1546-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">b.vec=</span><span class="fu">runif</span>(nlev, <span class="dv">1</span>, <span class="dv">20</span>),</span>
<span id="cb1546-12"><a href="mod-07.html#cb1546-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">sigma=</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="dv">20</span>))</span>
<span id="cb1546-13"><a href="mod-07.html#cb1546-13" aria-hidden="true" tabindex="-1"></a>    }<span class="co">#i</span></span>
<span id="cb1546-14"><a href="mod-07.html#cb1546-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb1546-15"><a href="mod-07.html#cb1546-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, set some parameters that control how JAGS will run. For actual inference, use a number of iterations <span class="math inline">\(\ge\)</span> 100,000 (<code>n.iter</code>) and a burn-in length (<code>n.burn</code>) of about 20% of the total number of iterations. A large thinning interval (<code>n.thin</code>) is needed to mitigate autocorrelation of the MCMC chains; 100 is commonly used. These values are probably larger than needed for JAGS, but not larger than needed for OpenBUGS or WinBUGS<a href="literature-cited.html#fn76" class="footnote-ref" id="fnref76"><sup>76</sup></a>. The final size of your posterior samples—i.e., the number of draws from the posterior distribution that can be used for inference—is equal to:</p>
<p><span class="math display">\[n_{post}=n_{chains}\left(\frac{n_{iter}-n_{burn}}{n_{thin}}\right)\]</span></p>
<p>Set the last few parameters and send the model to JAGS:</p>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="mod-07.html#cb1547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjags)</span>
<span id="cb1547-2"><a href="mod-07.html#cb1547-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R2jags)</span>
<span id="cb1547-3"><a href="mod-07.html#cb1547-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-4"><a href="mod-07.html#cb1547-4" aria-hidden="true" tabindex="-1"></a>nchains <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1547-5"><a href="mod-07.html#cb1547-5" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">init.fun</span>(nchains)</span>
<span id="cb1547-6"><a href="mod-07.html#cb1547-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-7"><a href="mod-07.html#cb1547-7" aria-hidden="true" tabindex="-1"></a><span class="co"># parameters to monitor</span></span>
<span id="cb1547-8"><a href="mod-07.html#cb1547-8" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mu.a&quot;</span>, <span class="st">&quot;sd.a&quot;</span>, <span class="st">&quot;mu.b&quot;</span>, <span class="st">&quot;sd.b&quot;</span>, <span class="st">&quot;sigma&quot;</span>,</span>
<span id="cb1547-9"><a href="mod-07.html#cb1547-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;a.vec&quot;</span>, <span class="st">&quot;b.vec&quot;</span>)</span>
<span id="cb1547-10"><a href="mod-07.html#cb1547-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-11"><a href="mod-07.html#cb1547-11" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC parameters</span></span>
<span id="cb1547-12"><a href="mod-07.html#cb1547-12" aria-hidden="true" tabindex="-1"></a>n.iter <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb1547-13"><a href="mod-07.html#cb1547-13" aria-hidden="true" tabindex="-1"></a>n.burnin <span class="ot">&lt;-</span> <span class="fl">1e2</span></span>
<span id="cb1547-14"><a href="mod-07.html#cb1547-14" aria-hidden="true" tabindex="-1"></a>n.thin <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1547-15"><a href="mod-07.html#cb1547-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-16"><a href="mod-07.html#cb1547-16" aria-hidden="true" tabindex="-1"></a>mod3j <span class="ot">&lt;-</span> <span class="fu">jags</span>(<span class="at">data=</span>in.data, <span class="at">inits=</span>inits,</span>
<span id="cb1547-17"><a href="mod-07.html#cb1547-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">parameters.to.save=</span>params,</span>
<span id="cb1547-18"><a href="mod-07.html#cb1547-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">model.file=</span>mod.name,</span>
<span id="cb1547-19"><a href="mod-07.html#cb1547-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">n.chains=</span>nchains, <span class="at">n.iter=</span>n.iter,</span>
<span id="cb1547-20"><a href="mod-07.html#cb1547-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">n.burnin=</span>n.burnin, <span class="at">n.thin=</span>n.thin)<span class="co">#jags</span></span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 216
##    Unobserved stochastic nodes: 21
##    Total graph size: 909
## 
## Initializing model
## 
## 
  |                                                        
  |                                                  |   0%
  |                                                        
  |++++++++++++++++++++++++++++++++++++++++++++++++++| 100%
## 
  |                                                        
  |                                                  |   0%
  |                                                        
  |*                                                 |   2%
  |                                                        
  |**                                                |   4%
  |                                                        
  |***                                               |   6%
  |                                                        
  |****                                              |   8%
  |                                                        
  |*****                                             |  10%
  |                                                        
  |******                                            |  12%
  |                                                        
  |*******                                           |  14%
  |                                                        
  |********                                          |  16%
  |                                                        
  |*********                                         |  18%
  |                                                        
  |**********                                        |  20%
  |                                                        
  |***********                                       |  22%
  |                                                        
  |************                                      |  24%
  |                                                        
  |*************                                     |  27%
  |                                                        
  |**************                                    |  29%
  |                                                        
  |***************                                   |  31%
  |                                                        
  |****************                                  |  33%
  |                                                        
  |*****************                                 |  35%
  |                                                        
  |******************                                |  37%
  |                                                        
  |*******************                               |  39%
  |                                                        
  |********************                              |  41%
  |                                                        
  |*********************                             |  43%
  |                                                        
  |**********************                            |  45%
  |                                                        
  |***********************                           |  47%
  |                                                        
  |************************                          |  49%
  |                                                        
  |**************************                        |  51%
  |                                                        
  |***************************                       |  53%
  |                                                        
  |****************************                      |  55%
  |                                                        
  |*****************************                     |  57%
  |                                                        
  |******************************                    |  59%
  |                                                        
  |*******************************                   |  61%
  |                                                        
  |********************************                  |  63%
  |                                                        
  |*********************************                 |  65%
  |                                                        
  |**********************************                |  67%
  |                                                        
  |***********************************               |  69%
  |                                                        
  |************************************              |  71%
  |                                                        
  |*************************************             |  73%
  |                                                        
  |**************************************            |  76%
  |                                                        
  |***************************************           |  78%
  |                                                        
  |****************************************          |  80%
  |                                                        
  |*****************************************         |  82%
  |                                                        
  |******************************************        |  84%
  |                                                        
  |*******************************************       |  86%
  |                                                        
  |********************************************      |  88%
  |                                                        
  |*********************************************     |  90%
  |                                                        
  |**********************************************    |  92%
  |                                                        
  |***********************************************   |  94%
  |                                                        
  |************************************************  |  96%
  |                                                        
  |************************************************* |  98%
  |                                                        
  |**************************************************| 100%</code></pre>
<p>The most important part of the output is here obtained by printing the model object to the console:</p>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="mod-07.html#cb1549-1" aria-hidden="true" tabindex="-1"></a>mod3j</span></code></pre></div>
<pre><code>## Inference for Bugs model at &quot;nlme_mod03.txt&quot;, fit using jags,
##  3 chains, each with 5000 iterations (first 100 discarded), n.thin = 100
##  n.sims = 147 iterations saved
##           mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat
## a.vec[1]  128.513   6.888  116.049  123.847  128.003  133.146  142.769 0.995
## a.vec[2]  124.844   7.369  112.265  119.553  123.998  129.427  141.065 1.027
## a.vec[3]  131.011   8.392  117.081  125.895  129.974  135.282  149.705 1.002
## a.vec[4]  128.561   7.784  114.009  123.471  128.797  133.397  143.299 1.018
## a.vec[5]  130.787   8.030  116.861  125.303  129.991  135.742  146.610 1.034
## a.vec[6]  141.115   7.310  128.492  136.745  139.739  145.799  157.006 1.030
## a.vec[7]  157.374   8.199  142.347  152.461  156.953  161.871  173.935 1.023
## a.vec[8]  112.327   9.903   94.144  105.211  111.992  118.570  132.351 0.999
## b.vec[1]   17.655   3.048   12.552   15.310   17.434   19.692   23.174 0.998
## b.vec[2]   17.503   3.452   12.110   14.843   17.549   19.415   24.899 1.045
## b.vec[3]   30.481   5.581   21.453   27.065   29.868   33.323   43.953 1.004
## b.vec[4]   25.801   4.611   18.427   22.587   25.446   28.601   35.398 0.993
## b.vec[5]   22.084   3.786   15.758   19.649   21.693   24.311   29.921 1.026
## b.vec[6]   22.279   3.304   17.169   19.847   21.889   24.332   29.111 1.015
## b.vec[7]   23.264   3.522   17.293   20.870   22.635   25.248   30.658 1.036
## b.vec[8]   38.488   8.071   25.234   32.215   37.642   44.289   55.795 1.007
## mu.a      131.686   5.700  120.606  128.297  131.977  135.282  143.156 0.999
## mu.b       24.845   3.978   18.438   22.266   24.084   27.565   32.609 1.018
## sd.a       14.226   3.392    7.310   11.971   14.170   16.999   19.760 1.064
## sd.b        9.087   3.613    3.604    6.349    8.695   11.196   17.040 1.037
## sigma       8.244   0.411    7.515    7.919    8.222    8.496    9.086 1.017
## deviance 1523.397   6.499 1513.634 1518.874 1522.689 1526.226 1537.916 1.080
##          n.eff
## a.vec[1]   150
## a.vec[2]    75
## a.vec[3]   150
## a.vec[4]   150
## a.vec[5]    68
## a.vec[6]   150
## a.vec[7]   140
## a.vec[8]   150
## b.vec[1]   150
## b.vec[2]    58
## b.vec[3]   150
## b.vec[4]   150
## b.vec[5]    67
## b.vec[6]   140
## b.vec[7]    76
## b.vec[8]   120
## mu.a       150
## mu.b       150
## sd.a        83
## sd.b        75
## sigma      150
## deviance    35
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 20.2 and DIC = 1543.5
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p>Unlike <code>lmer()</code>, <code>glmer()</code>, and <code>nlmer()</code>, an MCMC output automatically contains estimates of the region in which value of each parameter is likely to fall. However, instead of being called “confidence intervals” (CI), these intervals are called <strong>credible intervals (CRI)</strong>. The difference between a CI and a CRI is in how they are calculated. CI are calculated using the estimated mean, SE, and properties of the normal distribution. CRI, on the other hand, are simply quantiles of the posterior distribution of the parameter. This means that CRI are inherently Bayesian and only defined in Bayesian inference; CI are frequentist and used in non-Bayesian context. CRI have the distinct advantage of not assuming anything about the appropriate distribution for the parameter.</p>
<p>Other outputs of MCMC can be used to calculate model predictions and their 95% CRI. Let’s use the posterior draws to calculate model predictions. The posteriors are stored in several ways within the JAGS output. For generating predictions and CRI, we should use the values in the <code>sims.matrix</code> part of the output, which have already been permuted (this reduces bias in the predictions).</p>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="mod-07.html#cb1551-1" aria-hidden="true" tabindex="-1"></a>po <span class="ot">&lt;-</span> mod3j<span class="sc">$</span>BUGSoutput<span class="sc">$</span>sims.matrix</span>
<span id="cb1551-2"><a href="mod-07.html#cb1551-2" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="fu">nrow</span>(po)</span>
<span id="cb1551-3"><a href="mod-07.html#cb1551-3" aria-hidden="true" tabindex="-1"></a>a.cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;a.vec&quot;</span>, <span class="fu">colnames</span>(po))</span>
<span id="cb1551-4"><a href="mod-07.html#cb1551-4" aria-hidden="true" tabindex="-1"></a>b.cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;b.vec&quot;</span>, <span class="fu">colnames</span>(po))</span>
<span id="cb1551-5"><a href="mod-07.html#cb1551-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-6"><a href="mod-07.html#cb1551-6" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1551-7"><a href="mod-07.html#cb1551-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>conc), <span class="fu">max</span>(dat<span class="sc">$</span>conc), <span class="at">length=</span>pn)</span>
<span id="cb1551-8"><a href="mod-07.html#cb1551-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-9"><a href="mod-07.html#cb1551-9" aria-hidden="true" tabindex="-1"></a><span class="co"># version 1: full random effects</span></span>
<span id="cb1551-10"><a href="mod-07.html#cb1551-10" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">subs=</span><span class="dv">1</span><span class="sc">:</span>nlev, <span class="at">conc=</span>x)</span>
<span id="cb1551-11"><a href="mod-07.html#cb1551-11" aria-hidden="true" tabindex="-1"></a>dy1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">nrow</span>(dx1), <span class="at">ncol=</span>nsim)</span>
<span id="cb1551-12"><a href="mod-07.html#cb1551-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dx1)){</span>
<span id="cb1551-13"><a href="mod-07.html#cb1551-13" aria-hidden="true" tabindex="-1"></a>    ilev <span class="ot">&lt;-</span> dx1<span class="sc">$</span>subs[i]</span>
<span id="cb1551-14"><a href="mod-07.html#cb1551-14" aria-hidden="true" tabindex="-1"></a>    use.ac <span class="ot">&lt;-</span> a.cols[ilev]</span>
<span id="cb1551-15"><a href="mod-07.html#cb1551-15" aria-hidden="true" tabindex="-1"></a>    use.bc <span class="ot">&lt;-</span> b.cols[ilev]</span>
<span id="cb1551-16"><a href="mod-07.html#cb1551-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb1551-17"><a href="mod-07.html#cb1551-17" aria-hidden="true" tabindex="-1"></a>        use.a <span class="ot">&lt;-</span> po[j, use.ac]</span>
<span id="cb1551-18"><a href="mod-07.html#cb1551-18" aria-hidden="true" tabindex="-1"></a>        use.b <span class="ot">&lt;-</span> po[j, use.bc]</span>
<span id="cb1551-19"><a href="mod-07.html#cb1551-19" aria-hidden="true" tabindex="-1"></a>        dy1[i,j] <span class="ot">&lt;-</span> (use.a<span class="sc">*</span>dx1<span class="sc">$</span>conc[i])<span class="sc">/</span>(use.b<span class="sc">+</span>dx1<span class="sc">$</span>conc[i])</span>
<span id="cb1551-20"><a href="mod-07.html#cb1551-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1551-21"><a href="mod-07.html#cb1551-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1551-22"><a href="mod-07.html#cb1551-22" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy1, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb1551-23"><a href="mod-07.html#cb1551-23" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>mn <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy1, <span class="dv">1</span>, quantile, <span class="fl">0.5</span>)</span>
<span id="cb1551-24"><a href="mod-07.html#cb1551-24" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy1, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb1551-25"><a href="mod-07.html#cb1551-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-26"><a href="mod-07.html#cb1551-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-27"><a href="mod-07.html#cb1551-27" aria-hidden="true" tabindex="-1"></a><span class="co"># version 2: no random effects</span></span>
<span id="cb1551-28"><a href="mod-07.html#cb1551-28" aria-hidden="true" tabindex="-1"></a>dx2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">conc=</span>x)</span>
<span id="cb1551-29"><a href="mod-07.html#cb1551-29" aria-hidden="true" tabindex="-1"></a>dy2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow=</span><span class="fu">nrow</span>(dx2), <span class="at">ncol=</span><span class="fu">nrow</span>(po))</span>
<span id="cb1551-30"><a href="mod-07.html#cb1551-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dx2)){</span>
<span id="cb1551-31"><a href="mod-07.html#cb1551-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim){</span>
<span id="cb1551-32"><a href="mod-07.html#cb1551-32" aria-hidden="true" tabindex="-1"></a>        dy2[i,j] <span class="ot">&lt;-</span> po[j,<span class="st">&quot;mu.a&quot;</span>]<span class="sc">*</span>dx2<span class="sc">$</span>conc[i]<span class="sc">/</span>(po[j,<span class="st">&quot;mu.b&quot;</span>]<span class="sc">+</span>dx2<span class="sc">$</span>conc[i])</span>
<span id="cb1551-33"><a href="mod-07.html#cb1551-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1551-34"><a href="mod-07.html#cb1551-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1551-35"><a href="mod-07.html#cb1551-35" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy2, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>)</span>
<span id="cb1551-36"><a href="mod-07.html#cb1551-36" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>mn <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy2, <span class="dv">1</span>, quantile, <span class="fl">0.5</span>)</span>
<span id="cb1551-37"><a href="mod-07.html#cb1551-37" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">apply</span>(dy2, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>)</span></code></pre></div>
<p>Now make the plot:</p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="mod-07.html#cb1552-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dx2<span class="sc">$</span>conc, dx2<span class="sc">$</span>mn, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1552-2"><a href="mod-07.html#cb1552-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="st">&quot;Concentration (units)&quot;</span>,</span>
<span id="cb1552-3"><a href="mod-07.html#cb1552-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="st">&quot;Reaction rate (units)&quot;</span>,</span>
<span id="cb1552-4"><a href="mod-07.html#cb1552-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span>
<span id="cb1552-5"><a href="mod-07.html#cb1552-5" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="at">x=</span><span class="fu">c</span>(dx2<span class="sc">$</span>conc, <span class="fu">rev</span>(dx2<span class="sc">$</span>conc)),</span>
<span id="cb1552-6"><a href="mod-07.html#cb1552-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(dx2<span class="sc">$</span>lo, <span class="fu">rev</span>(dx2<span class="sc">$</span>up)),</span>
<span id="cb1552-7"><a href="mod-07.html#cb1552-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">border=</span><span class="cn">NA</span>, <span class="at">col=</span><span class="st">&quot;lightpink&quot;</span>)</span>
<span id="cb1552-8"><a href="mod-07.html#cb1552-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx2<span class="sc">$</span>conc, dx2<span class="sc">$</span>mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;red2&quot;</span>)</span>
<span id="cb1552-9"><a href="mod-07.html#cb1552-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nlev){</span>
<span id="cb1552-10"><a href="mod-07.html#cb1552-10" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx1<span class="sc">$</span>subs<span class="sc">==</span>i)</span>
<span id="cb1552-11"><a href="mod-07.html#cb1552-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx1<span class="sc">$</span>conc[flag], dx1<span class="sc">$</span>mn[flag],</span>
<span id="cb1552-12"><a href="mod-07.html#cb1552-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;grey40&quot;</span>)</span>
<span id="cb1552-13"><a href="mod-07.html#cb1552-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-694-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>The plot shows the curves for individual substrates as thin lines, and the overall prediction with 95% CRI as a red line and shaded area. The highlighted curve and CRI is the expectation for any level of the random effect factor not in the original dataset. In other words, it is what the model predicts given the variability in the levels of the random factor that have already been observed. The ability to make robust predictions about unobserved levels of the random factor is one of the biggest advantages of mixed models.</p>
</div>
<div id="nlme-on-real-data" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> NLME on real data</h3>
<p><span class="citation">Kirchman et al. (<a href="#ref-kirchman2009microbial" role="doc-biblioref">2009</a>)</span> investigated the role of temperature and organic carbon availability on growth and secondary production by heterotrophic bacteria in the oceans. Heterotrophic bacteria are key components of marine food webs and can exert enormous control over ecosystem cycling of nutrients. The figure below shows the place of heterotrophic bacteria in the marine “microbial loop” that relates dissolved CO2 and dissolved organic carbon (DOC) <span class="citation">(<a href="#ref-kirchman2009microbial" role="doc-biblioref">Kirchman et al. 2009</a>)</span>.</p>
<p><img src="C:/Users/ngreen62/OneDrive%20-%20Kennesaw%20State%20University/biol%206490/_stat/fig/07_02.jpg" /></p>
<p>To better understand how these bacteria affect ocean ecosystems, the authors examined bacterial growth (d<sup>-1</sup>) and productivity (mmol C m<sup>-2</sup> d<sup>-1</sup>) varied with latitude (<span class="math inline">\(^\circ\)</span>N or <span class="math inline">\(^\circ\)</span>S), nutrient availability (<span class="math inline">\(\mu\)</span>M C), and mean annual temperature (<span class="math inline">\(^\circ\)</span>C). We will re-examine part of their dataset to practice using nonlinear mixed effects models. The data are stored in this <a href="https://greenquanteco.github.io/kirchman_data_2021-10-21.csv">text file</a>. Download this file and save it to your R working directory.</p>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="mod-07.html#cb1553-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;kirchman_data_2021-10-21.csv&quot;</span></span>
<span id="cb1553-2"><a href="mod-07.html#cb1553-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>As usual, we start by exploring the distributions of the variables and a basic scatterplot.</p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1554-1"><a href="mod-07.html#cb1554-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1554-2"><a href="mod-07.html#cb1554-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>temp)</span>
<span id="cb1554-3"><a href="mod-07.html#cb1554-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>prod)</span>
<span id="cb1554-4"><a href="mod-07.html#cb1554-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>prod)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-696-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>The figure suggests that the response variable, productivity (<code>prod</code>), is right-skewed. So, it might benefit from a log transform. The scatterplot backs this up—notice the “dust bunny” in the lower right. It’s not clear whether or not the predictor variable temperature (<code>temp</code>) needs to be transformed. Let’s leave it alone for now.</p>
<p>Make a log-transformed version of productivity and a new set of exploratory figures. We’ll use <span class="math inline">\(log_{10}\)</span> to save ourselves some trouble later.</p>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="mod-07.html#cb1555-1" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>logy <span class="ot">&lt;-</span> <span class="fu">log10</span>(dat<span class="sc">$</span>prod)</span>
<span id="cb1555-2"><a href="mod-07.html#cb1555-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1555-3"><a href="mod-07.html#cb1555-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb1555-4"><a href="mod-07.html#cb1555-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>temp)</span>
<span id="cb1555-5"><a href="mod-07.html#cb1555-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dat<span class="sc">$</span>logy)</span>
<span id="cb1555-6"><a href="mod-07.html#cb1555-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>logy)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-697-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>There appears to be a nonlinear relationship between log-transformed productivity and temperature. The values start small and increase quickly until about 2 <span class="math inline">\(^\circ\)</span>C, after which the productivity levels off. Can you think of a biological interpretation of this curve shape?</p>
<p>There seem to be some distinct clumps in the scatterplot which might correspond to the grouping variable sea. Let’s add some colors to the dataset and then to the plot. Just for fun, let’s make a color ramp from colder to warmer sites.</p>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1556-1"><a href="mod-07.html#cb1556-1" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(temp<span class="sc">~</span>sea, <span class="at">data=</span>dat, median)</span>
<span id="cb1556-2"><a href="mod-07.html#cb1556-2" aria-hidden="true" tabindex="-1"></a>agg <span class="ot">&lt;-</span> agg[<span class="fu">order</span>(agg<span class="sc">$</span>temp),]</span>
<span id="cb1556-3"><a href="mod-07.html#cb1556-3" aria-hidden="true" tabindex="-1"></a>nsea <span class="ot">&lt;-</span> <span class="fu">nrow</span>(agg)</span>
<span id="cb1556-4"><a href="mod-07.html#cb1556-4" aria-hidden="true" tabindex="-1"></a>seas <span class="ot">&lt;-</span> agg<span class="sc">$</span>sea</span>
<span id="cb1556-5"><a href="mod-07.html#cb1556-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1556-6"><a href="mod-07.html#cb1556-6" aria-hidden="true" tabindex="-1"></a><span class="co"># color ramp from colder (blue) to warmer (red)</span></span>
<span id="cb1556-7"><a href="mod-07.html#cb1556-7" aria-hidden="true" tabindex="-1"></a>col.fun <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>))</span>
<span id="cb1556-8"><a href="mod-07.html#cb1556-8" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">col.fun</span>(nsea)</span>
<span id="cb1556-9"><a href="mod-07.html#cb1556-9" aria-hidden="true" tabindex="-1"></a>agg<span class="sc">$</span>col <span class="ot">&lt;-</span> cols</span>
<span id="cb1556-10"><a href="mod-07.html#cb1556-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1556-11"><a href="mod-07.html#cb1556-11" aria-hidden="true" tabindex="-1"></a>matchx <span class="ot">&lt;-</span> <span class="fu">match</span>(dat<span class="sc">$</span>sea, agg<span class="sc">$</span>sea)</span>
<span id="cb1556-12"><a href="mod-07.html#cb1556-12" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> agg<span class="sc">$</span>col[matchx]</span>
<span id="cb1556-13"><a href="mod-07.html#cb1556-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1556-14"><a href="mod-07.html#cb1556-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1556-15"><a href="mod-07.html#cb1556-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>logy,</span>
<span id="cb1556-16"><a href="mod-07.html#cb1556-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">cex=</span><span class="fl">1.3</span>)</span>
<span id="cb1556-17"><a href="mod-07.html#cb1556-17" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span>seas,</span>
<span id="cb1556-18"><a href="mod-07.html#cb1556-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span>cols, <span class="at">cex=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-698-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>As nice as the color ramp effect is, the seas are still hard to tell apart. Let’s add some shapes as well.</p>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="mod-07.html#cb1557-1" aria-hidden="true" tabindex="-1"></a>agg<span class="sc">$</span>shp <span class="ot">&lt;-</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span></span>
<span id="cb1557-2"><a href="mod-07.html#cb1557-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>shp <span class="ot">&lt;-</span> agg<span class="sc">$</span>shp[matchx]</span>
<span id="cb1557-3"><a href="mod-07.html#cb1557-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1557-4"><a href="mod-07.html#cb1557-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1557-5"><a href="mod-07.html#cb1557-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>logy,</span>
<span id="cb1557-6"><a href="mod-07.html#cb1557-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span>dat<span class="sc">$</span>shp, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">cex=</span><span class="fl">1.3</span>)</span>
<span id="cb1557-7"><a href="mod-07.html#cb1557-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span>seas,</span>
<span id="cb1557-8"><a href="mod-07.html#cb1557-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span>agg<span class="sc">$</span>shp, <span class="at">col=</span>cols, <span class="at">cex=</span><span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-699-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>There appears to be an effect of temperature and possibly of sea. Biologically, the bacteria within a sea are probably more similar to each other than they are to bacteria in other seas. So, we should expect there to be some effect of sea just based on genetic relatedness or some other kind of similarity. However, we want a model that is applicable to all seas, not just the 6 in this dataset. For example, this dataset is missing the Indian Ocean, the Mediterranean, the Caribbean, the Sea of Japan, and many others. So, we need a nonlinear <em>mixed model</em>. We don’t know exactly what curve to use, so we’ll try a few. The table below shows the equations for each model.</p>
<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Function</th>
<th>Fixed effects</th>
<th>Random effects</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Monod, random <em>a</em></td>
<td><span class="math inline">\(\mu_i=\frac{a_jx_i}{b+x_i}\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td>Monod, random <em>b</em></td>
<td><span class="math inline">\(\mu_i=\frac{ax_i}{b_j+x_i}\)</span></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Monod, random <em>a</em> and <em>b</em></td>
<td><span class="math inline">\(\mu_i=\frac{a_jx_i}{b_j+x_i}\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>4</td>
<td>Holling type III, random <em>a</em></td>
<td><span class="math inline">\(\mu_i=\frac{a_jx_i^2}{b^2+x_i^2}\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td>5</td>
<td>Holling type III, random <em>b</em></td>
<td><span class="math inline">\(\mu_i=\frac{ax_i^2}{b_j^2+x_i^2}\)</span></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>6</td>
<td>Holling type III, random <em>a</em> and <em>b</em></td>
<td><span class="math inline">\(\mu_i=\frac{a_jx_i^2}{b^2+x_i^2}\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>7</td>
<td>Monomolecular, random <em>a</em></td>
<td><span class="math inline">\(\mu_i=a_j\left(1-e^{-bx}\right)\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td>8</td>
<td>Monomolecular, random <em>b</em></td>
<td><span class="math inline">\(\mu_i=a\left(1-e^{-b_jx}\right)\)</span></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
<tr class="odd">
<td>9</td>
<td>Monomolecular, random <em>a</em> and <em>b</em></td>
<td><span class="math inline">\(\mu_i=a_j\left(1-e^{-b_jx}\right)\)</span></td>
<td><span class="math inline">\(a_j \sim Normal\left(\mu_a,\sigma_a^2\right)\)</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td><span class="math inline">\(b_j \sim Normal\left(\mu_b,\sigma_b^2\right)\)</span></td>
</tr>
</tbody>
</table>
<p>Fitting the <strong>Monod (aka: Michaelis-Menten)</strong> model with mixed effects is simple, because there is a self-start version of the function designed for nonlinear modeling (we’ve used it before). We just need to remember to supply reasonable starting values.</p>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1558-1"><a href="mod-07.html#cb1558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1558-2"><a href="mod-07.html#cb1558-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Monod (aka: Michaelis-Menten) with</span></span>
<span id="cb1558-3"><a href="mod-07.html#cb1558-3" aria-hidden="true" tabindex="-1"></a><span class="co"># different random structures</span></span>
<span id="cb1558-4"><a href="mod-07.html#cb1558-4" aria-hidden="true" tabindex="-1"></a>startvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a=</span><span class="fl">1.3</span>, <span class="at">b=</span><span class="dv">1</span>)</span>
<span id="cb1558-5"><a href="mod-07.html#cb1558-5" aria-hidden="true" tabindex="-1"></a>mod01 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">SSmicmen</span>(temp, a, b)<span class="sc">~</span>a<span class="sc">|</span>sea,</span>
<span id="cb1558-6"><a href="mod-07.html#cb1558-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1558-7"><a href="mod-07.html#cb1558-7" aria-hidden="true" tabindex="-1"></a>mod02 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">SSmicmen</span>(temp, a, b)<span class="sc">~</span>b<span class="sc">|</span>sea,</span>
<span id="cb1558-8"><a href="mod-07.html#cb1558-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1558-9"><a href="mod-07.html#cb1558-9" aria-hidden="true" tabindex="-1"></a>mod03 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">SSmicmen</span>(temp, a, b)<span class="sc">~</span>(a<span class="sc">|</span>sea)<span class="sc">+</span>(b<span class="sc">|</span>sea),</span>
<span id="cb1558-10"><a href="mod-07.html#cb1558-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span></code></pre></div>
<p>The other two curves are less simple to fit because there is no self-start model available. In <code>nlmer()</code>, the fixed part of the model needs to be provided as a special type of function that takes in input values and parameter values, and outputs a vector of response values. Additionally, the function needs to have some internal attributes that let <code>nlmer()</code> evaluate its likelihood function and how the likelihood function changes. The procedure below seems to work well.</p>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="mod-07.html#cb1559-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Holling type III (Bolker 2008 p. 92)</span></span>
<span id="cb1559-2"><a href="mod-07.html#cb1559-2" aria-hidden="true" tabindex="-1"></a>startvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">a=</span><span class="fl">1.3</span>, <span class="at">b=</span><span class="dv">1</span>)</span>
<span id="cb1559-3"><a href="mod-07.html#cb1559-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1559-4"><a href="mod-07.html#cb1559-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define model as function</span></span>
<span id="cb1559-5"><a href="mod-07.html#cb1559-5" aria-hidden="true" tabindex="-1"></a>holl <span class="ot">&lt;-</span> <span class="er">~</span>(a<span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(b<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1559-6"><a href="mod-07.html#cb1559-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1559-7"><a href="mod-07.html#cb1559-7" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare version of function for nlmer()</span></span>
<span id="cb1559-8"><a href="mod-07.html#cb1559-8" aria-hidden="true" tabindex="-1"></a>hollfun <span class="ot">&lt;-</span> <span class="fu">deriv</span>(holl, <span class="at">namevec=</span><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</span>
<span id="cb1559-9"><a href="mod-07.html#cb1559-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">function.arg=</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb1559-10"><a href="mod-07.html#cb1559-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1559-11"><a href="mod-07.html#cb1559-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models</span></span>
<span id="cb1559-12"><a href="mod-07.html#cb1559-12" aria-hidden="true" tabindex="-1"></a>mod04 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">hollfun</span>(temp, a, b)<span class="sc">~</span>a<span class="sc">|</span>sea,</span>
<span id="cb1559-13"><a href="mod-07.html#cb1559-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1559-14"><a href="mod-07.html#cb1559-14" aria-hidden="true" tabindex="-1"></a>mod05 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">hollfun</span>(temp, a, b)<span class="sc">~</span>b<span class="sc">|</span>sea,</span>
<span id="cb1559-15"><a href="mod-07.html#cb1559-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span></code></pre></div>
<pre><code>## Warning in (function (fn, par, lower = rep.int(-Inf, n), upper = rep.int(Inf, :
## failure to converge in 10000 evaluations</code></pre>
<pre><code>## Warning in optwrap(control$optimizer[[1]], devfun, rho$pp$theta, lower =
## rho$lower, : convergence code 4 from Nelder_Mead: failure to converge in 10000
## evaluations</code></pre>
<pre><code>## Error in fn(nM$xeval()): prss{Update} failed to converge in &#39;maxit&#39; iterations</code></pre>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="mod-07.html#cb1563-1" aria-hidden="true" tabindex="-1"></a>mod06 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">hollfun</span>(temp, a, b)<span class="sc">~</span>(a<span class="sc">|</span>sea)<span class="sc">+</span>(b<span class="sc">|</span>sea),</span>
<span id="cb1563-2"><a href="mod-07.html#cb1563-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span></code></pre></div>
<pre><code>## Error in fn(nM$xeval()): prss{Update} failed to converge in &#39;maxit&#39; iterations</code></pre>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="mod-07.html#cb1565-1" aria-hidden="true" tabindex="-1"></a><span class="co"># monomolecular (Bolker p. 95)</span></span>
<span id="cb1565-2"><a href="mod-07.html#cb1565-2" aria-hidden="true" tabindex="-1"></a><span class="co"># special case of von Bertalanffy curve</span></span>
<span id="cb1565-3"><a href="mod-07.html#cb1565-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1565-4"><a href="mod-07.html#cb1565-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define model as function</span></span>
<span id="cb1565-5"><a href="mod-07.html#cb1565-5" aria-hidden="true" tabindex="-1"></a>mono <span class="ot">&lt;-</span> <span class="er">~</span>a<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>b<span class="sc">*</span>x))</span>
<span id="cb1565-6"><a href="mod-07.html#cb1565-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1565-7"><a href="mod-07.html#cb1565-7" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare version of function for nlmer()</span></span>
<span id="cb1565-8"><a href="mod-07.html#cb1565-8" aria-hidden="true" tabindex="-1"></a>monofun <span class="ot">&lt;-</span> <span class="fu">deriv</span>(mono, <span class="at">namevec=</span><span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), </span>
<span id="cb1565-9"><a href="mod-07.html#cb1565-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">function.arg=</span><span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb1565-10"><a href="mod-07.html#cb1565-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1565-11"><a href="mod-07.html#cb1565-11" aria-hidden="true" tabindex="-1"></a>mod07 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">monofun</span>(temp, a, b)<span class="sc">~</span>a<span class="sc">|</span>sea,</span>
<span id="cb1565-12"><a href="mod-07.html#cb1565-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1565-13"><a href="mod-07.html#cb1565-13" aria-hidden="true" tabindex="-1"></a>mod08 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">monofun</span>(temp, a, b)<span class="sc">~</span>b<span class="sc">|</span>sea,</span>
<span id="cb1565-14"><a href="mod-07.html#cb1565-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span>
<span id="cb1565-15"><a href="mod-07.html#cb1565-15" aria-hidden="true" tabindex="-1"></a>mod09 <span class="ot">&lt;-</span> <span class="fu">nlmer</span>(logy<span class="sc">~</span><span class="fu">monofun</span>(temp, a, b)<span class="sc">~</span>(a<span class="sc">|</span>sea)<span class="sc">+</span>(b<span class="sc">|</span>sea),</span>
<span id="cb1565-16"><a href="mod-07.html#cb1565-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat, <span class="at">start=</span>startvec)</span></code></pre></div>
<p>R was not able to find solutions for models 5 and 6, so we can discard those. Let’s examine the outputs of the models that did fit. First, we can use AIC to get a sense of which models might have worked best:</p>
<div class="sourceCode" id="cb1566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1566-1"><a href="mod-07.html#cb1566-1" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> <span class="fu">AIC</span>(mod01, mod02, mod03, mod04, mod07, mod08, mod09)</span>
<span id="cb1566-2"><a href="mod-07.html#cb1566-2" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>delta <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>AIC <span class="sc">-</span> <span class="fu">min</span>(aic.df<span class="sc">$</span>AIC)</span>
<span id="cb1566-3"><a href="mod-07.html#cb1566-3" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span><span class="sc">*</span>aic.df<span class="sc">$</span>delta)</span>
<span id="cb1566-4"><a href="mod-07.html#cb1566-4" aria-hidden="true" tabindex="-1"></a>aic.df<span class="sc">$</span>wt <span class="ot">&lt;-</span> aic.df<span class="sc">$</span>wt<span class="sc">/</span><span class="fu">sum</span>(aic.df<span class="sc">$</span>wt)</span>
<span id="cb1566-5"><a href="mod-07.html#cb1566-5" aria-hidden="true" tabindex="-1"></a>aic.df <span class="ot">&lt;-</span> aic.df[<span class="fu">order</span>(<span class="sc">-</span>aic.df<span class="sc">$</span>wt),]</span>
<span id="cb1566-6"><a href="mod-07.html#cb1566-6" aria-hidden="true" tabindex="-1"></a>aic.df</span></code></pre></div>
<pre><code>##       df      AIC      delta           wt
## mod08  4 105.4030   0.000000 6.545609e-01
## mod09  5 107.4030   1.999977 2.408023e-01
## mod07  4 109.0699   3.666938 1.046368e-01
## mod04  4 156.6238  51.220848 4.937240e-12
## mod01  4 164.5428  59.139802 9.416842e-14
## mod03  5 166.5428  61.139802 3.464263e-14
## mod02  4 376.3158 270.912825 9.726972e-60</code></pre>
<p>The AICs suggest that model 8 is the best-fitting. This was the monomolecular curve with the growth constant (<em>b</em>) varying by sea. The Monod functions were the worst fitting (by AIC); and the only Holling curve that fit was somewhere in the middle.
Let’s generate and plot model predictions as usual. We’ll have to calculate the predictions manually because the <code>predict()</code> method for <code>nlmer()</code> objects is not well documented.</p>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1568-1"><a href="mod-07.html#cb1568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of points and x values</span></span>
<span id="cb1568-2"><a href="mod-07.html#cb1568-2" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1568-3"><a href="mod-07.html#cb1568-3" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>temp), <span class="fu">max</span>(dat<span class="sc">$</span>temp), <span class="at">length=</span>pn)</span>
<span id="cb1568-4"><a href="mod-07.html#cb1568-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1568-5"><a href="mod-07.html#cb1568-5" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions by level (sea)</span></span>
<span id="cb1568-6"><a href="mod-07.html#cb1568-6" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">sea=</span>seas, <span class="at">temp=</span>px)</span>
<span id="cb1568-7"><a href="mod-07.html#cb1568-7" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> dx1[<span class="fu">order</span>(dx1<span class="sc">$</span>sea, dx1<span class="sc">$</span>temp),]</span>
<span id="cb1568-8"><a href="mod-07.html#cb1568-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1568-9"><a href="mod-07.html#cb1568-9" aria-hidden="true" tabindex="-1"></a><span class="do">## coefficients table (including random b)</span></span>
<span id="cb1568-10"><a href="mod-07.html#cb1568-10" aria-hidden="true" tabindex="-1"></a>cofs <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod08)<span class="sc">$</span>sea</span>
<span id="cb1568-11"><a href="mod-07.html#cb1568-11" aria-hidden="true" tabindex="-1"></a>matchx <span class="ot">&lt;-</span> <span class="fu">match</span>(dx1<span class="sc">$</span>sea, <span class="fu">rownames</span>(cofs))</span>
<span id="cb1568-12"><a href="mod-07.html#cb1568-12" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>a <span class="ot">&lt;-</span> cofs<span class="sc">$</span>a[matchx]</span>
<span id="cb1568-13"><a href="mod-07.html#cb1568-13" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>b <span class="ot">&lt;-</span> cofs<span class="sc">$</span>b[matchx]</span>
<span id="cb1568-14"><a href="mod-07.html#cb1568-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1568-15"><a href="mod-07.html#cb1568-15" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate predictions</span></span>
<span id="cb1568-16"><a href="mod-07.html#cb1568-16" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>y <span class="ot">&lt;-</span> dx1<span class="sc">$</span>a<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>dx1<span class="sc">$</span>b<span class="sc">*</span>dx1<span class="sc">$</span>temp))</span>
<span id="cb1568-17"><a href="mod-07.html#cb1568-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1568-18"><a href="mod-07.html#cb1568-18" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction of overall mean (applicable to other seas)</span></span>
<span id="cb1568-19"><a href="mod-07.html#cb1568-19" aria-hidden="true" tabindex="-1"></a>dx2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">temp=</span>px)</span>
<span id="cb1568-20"><a href="mod-07.html#cb1568-20" aria-hidden="true" tabindex="-1"></a>fixe <span class="ot">&lt;-</span> <span class="fu">fixef</span>(mod08)</span>
<span id="cb1568-21"><a href="mod-07.html#cb1568-21" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>y <span class="ot">&lt;-</span> fixe[<span class="st">&quot;a&quot;</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>fixe[<span class="st">&quot;b&quot;</span>]<span class="sc">*</span>dx2<span class="sc">$</span>temp))</span></code></pre></div>
<p>Now we can assemble a few pieces and make our nice plot.</p>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="mod-07.html#cb1569-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 40% opacity (alpha) to the colors for</span></span>
<span id="cb1569-2"><a href="mod-07.html#cb1569-2" aria-hidden="true" tabindex="-1"></a><span class="co"># clearer plot (pun intended)</span></span>
<span id="cb1569-3"><a href="mod-07.html#cb1569-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(dat<span class="sc">$</span>col, <span class="st">&quot;40&quot;</span>)</span>
<span id="cb1569-4"><a href="mod-07.html#cb1569-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-5"><a href="mod-07.html#cb1569-5" aria-hidden="true" tabindex="-1"></a><span class="co"># nicer version of names for legend</span></span>
<span id="cb1569-6"><a href="mod-07.html#cb1569-6" aria-hidden="true" tabindex="-1"></a>leg.labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1569-7"><a href="mod-07.html#cb1569-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Ross Sea&quot;</span>, <span class="st">&quot;Western Arctic&quot;</span>,</span>
<span id="cb1569-8"><a href="mod-07.html#cb1569-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Subarctic Pacific&quot;</span>, <span class="st">&quot;North Atlantic&quot;</span>,</span>
<span id="cb1569-9"><a href="mod-07.html#cb1569-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Arabian Sea&quot;</span>, <span class="st">&quot;Equatorial Pacific&quot;</span>)</span>
<span id="cb1569-10"><a href="mod-07.html#cb1569-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-11"><a href="mod-07.html#cb1569-11" aria-hidden="true" tabindex="-1"></a><span class="co"># graphical parameters for attractive plot</span></span>
<span id="cb1569-12"><a href="mod-07.html#cb1569-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1569-13"><a href="mod-07.html#cb1569-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lend=</span><span class="dv">1</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb1569-14"><a href="mod-07.html#cb1569-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.axis=</span><span class="fl">1.3</span>, <span class="at">cex.lab=</span><span class="fl">1.3</span>)</span>
<span id="cb1569-15"><a href="mod-07.html#cb1569-15" aria-hidden="true" tabindex="-1"></a><span class="co"># set up plot area</span></span>
<span id="cb1569-16"><a href="mod-07.html#cb1569-16" aria-hidden="true" tabindex="-1"></a><span class="do">## note expression() used for proper axis labels</span></span>
<span id="cb1569-17"><a href="mod-07.html#cb1569-17" aria-hidden="true" tabindex="-1"></a><span class="do">## and y axis suppressed (yaxt=&quot;n&quot;) so a better </span></span>
<span id="cb1569-18"><a href="mod-07.html#cb1569-18" aria-hidden="true" tabindex="-1"></a><span class="do">## y axis can be added manually</span></span>
<span id="cb1569-19"><a href="mod-07.html#cb1569-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>logy, <span class="at">type=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1569-20"><a href="mod-07.html#cb1569-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">expression</span>(Temperature<span class="sc">~</span>(degree<span class="sc">*</span>C)),</span>
<span id="cb1569-21"><a href="mod-07.html#cb1569-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="fu">expression</span>(Productivity<span class="sc">~</span>(mmol<span class="sc">~</span>C<span class="sc">~</span>m<span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>}<span class="sc">~</span>d<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})),</span>
<span id="cb1569-22"><a href="mod-07.html#cb1569-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxt=</span><span class="st">&quot;n&quot;</span>,</span>
<span id="cb1569-23"><a href="mod-07.html#cb1569-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">2</span>))</span>
<span id="cb1569-24"><a href="mod-07.html#cb1569-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-25"><a href="mod-07.html#cb1569-25" aria-hidden="true" tabindex="-1"></a><span class="co"># add sea-specific lines in a loop</span></span>
<span id="cb1569-26"><a href="mod-07.html#cb1569-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsea){</span>
<span id="cb1569-27"><a href="mod-07.html#cb1569-27" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dx1<span class="sc">$</span>sea <span class="sc">==</span> seas[i])</span>
<span id="cb1569-28"><a href="mod-07.html#cb1569-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(dx1<span class="sc">$</span>temp[flag], dx1<span class="sc">$</span>y[flag],</span>
<span id="cb1569-29"><a href="mod-07.html#cb1569-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;grey60&quot;</span>)</span>
<span id="cb1569-30"><a href="mod-07.html#cb1569-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1569-31"><a href="mod-07.html#cb1569-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-32"><a href="mod-07.html#cb1569-32" aria-hidden="true" tabindex="-1"></a><span class="co"># add fixed effect line</span></span>
<span id="cb1569-33"><a href="mod-07.html#cb1569-33" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dx2<span class="sc">$</span>temp, dx2<span class="sc">$</span>y, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1569-34"><a href="mod-07.html#cb1569-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-35"><a href="mod-07.html#cb1569-35" aria-hidden="true" tabindex="-1"></a><span class="co"># original data, with semi-transparent colors</span></span>
<span id="cb1569-36"><a href="mod-07.html#cb1569-36" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(dat<span class="sc">$</span>temp, dat<span class="sc">$</span>logy,</span>
<span id="cb1569-37"><a href="mod-07.html#cb1569-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">pch=</span>dat<span class="sc">$</span>shp, <span class="at">col=</span>dat<span class="sc">$</span>col2, <span class="at">cex=</span><span class="fl">1.3</span>)</span>
<span id="cb1569-38"><a href="mod-07.html#cb1569-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-39"><a href="mod-07.html#cb1569-39" aria-hidden="true" tabindex="-1"></a><span class="co"># fancy y axis with logarithmic tick marks</span></span>
<span id="cb1569-40"><a href="mod-07.html#cb1569-40" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>, <span class="at">by=</span><span class="dv">1</span>),</span>
<span id="cb1569-41"><a href="mod-07.html#cb1569-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span><span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>))</span>
<span id="cb1569-42"><a href="mod-07.html#cb1569-42" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side=</span><span class="dv">2</span>, <span class="at">at=</span><span class="fu">log10</span>(<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span><span class="sc">*</span><span class="dv">10</span>)),</span>
<span id="cb1569-43"><a href="mod-07.html#cb1569-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels=</span><span class="cn">NA</span>, <span class="at">tcl=</span><span class="sc">-</span><span class="fl">0.25</span>)</span>
<span id="cb1569-44"><a href="mod-07.html#cb1569-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1569-45"><a href="mod-07.html#cb1569-45" aria-hidden="true" tabindex="-1"></a><span class="co"># legend</span></span>
<span id="cb1569-46"><a href="mod-07.html#cb1569-46" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="at">legend=</span>leg.labs, <span class="at">pch=</span>agg<span class="sc">$</span>shp,</span>
<span id="cb1569-47"><a href="mod-07.html#cb1569-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">paste0</span>(cols, <span class="st">&quot;40&quot;</span>), <span class="at">cex=</span><span class="fl">1.3</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-704-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="mod-07-gamm" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> (Generalized) additive mixed models (AMM/GAMM)</h2>
<p>The last category of mixed models that we will cover are <strong>generalized additive mixed models (GAMM)</strong>. GAMM extend <a href="mod-06.html#mod-06-gam">generalized additive models (GAM)</a> by allowing for observations in different groups to have different intercepts or different smoothing functions. If that sounds complicated, that’s because it is.</p>
<ul>
<li><strong>Additive models (AM)</strong> are a generalization of linear models, where a <strong>smoother</strong> of arbitrary shape is fit instead of a straight line. Smoothers can describe nonlinear patterns (very common in biology), but the process of fitting smoothers is sensitive to many assumptions and methodological details.</li>
<li><strong>Generalized additive models (GAM)</strong> generalize AM by relaxing the assumption of normal residuals and introducing a link function to additive models. This adds a layer of complexity to additive modeling<a href="literature-cited.html#fn77" class="footnote-ref" id="fnref77"><sup>77</sup></a>.</li>
<li><strong>Generalized additive mixed models (GAMM)</strong> generalize GAM by allowing different groups of observations to have different smoothers, or different coefficients on those smoothers. This adds even more complexity to the model.</li>
</ul>
<p>Going from a linear model to a generalized linear model adds a layer of complication. Going from a fixed effects model to a mixed effects model adds more complication. And going from a linear model to an additive one compounds all of these complications. I’m not trying to warn you away from trying GAMM–just advising you to be prepared for frustration.</p>
<div id="example-gamm-with-real-data" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Example GAMM with real data</h3>
<p><span class="citation">Pethybridge et al. (<a href="#ref-pethybridge2018" role="doc-biblioref">2018</a>)</span> compiled data on stable isotope concentrations in 3 species of tuna throughout the Atlantic, Pacific, and Indian Oceans. They used these concentrations to estimate the trophic position of each species. The data were made available in a separate publication <span class="citation">(<a href="#ref-bodin2021" role="doc-biblioref">Bodin et al. 2021</a>)</span>. Download this <a href="https://greenquanteco.github.io/bodin_data_2021-10-22.csv">adapted version of the dataset</a> and save it to your R home directory (or other favorite folder). Import the data and take a look.</p>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1570-1"><a href="mod-07.html#cb1570-1" aria-hidden="true" tabindex="-1"></a>in.name <span class="ot">&lt;-</span> <span class="st">&quot;bodin_data_2021-10-22.csv&quot;</span></span>
<span id="cb1570-2"><a href="mod-07.html#cb1570-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(in.name, <span class="at">header=</span><span class="cn">TRUE</span>)</span>
<span id="cb1570-3"><a href="mod-07.html#cb1570-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove observations missing trophic position</span></span>
<span id="cb1570-4"><a href="mod-07.html#cb1570-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat[<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>tp),]</span>
<span id="cb1570-5"><a href="mod-07.html#cb1570-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1570-6"><a href="mod-07.html#cb1570-6" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect dataset</span></span>
<span id="cb1570-7"><a href="mod-07.html#cb1570-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code></pre></div>
<pre><code>##            species        common       date    lat    long ocean fork  d15n
## 1 Thunnus alalunga Albacore tuna 2002-10-10 -16.64 -150.79    PO   91 15.17
## 2 Thunnus alalunga Albacore tuna 2004-16-09 -25.85  153.98    PO   87  9.55
## 3 Thunnus alalunga Albacore tuna 2004-16-09 -25.85  153.98    PO   99  9.48
## 4 Thunnus alalunga Albacore tuna 2004-20-09 -28.17  155.82    PO   78 10.46
## 5 Thunnus alalunga Albacore tuna 2004-23-09 -28.37  160.13    PO   76 12.23
## 6 Thunnus alalunga Albacore tuna 2004-23-09 -28.37  160.13    PO   80 10.35
##     tp
## 1 7.32
## 2 4.98
## 3 4.95
## 4 5.36
## 5 6.10
## 6 5.31</code></pre>
<p>The dataset has the following variables:</p>
<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Units</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>species</code></td>
<td>N/A</td>
<td>Scientific name (binomen) of species.</td>
</tr>
<tr class="even">
<td><code>common</code></td>
<td>N/A</td>
<td>Common name of species.</td>
</tr>
<tr class="odd">
<td><code>date</code></td>
<td>Days</td>
<td>Date of observation in YYYY-MM-DD format.</td>
</tr>
<tr class="even">
<td><code>lat</code></td>
<td><span class="math inline">\(^\circ\)</span>N</td>
<td>Latitude of observation. Positive values indicate <span class="math inline">\(^\circ\)</span>N; negative values indicate <span class="math inline">\(^\circ\)</span>S.</td>
</tr>
<tr class="odd">
<td><code>long</code></td>
<td><span class="math inline">\(^\circ\)</span>E</td>
<td>Longitude of observation. Positive values indicate <span class="math inline">\(^\circ\)</span>E; negative values indicate <span class="math inline">\(^\circ\)</span>W.</td>
</tr>
<tr class="even">
<td><code>ocean</code></td>
<td>N/A</td>
<td>Ocean where observation was taken. <code>AO</code> = Atlantic Ocean; <code>IO</code> = Indian Ocean; <code>PO</code> = Pacific Ocean.</td>
</tr>
<tr class="odd">
<td><code>fork</code></td>
<td>cm</td>
<td>Fork length (FL) of individual fish (distance from tip of snout to middle caudal fin rays). Slightly less than total length (TL).</td>
</tr>
<tr class="even">
<td><code>d15n</code></td>
<td>Parts per thousand</td>
<td>Ratio of <sup>15</sup>N to <sup>14</sup>N in sample (aka: <span class="math inline">\(\delta\)</span><sup>15</sup>N or “delta fifteen N”)</td>
</tr>
<tr class="odd">
<td><code>tp</code></td>
<td>Tropic levels</td>
<td>Estimated trophic level of individual based on <span class="math inline">\(\delta\)</span><sup>15</sup>N in tissue samples.</td>
</tr>
</tbody>
</table>
<p>The researchers were interested in how the trophic level of tuna varied with body size and geography. The trophic level expresses how high in the food chain an animal is. Primary producers such as plants and phytoplankton have a trophic level of 1. Animals that consume primary producers have a trophic level of 2. For example, grasses have trophic level 1, zebras have trophic level 2, and lions have trophic level 3.</p>
<p>The variables in play are animal size (fork length), latitude, longitude, ocean, and species. Fork length, latitude, and longitude can be modeled as continuous predictors. Ocean and species are factors. Ocean has 3 levels (Atlantic, Indian, and Pacific), as does species (<em>Thunnus albacares</em>, <em>T. obesus</em>, and <em>T. alalunga</em>). Which of these factors should be treated as fixed? Which as random? It depends on the researchers’ goals. If the objective is to predict the trophic position of particular species, or to predict the trophic position of species within particular oceans, then those factors should be fixed. If the sets of oceans and species in the dataset are just taken as representing other, unexamined oceans and/or species, then these factors should be treated as random. We will follow the example of the original authors and treat ocean as a random factor, with species as fixed.</p>
<p>Now that we have decided on a mixed model approach, we need to decide whether to use linear models or additive models. A quick plot of the data, with species and ocean overlaid as shapes and colors, respectively, suggests that linear models are unlikely to describe the data very well. So, we can try an additive model.</p>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1572-1"><a href="mod-07.html#cb1572-1" aria-hidden="true" tabindex="-1"></a><span class="co"># color by ocean</span></span>
<span id="cb1572-2"><a href="mod-07.html#cb1572-2" aria-hidden="true" tabindex="-1"></a>ocs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>ocean))</span>
<span id="cb1572-3"><a href="mod-07.html#cb1572-3" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">rainbow</span>(<span class="fu">length</span>(ocs), <span class="at">alpha=</span><span class="fl">0.4</span>)</span>
<span id="cb1572-4"><a href="mod-07.html#cb1572-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>col <span class="ot">&lt;-</span> cols[<span class="fu">match</span>(dat<span class="sc">$</span>ocean, ocs)]</span>
<span id="cb1572-5"><a href="mod-07.html#cb1572-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-6"><a href="mod-07.html#cb1572-6" aria-hidden="true" tabindex="-1"></a><span class="co"># shape by species</span></span>
<span id="cb1572-7"><a href="mod-07.html#cb1572-7" aria-hidden="true" tabindex="-1"></a>spps <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>species))</span>
<span id="cb1572-8"><a href="mod-07.html#cb1572-8" aria-hidden="true" tabindex="-1"></a>pchs <span class="ot">&lt;-</span> <span class="dv">15</span><span class="sc">:</span><span class="dv">17</span></span>
<span id="cb1572-9"><a href="mod-07.html#cb1572-9" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>pch <span class="ot">&lt;-</span> pchs[<span class="fu">match</span>(dat<span class="sc">$</span>species, spps)]</span>
<span id="cb1572-10"><a href="mod-07.html#cb1572-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-11"><a href="mod-07.html#cb1572-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">cex.lab=</span><span class="fl">1.4</span>, <span class="at">cex.axis=</span><span class="fl">1.4</span>)</span>
<span id="cb1572-12"><a href="mod-07.html#cb1572-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>lat, dat<span class="sc">$</span>tp, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">pch=</span>dat<span class="sc">$</span>pch)</span>
<span id="cb1572-13"><a href="mod-07.html#cb1572-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>long, dat<span class="sc">$</span>tp, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">pch=</span>dat<span class="sc">$</span>pch)</span>
<span id="cb1572-14"><a href="mod-07.html#cb1572-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>fork, dat<span class="sc">$</span>tp, <span class="at">col=</span>dat<span class="sc">$</span>col, <span class="at">pch=</span>dat<span class="sc">$</span>pch)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-706-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>Next, we need to consider what kind of additive model to use. The decision of whether to use an additive mixed model (AMM) or generalized additive mixed model (GAMM) hinges on the distribution of the response variable. Trophic positions cannot be negative (or &lt;1), so we might think of the values as coming from a lognormal distribution. This would be a GAMM with Gaussian family and log link function.</p>
<p>The main R package for fitting GAMM is the same package for fitting GAM: <code>mgcv</code> <span class="citation">(<a href="#ref-wood2017generalized" role="doc-biblioref">Wood 2017</a>)</span>. It should be noted that there are several ways within <code>mgcv</code> to fit GAMM. We’ll use the function <code>gamm()</code>; function <code>gam()</code> can also be used by manipulating some of the arguments to the smoother functions <code>s()</code>.</p>
<p>For this example we will fit 3 models, each with smoothers for a single continuous predictor. Each species will have its own smoother: this is what the <code>by=spp</code> argument in <code>s()</code> does. The random intercept of <code>ocean</code> is specified as a list.</p>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="mod-07.html#cb1573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1573-2"><a href="mod-07.html#cb1573-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1573-3"><a href="mod-07.html#cb1573-3" aria-hidden="true" tabindex="-1"></a><span class="co"># very important: make a factor version of species to be </span></span>
<span id="cb1573-4"><a href="mod-07.html#cb1573-4" aria-hidden="true" tabindex="-1"></a><span class="co"># used by gamm()</span></span>
<span id="cb1573-5"><a href="mod-07.html#cb1573-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>spp <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat<span class="sc">$</span>species)</span>
<span id="cb1573-6"><a href="mod-07.html#cb1573-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1573-7"><a href="mod-07.html#cb1573-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models</span></span>
<span id="cb1573-8"><a href="mod-07.html#cb1573-8" aria-hidden="true" tabindex="-1"></a>mod01 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(tp<span class="sc">~</span><span class="fu">s</span>(lat, <span class="at">by=</span>spp), <span class="at">data=</span>dat,</span>
<span id="cb1573-9"><a href="mod-07.html#cb1573-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">random=</span><span class="fu">list</span>(<span class="at">ocean=</span><span class="sc">~</span><span class="dv">1</span>), <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Maximum number of PQL iterations:  20</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="mod-07.html#cb1579-1" aria-hidden="true" tabindex="-1"></a>mod02 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(tp<span class="sc">~</span><span class="fu">s</span>(long, <span class="at">by=</span>spp), <span class="at">data=</span>dat,</span>
<span id="cb1579-2"><a href="mod-07.html#cb1579-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">random=</span><span class="fu">list</span>(<span class="at">ocean=</span><span class="sc">~</span><span class="dv">1</span>), <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Maximum number of PQL iterations:  20</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<pre><code>## iteration 5</code></pre>
<div class="sourceCode" id="cb1586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1586-1"><a href="mod-07.html#cb1586-1" aria-hidden="true" tabindex="-1"></a>mod03 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(tp<span class="sc">~</span><span class="fu">s</span>(fork, <span class="at">by=</span>spp), <span class="at">data=</span>dat,</span>
<span id="cb1586-2"><a href="mod-07.html#cb1586-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">random=</span><span class="fu">list</span>(<span class="at">ocean=</span><span class="sc">~</span><span class="dv">1</span>), <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Maximum number of PQL iterations:  20</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<p>Outputs from <code>gamm()</code> are very complicated and intimidating, even to experts. The most important part of the output is in the <code>$gam</code> component.</p>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1592-1"><a href="mod-07.html#cb1592-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod01<span class="sc">$</span>gam, <span class="at">cor=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: log 
## 
## Formula:
## tp ~ s(lat, by = spp)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.64874    0.01467   112.4   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                               edf Ref.df      F p-value    
## s(lat):sppThunnus alalunga  7.257  7.257 122.11  &lt;2e-16 ***
## s(lat):sppThunnus albacares 8.743  8.743  27.61  &lt;2e-16 ***
## s(lat):sppThunnus obesus    8.661  8.661  20.05  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.365   
##   Scale est. = 0.68458   n = 3177</code></pre>
<p>The output contains only one parametric component, the estimated intercept. The overall or mean intercept was estimated as 1.648 <span class="math inline">\(\pm\)</span> 0.015, and was statistically significant. The “approximate signicance” of smooth terms is presented in a table separate from the parametric components. The “approximate” part of the name is very important: take estimates of <em>P</em>-values, <em>R</em><sup>2</sup>, and other such measures from GAMMs with a grain of salt. Even the help page for <code>summary.gam()</code> states that the <em>P</em>-value presented are likely to be too small.</p>
<p>If you have a factor with &gt;2 levels, you can print an ANOVA for the level-specific smoothers:</p>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1594-1"><a href="mod-07.html#cb1594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod01<span class="sc">$</span>gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: log 
## 
## Formula:
## tp ~ s(lat, by = spp)
## 
## Approximate significance of smooth terms:
##                               edf Ref.df      F p-value
## s(lat):sppThunnus alalunga  7.257  7.257 122.11  &lt;2e-16
## s(lat):sppThunnus albacares 8.743  8.743  27.61  &lt;2e-16
## s(lat):sppThunnus obesus    8.661  8.661  20.05  &lt;2e-16</code></pre>
<p>You can see the estimated smoothers using <code>plot()</code> on the <code>$gam</code> output.</p>
<div class="sourceCode" id="cb1596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1596-1"><a href="mod-07.html#cb1596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co"># 1x3 panels, because 3 smoothers</span></span>
<span id="cb1596-2"><a href="mod-07.html#cb1596-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod01<span class="sc">$</span>gam)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-710-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1597-1"><a href="mod-07.html#cb1597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod02<span class="sc">$</span>gam)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-710-2.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1598-1"><a href="mod-07.html#cb1598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod03<span class="sc">$</span>gam)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-710-3.png" width="864" style="display: block; margin: auto;" /></p>
<p>Some of the smoothers for the predictor variables have quite different shapes for each species! The original study authors fit a separate model for each species and continuous predictor combination. But, with this many observations <code>(nrow(dat))</code>, we might be able to fit a single model that includes all predictors.</p>
<div class="sourceCode" id="cb1599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1599-1"><a href="mod-07.html#cb1599-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can we fit all the predictors in one model?</span></span>
<span id="cb1599-2"><a href="mod-07.html#cb1599-2" aria-hidden="true" tabindex="-1"></a>mod04 <span class="ot">&lt;-</span> <span class="fu">gamm</span>(tp<span class="sc">~</span><span class="fu">s</span>(lat, <span class="at">by=</span>spp)<span class="sc">+</span><span class="fu">s</span>(long, <span class="at">by=</span>spp)<span class="sc">+</span><span class="fu">s</span>(fork, <span class="at">by=</span>spp),</span>
<span id="cb1599-3"><a href="mod-07.html#cb1599-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data=</span>dat,</span>
<span id="cb1599-4"><a href="mod-07.html#cb1599-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">random=</span><span class="fu">list</span>(<span class="at">ocean=</span><span class="sc">~</span><span class="dv">1</span>),</span>
<span id="cb1599-5"><a href="mod-07.html#cb1599-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family=</span><span class="fu">gaussian</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Maximum number of PQL iterations:  20</code></pre>
<pre><code>## iteration 1</code></pre>
<pre><code>## iteration 2</code></pre>
<pre><code>## iteration 3</code></pre>
<pre><code>## iteration 4</code></pre>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1605-1"><a href="mod-07.html#cb1605-1" aria-hidden="true" tabindex="-1"></a><span class="co"># yes!</span></span>
<span id="cb1605-2"><a href="mod-07.html#cb1605-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod04<span class="sc">$</span>gam)</span></code></pre></div>
<pre><code>## 
## Family: gaussian 
## Link function: log 
## 
## Formula:
## tp ~ s(lat, by = spp) + s(long, by = spp) + s(fork, by = spp)
## 
## Parametric coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.8114     0.1406   12.88   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##                                edf Ref.df      F  p-value    
## s(lat):sppThunnus alalunga   6.581  6.581 66.471  &lt; 2e-16 ***
## s(lat):sppThunnus albacares  8.518  8.518 20.780  &lt; 2e-16 ***
## s(lat):sppThunnus obesus     8.848  8.848 32.363  &lt; 2e-16 ***
## s(long):sppThunnus alalunga  8.100  8.100 40.762  &lt; 2e-16 ***
## s(long):sppThunnus albacares 8.020  8.020 23.551  &lt; 2e-16 ***
## s(long):sppThunnus obesus    8.010  8.010 52.744  &lt; 2e-16 ***
## s(fork):sppThunnus alalunga  3.660  3.660  8.713 1.64e-05 ***
## s(fork):sppThunnus albacares 6.447  6.447 14.814  &lt; 2e-16 ***
## s(fork):sppThunnus obesus    7.625  7.625  4.212 4.67e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  -0.0545   
##   Scale est. = 0.48822   n = 3168</code></pre>
<p>Examine the smoothers:</p>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1607-1"><a href="mod-07.html#cb1607-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 predictors * 3 species = 9 panels</span></span>
<span id="cb1607-2"><a href="mod-07.html#cb1607-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note use of mfcol to fill by column,</span></span>
<span id="cb1607-3"><a href="mod-07.html#cb1607-3" aria-hidden="true" tabindex="-1"></a><span class="co"># so species are rows and predictors are columns</span></span>
<span id="cb1607-4"><a href="mod-07.html#cb1607-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb1607-5"><a href="mod-07.html#cb1607-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod04<span class="sc">$</span>gam)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-712-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>The plots produced by plotting a <code>$gam</code> output show the effect of each smoother, not the actual predicted <em>y</em> value. The predicted value for an observation is obtained by adding the intercept to the effect of each smoother (this is what the “additive” in “additive model” means). For your manuscript, you probably want to show model predictions on the original data scale. The method below should work for most situations.</p>
<p>In the past, we’ve predicted response variables with single continuous predictor variables. For this example, we have 3 continuous predictors. The usual strategy a situation with &gt;1 continuous predictor is to present model predictions for each predictor with the other predictors held at their median. This makes the bookkeeping a little complicated, but the final graph is well worth the effort.</p>
<div class="sourceCode" id="cb1608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1608-1"><a href="mod-07.html#cb1608-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of x values for prediction</span></span>
<span id="cb1608-2"><a href="mod-07.html#cb1608-2" aria-hidden="true" tabindex="-1"></a>pn <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1608-3"><a href="mod-07.html#cb1608-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-4"><a href="mod-07.html#cb1608-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sequence of each x value acros its domain</span></span>
<span id="cb1608-5"><a href="mod-07.html#cb1608-5" aria-hidden="true" tabindex="-1"></a>px1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>lat), <span class="fu">max</span>(dat<span class="sc">$</span>lat), <span class="at">length=</span>pn)</span>
<span id="cb1608-6"><a href="mod-07.html#cb1608-6" aria-hidden="true" tabindex="-1"></a>px2 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>long), <span class="fu">max</span>(dat<span class="sc">$</span>long), <span class="at">length=</span>pn)</span>
<span id="cb1608-7"><a href="mod-07.html#cb1608-7" aria-hidden="true" tabindex="-1"></a>px3 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(dat<span class="sc">$</span>fork, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb1608-8"><a href="mod-07.html#cb1608-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(dat<span class="sc">$</span>fork, <span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="at">length=</span>pn)</span>
<span id="cb1608-9"><a href="mod-07.html#cb1608-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-10"><a href="mod-07.html#cb1608-10" aria-hidden="true" tabindex="-1"></a><span class="co"># data frame of all factors and an index for row number (z)</span></span>
<span id="cb1608-11"><a href="mod-07.html#cb1608-11" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">ocean=</span><span class="cn">NA</span>, <span class="at">spp=</span>spps, <span class="at">z=</span><span class="dv">1</span><span class="sc">:</span>pn)</span>
<span id="cb1608-12"><a href="mod-07.html#cb1608-12" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> dx[<span class="fu">order</span>(dx<span class="sc">$</span>ocean, dx<span class="sc">$</span>spp, dx<span class="sc">$</span>z),]</span>
<span id="cb1608-13"><a href="mod-07.html#cb1608-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-14"><a href="mod-07.html#cb1608-14" aria-hidden="true" tabindex="-1"></a><span class="co"># add median of each predictor to dx</span></span>
<span id="cb1608-15"><a href="mod-07.html#cb1608-15" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>lat <span class="ot">&lt;-</span> <span class="fu">median</span>(dat<span class="sc">$</span>lat)</span>
<span id="cb1608-16"><a href="mod-07.html#cb1608-16" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>long <span class="ot">&lt;-</span> <span class="fu">median</span>(dat<span class="sc">$</span>long)</span>
<span id="cb1608-17"><a href="mod-07.html#cb1608-17" aria-hidden="true" tabindex="-1"></a>dx<span class="sc">$</span>fork <span class="ot">&lt;-</span> <span class="fu">median</span>(dat<span class="sc">$</span>fork, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb1608-18"><a href="mod-07.html#cb1608-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-19"><a href="mod-07.html#cb1608-19" aria-hidden="true" tabindex="-1"></a><span class="co"># need separate data frame of predictions for</span></span>
<span id="cb1608-20"><a href="mod-07.html#cb1608-20" aria-hidden="true" tabindex="-1"></a><span class="co"># each predictor</span></span>
<span id="cb1608-21"><a href="mod-07.html#cb1608-21" aria-hidden="true" tabindex="-1"></a>dx1 <span class="ot">&lt;-</span> dx</span>
<span id="cb1608-22"><a href="mod-07.html#cb1608-22" aria-hidden="true" tabindex="-1"></a>dx2 <span class="ot">&lt;-</span> dx</span>
<span id="cb1608-23"><a href="mod-07.html#cb1608-23" aria-hidden="true" tabindex="-1"></a>dx3 <span class="ot">&lt;-</span> dx</span>
<span id="cb1608-24"><a href="mod-07.html#cb1608-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-25"><a href="mod-07.html#cb1608-25" aria-hidden="true" tabindex="-1"></a><span class="co"># in each prediction data frame, assign ONE of</span></span>
<span id="cb1608-26"><a href="mod-07.html#cb1608-26" aria-hidden="true" tabindex="-1"></a><span class="co"># the predictors its sequence of values, leaving</span></span>
<span id="cb1608-27"><a href="mod-07.html#cb1608-27" aria-hidden="true" tabindex="-1"></a><span class="co"># other predictors at their median.</span></span>
<span id="cb1608-28"><a href="mod-07.html#cb1608-28" aria-hidden="true" tabindex="-1"></a><span class="do">## works because of recycling rule:</span></span>
<span id="cb1608-29"><a href="mod-07.html#cb1608-29" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>lat <span class="ot">&lt;-</span> px1</span>
<span id="cb1608-30"><a href="mod-07.html#cb1608-30" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>long <span class="ot">&lt;-</span> px2</span>
<span id="cb1608-31"><a href="mod-07.html#cb1608-31" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>fork <span class="ot">&lt;-</span> px3</span>
<span id="cb1608-32"><a href="mod-07.html#cb1608-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-33"><a href="mod-07.html#cb1608-33" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate predictions</span></span>
<span id="cb1608-34"><a href="mod-07.html#cb1608-34" aria-hidden="true" tabindex="-1"></a>pred1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod04<span class="sc">$</span>gam, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx1),</span>
<span id="cb1608-35"><a href="mod-07.html#cb1608-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1608-36"><a href="mod-07.html#cb1608-36" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod04<span class="sc">$</span>gam, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx2),</span>
<span id="cb1608-37"><a href="mod-07.html#cb1608-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1608-38"><a href="mod-07.html#cb1608-38" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod04<span class="sc">$</span>gam, <span class="at">newdata=</span><span class="fu">data.frame</span>(dx3), </span>
<span id="cb1608-39"><a href="mod-07.html#cb1608-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">type=</span><span class="st">&quot;link&quot;</span>, <span class="at">se.fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb1608-40"><a href="mod-07.html#cb1608-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-41"><a href="mod-07.html#cb1608-41" aria-hidden="true" tabindex="-1"></a><span class="co"># add predictions and SE to data frames</span></span>
<span id="cb1608-42"><a href="mod-07.html#cb1608-42" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>mu <span class="ot">&lt;-</span> pred1<span class="sc">$</span>fit</span>
<span id="cb1608-43"><a href="mod-07.html#cb1608-43" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>mu <span class="ot">&lt;-</span> pred2<span class="sc">$</span>fit</span>
<span id="cb1608-44"><a href="mod-07.html#cb1608-44" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>mu <span class="ot">&lt;-</span> pred3<span class="sc">$</span>fit</span>
<span id="cb1608-45"><a href="mod-07.html#cb1608-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-46"><a href="mod-07.html#cb1608-46" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>se <span class="ot">&lt;-</span> pred1<span class="sc">$</span>se.fit</span>
<span id="cb1608-47"><a href="mod-07.html#cb1608-47" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>se <span class="ot">&lt;-</span> pred2<span class="sc">$</span>se.fit</span>
<span id="cb1608-48"><a href="mod-07.html#cb1608-48" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>se <span class="ot">&lt;-</span> pred3<span class="sc">$</span>se.fit</span>
<span id="cb1608-49"><a href="mod-07.html#cb1608-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-50"><a href="mod-07.html#cb1608-50" aria-hidden="true" tabindex="-1"></a><span class="co"># normal approximation for 95% CI</span></span>
<span id="cb1608-51"><a href="mod-07.html#cb1608-51" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.025</span>, dx1<span class="sc">$</span>mu, dx1<span class="sc">$</span>se)</span>
<span id="cb1608-52"><a href="mod-07.html#cb1608-52" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.025</span>, dx2<span class="sc">$</span>mu, dx2<span class="sc">$</span>se)</span>
<span id="cb1608-53"><a href="mod-07.html#cb1608-53" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>lo <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.025</span>, dx3<span class="sc">$</span>mu, dx3<span class="sc">$</span>se)</span>
<span id="cb1608-54"><a href="mod-07.html#cb1608-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-55"><a href="mod-07.html#cb1608-55" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>mn <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.5</span>, dx1<span class="sc">$</span>mu, dx1<span class="sc">$</span>se)</span>
<span id="cb1608-56"><a href="mod-07.html#cb1608-56" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>mn <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.5</span>, dx2<span class="sc">$</span>mu, dx2<span class="sc">$</span>se)</span>
<span id="cb1608-57"><a href="mod-07.html#cb1608-57" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>mn <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.5</span>, dx3<span class="sc">$</span>mu, dx3<span class="sc">$</span>se)</span>
<span id="cb1608-58"><a href="mod-07.html#cb1608-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-59"><a href="mod-07.html#cb1608-59" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.975</span>, dx1<span class="sc">$</span>mu, dx1<span class="sc">$</span>se)</span>
<span id="cb1608-60"><a href="mod-07.html#cb1608-60" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.975</span>, dx2<span class="sc">$</span>mu, dx2<span class="sc">$</span>se)</span>
<span id="cb1608-61"><a href="mod-07.html#cb1608-61" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>up <span class="ot">&lt;-</span> <span class="fu">qlnorm</span>(<span class="fl">0.975</span>, dx3<span class="sc">$</span>mu, dx3<span class="sc">$</span>se)</span>
<span id="cb1608-62"><a href="mod-07.html#cb1608-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-63"><a href="mod-07.html#cb1608-63" aria-hidden="true" tabindex="-1"></a><span class="co"># add variable &quot;panel&quot; to help organize the plot later</span></span>
<span id="cb1608-64"><a href="mod-07.html#cb1608-64" aria-hidden="true" tabindex="-1"></a>dx1<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each=</span>pn)</span>
<span id="cb1608-65"><a href="mod-07.html#cb1608-65" aria-hidden="true" tabindex="-1"></a>dx2<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">each=</span>pn)</span>
<span id="cb1608-66"><a href="mod-07.html#cb1608-66" aria-hidden="true" tabindex="-1"></a>dx3<span class="sc">$</span>panel <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">each=</span>pn)</span>
<span id="cb1608-67"><a href="mod-07.html#cb1608-67" aria-hidden="true" tabindex="-1"></a>dz <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dx1, dx2, dx3)</span>
<span id="cb1608-68"><a href="mod-07.html#cb1608-68" aria-hidden="true" tabindex="-1"></a>dz <span class="ot">&lt;-</span> dz[<span class="fu">order</span>(dz<span class="sc">$</span>panel),]</span></code></pre></div>
<p>Next we make the plot.</p>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1609-1"><a href="mod-07.html#cb1609-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helps with bookkeeping</span></span>
<span id="cb1609-2"><a href="mod-07.html#cb1609-2" aria-hidden="true" tabindex="-1"></a>pan.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">panel=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, </span>
<span id="cb1609-3"><a href="mod-07.html#cb1609-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">con=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;lat&quot;</span>, <span class="st">&quot;long&quot;</span>, <span class="st">&quot;fork&quot;</span>), <span class="at">each=</span><span class="dv">3</span>),</span>
<span id="cb1609-4"><a href="mod-07.html#cb1609-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">spp=</span><span class="fu">rep</span>(spps, <span class="at">times=</span><span class="dv">3</span>))</span>
<span id="cb1609-5"><a href="mod-07.html#cb1609-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1609-6"><a href="mod-07.html#cb1609-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">5.1</span>, <span class="fl">1.1</span>, <span class="fl">1.1</span>),</span>
<span id="cb1609-7"><a href="mod-07.html#cb1609-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, <span class="at">las=</span><span class="dv">1</span>)</span>
<span id="cb1609-8"><a href="mod-07.html#cb1609-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb1609-9"><a href="mod-07.html#cb1609-9" aria-hidden="true" tabindex="-1"></a>    flag <span class="ot">&lt;-</span> <span class="fu">which</span>(dz<span class="sc">$</span>panel <span class="sc">==</span> i)</span>
<span id="cb1609-10"><a href="mod-07.html#cb1609-10" aria-hidden="true" tabindex="-1"></a>    zi <span class="ot">&lt;-</span> dz[flag,]</span>
<span id="cb1609-11"><a href="mod-07.html#cb1609-11" aria-hidden="true" tabindex="-1"></a>    xvar <span class="ot">&lt;-</span> pan.df<span class="sc">$</span>con[i]</span>
<span id="cb1609-12"><a href="mod-07.html#cb1609-12" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> zi[,xvar]</span>
<span id="cb1609-13"><a href="mod-07.html#cb1609-13" aria-hidden="true" tabindex="-1"></a>    sppi <span class="ot">&lt;-</span> pan.df<span class="sc">$</span>spp[i]</span>
<span id="cb1609-14"><a href="mod-07.html#cb1609-14" aria-hidden="true" tabindex="-1"></a>    di <span class="ot">&lt;-</span> dat[<span class="fu">which</span>(dat<span class="sc">$</span>species <span class="sc">==</span> sppi),]</span>
<span id="cb1609-15"><a href="mod-07.html#cb1609-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1609-16"><a href="mod-07.html#cb1609-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(xvar <span class="sc">==</span> <span class="st">&quot;lat&quot;</span>){</span>
<span id="cb1609-17"><a href="mod-07.html#cb1609-17" aria-hidden="true" tabindex="-1"></a>        use.xlab <span class="ot">&lt;-</span> <span class="fu">expression</span>(Latitude<span class="sc">~</span>(degree<span class="sc">*</span>N))</span>
<span id="cb1609-18"><a href="mod-07.html#cb1609-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1609-19"><a href="mod-07.html#cb1609-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(xvar <span class="sc">==</span> <span class="st">&quot;long&quot;</span>){</span>
<span id="cb1609-20"><a href="mod-07.html#cb1609-20" aria-hidden="true" tabindex="-1"></a>        use.xlab <span class="ot">&lt;-</span> <span class="fu">expression</span>(Longitude<span class="sc">~</span>(degree<span class="sc">*</span>E))</span>
<span id="cb1609-21"><a href="mod-07.html#cb1609-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1609-22"><a href="mod-07.html#cb1609-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(xvar <span class="sc">==</span> <span class="st">&quot;fork&quot;</span>){</span>
<span id="cb1609-23"><a href="mod-07.html#cb1609-23" aria-hidden="true" tabindex="-1"></a>        use.xlab <span class="ot">&lt;-</span> <span class="st">&quot;Fork length (cm)&quot;</span></span>
<span id="cb1609-24"><a href="mod-07.html#cb1609-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1609-25"><a href="mod-07.html#cb1609-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(di[,xvar], di<span class="sc">$</span>tp, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">&quot;#00000020&quot;</span>,</span>
<span id="cb1609-26"><a href="mod-07.html#cb1609-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">16</span>), <span class="at">xlab=</span>use.xlab,</span>
<span id="cb1609-27"><a href="mod-07.html#cb1609-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">&quot;Trophic level (unitless)&quot;</span>)</span>
<span id="cb1609-28"><a href="mod-07.html#cb1609-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x, zi<span class="sc">$</span>mn, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1609-29"><a href="mod-07.html#cb1609-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x, zi<span class="sc">$</span>lo, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1609-30"><a href="mod-07.html#cb1609-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x, zi<span class="sc">$</span>up, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb1609-31"><a href="mod-07.html#cb1609-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title</span>(<span class="at">main=</span>pan.df<span class="sc">$</span>spp[i], <span class="at">adj=</span><span class="dv">0</span>, <span class="at">font.main=</span><span class="dv">3</span>)</span>
<span id="cb1609-32"><a href="mod-07.html#cb1609-32" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-714-1.png" width="864" style="display: block; margin: auto;" /></p>
<p>The fitted smoothers are pretty good for some species and predictors, but not so much for others. Refinement of the analysis should involve revisiting what distribution to use and what random effects structure to include in the model. Fiddling with the options for fitting smoothers (see <code>?s</code>) might help as well.</p>

</div>
</div>
</div>
<h3>Literature Cited</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-bodin2021" class="csl-entry">
Bodin, N., H. Pethybridge, L. M. Duffy, A. Lorrain, V. Allain, J. M. Logan, F. Ménard, B. Graham, C. A. Choy, C. J. Somes, R. J. Olson, and J. W. Young. 2021. <a href="https://doi.org/10.1002/ecy.3265">Global data set for nitrogen and carbon stable isotopes of tunas</a>. Ecology 102:e03265.
</div>
<div id="ref-bolker2008ecological" class="csl-entry">
Bolker, B. M. 2008. Ecological models and data in <span>R</span>. Princeton University Press, Princeton, New Jersey, USA.
</div>
<div id="ref-kery2002" class="csl-entry">
Kéry, M. 2002. Inferring the absence of a species: <span class="nocase">a</span> case study of snakes. The Journal of <span>W</span>ildlife <span>M</span>anagement:330–338.
</div>
<div id="ref-kery2010" class="csl-entry">
Kéry, M. 2010. Introduction to <span>W</span>in<span>BUGS</span> for ecologists: <span>B</span>ayesian approach to regression, <span>ANOVA</span>, mixed models and related analyses. Academic Press.
</div>
<div id="ref-kirchman2009microbial" class="csl-entry">
Kirchman, D. L., X. A. G. Morán, and H. Ducklow. 2009. Microbial growth in the polar oceans—role of temperature and potential impact of climate change. Nature <span>R</span>eviews <span>M</span>icrobiology 7:451–459.
</div>
<div id="ref-JSSv082i13" class="csl-entry">
Kuznetsova, A., P. B. Brockhoff, and R. H. B. Christensen. 2017. <a href="https://doi.org/10.18637/jss.v082.i13"><span class="nocase">l</span>mer<span>T</span>est package: Tests in linear mixed effects models</a>. Journal of Statistical Software 82:1–26.
</div>
<div id="ref-pethybridge2018" class="csl-entry">
Pethybridge, H., C. A. Choy, J. M. Logan, V. Allain, A. Lorrain, N. Bodin, C. J. Somes, J. Young, F. Ménard, C. Langlais, L. Duffy, A. J. Hobday, P. Kuhnert, B. Fry, C. Menkes, and R. J. Olson. 2018. <a href="https://doi.org/10.1111/geb.12763">A global meta-analysis of marine predator nitrogen stable isotopes: Relationships between trophic structure and environmental conditions</a>. Global Ecology and Biogeography 27:1043–1055.
</div>
<div id="ref-plummer2003jags" class="csl-entry">
Plummer, M. 2003. <span>JAGS</span>: A program for analysis of <span>B</span>ayesian graphical models using <span>G</span>ibbs sampling. Pages 1–10 Proceedings of the 3rd international workshop on distributed statistical computing. Vienna, Austria.
</div>
<div id="ref-plummer2021" class="csl-entry">
Plummer, M. 2021. <a href="https://CRAN.R-project.org/package=rjags"><span class="nocase">r</span>jags: <span>B</span>ayesian graphical models using <span>MCMC</span></a>.
</div>
<div id="ref-su2021" class="csl-entry">
Su, Y.-S., and Masanao Yajima. 2021. <a href="https://CRAN.R-project.org/package=R2jags"><span>R2</span>jags: Using <span>R</span> to run ’<span>JAGS</span>’</a>.
</div>
<div id="ref-vicente2005" class="csl-entry">
Vicente, J., Y. Fierro, and C. Gortazar. 2005. <a href="https://doi.org/10.1007/s00436-004-1255-9">Seasonal dynamics of the fecal excretion of <em><span>E</span>laphostrongylus cervi</em> (<span>N</span>ematoda, <span>M</span>etastrongyloidea) first-stage larvae in <span>I</span>berian red deer (<em><span>C</span>ervus elaphus hispanicus) from southern <span>S</span>pain</em></a>. Parasitology Research 95:60–64.
</div>
<div id="ref-werner2014" class="csl-entry">
Werner, J., and E. M. Griebeler. 2014. <a href="https://doi.org/10.1371/journal.pone.0088834">Allometries of maximum growth rate versus body mass at maximum growth indicate that non-avian dinosaurs had growth rates typical of fast growing ectothermic sauropsids</a>. <span>PloS</span> <span>ONE</span> 9:e88834.
</div>
<div id="ref-wood2017generalized" class="csl-entry">
Wood, S. N. 2017. Generalized additive models: An introduction with <span>R</span>. 2nd edition. CRC press.
</div>
<div id="ref-zuur2009mixed" class="csl-entry">
Zuur, A. F., E. N. Ieno, N. J. Walker, A. A. Saveliev, G. M. Smith, and others. 2009a. Mixed effects models and extensions in ecology with <span>R</span>. Springer, New York.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mod-06.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mod-08.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
